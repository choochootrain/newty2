function JSCompiler_unstubMethod(a,b){return JSCompiler_stubMap[a]=b}goog.structs.Map.prototype.toObject=JSCompiler_unstubMethod(20,function(){this.cleanupKeysArray_();for(var a={},b=0;b<this.keys_.length;b++){var c=this.keys_[b];a[c]=this.map_[c]}return a});fyre.conv.LivefyreAuthDelegate.prototype.logout=JSCompiler_unstubMethod(19,function(a){this.backend.addCallback(function(b){b.logout(a)})});fyre.conv.SPAuthDelegate.prototype.logout=JSCompiler_unstubMethod(18,function(a){this.backend.addCallback(function(b){b.logout(a)})});
fyre.conv.BackplaneAuthDelegate.prototype.logout=JSCompiler_unstubMethod(17,function(a){this.backend.addCallback(function(b){b.logout(a)})});fyre.conv.RemoteAuthDelegate.prototype.logout=JSCompiler_unstubMethod(16,function(a){this.backend.addCallback(function(b){b.logout(a)})});fyre.conv.SPAuthDelegate.prototype.login=JSCompiler_unstubMethod(15,function(a){this.backend.addCallback(function(b){b.login(a)})});fyre.conv.BackplaneAuthDelegate.prototype.login=JSCompiler_unstubMethod(14,function(a){this.backend.addCallback(function(b){b.login(a)})});
fyre.conv.RemoteAuthDelegate.prototype.login=JSCompiler_unstubMethod(13,function(a){this.backend.addCallback(function(b){b.login(a)})});fyre.conv.BackplaneAuthDelegate.prototype.logoutInternal=JSCompiler_unstubMethod(12,function(){this.backend.addCallback(function(a){a.logoutInternal()})});fyre.conv.LivefyreAuthDelegate.prototype.editProfile=JSCompiler_unstubMethod(11,function(a,b){this.backend.addCallback(function(c){c.editProfile(a,b)})});
fyre.conv.SPAuthDelegate.prototype.editProfile=JSCompiler_unstubMethod(10,function(a){this.backend.addCallback(function(b){b.editProfile(a)})});fyre.conv.BackplaneAuthDelegate.prototype.editProfile=JSCompiler_unstubMethod(9,function(a){this.backend.addCallback(function(b){b.editProfile(a)})});fyre.conv.LivefyreAuthDelegate.prototype.viewProfile=JSCompiler_unstubMethod(8,function(a,b){this.backend.addCallback(function(c){c.viewProfile(a,b)})});
fyre.conv.SPAuthDelegate.prototype.viewProfile=JSCompiler_unstubMethod(7,function(a,b){this.backend.addCallback(function(c){c.viewProfile(a,b)})});fyre.conv.BackplaneAuthDelegate.prototype.viewProfile=JSCompiler_unstubMethod(6,function(a,b){this.backend.addCallback(function(c){c.viewProfile(a,b)})});goog.net.Jsonp.prototype.setRequestTimeout=JSCompiler_unstubMethod(5,function(a){this.timeout_=a});fyre.conv.LivefyreAuthDelegate.prototype.loginByCookie=JSCompiler_unstubMethod(3,function(a){this.backend.addCallback(function(b){b.loginByCookie(a)})});
fyre.conv.SPAuthDelegate.prototype.loginByCookie=JSCompiler_unstubMethod(2,function(a,b){this.backend.addCallback(function(c){c.loginByCookie(a,b)})});fyre.conv.BackplaneAuthDelegate.prototype.loginByCookie=JSCompiler_unstubMethod(1,function(a,b){this.backend.addCallback(function(c){c.loginByCookie(a,b)})});fyre.conv.RemoteAuthDelegate.prototype.loginByCookie=JSCompiler_unstubMethod(0,function(a,b){this.backend.addCallback(function(c){c.loginByCookie(a,b)})});fyre.conv.app={};
fyre.conv.app.CONSTANTS={COMMENT_QUERY_PARAM:"lf_comment",NAME:"fyre.conv.app.main"};goog.disposable={};goog.disposable.IDisposable=function(){};goog.Disposable=function(){goog.Disposable.ENABLE_MONITORING&&(goog.Disposable.instances_[goog.getUid(this)]=this)};goog.Disposable.ENABLE_MONITORING=!1;goog.Disposable.instances_={};goog.Disposable.getUndisposedObjects=function(){var a=[],b;for(b in goog.Disposable.instances_)goog.Disposable.instances_.hasOwnProperty(b)&&a.push(goog.Disposable.instances_[Number(b)]);return a};goog.Disposable.clearUndisposedObjects=function(){goog.Disposable.instances_={}};goog.Disposable.prototype.disposed_=!1;
goog.Disposable.prototype.isDisposed=function(){return this.disposed_};goog.Disposable.prototype.getDisposed=goog.Disposable.prototype.isDisposed;goog.Disposable.prototype.dispose=function(){if(!this.disposed_&&(this.disposed_=!0,this.disposeInternal(),goog.Disposable.ENABLE_MONITORING)){var a=goog.getUid(this);if(!goog.Disposable.instances_.hasOwnProperty(a))throw Error(this+" did not call the goog.Disposable base constructor or was disposed of after a clearUndisposedObjects call");delete goog.Disposable.instances_[a]}};
goog.Disposable.prototype.registerDisposable=function(a){this.dependentDisposables_||(this.dependentDisposables_=[]);this.dependentDisposables_.push(a)};goog.Disposable.prototype.disposeInternal=function(){this.dependentDisposables_&&goog.disposeAll.apply(null,this.dependentDisposables_)};goog.dispose=function(a){a&&"function"==typeof a.dispose&&a.dispose()};goog.disposeAll=function(a){for(var b=0,c=arguments.length;b<c;++b){var d=arguments[b];goog.isArrayLike(d)?goog.disposeAll.apply(null,d):goog.dispose(d)}};fyre.conv.app.ExternalApp=function(a){var b=fyre.conv.app.ExternalApp.EXTERN_KEYS;this[b.CHANGE_COLLECTION]=goog.bind(a.changeCollection,a);this[b.REMOVE]=goog.bind(a.remove,a);this[b.STOP]=goog.bind(a.stop,a);this[b.ON]=goog.bind(a.on,a);goog.DEBUG&&(this.opts=a.opts,this[b.RESUME]=goog.bind(a.resume,a))};goog.inherits(fyre.conv.app.ExternalApp,goog.Disposable);fyre.conv.app.ExternalApp.EXTERN_KEYS={CHANGE_COLLECTION:"changeCollection",REMOVE:"remove",STOP:"stop",ON:"on",OFF:"off",BIND:"bind",RESUME:"resume"};
fyre.conv.app.ExternalApp.prototype.changeCollection=function(){};goog.exportProperty(fyre.conv.app.ExternalApp.prototype,fyre.conv.app.ExternalApp.EXTERN_KEYS.CHANGE_COLLECTION,fyre.conv.app.ExternalApp.prototype.changeCollection);fyre.conv.app.ExternalApp.prototype.remove=function(){};goog.exportProperty(fyre.conv.app.ExternalApp.prototype,fyre.conv.app.ExternalApp.EXTERN_KEYS.REMOVE,fyre.conv.app.ExternalApp.prototype.remove);fyre.conv.app.ExternalApp.prototype.stop=function(){};
goog.exportProperty(fyre.conv.app.ExternalApp.prototype,fyre.conv.app.ExternalApp.EXTERN_KEYS.STOP,fyre.conv.app.ExternalApp.prototype.stop);fyre.conv.app.ExternalApp.prototype.resume=function(){};goog.exportProperty(fyre.conv.app.ExternalApp.prototype,fyre.conv.app.ExternalApp.EXTERN_KEYS.RESUME,fyre.conv.app.ExternalApp.prototype.resume);fyre.conv.app.ExternalApp.prototype.on=function(){};goog.exportProperty(fyre.conv.app.ExternalApp.prototype,fyre.conv.app.ExternalApp.EXTERN_KEYS.ON,fyre.conv.app.ExternalApp.prototype.on);
fyre.conv.app.ExternalApp.prototype.bind=function(a,b){var c=Array.prototype.slice.call(arguments,1);c.unshift(this);c.unshift(a||goog.nullFunction);return goog.bind.apply(this,c)};goog.exportProperty(fyre.conv.app.ExternalApp.prototype,fyre.conv.app.ExternalApp.EXTERN_KEYS.BIND,fyre.conv.app.ExternalApp.prototype.bind);
fyre.conv.app.ExternalApp.prototype.disposeInternal=function(){fyre.conv.app.ExternalApp.superClass_.disposeInternal.call(this);var a=fyre.conv.app.ExternalApp.EXTERN_KEYS;delete this[a.CHANGE_COLLECTION];delete this[a.REMOVE];delete this[a.STOP];delete this[a.RESUME];delete this[a.ON];delete this[a.OFF]};goog.net.EventType={COMPLETE:"complete",SUCCESS:"success",ERROR:"error",ABORT:"abort",READY:"ready",READY_STATE_CHANGE:"readystatechange",TIMEOUT:"timeout",INCREMENTAL_DATA:"incrementaldata",PROGRESS:"progress"};fyre.v1.io={};fyre.v1.io.Base=function(a){var b={url:window.location.href,success:goog.nullFunction,failure:goog.nullFunction,method:"GET",timeout:30};goog.object.extend(b,a);this.url=new goog.Uri(b.url);this.success_cb=b.success||fyre.v1.util.noop;this.failure_cb=b.failure||fyre.v1.util.noop;this.method=b.method.toUpperCase();goog.asserts.assert(goog.array.contains([fyre.v1.io.POST,fyre.v1.io.GET],this.method));this.timeout=b.timeout;this.xhr=null};fyre.v1.io.WITH_CREDENTIALS="with_credentials";
fyre.v1.io.POST="POST";fyre.v1.io.GET="GET";fyre.v1.io.Base.prototype.send=goog.nullFunction;fyre.v1.io.Base.prototype.abort=function(){this.xhr&&this.xhr.abort()};fyre.v1.io.Base.prototype.success=function(a){if(a&&goog.isString(a))try{a=goog.json.unsafeParse(a)}catch(b){}this.success_cb(a)};fyre.v1.io.Base.prototype.failure=function(a){if(a&&goog.isString(a))try{a=goog.json.unsafeParse(a)}catch(b){}this.failure_cb(a)};
fyre.v1.io.Base.prototype._setGetData=function(a){var b=new goog.Uri(this.url);"GET"===this.method&&(a=goog.Uri.QueryData.createFromMap(new goog.structs.Map(a)),a.extend(b.getQueryData()),b.setQueryData(a));return b};fyre.v1.io.Base.prototype._setPostData=function(a){if("POST"===this.method)return goog.isString(a)?a:goog.isObject(a)?goog.Uri.QueryData.createFromMap(new goog.structs.Map(a)).toString():goog.json.serialize(a)};fyre.v1.io.Cors=function(a){fyre.v1.io.Base.call(this,a);this.withCredentials=fyre.v1.io.WITH_CREDENTIALS in a?a[fyre.v1.io.WITH_CREDENTIALS]:!0;this.xhr=new XMLHttpRequest};goog.inherits(fyre.v1.io.Cors,fyre.v1.io.Base);
fyre.v1.io.Cors.prototype.send=function(a,b){this.xhr.open(this.method,this._setGetData(a).toString(),!0);goog.isObject(b)&&goog.object.forEach(b,function(a,b){this.xhr.setRequestHeader(b,a)},this);this.xhr.withCredentials=this.withCredentials;this.xhr.onreadystatechange=goog.bind(this.callback,this);this.xhr.send(this._setPostData(a))};
fyre.v1.io.Cors.prototype.callback=function(){4===this.xhr.readyState&&(200===this.xhr.status||304===this.xhr.status)?this.success(this.xhr.responseText):4===this.xhr.readyState&&this.failure(this.xhr.responseText)};fyre.v1.io.IECors=function(a){fyre.v1.io.Base.call(this,a);this.xhr=new window.XDomainRequest};goog.inherits(fyre.v1.io.IECors,fyre.v1.io.Base);fyre.v1.io.IECors.prototype.send=function(a){this.xhr.open(this.method,this._setGetData(a).toString());this.xhr.onload=goog.bind(function(){this.callback("success",this.xhr.responseText)},this);this.xhr.onerror=goog.bind(function(){this.callback("failure",this.xhr.responseText)},this);this.xhr.send(this._setPostData(a))};
fyre.v1.io.IECors.prototype.callback=function(a,b){var c={};if("success"===a){try{if(c=goog.json.unsafeParse(b),200!==c.code&&304!==c.code){this.failure(b);return}}catch(d){}this.success(b)}else this.failure(b)};fyre.v1.io.Jsonp=function(a){fyre.v1.io.Base.call(this,a);this.xhr=new goog.net.Jsonp(this.url);this.xhr.setRequestTimeout(3E4);this.resp={cancel:goog.bind(this.xhr.cancel,this.xhr)}};goog.inherits(fyre.v1.io.Jsonp,fyre.v1.io.Base);fyre.v1.io.Jsonp.prototype.success_=function(a){a&&"error"==a.status?this.failure(a):this.success(a)};
fyre.v1.io.Jsonp.prototype.send=function(a){"POST"==this.method&&(goog.isString(a)&&(a={_body:a}),a._method="POST");this.xhr.uri_=this.url;a instanceof goog.structs.Map&&(a=a.toObject());this.resp=this.xhr.send(a,goog.bind(this.success_,this),goog.bind(this.failure,this))};fyre.v1.io.Jsonp.prototype.abort=function(){this.xhr.cancel(this.resp);this.failure()};fyre.v1.io.XDR=function(a){fyre.v1.io.Base.call(this,a);this.xhr=fyre.v1.io.XDR._getTransport(a);this.xhr.success=goog.bind(this.success,this);this.xhr.failure=goog.bind(this.failure,this)};goog.inherits(fyre.v1.io.XDR,fyre.v1.io.Base);fyre.v1.io.XDR.prototype.success=function(a){fyre.v1.io.XDR.superClass_.success.call(this,a)};fyre.v1.io.XDR.prototype.failure=function(a){fyre.v1.io.XDR.superClass_.failure.call(this,a)};
fyre.v1.io.XDR.prototype.send=function(a,b){this.xhr.url=this.url;this.xhr.send(a,b)};fyre.v1.io.XDR._getTransport=function(a){switch(a.transport||fyre.v1.io.XDR.TRANSPORT){case "CORS":return new fyre.v1.io.Cors(a);case "IECORS":return new fyre.v1.io.IECors(a);case "jsonp":return new fyre.v1.io.Jsonp(a);default:goog.asserts.assert("Unknown transport")}};
fyre.v1.io.XDR.TRANSPORT=function(){return 0===window.location.href.indexOf("file://")?"jsonp":window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?"CORS":"jsonp"}();fyre.v1.lib={};
fyre.v1.lib.Raven=function(){var a={VERSION:"@VERSION",loaded:!1,options:{secretKey:void 0,publicKey:void 0,servers:[],projectId:1,logger:"javascript",site:void 0,signatureUrl:void 0,fetchHeaders:!1,testMode:!1,ignoreErrors:[]},funcNameRE:/function\s*([\w\-$]+)?\s*\(/i};a.config=function(b){var c=[];if("string"===typeof b)if(0===b.indexOf("http"))b=a.parseDSN(b);else throw"Base64 encoded config is no longer supported - use DSN";goog.object.forEach(b,function(b,c){a.options[c]=b});goog.array.forEach(a.options.servers,function(b){"/"!==
b.slice(-1)&&(b+="/");c.push(b+"api/"+a.options.projectId+"/store/")});a.options.servers=c};a.parseUri=function(b){for(var c=a.parseUri.options,b=c.parser[c.strictMode?"strict":"loose"].exec(b),d={},e=14;e--;)d[c.key[e]]=b[e]||"";d[c.q.name]={};d[c.key[12]].replace(c.q.parser,function(a,b,e){b&&(d[c.q.name][b]=e)});return d};a.parseUri.options={strictMode:!1,key:"source,protocol,authority,userInfo,user,password,host,port,relative,path,directory,file,query,anchor".split(","),q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},
parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};a.parseDSN=function(b){var b=a.parseUri(b),c=b.path.lastIndexOf("/"),d;-1===c?(c=b.path.substr(1),d=""):(d=b.path.substr(1,c),c=b.path.substr(c+1));
return{servers:[b.protocol+"://"+b.host+":"+b.port+"/"+d],publicKey:b.user,secretKey:b.password,projectId:c}};a.getHeaders=function(){var a={};a.Referer=document.referrer;a["User-Agent"]=navigator.userAgent;return a};a.parseHeaders=function(a){var c={};goog.array.forEach(a.split("\n"),function(a){var b=a.slice(0,a.indexOf(":")),a=a.slice(a.indexOf(":")+2);c[b]=a});return c};a.getSignature=function(b,c,d){a.options.signatureUrl?(new fyre.v1.io.XDR({method:"POST",success:function(a){d(a.signature)},
url:a.options.signatureUrl})).send({message:b,timestamp:c}):d()};a.getAuthHeader=function(b,c){var d;d="Sentry sentry_version=2.0, "+("sentry_timestamp="+c+", ")+("sentry_client=raven-js/"+a.VERSION);a.options.publicKey&&(d+=", sentry_key="+a.options.publicKey);b&&(d+=", sentry_signature="+b);return d};a.captureException=function(b){var c,d,e;b.line?c=b.line:b.lineNumber&&(c=b.lineNumber);b.sourceURL?e=b.sourceURL:b.fileName&&(e=b.fileName);b.arguments&&b.stack?d=this.chromeTraceback(b):b.stack?d=
-1==b.stack.indexOf("@")?this.chromeTraceback(b):this.firefoxTraceback(b):(d=[{filename:e,lineno:c}],d=d.concat(this.otherTraceback(arguments.callee)));a.process(b,e,c,d)};a.captureMessage=function(b){a.process(b)};a.trimString=function(a){return a.replace(/^\s+|\s+$/g,"")};a.chromeTraceback=function(b){var c,d,e,f,g=[],b=b.stack.split("\n");goog.array.forEach(b.slice(1),function(b){c=a.trimString(b).slice(3);"unknown source"!=c&&(c=c.split(" "),2<c.length?(d=c[0],e=c.slice(1).join(" "),f="(unknown)"):
2==c.length?(d=c[0],e=c[1]):(d="(unknown)",e=c[0]),e&&"(unknown source)"!=e&&(e="("==e.slice(0,1)?e.slice(1,-1).split(":"):e.split(":"),f=e.slice(-2)[0],e=e.slice(0,-2).join(":")),g.push({"function":d,filename:e,lineno:f}))});return g};a.firefoxTraceback=function(a){var c,d,e,f,g,h=[],a=a.stack.split("\n");goog.array.forEach(a,function(a){a&&(c=a.split("@"),c[0]?(d=c[0].split("("),e=")"!=d[1]?d[1].slice(0,-1).split(","):void 0,d=d[0]?d[0]:"(unknown)"):d="(unknown)",f=c[1].split(":"),g=f.slice(-1)[0],
f=f.slice(0,-1).join(":"),h.push({"function":d,filename:f,lineno:g,vars:{arguments:e}}))});return h};a.otherTraceback=function(a){for(var c,d,e=[];a&&9>e.length;)c=a.name||(this.funcNameRE.test(a.toString())?goog.global.RegExp.$1||"<anonymous>":"<anonymous>"),d=a.arguments?this.stringifyArguments(a.arguments):void 0,e.push({filename:"(unknown source)",lineno:"(unknown)","function":c,post_context:a.toString().split("\n"),vars:{arguments:d}}),a=a.caller;return e};a.stringifyArguments=function(a){var c,
d=this,e=[];goog.array.forEach(a,function(a){void 0===a?e.push("undefined"):null===a?e.push("null"):a instanceof Array?e.push(d.stringifyArguments(a)):a.constructor?(c=a.constructor.name||(d.funcNameRE.test(a.constructor.toString())?goog.global.RegExp.$1||"<unknown>":"<unknown>"),"String"==c?e.push('"'+a+'"'):"Number"==c||"Date"==c?e.push(a):"Boolean"==c?e.push(a?"true":"false"):e.push(c)):e.push("<unknown>")});return e};a.process=function(b,c,d,e,f){var g,h,i,j=window.location.origin+window.location.pathname,
k=window.location.search.slice(1);"object"===typeof b&&(i=b.name,b=b.message);goog.array.contains(a.options.ignoreErrors,b)||(e?(g={frames:e},c=c||e[0].filename):c&&(g={frames:[{filename:c,lineno:d}]}),c={message:d?b+" at "+d:b,culprit:c,project:a.options.projectId,logger:a.options.logger,site:a.options.site},g&&(c["sentry.interfaces.Stacktrace"]=g),i&&(c["sentry.interfaces.Exception"]={type:i,value:b}),a.options.testMode||(c["sentry.interfaces.Http"]={url:j,querystring:k,headers:a.getHeaders()}),
f=f||(new Date).getTime(),h=goog.json.serialize(c),a.getSignature(h,f,function(b){var c=a.getAuthHeader(b,f);goog.array.forEach(a.options.servers,function(a){a=new fyre.v1.io.XDR({method:"POST",url:a});a.xhr.withCredentials=!1;a.send(h,{Authentication:c,"Content-Type":"application/json","X-Sentry-Auth":c})})}))};return a}();goog.structs.Collection=function(){};goog.structs.Set=function(a){this.map_=new goog.structs.Map;a&&this.addAll(a)};goog.structs.Set.getKey_=function(a){var b=typeof a;return"object"==b&&a||"function"==b?"o"+goog.getUid(a):b.substr(0,1)+a};goog.structs.Set.prototype.getCount=function(){return this.map_.getCount()};goog.structs.Set.prototype.add=function(a){this.map_.set(goog.structs.Set.getKey_(a),a)};goog.structs.Set.prototype.addAll=function(a){for(var a=goog.structs.getValues(a),b=a.length,c=0;c<b;c++)this.add(a[c])};
goog.structs.Set.prototype.removeAll=function(a){for(var a=goog.structs.getValues(a),b=a.length,c=0;c<b;c++)this.remove(a[c])};goog.structs.Set.prototype.remove=function(a){return this.map_.remove(goog.structs.Set.getKey_(a))};goog.structs.Set.prototype.clear=function(){this.map_.clear()};goog.structs.Set.prototype.isEmpty=function(){return this.map_.isEmpty()};goog.structs.Set.prototype.contains=function(a){return this.map_.containsKey(goog.structs.Set.getKey_(a))};
goog.structs.Set.prototype.containsAll=function(a){return goog.structs.every(a,this.contains,this)};goog.structs.Set.prototype.intersection=function(a){for(var b=new goog.structs.Set,a=goog.structs.getValues(a),c=0;c<a.length;c++){var d=a[c];this.contains(d)&&b.add(d)}return b};goog.structs.Set.prototype.difference=function(a){var b=this.clone();b.removeAll(a);return b};goog.structs.Set.prototype.getValues=function(){return this.map_.getValues()};goog.structs.Set.prototype.clone=function(){return new goog.structs.Set(this)};
goog.structs.Set.prototype.equals=function(a){return this.getCount()==goog.structs.getCount(a)&&this.isSubsetOf(a)};goog.structs.Set.prototype.isSubsetOf=function(a){var b=goog.structs.getCount(a);if(this.getCount()>b)return!1;!(a instanceof goog.structs.Set)&&5<b&&(a=new goog.structs.Set(a));return goog.structs.every(this,function(b){return goog.structs.contains(a,b)})};goog.structs.Set.prototype.__iterator__=function(){return this.map_.__iterator__(!1)};goog.debug.catchErrors=function(a,b,c){var c=c||goog.global,d=c.onerror,e=!!b;goog.userAgent.WEBKIT&&!goog.userAgent.isVersion("535.3")&&(e=!e);c.onerror=function(b,c,h){d&&d(b,c,h);a({message:b,fileName:c,line:h});return e}};goog.debug.expose=function(a,b){if("undefined"==typeof a)return"undefined";if(null==a)return"NULL";var c=[],d;for(d in a)if(b||!goog.isFunction(a[d])){var e=d+" = ";try{e+=a[d]}catch(f){e+="*** "+f+" ***"}c.push(e)}return c.join("\n")};
goog.debug.deepExpose=function(a,b){var c=new goog.structs.Set,d=[],e=function(a,g){var h=g+"  ";try{if(goog.isDef(a))if(goog.isNull(a))d.push("NULL");else if(goog.isString(a))d.push('"'+a.replace(/\n/g,"\n"+g)+'"');else if(goog.isFunction(a))d.push((""+a).replace(/\n/g,"\n"+g));else if(goog.isObject(a))if(c.contains(a))d.push("*** reference loop detected ***");else{c.add(a);d.push("{");for(var i in a)if(b||!goog.isFunction(a[i]))d.push("\n"),d.push(h),d.push(i+" = "),e(a[i],h);d.push("\n"+g+"}")}else d.push(a);
else d.push("undefined")}catch(j){d.push("*** "+j+" ***")}};e(a,"");return d.join("")};goog.debug.exposeArray=function(a){for(var b=[],c=0;c<a.length;c++)goog.isArray(a[c])?b.push(goog.debug.exposeArray(a[c])):b.push(a[c]);return"[ "+b.join(", ")+" ]"};
goog.debug.exposeException=function(a,b){try{var c=goog.debug.normalizeErrorObject(a);return"Message: "+goog.string.htmlEscape(c.message)+'\nUrl: <a href="view-source:'+c.fileName+'" target="_new">'+c.fileName+"</a>\nLine: "+c.lineNumber+"\n\nBrowser stack:\n"+goog.string.htmlEscape(c.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+goog.string.htmlEscape(goog.debug.getStacktrace(b)+"-> ")}catch(d){return"Exception trying to expose exception! You win, we lose. "+d}};
goog.debug.normalizeErrorObject=function(a){var b=goog.getObjectByName("window.location.href");if(goog.isString(a))return{message:a,name:"Unknown error",lineNumber:"Not available",fileName:b,stack:"Not available"};var c,d,e=!1;try{c=a.lineNumber||a.line||"Not available"}catch(f){c="Not available",e=!0}try{d=a.fileName||a.filename||a.sourceURL||b}catch(g){d="Not available",e=!0}return e||!a.lineNumber||!a.fileName||!a.stack?{message:a.message,name:a.name,lineNumber:c,fileName:d,stack:a.stack||"Not available"}:
a};goog.debug.enhanceError=function(a,b){var c="string"==typeof a?Error(a):a;c.stack||(c.stack=goog.debug.getStacktrace(arguments.callee.caller));if(b){for(var d=0;c["message"+d];)++d;c["message"+d]=""+b}return c};
goog.debug.getStacktraceSimple=function(a){for(var b=[],c=arguments.callee.caller,d=0;c&&(!a||d<a);){b.push(goog.debug.getFunctionName(c));b.push("()\n");try{c=c.caller}catch(e){b.push("[exception trying to get caller]\n");break}d++;if(d>=goog.debug.MAX_STACK_DEPTH){b.push("[...long stack...]");break}}a&&d>=a?b.push("[...reached max depth limit...]"):b.push("[end]");return b.join("")};goog.debug.MAX_STACK_DEPTH=50;
goog.debug.getStacktrace=function(a){return goog.debug.getStacktraceHelper_(a||arguments.callee.caller,[])};
goog.debug.getStacktraceHelper_=function(a,b){var c=[];if(goog.array.contains(b,a))c.push("[...circular reference...]");else if(a&&b.length<goog.debug.MAX_STACK_DEPTH){c.push(goog.debug.getFunctionName(a)+"(");for(var d=a.arguments,e=0;e<d.length;e++){0<e&&c.push(", ");var f;f=d[e];switch(typeof f){case "object":f=f?"object":"null";break;case "string":break;case "number":f=""+f;break;case "boolean":f=f?"true":"false";break;case "function":f=(f=goog.debug.getFunctionName(f))?f:"[fn]";break;default:f=
typeof f}40<f.length&&(f=f.substr(0,40)+"...");c.push(f)}b.push(a);c.push(")\n");try{c.push(goog.debug.getStacktraceHelper_(a.caller,b))}catch(g){c.push("[exception trying to get caller]\n")}}else a?c.push("[...long stack...]"):c.push("[end]");return c.join("")};goog.debug.setFunctionResolver=function(a){goog.debug.fnNameResolver_=a};
goog.debug.getFunctionName=function(a){if(goog.debug.fnNameCache_[a])return goog.debug.fnNameCache_[a];if(goog.debug.fnNameResolver_){var b=goog.debug.fnNameResolver_(a);if(b)return goog.debug.fnNameCache_[a]=b}a=""+a;goog.debug.fnNameCache_[a]||(b=/function ([^\(]+)/.exec(a),goog.debug.fnNameCache_[a]=b?b[1]:"[Anonymous]");return goog.debug.fnNameCache_[a]};
goog.debug.makeWhitespaceVisible=function(a){return a.replace(/ /g,"[_]").replace(/\f/g,"[f]").replace(/\n/g,"[n]\n").replace(/\r/g,"[r]").replace(/\t/g,"[t]")};goog.debug.fnNameCache_={};goog.debug.LogRecord=function(a,b,c,d,e){this.reset(a,b,c,d,e)};goog.debug.LogRecord.prototype.sequenceNumber_=0;goog.debug.LogRecord.prototype.exception_=null;goog.debug.LogRecord.prototype.exceptionText_=null;goog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS=!0;goog.debug.LogRecord.nextSequenceNumber_=0;
goog.debug.LogRecord.prototype.reset=function(a,b,c,d,e){goog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS&&(this.sequenceNumber_="number"==typeof e?e:goog.debug.LogRecord.nextSequenceNumber_++);this.time_=d||goog.now();this.level_=a;this.msg_=b;this.loggerName_=c;delete this.exception_;delete this.exceptionText_};goog.debug.LogRecord.prototype.getLoggerName=function(){return this.loggerName_};goog.debug.LogRecord.prototype.getException=function(){return this.exception_};
goog.debug.LogRecord.prototype.setException=function(a){this.exception_=a};goog.debug.LogRecord.prototype.getExceptionText=function(){return this.exceptionText_};goog.debug.LogRecord.prototype.setExceptionText=function(a){this.exceptionText_=a};goog.debug.LogRecord.prototype.setLoggerName=function(a){this.loggerName_=a};goog.debug.LogRecord.prototype.getLevel=function(){return this.level_};goog.debug.LogRecord.prototype.setLevel=function(a){this.level_=a};
goog.debug.LogRecord.prototype.getMessage=function(){return this.msg_};goog.debug.LogRecord.prototype.setMessage=function(a){this.msg_=a};goog.debug.LogRecord.prototype.getMillis=function(){return this.time_};goog.debug.LogRecord.prototype.setMillis=function(a){this.time_=a};goog.debug.LogRecord.prototype.getSequenceNumber=function(){return this.sequenceNumber_};goog.debug.LogBuffer=function(){goog.asserts.assert(goog.debug.LogBuffer.isBufferingEnabled(),"Cannot use goog.debug.LogBuffer without defining goog.debug.LogBuffer.CAPACITY.");this.clear()};goog.debug.LogBuffer.getInstance=function(){goog.debug.LogBuffer.instance_||(goog.debug.LogBuffer.instance_=new goog.debug.LogBuffer);return goog.debug.LogBuffer.instance_};goog.debug.LogBuffer.CAPACITY=0;
goog.debug.LogBuffer.prototype.addRecord=function(a,b,c){var d=(this.curIndex_+1)%goog.debug.LogBuffer.CAPACITY;this.curIndex_=d;if(this.isFull_)return d=this.buffer_[d],d.reset(a,b,c),d;this.isFull_=d==goog.debug.LogBuffer.CAPACITY-1;return this.buffer_[d]=new goog.debug.LogRecord(a,b,c)};goog.debug.LogBuffer.isBufferingEnabled=function(){return 0<goog.debug.LogBuffer.CAPACITY};
goog.debug.LogBuffer.prototype.clear=function(){this.buffer_=Array(goog.debug.LogBuffer.CAPACITY);this.curIndex_=-1;this.isFull_=!1};goog.debug.LogBuffer.prototype.forEachRecord=function(a){var b=this.buffer_;if(b[0]){var c=this.curIndex_,d=this.isFull_?c:-1;do d=(d+1)%goog.debug.LogBuffer.CAPACITY,a(b[d]);while(d!=c)}};goog.debug.Logger=function(a){this.name_=a};goog.debug.Logger.prototype.parent_=null;goog.debug.Logger.prototype.level_=null;goog.debug.Logger.prototype.children_=null;goog.debug.Logger.prototype.handlers_=null;goog.debug.Logger.ENABLE_HIERARCHY=!0;goog.debug.Logger.ENABLE_HIERARCHY||(goog.debug.Logger.rootHandlers_=[]);goog.debug.Logger.Level=function(a,b){this.name=a;this.value=b};goog.debug.Logger.Level.prototype.toString=function(){return this.name};
goog.debug.Logger.Level.OFF=new goog.debug.Logger.Level("OFF",Infinity);goog.debug.Logger.Level.SHOUT=new goog.debug.Logger.Level("SHOUT",1200);goog.debug.Logger.Level.SEVERE=new goog.debug.Logger.Level("SEVERE",1E3);goog.debug.Logger.Level.WARNING=new goog.debug.Logger.Level("WARNING",900);goog.debug.Logger.Level.INFO=new goog.debug.Logger.Level("INFO",800);goog.debug.Logger.Level.CONFIG=new goog.debug.Logger.Level("CONFIG",700);goog.debug.Logger.Level.FINE=new goog.debug.Logger.Level("FINE",500);
goog.debug.Logger.Level.FINER=new goog.debug.Logger.Level("FINER",400);goog.debug.Logger.Level.FINEST=new goog.debug.Logger.Level("FINEST",300);goog.debug.Logger.Level.ALL=new goog.debug.Logger.Level("ALL",0);
goog.debug.Logger.Level.PREDEFINED_LEVELS=[goog.debug.Logger.Level.OFF,goog.debug.Logger.Level.SHOUT,goog.debug.Logger.Level.SEVERE,goog.debug.Logger.Level.WARNING,goog.debug.Logger.Level.INFO,goog.debug.Logger.Level.CONFIG,goog.debug.Logger.Level.FINE,goog.debug.Logger.Level.FINER,goog.debug.Logger.Level.FINEST,goog.debug.Logger.Level.ALL];goog.debug.Logger.Level.predefinedLevelsCache_=null;
goog.debug.Logger.Level.createPredefinedLevelsCache_=function(){goog.debug.Logger.Level.predefinedLevelsCache_={};for(var a=0,b;b=goog.debug.Logger.Level.PREDEFINED_LEVELS[a];a++)goog.debug.Logger.Level.predefinedLevelsCache_[b.value]=b,goog.debug.Logger.Level.predefinedLevelsCache_[b.name]=b};
goog.debug.Logger.Level.getPredefinedLevel=function(a){goog.debug.Logger.Level.predefinedLevelsCache_||goog.debug.Logger.Level.createPredefinedLevelsCache_();return goog.debug.Logger.Level.predefinedLevelsCache_[a]||null};
goog.debug.Logger.Level.getPredefinedLevelByValue=function(a){goog.debug.Logger.Level.predefinedLevelsCache_||goog.debug.Logger.Level.createPredefinedLevelsCache_();if(a in goog.debug.Logger.Level.predefinedLevelsCache_)return goog.debug.Logger.Level.predefinedLevelsCache_[a];for(var b=0;b<goog.debug.Logger.Level.PREDEFINED_LEVELS.length;++b){var c=goog.debug.Logger.Level.PREDEFINED_LEVELS[b];if(c.value<=a)return c}return null};goog.debug.Logger.getLogger=function(a){return goog.debug.LogManager.getLogger(a)};
goog.debug.Logger.logToProfilers=function(a){goog.global.console&&(goog.global.console.timeStamp?goog.global.console.timeStamp(a):goog.global.console.markTimeline&&goog.global.console.markTimeline(a));goog.global.msWriteProfilerMark&&goog.global.msWriteProfilerMark(a)};goog.debug.Logger.prototype.getName=function(){return this.name_};
goog.debug.Logger.prototype.addHandler=function(a){goog.debug.Logger.ENABLE_HIERARCHY?(this.handlers_||(this.handlers_=[]),this.handlers_.push(a)):(goog.asserts.assert(!this.name_,"Cannot call addHandler on a non-root logger when goog.debug.Logger.ENABLE_HIERARCHY is false."),goog.debug.Logger.rootHandlers_.push(a))};goog.debug.Logger.prototype.removeHandler=function(a){var b=goog.debug.Logger.ENABLE_HIERARCHY?this.handlers_:goog.debug.Logger.rootHandlers_;return!!b&&goog.array.remove(b,a)};
goog.debug.Logger.prototype.getParent=function(){return this.parent_};goog.debug.Logger.prototype.getChildren=function(){this.children_||(this.children_={});return this.children_};goog.debug.Logger.prototype.setLevel=function(a){goog.debug.Logger.ENABLE_HIERARCHY?this.level_=a:(goog.asserts.assert(!this.name_,"Cannot call setLevel() on a non-root logger when goog.debug.Logger.ENABLE_HIERARCHY is false."),goog.debug.Logger.rootLevel_=a)};goog.debug.Logger.prototype.getLevel=function(){return this.level_};
goog.debug.Logger.prototype.getEffectiveLevel=function(){if(!goog.debug.Logger.ENABLE_HIERARCHY)return goog.debug.Logger.rootLevel_;if(this.level_)return this.level_;if(this.parent_)return this.parent_.getEffectiveLevel();goog.asserts.fail("Root logger has no level set.");return null};goog.debug.Logger.prototype.isLoggable=function(a){return a.value>=this.getEffectiveLevel().value};goog.debug.Logger.prototype.log=function(a,b,c){this.isLoggable(a)&&this.doLogRecord_(this.getLogRecord(a,b,c))};
goog.debug.Logger.prototype.getLogRecord=function(a,b,c){var d=goog.debug.LogBuffer.isBufferingEnabled()?goog.debug.LogBuffer.getInstance().addRecord(a,b,this.name_):new goog.debug.LogRecord(a,""+b,this.name_);c&&(d.setException(c),d.setExceptionText(goog.debug.exposeException(c,arguments.callee.caller)));return d};goog.debug.Logger.prototype.shout=function(a,b){this.log(goog.debug.Logger.Level.SHOUT,a,b)};
goog.debug.Logger.prototype.severe=function(a,b){this.log(goog.debug.Logger.Level.SEVERE,a,b)};goog.debug.Logger.prototype.warning=function(a,b){this.log(goog.debug.Logger.Level.WARNING,a,b)};goog.debug.Logger.prototype.info=function(a,b){this.log(goog.debug.Logger.Level.INFO,a,b)};goog.debug.Logger.prototype.config=function(a,b){this.log(goog.debug.Logger.Level.CONFIG,a,b)};goog.debug.Logger.prototype.fine=function(a,b){this.log(goog.debug.Logger.Level.FINE,a,b)};
goog.debug.Logger.prototype.finer=function(a,b){this.log(goog.debug.Logger.Level.FINER,a,b)};goog.debug.Logger.prototype.finest=JSCompiler_stubMethod(4);goog.debug.Logger.prototype.logRecord=function(a){this.isLoggable(a.getLevel())&&this.doLogRecord_(a)};goog.debug.Logger.prototype.doLogRecord_=function(a){goog.debug.Logger.logToProfilers("log:"+a.getMessage());if(goog.debug.Logger.ENABLE_HIERARCHY)for(var b=this;b;)b.callPublish_(a),b=b.getParent();else for(var b=0,c;c=goog.debug.Logger.rootHandlers_[b++];)c(a)};
goog.debug.Logger.prototype.callPublish_=function(a){if(this.handlers_)for(var b=0,c;c=this.handlers_[b];b++)c(a)};goog.debug.Logger.prototype.setParent_=function(a){this.parent_=a};goog.debug.Logger.prototype.addChild_=function(a,b){this.getChildren()[a]=b};goog.debug.LogManager=goog.debug.LogManager||{};goog.debug.LogManager.loggers_=goog.debug.LogManager.loggers_||{};goog.debug.LogManager.rootLogger_=goog.debug.LogManager.rootLogger_||null;
goog.debug.LogManager.initialize=function(){goog.debug.LogManager.rootLogger_||(goog.debug.LogManager.rootLogger_=new goog.debug.Logger(""),goog.debug.LogManager.loggers_[""]=goog.debug.LogManager.rootLogger_,goog.debug.LogManager.rootLogger_.setLevel(goog.debug.Logger.Level.CONFIG))};goog.debug.LogManager.getLoggers=function(){return goog.debug.LogManager.loggers_};goog.debug.LogManager.getRoot=function(){goog.debug.LogManager.initialize();return goog.debug.LogManager.rootLogger_};
goog.debug.LogManager.getLogger=function(a){goog.debug.LogManager.initialize();return goog.debug.LogManager.loggers_[a]||goog.debug.LogManager.createLogger_(a)};goog.debug.LogManager.createFunctionForCatchErrors=function(a){return function(b){(a||goog.debug.LogManager.getRoot()).severe("Error: "+b.message+" ("+b.fileName+" @ Line: "+b.line+")")}};
goog.debug.LogManager.createLogger_=function(a){var b=new goog.debug.Logger(a);if(goog.debug.Logger.ENABLE_HIERARCHY){var c=a.lastIndexOf("."),d=a.substr(0,c),c=a.substr(c+1),d=goog.debug.LogManager.getLogger(d);d.addChild_(c,b);b.setParent_(d)}return goog.debug.LogManager.loggers_[a]=b};goog.debug.RelativeTimeProvider=function(){this.relativeTimeStart_=goog.now()};goog.debug.RelativeTimeProvider.defaultInstance_=new goog.debug.RelativeTimeProvider;goog.debug.RelativeTimeProvider.prototype.set=function(a){this.relativeTimeStart_=a};goog.debug.RelativeTimeProvider.prototype.reset=function(){this.set(goog.now())};goog.debug.RelativeTimeProvider.prototype.get=function(){return this.relativeTimeStart_};goog.debug.RelativeTimeProvider.getDefaultInstance=function(){return goog.debug.RelativeTimeProvider.defaultInstance_};goog.debug.Formatter=function(a){this.prefix_=a||"";this.startTimeProvider_=goog.debug.RelativeTimeProvider.getDefaultInstance()};goog.debug.Formatter.prototype.showAbsoluteTime=!0;goog.debug.Formatter.prototype.showRelativeTime=!0;goog.debug.Formatter.prototype.showLoggerName=!0;goog.debug.Formatter.prototype.showExceptionText=!1;goog.debug.Formatter.prototype.showSeverityLevel=!1;goog.debug.Formatter.prototype.setStartTimeProvider=function(a){this.startTimeProvider_=a};
goog.debug.Formatter.prototype.getStartTimeProvider=function(){return this.startTimeProvider_};goog.debug.Formatter.prototype.resetRelativeTimeStart=function(){this.startTimeProvider_.reset()};
goog.debug.Formatter.getDateTimeStamp_=function(a){a=new Date(a.getMillis());return goog.debug.Formatter.getTwoDigitString_(a.getFullYear()-2E3)+goog.debug.Formatter.getTwoDigitString_(a.getMonth()+1)+goog.debug.Formatter.getTwoDigitString_(a.getDate())+" "+goog.debug.Formatter.getTwoDigitString_(a.getHours())+":"+goog.debug.Formatter.getTwoDigitString_(a.getMinutes())+":"+goog.debug.Formatter.getTwoDigitString_(a.getSeconds())+"."+goog.debug.Formatter.getTwoDigitString_(Math.floor(a.getMilliseconds()/
10))};goog.debug.Formatter.getTwoDigitString_=function(a){return 10>a?"0"+a:""+a};goog.debug.Formatter.getRelativeTime_=function(a,b){var c=(a.getMillis()-b)/1E3,d=c.toFixed(3),e=0;if(1>c)e=2;else for(;100>c;)e++,c*=10;for(;0<e--;)d=" "+d;return d};goog.debug.HtmlFormatter=function(a){goog.debug.Formatter.call(this,a)};goog.inherits(goog.debug.HtmlFormatter,goog.debug.Formatter);goog.debug.HtmlFormatter.prototype.showExceptionText=!0;
goog.debug.HtmlFormatter.prototype.formatRecord=function(a){var b;switch(a.getLevel().value){case goog.debug.Logger.Level.SHOUT.value:b="dbg-sh";break;case goog.debug.Logger.Level.SEVERE.value:b="dbg-sev";break;case goog.debug.Logger.Level.WARNING.value:b="dbg-w";break;case goog.debug.Logger.Level.INFO.value:b="dbg-i";break;default:b="dbg-f"}var c=[];c.push(this.prefix_," ");this.showAbsoluteTime&&c.push("[",goog.debug.Formatter.getDateTimeStamp_(a),"] ");this.showRelativeTime&&c.push("[",goog.string.whitespaceEscape(goog.debug.Formatter.getRelativeTime_(a,
this.startTimeProvider_.get())),"s] ");this.showLoggerName&&c.push("[",goog.string.htmlEscape(a.getLoggerName()),"] ");c.push('<span class="',b,'">',goog.string.newLineToBr(goog.string.whitespaceEscape(goog.string.htmlEscape(a.getMessage()))));this.showExceptionText&&a.getException()&&c.push("<br>",goog.string.newLineToBr(goog.string.whitespaceEscape(a.getExceptionText()||"")));c.push("</span><br>");return c.join("")};goog.debug.TextFormatter=function(a){goog.debug.Formatter.call(this,a)};
goog.inherits(goog.debug.TextFormatter,goog.debug.Formatter);
goog.debug.TextFormatter.prototype.formatRecord=function(a){var b=[];b.push(this.prefix_," ");this.showAbsoluteTime&&b.push("[",goog.debug.Formatter.getDateTimeStamp_(a),"] ");this.showRelativeTime&&b.push("[",goog.debug.Formatter.getRelativeTime_(a,this.startTimeProvider_.get()),"s] ");this.showLoggerName&&b.push("[",a.getLoggerName(),"] ");this.showSeverityLevel&&b.push("[",a.getLevel().name,"] ");b.push(a.getMessage(),"\n");this.showExceptionText&&a.getException()&&b.push(a.getExceptionText(),
"\n");return b.join("")};goog.debug.Console=function(){this.publishHandler_=goog.bind(this.addLogRecord,this);this.formatter_=new goog.debug.TextFormatter;this.formatter_.showAbsoluteTime=!1;this.isCapturing_=this.formatter_.showExceptionText=!1;this.logBuffer_="";this.filteredLoggers_={}};goog.debug.Console.prototype.getFormatter=function(){return this.formatter_};
goog.debug.Console.prototype.setCapturing=function(a){if(a!=this.isCapturing_){var b=goog.debug.LogManager.getRoot();a?b.addHandler(this.publishHandler_):(b.removeHandler(this.publishHandler_),this.logBuffer="");this.isCapturing_=a}};
goog.debug.Console.prototype.addLogRecord=function(a){if(!this.filteredLoggers_[a.getLoggerName()]){var b=this.formatter_.formatRecord(a),c=goog.debug.Console.console_;if(c&&c.firebug)switch(a.getLevel()){case goog.debug.Logger.Level.SHOUT:c.info(b);break;case goog.debug.Logger.Level.SEVERE:c.error(b);break;case goog.debug.Logger.Level.WARNING:c.warn(b);break;default:c.debug(b)}else c?c.log(b):window.opera?window.opera.postError(b):this.logBuffer_+=b}};
goog.debug.Console.prototype.addFilter=function(a){this.filteredLoggers_[a]=!0};goog.debug.Console.prototype.removeFilter=function(a){delete this.filteredLoggers_[a]};goog.debug.Console.instance=null;goog.debug.Console.console_=window.console;goog.debug.Console.autoInstall=function(){goog.debug.Console.instance||(goog.debug.Console.instance=new goog.debug.Console);-1!=window.location.href.indexOf("Debug=true")&&goog.debug.Console.instance.setCapturing(!0)};goog.debug.Console.show=function(){alert(goog.debug.Console.instance.logBuffer_)};fyre.v1.logging={};fyre.v1.logging.CustomLogger=function(){goog.debug.Console.call(this);this.formatter_.showRelativeTime=!1;fyre.v1.lib.Raven.config(fyre.v1.config.servers.sentry_dsn)};goog.inherits(fyre.v1.logging.CustomLogger,goog.debug.Console);
fyre.v1.logging.CustomLogger.prototype.addLogRecord=function(a){fyre.v1.logging.CustomLogger.superClass_.addLogRecord.call(this,a);-1===fyre.v1.config.servers.sentry_dsn.indexOf(".livefyre.com")||a.getLevel()!==goog.debug.Logger.Level.SEVERE||"CORS"!==fyre.v1.io.XDR.TRANSPORT||(a.exception_?fyre.v1.lib.Raven.captureException(a.exception_):fyre.v1.lib.Raven.captureMessage(this.formatter_.formatRecord(a)))};
fyre.v1.logging.CustomLogger.autoInstall=function(){fyre.v1.logging.CustomLogger.instance||(fyre.v1.logging.CustomLogger.instance=new fyre.v1.logging.CustomLogger)};fyre.v1.logging.CustomLogger.show=function(){alert(fyre.v1.logging.CustomLogger.instance.logBuffer_)};goog.global.console=goog.global.console||{log:function(){},warn:function(){}};fyre.v1.logging.OFF=goog.debug.Logger.Level.OFF;fyre.v1.logging.SHOUT=goog.debug.Logger.Level.SHOUT;fyre.v1.logging.SEVERE=goog.debug.Logger.Level.SEVERE;fyre.v1.logging.WARNING=goog.debug.Logger.Level.WARNING;fyre.v1.logging.INFO=goog.debug.Logger.Level.INFO;fyre.v1.logging.CONFIG=goog.debug.Logger.Level.CONFIG;fyre.v1.logging.FINE=goog.debug.Logger.Level.FINE;fyre.v1.logging.FINER=goog.debug.Logger.Level.FINER;
fyre.v1.logging.FINEST=goog.debug.Logger.Level.FINEST;fyre.v1.logging.ALL=goog.debug.Logger.Level.ALL;fyre.v1.logging.setLevel=function(a){goog.debug.LogManager.getRoot().setLevel(a)};fyre.v1.logging.getLevel=function(){return goog.debug.LogManager.getRoot().getLevel()};fyre.v1.logging.getLogger=goog.debug.Logger.getLogger;fyre.v1.logging.setLevel(goog.debug.Logger.Level.getPredefinedLevel(fyre.v1.config.logging.level));fyre.v1.logging.errorCallback=function(){};
fyre.v1.config.servers.sentry_dsn&&(fyre.v1.logging.CustomLogger.autoInstall(),fyre.v1.logging.CustomLogger.instance.setCapturing(!0));fyre.v1.object={};fyre.v1.object.Base=function(){this.CONSTANTS=this.CONSTANTS||this.constructor.CONSTANTS;if(!arguments||!arguments[0])arguments[0]={};this.initialize.apply(this,arguments)};fyre.v1.object.Base.prototype.initialize=function(a){this.opts=a};fyre.v1.object.Base.prototype.configureLogging=function(a){this.logger=fyre.v1.logging.getLogger(a||"NO NAME")};fyre.v1.object.Base.prototype.bind=function(a,b){goog.array.splice(arguments,1,0,this);return goog.bind.apply(null,arguments)};fyre.v1.client={};fyre.v1.client.BaseClient=function(a){fyre.v1.object.Base.call(this,a)};goog.inherits(fyre.v1.client.BaseClient,fyre.v1.object.Base);fyre.v1.client.BaseClient.prototype.adminXdrHelper_=function(a,b,c,d,e){this.xdrHelper_(a,fyre.v1.config.servers.admin+b,c,d,e,!0)};fyre.v1.client.BaseClient.prototype.bootstrapXdrHelper_=function(a,b,c,d,e){this.xdrHelper_(a,fyre.v1.config.servers.bootstrap+b,c,d,e,!0)};
fyre.v1.client.BaseClient.prototype.quillXdrHelper_=function(a,b,c,d,e){this.xdrHelper_(a,fyre.v1.config.servers.quill+b,c,d,e,!0)};fyre.v1.client.BaseClient.prototype.searchXdrHelper_=function(a,b,c,d,e,f){b.apitoken=this.apiTokenHelper_(a);this.xdrHelper_(b,fyre.v1.config.servers.search+c,d,e,f)};fyre.v1.client.BaseClient.prototype.apiTokenHelper_=function(a){var b=window.user.get("api_token");return goog.isString(b)?b:b[a]};
fyre.v1.client.BaseClient.prototype.xdrHelper_=function(a,b,c,d,e,f){f&&window.user&&(f=window.user.get("token"),c==fyre.v1.io.POST&&goog.isString(a)?(b=new goog.Uri(b),b.getQueryData().set("lftoken",f),b=b.toString()):a.lftoken=f);(new fyre.v1.io.XDR({url:b,method:c,success:d,failure:e})).send(a)};goog.testing={};goog.testing.stacktrace={};goog.testing.stacktrace.Frame=function(a,b,c,d,e){this.context_=a;this.name_=b;this.alias_=c;this.args_=d;this.path_=e};goog.testing.stacktrace.Frame.prototype.getName=function(){return this.name_};goog.testing.stacktrace.Frame.prototype.isAnonymous=function(){return!this.name_||"[object Object]"==this.context_};
goog.testing.stacktrace.Frame.prototype.toCanonicalString=function(){var a=goog.testing.stacktrace.htmlEscape_,b=goog.testing.stacktrace.maybeDeobfuscateFunctionName_,b=[this.context_?a(this.context_)+".":"",this.name_?a(b(this.name_)):"anonymous",a(this.args_),this.alias_?" [as "+a(b(this.alias_))+"]":""];if(this.path_)if(b.push(" at "),goog.testing.stacktrace.isClosureInspectorActive_()){var c=this.path_.match(/\d+$/)[0];b.push('<a href="" onclick="CLOSURE_INSPECTOR___.showLine(\'',a(this.path_),
"', '",c,"'); return false\">",a(this.path_),"</a>")}else b.push(a(this.path_));return b.join("")};goog.testing.stacktrace.MAX_DEPTH_=20;goog.testing.stacktrace.MAX_FIREFOX_FRAMESTRING_LENGTH_=5E5;goog.testing.stacktrace.IDENTIFIER_PATTERN_="[a-zA-Z_$][\\w$]*";goog.testing.stacktrace.CHROME_ALIAS_PATTERN_="(?: \\[as ("+goog.testing.stacktrace.IDENTIFIER_PATTERN_+")\\])?";goog.testing.stacktrace.CHROME_FUNCTION_NAME_PATTERN_="(?:new )?(?:"+goog.testing.stacktrace.IDENTIFIER_PATTERN_+"|<anonymous>)";
goog.testing.stacktrace.CHROME_FUNCTION_CALL_PATTERN_=" (?:(.*?)\\.)?("+goog.testing.stacktrace.CHROME_FUNCTION_NAME_PATTERN_+")"+goog.testing.stacktrace.CHROME_ALIAS_PATTERN_;goog.testing.stacktrace.URL_PATTERN_="((?:http|https|file)://[^\\s)]+|javascript:.*)";goog.testing.stacktrace.CHROME_URL_PATTERN_=" (?:\\(unknown source\\)|\\(native\\)|\\((?:eval at )?"+goog.testing.stacktrace.URL_PATTERN_+"\\)|"+goog.testing.stacktrace.URL_PATTERN_+")";
goog.testing.stacktrace.CHROME_STACK_FRAME_REGEXP_=RegExp("^    at(?:"+goog.testing.stacktrace.CHROME_FUNCTION_CALL_PATTERN_+")?"+goog.testing.stacktrace.CHROME_URL_PATTERN_+"$");goog.testing.stacktrace.FIREFOX_FUNCTION_CALL_PATTERN_="("+goog.testing.stacktrace.IDENTIFIER_PATTERN_+")?(\\(.*\\))?@";goog.testing.stacktrace.FIREFOX_STACK_FRAME_REGEXP_=RegExp("^"+goog.testing.stacktrace.FIREFOX_FUNCTION_CALL_PATTERN_+"(?::0|"+goog.testing.stacktrace.URL_PATTERN_+")$");
goog.testing.stacktrace.FUNCTION_SOURCE_REGEXP_=RegExp("^function ("+goog.testing.stacktrace.IDENTIFIER_PATTERN_+")");
goog.testing.stacktrace.followCallChain_=function(){for(var a=[],b=arguments.callee.caller,c=0;b&&c<goog.testing.stacktrace.MAX_DEPTH_;){var d=Function.prototype.toString.call(b).match(goog.testing.stacktrace.FUNCTION_SOURCE_REGEXP_),d=d?d[1]:"",e=["("];if(b.arguments)for(var f=0;f<b.arguments.length;f++){var g=b.arguments[f];0<f&&e.push(", ");goog.isString(g)?e.push('"',g,'"'):g&&g.$replay?e.push("goog.testing.Mock"):e.push(""+g)}else e.push("unknown");e.push(")");e=e.join("");a.push(new goog.testing.stacktrace.Frame("",
d,"",e,""));try{b=b.caller}catch(h){break}c++}return a};
goog.testing.stacktrace.parseStackFrame_=function(a){var b=a.match(goog.testing.stacktrace.CHROME_STACK_FRAME_REGEXP_);if(b)return new goog.testing.stacktrace.Frame(b[1]||"",b[2]||"",b[3]||"","",b[4]||b[5]||"");return a.length>goog.testing.stacktrace.MAX_FIREFOX_FRAMESTRING_LENGTH_?goog.testing.stacktrace.parseLongFirefoxFrame_(a):(b=a.match(goog.testing.stacktrace.FIREFOX_STACK_FRAME_REGEXP_))?new goog.testing.stacktrace.Frame("",b[1]||"","",b[2]||"",b[3]||""):null};
goog.testing.stacktrace.parseLongFirefoxFrame_=function(a){var b=a.indexOf("("),c=a.lastIndexOf("@"),d=a.lastIndexOf(":"),e="";0<=b&&b<c&&(e=a.substring(0,b));var f="";0<=c&&c+1<d&&(f=a.substring(c+1));d="";0<=b&&0<c&&b<c&&(d=a.substring(b,c));return new goog.testing.stacktrace.Frame("",e,"",d,f)};goog.testing.stacktrace.setDeobfuscateFunctionName=function(a){goog.testing.stacktrace.deobfuscateFunctionName_=a};
goog.testing.stacktrace.maybeDeobfuscateFunctionName_=function(a){return goog.testing.stacktrace.deobfuscateFunctionName_?goog.testing.stacktrace.deobfuscateFunctionName_(a):a};goog.testing.stacktrace.isClosureInspectorActive_=function(){return Boolean(goog.global.CLOSURE_INSPECTOR___&&goog.global.CLOSURE_INSPECTOR___.supportsJSUnit)};goog.testing.stacktrace.htmlEscape_=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};
goog.testing.stacktrace.framesToString_=function(a){for(var b=a.length-1;a[b]&&a[b].isAnonymous();)b--;for(var c=-1,d=0;d<a.length;d++)if(a[d]&&"_assert"==a[d].getName()){c=d;break}for(var e=[],d=c+1;d<=b;d++)e.push("> "),a[d]?e.push(a[d].toCanonicalString()):e.push("(unknown)"),e.push("\n");return e.join("")};goog.testing.stacktrace.parse_=function(a){for(var a=a.replace(/\s*$/,"").split("\n"),b=[],c=0;c<a.length;c++)b.push(goog.testing.stacktrace.parseStackFrame_(a[c]));return b};
goog.testing.stacktrace.canonicalize=function(a){a=goog.testing.stacktrace.parse_(a);return goog.testing.stacktrace.framesToString_(a)};goog.testing.stacktrace.get=function(){var a=Error().stack,a=a?goog.testing.stacktrace.parse_(a):goog.testing.stacktrace.followCallChain_();return goog.testing.stacktrace.framesToString_(a)};goog.exportSymbol("setDeobfuscateFunctionName",goog.testing.stacktrace.setDeobfuscateFunctionName);fyre.v1.error={};fyre.v1.error.ExceptionClient=function(a){fyre.v1.client.BaseClient.call(this,a||{})};goog.inherits(fyre.v1.error.ExceptionClient,fyre.v1.client.BaseClient);fyre.v1.error.ExceptionClient.prototype.sendError=function(a){this.quillXdrHelper_({err:a.toString(),stack:a.stack||"",ua:goog.global.navigator.userAgent},"/api/v3.0/error","GET",goog.nullFunction,goog.nullFunction)};fyre.v1.error.ExceptionHandler=function(){};goog.addSingletonGetter(fyre.v1.error.ExceptionHandler);fyre.v1.error.ExceptionHandler.prototype.on_=function(){return fyre.v1.config.FORCE_SEND_EXCEPTIONS||!goog.DEBUG};fyre.v1.error.ExceptionHandler.prototype.FORCE_SEND_EXCEPTIONS=!0;
fyre.v1.error.ExceptionHandler.prototype.catcherr=function(a,b){goog.asserts.assert(goog.isFunction(a));var c=Array.prototype.slice.call(arguments,1);if(this.on_())try{a.apply(null,c)}catch(d){fyre.v1.logging.getLogger(c&&c[2]&&c[2].name||"").severe(d,d)}else return a.apply(null,c)};fyre.v1.error.ExceptionHandler.prototype.wrapFunction_=function(a,b){var c=this;return function(){var d=Array.prototype.slice.call(arguments);d.unshift(a);d.push(b);return c.catcherr.apply(c,d)}};
fyre.v1.error.ExceptionHandler.prototype.wrapBus=function(a){goog.asserts.assert(a instanceof fyre.v1.messenger.PubSub);goog.asserts.assert(!a.originalTrigger_,"cannot wrap a bus twice.");a.originalTrigger_=a.trigger;a.trigger=this.wrapFunction_(goog.bind(a.trigger,a),a.name)};
fyre.v1.error.ExceptionHandler.prototype.unwrapBus=function(a){goog.asserts.assert(a instanceof fyre.v1.messenger.PubSub);goog.asserts.assert(a.originalTrigger_,"bus has not been wrapped.");delete a.trigger;a.trigger=a.originalTrigger_;delete a.originalTrigger_};goog.math.Box=function(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d};goog.math.Box.boundingBox=function(a){for(var b=new goog.math.Box(arguments[0].y,arguments[0].x,arguments[0].y,arguments[0].x),c=1;c<arguments.length;c++){var d=arguments[c];b.top=Math.min(b.top,d.y);b.right=Math.max(b.right,d.x);b.bottom=Math.max(b.bottom,d.y);b.left=Math.min(b.left,d.x)}return b};goog.math.Box.prototype.clone=function(){return new goog.math.Box(this.top,this.right,this.bottom,this.left)};
goog.DEBUG&&(goog.math.Box.prototype.toString=function(){return"("+this.top+"t, "+this.right+"r, "+this.bottom+"b, "+this.left+"l)"});goog.math.Box.prototype.contains=function(a){return goog.math.Box.contains(this,a)};goog.math.Box.prototype.expand=function(a,b,c,d){goog.isObject(a)?(this.top-=a.top,this.right+=a.right,this.bottom+=a.bottom,this.left-=a.left):(this.top-=a,this.right+=b,this.bottom+=c,this.left-=d);return this};
goog.math.Box.prototype.expandToInclude=function(a){this.left=Math.min(this.left,a.left);this.top=Math.min(this.top,a.top);this.right=Math.max(this.right,a.right);this.bottom=Math.max(this.bottom,a.bottom)};goog.math.Box.equals=function(a,b){return a==b?!0:!a||!b?!1:a.top==b.top&&a.right==b.right&&a.bottom==b.bottom&&a.left==b.left};
goog.math.Box.contains=function(a,b){return!a||!b?!1:b instanceof goog.math.Box?b.left>=a.left&&b.right<=a.right&&b.top>=a.top&&b.bottom<=a.bottom:b.x>=a.left&&b.x<=a.right&&b.y>=a.top&&b.y<=a.bottom};goog.math.Box.distance=function(a,b){return b.x>=a.left&&b.x<=a.right?b.y>=a.top&&b.y<=a.bottom?0:b.y<a.top?a.top-b.y:b.y-a.bottom:b.y>=a.top&&b.y<=a.bottom?b.x<a.left?a.left-b.x:b.x-a.right:goog.math.Coordinate.distance(b,new goog.math.Coordinate(b.x<a.left?a.left:a.right,b.y<a.top?a.top:a.bottom))};
goog.math.Box.intersects=function(a,b){return a.left<=b.right&&b.left<=a.right&&a.top<=b.bottom&&b.top<=a.bottom};goog.math.Box.intersectsWithPadding=function(a,b,c){return a.left<=b.right+c&&b.left<=a.right+c&&a.top<=b.bottom+c&&b.top<=a.bottom+c};goog.math.Rect=function(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d};goog.math.Rect.prototype.clone=function(){return new goog.math.Rect(this.left,this.top,this.width,this.height)};goog.math.Rect.prototype.toBox=function(){return new goog.math.Box(this.top,this.left+this.width,this.top+this.height,this.left)};goog.math.Rect.createFromBox=function(a){return new goog.math.Rect(a.left,a.top,a.right-a.left,a.bottom-a.top)};
goog.DEBUG&&(goog.math.Rect.prototype.toString=function(){return"("+this.left+", "+this.top+" - "+this.width+"w x "+this.height+"h)"});goog.math.Rect.equals=function(a,b){return a==b?!0:!a||!b?!1:a.left==b.left&&a.width==b.width&&a.top==b.top&&a.height==b.height};
goog.math.Rect.prototype.intersection=function(a){var b=Math.max(this.left,a.left),c=Math.min(this.left+this.width,a.left+a.width);if(b<=c){var d=Math.max(this.top,a.top),a=Math.min(this.top+this.height,a.top+a.height);if(d<=a)return this.left=b,this.top=d,this.width=c-b,this.height=a-d,!0}return!1};
goog.math.Rect.intersection=function(a,b){var c=Math.max(a.left,b.left),d=Math.min(a.left+a.width,b.left+b.width);if(c<=d){var e=Math.max(a.top,b.top),f=Math.min(a.top+a.height,b.top+b.height);if(e<=f)return new goog.math.Rect(c,e,d-c,f-e)}return null};goog.math.Rect.intersects=function(a,b){return a.left<=b.left+b.width&&b.left<=a.left+a.width&&a.top<=b.top+b.height&&b.top<=a.top+a.height};goog.math.Rect.prototype.intersects=function(a){return goog.math.Rect.intersects(this,a)};
goog.math.Rect.difference=function(a,b){var c=goog.math.Rect.intersection(a,b);if(!c||!c.height||!c.width)return[a.clone()];var c=[],d=a.top,e=a.height,f=a.left+a.width,g=a.top+a.height,h=b.left+b.width,i=b.top+b.height;b.top>a.top&&(c.push(new goog.math.Rect(a.left,a.top,a.width,b.top-a.top)),d=b.top,e-=b.top-a.top);i<g&&(c.push(new goog.math.Rect(a.left,i,a.width,g-i)),e=i-d);b.left>a.left&&c.push(new goog.math.Rect(a.left,d,b.left-a.left,e));h<f&&c.push(new goog.math.Rect(h,d,f-h,e));return c};
goog.math.Rect.prototype.difference=function(a){return goog.math.Rect.difference(this,a)};goog.math.Rect.prototype.boundingRect=function(a){var b=Math.max(this.left+this.width,a.left+a.width),c=Math.max(this.top+this.height,a.top+a.height);this.left=Math.min(this.left,a.left);this.top=Math.min(this.top,a.top);this.width=b-this.left;this.height=c-this.top};goog.math.Rect.boundingRect=function(a,b){if(!a||!b)return null;var c=a.clone();c.boundingRect(b);return c};
goog.math.Rect.prototype.contains=function(a){return a instanceof goog.math.Rect?this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height:a.x>=this.left&&a.x<=this.left+this.width&&a.y>=this.top&&a.y<=this.top+this.height};goog.math.Rect.prototype.getSize=function(){return new goog.math.Size(this.width,this.height)};goog.style={};goog.style.setStyle=function(a,b,c){goog.isString(b)?goog.style.setStyle_(a,c,b):goog.object.forEach(b,goog.partial(goog.style.setStyle_,a))};goog.style.setStyle_=function(a,b,c){a.style[goog.string.toCamelCase(c)]=b};goog.style.getStyle=function(a,b){return a.style[goog.string.toCamelCase(b)]||""};
goog.style.getComputedStyle=function(a,b){var c=goog.dom.getOwnerDocument(a);return c.defaultView&&c.defaultView.getComputedStyle&&(c=c.defaultView.getComputedStyle(a,null))?c[b]||c.getPropertyValue(b):""};goog.style.getCascadedStyle=function(a,b){return a.currentStyle?a.currentStyle[b]:null};goog.style.getStyle_=function(a,b){return goog.style.getComputedStyle(a,b)||goog.style.getCascadedStyle(a,b)||a.style&&a.style[b]};goog.style.getComputedPosition=function(a){return goog.style.getStyle_(a,"position")};
goog.style.getBackgroundColor=function(a){return goog.style.getStyle_(a,"backgroundColor")};goog.style.getComputedOverflowX=function(a){return goog.style.getStyle_(a,"overflowX")};goog.style.getComputedOverflowY=function(a){return goog.style.getStyle_(a,"overflowY")};goog.style.getComputedZIndex=function(a){return goog.style.getStyle_(a,"zIndex")};goog.style.getComputedTextAlign=function(a){return goog.style.getStyle_(a,"textAlign")};
goog.style.getComputedCursor=function(a){return goog.style.getStyle_(a,"cursor")};goog.style.setPosition=function(a,b,c){var d,e=goog.userAgent.GECKO&&(goog.userAgent.MAC||goog.userAgent.X11)&&goog.userAgent.isVersion("1.9");b instanceof goog.math.Coordinate?(d=b.x,b=b.y):(d=b,b=c);a.style.left=goog.style.getPixelStyleValue_(d,e);a.style.top=goog.style.getPixelStyleValue_(b,e)};goog.style.getPosition=function(a){return new goog.math.Coordinate(a.offsetLeft,a.offsetTop)};
goog.style.getClientViewportElement=function(a){a=a?a.nodeType==goog.dom.NodeType.DOCUMENT?a:goog.dom.getOwnerDocument(a):goog.dom.getDocument();return goog.userAgent.IE&&!goog.userAgent.isDocumentMode(9)&&!goog.dom.getDomHelper(a).isCss1CompatMode()?a.body:a.documentElement};
goog.style.getBoundingClientRect_=function(a){var b=a.getBoundingClientRect();goog.userAgent.IE&&(a=a.ownerDocument,b.left-=a.documentElement.clientLeft+a.body.clientLeft,b.top-=a.documentElement.clientTop+a.body.clientTop);return b};
goog.style.getOffsetParent=function(a){if(goog.userAgent.IE&&!goog.userAgent.isDocumentMode(8))return a.offsetParent;for(var b=goog.dom.getOwnerDocument(a),c=goog.style.getStyle_(a,"position"),d="fixed"==c||"absolute"==c,a=a.parentNode;a&&a!=b;a=a.parentNode)if(c=goog.style.getStyle_(a,"position"),d=d&&"static"==c&&a!=b.documentElement&&a!=b.body,!d&&(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight||"fixed"==c||"absolute"==c||"relative"==c))return a;return null};
goog.style.getVisibleRectForElement=function(a){for(var b=new goog.math.Box(0,Infinity,Infinity,0),c=goog.dom.getDomHelper(a),d=c.getDocument().body,e=c.getDocument().documentElement,f=c.getDocumentScrollElement();a=goog.style.getOffsetParent(a);)if((!goog.userAgent.IE||0!=a.clientWidth)&&(!goog.userAgent.WEBKIT||0!=a.clientHeight||a!=d)&&a!=d&&a!=e&&"visible"!=goog.style.getStyle_(a,"overflow")){var g=goog.style.getPageOffset(a),h=goog.style.getClientLeftTop(a);g.x+=h.x;g.y+=h.y;b.top=Math.max(b.top,
g.y);b.right=Math.min(b.right,g.x+a.clientWidth);b.bottom=Math.min(b.bottom,g.y+a.clientHeight);b.left=Math.max(b.left,g.x)}d=f.scrollLeft;f=f.scrollTop;b.left=Math.max(b.left,d);b.top=Math.max(b.top,f);c=c.getViewportSize();b.right=Math.min(b.right,d+c.width);b.bottom=Math.min(b.bottom,f+c.height);return 0<=b.top&&0<=b.left&&b.bottom>b.top&&b.right>b.left?b:null};
goog.style.scrollIntoContainerView=function(a,b,c){var d=goog.style.getPageOffset(a),e=goog.style.getPageOffset(b),f=goog.style.getBorderBox(b),g=d.x-e.x-f.left,d=d.y-e.y-f.top,e=b.clientWidth-a.offsetWidth,a=b.clientHeight-a.offsetHeight;c?(b.scrollLeft+=g-e/2,b.scrollTop+=d-a/2):(b.scrollLeft+=Math.min(g,Math.max(g-e,0)),b.scrollTop+=Math.min(d,Math.max(d-a,0)))};
goog.style.getClientLeftTop=function(a){if(goog.userAgent.GECKO&&!goog.userAgent.isVersion("1.9")){var b=parseFloat(goog.style.getComputedStyle(a,"borderLeftWidth"));if(goog.style.isRightToLeft(a))var c=a.offsetWidth-a.clientWidth-b-parseFloat(goog.style.getComputedStyle(a,"borderRightWidth")),b=b+c;return new goog.math.Coordinate(b,parseFloat(goog.style.getComputedStyle(a,"borderTopWidth")))}return new goog.math.Coordinate(a.clientLeft,a.clientTop)};
goog.style.getPageOffset=function(a){var b,c=goog.dom.getOwnerDocument(a),d=goog.style.getStyle_(a,"position"),e=goog.userAgent.GECKO&&c.getBoxObjectFor&&!a.getBoundingClientRect&&"absolute"==d&&(b=c.getBoxObjectFor(a))&&(0>b.screenX||0>b.screenY),f=new goog.math.Coordinate(0,0),g=goog.style.getClientViewportElement(c);if(a==g)return f;if(a.getBoundingClientRect)b=goog.style.getBoundingClientRect_(a),a=goog.dom.getDomHelper(c).getDocumentScroll(),f.x=b.left+a.x,f.y=b.top+a.y;else if(c.getBoxObjectFor&&
!e)b=c.getBoxObjectFor(a),a=c.getBoxObjectFor(g),f.x=b.screenX-a.screenX,f.y=b.screenY-a.screenY;else{b=a;do{f.x+=b.offsetLeft;f.y+=b.offsetTop;b!=a&&(f.x+=b.clientLeft||0,f.y+=b.clientTop||0);if(goog.userAgent.WEBKIT&&"fixed"==goog.style.getComputedPosition(b)){f.x+=c.body.scrollLeft;f.y+=c.body.scrollTop;break}b=b.offsetParent}while(b&&b!=a);if(goog.userAgent.OPERA||goog.userAgent.WEBKIT&&"absolute"==d)f.y-=c.body.offsetTop;for(b=a;(b=goog.style.getOffsetParent(b))&&b!=c.body&&b!=g;)if(f.x-=b.scrollLeft,
!goog.userAgent.OPERA||"TR"!=b.tagName)f.y-=b.scrollTop}return f};goog.style.getPageOffsetLeft=function(a){return goog.style.getPageOffset(a).x};goog.style.getPageOffsetTop=function(a){return goog.style.getPageOffset(a).y};goog.style.getFramedPageOffset=function(a,b){var c=new goog.math.Coordinate(0,0),d=goog.dom.getWindow(goog.dom.getOwnerDocument(a)),e=a;do{var f=d==b?goog.style.getPageOffset(e):goog.style.getClientPosition(e);c.x+=f.x;c.y+=f.y}while(d&&d!=b&&(e=d.frameElement)&&(d=d.parent));return c};
goog.style.translateRectForAnotherFrame=function(a,b,c){if(b.getDocument()!=c.getDocument()){var d=b.getDocument().body,c=goog.style.getFramedPageOffset(d,c.getWindow()),c=goog.math.Coordinate.difference(c,goog.style.getPageOffset(d));goog.userAgent.IE&&!b.isCss1CompatMode()&&(c=goog.math.Coordinate.difference(c,b.getDocumentScroll()));a.left+=c.x;a.top+=c.y}};
goog.style.getRelativePosition=function(a,b){var c=goog.style.getClientPosition(a),d=goog.style.getClientPosition(b);return new goog.math.Coordinate(c.x-d.x,c.y-d.y)};
goog.style.getClientPosition=function(a){var b=new goog.math.Coordinate;if(a.nodeType==goog.dom.NodeType.ELEMENT)if(a.getBoundingClientRect)a=goog.style.getBoundingClientRect_(a),b.x=a.left,b.y=a.top;else{var c=goog.dom.getDomHelper(a).getDocumentScroll(),a=goog.style.getPageOffset(a);b.x=a.x-c.x;b.y=a.y-c.y}else{var c=goog.isFunction(a.getBrowserEvent),d=a;a.targetTouches?d=a.targetTouches[0]:c&&a.getBrowserEvent().targetTouches&&(d=a.getBrowserEvent().targetTouches[0]);b.x=d.clientX;b.y=d.clientY}return b};
goog.style.setPageOffset=function(a,b,c){var d=goog.style.getPageOffset(a);b instanceof goog.math.Coordinate&&(c=b.y,b=b.x);goog.style.setPosition(a,a.offsetLeft+(b-d.x),a.offsetTop+(c-d.y))};goog.style.setSize=function(a,b,c){if(b instanceof goog.math.Size)c=b.height,b=b.width;else if(void 0==c)throw Error("missing height argument");goog.style.setWidth(a,b);goog.style.setHeight(a,c)};goog.style.getPixelStyleValue_=function(a,b){"number"==typeof a&&(a=(b?Math.round(a):a)+"px");return a};
goog.style.setHeight=function(a,b){a.style.height=goog.style.getPixelStyleValue_(b,!0)};goog.style.setWidth=function(a,b){a.style.width=goog.style.getPixelStyleValue_(b,!0)};goog.style.getSize=function(a){if("none"!=goog.style.getStyle_(a,"display"))return goog.style.getSizeWithDisplay_(a);var b=a.style,c=b.display,d=b.visibility,e=b.position;b.visibility="hidden";b.position="absolute";b.display="inline";a=goog.style.getSizeWithDisplay_(a);b.display=c;b.position=e;b.visibility=d;return a};
goog.style.getSizeWithDisplay_=function(a){var b=a.offsetWidth,c=a.offsetHeight,d=goog.userAgent.WEBKIT&&!b&&!c;return(!goog.isDef(b)||d)&&a.getBoundingClientRect?(a=goog.style.getBoundingClientRect_(a),new goog.math.Size(a.right-a.left,a.bottom-a.top)):new goog.math.Size(b,c)};goog.style.getBounds=function(a){var b=goog.style.getPageOffset(a),a=goog.style.getSize(a);return new goog.math.Rect(b.x,b.y,a.width,a.height)};goog.style.toCamelCase=function(a){return goog.string.toCamelCase(""+a)};
goog.style.toSelectorCase=function(a){return goog.string.toSelectorCase(a)};goog.style.getOpacity=function(a){var b=a.style,a="";"opacity"in b?a=b.opacity:"MozOpacity"in b?a=b.MozOpacity:"filter"in b&&(b=b.filter.match(/alpha\(opacity=([\d.]+)\)/))&&(a=""+b[1]/100);return""==a?a:Number(a)};goog.style.setOpacity=function(a,b){var c=a.style;"opacity"in c?c.opacity=b:"MozOpacity"in c?c.MozOpacity=b:"filter"in c&&(c.filter=""===b?"":"alpha(opacity="+100*b+")")};
goog.style.setTransparentBackgroundImage=function(a,b){var c=a.style;goog.userAgent.IE&&!goog.userAgent.isVersion("8")?c.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+b+'", sizingMethod="crop")':(c.backgroundImage="url("+b+")",c.backgroundPosition="top left",c.backgroundRepeat="no-repeat")};goog.style.clearTransparentBackgroundImage=function(a){a=a.style;"filter"in a?a.filter="":a.backgroundImage="none"};goog.style.showElement=function(a,b){a.style.display=b?"":"none"};
goog.style.isElementShown=function(a){return"none"!=a.style.display};goog.style.installStyles=function(a,b){var c=goog.dom.getDomHelper(b),d=null;if(goog.userAgent.IE)d=c.getDocument().createStyleSheet(),goog.style.setStyles(d,a);else{var e=c.getElementsByTagNameAndClass("head")[0];e||(d=c.getElementsByTagNameAndClass("body")[0],e=c.createDom("head"),d.parentNode.insertBefore(e,d));d=c.createDom("style");goog.style.setStyles(d,a);c.appendChild(e,d)}return d};
goog.style.uninstallStyles=function(a){goog.dom.removeNode(a.ownerNode||a.owningElement||a)};goog.style.setStyles=function(a,b){goog.userAgent.IE?a.cssText=b:a[goog.userAgent.WEBKIT?"innerText":"innerHTML"]=b};goog.style.setPreWrap=function(a){a=a.style;goog.userAgent.IE&&!goog.userAgent.isVersion("8")?(a.whiteSpace="pre",a.wordWrap="break-word"):a.whiteSpace=goog.userAgent.GECKO?"-moz-pre-wrap":"pre-wrap"};
goog.style.setInlineBlock=function(a){a=a.style;a.position="relative";goog.userAgent.IE&&!goog.userAgent.isVersion("8")?(a.zoom="1",a.display="inline"):a.display=goog.userAgent.GECKO?goog.userAgent.isVersion("1.9a")?"inline-block":"-moz-inline-box":"inline-block"};goog.style.isRightToLeft=function(a){return"rtl"==goog.style.getStyle_(a,"direction")};goog.style.unselectableStyle_=goog.userAgent.GECKO?"MozUserSelect":goog.userAgent.WEBKIT?"WebkitUserSelect":null;
goog.style.isUnselectable=function(a){return goog.style.unselectableStyle_?"none"==a.style[goog.style.unselectableStyle_].toLowerCase():goog.userAgent.IE||goog.userAgent.OPERA?"on"==a.getAttribute("unselectable"):!1};
goog.style.setUnselectable=function(a,b,c){var c=!c?a.getElementsByTagName("*"):null,d=goog.style.unselectableStyle_;if(d){if(b=b?"none":"",a.style[d]=b,c)for(var a=0,e;e=c[a];a++)e.style[d]=b}else if(goog.userAgent.IE||goog.userAgent.OPERA)if(b=b?"on":"",a.setAttribute("unselectable",b),c)for(a=0;e=c[a];a++)e.setAttribute("unselectable",b)};goog.style.getBorderBoxSize=function(a){return new goog.math.Size(a.offsetWidth,a.offsetHeight)};
goog.style.setBorderBoxSize=function(a,b){var c=goog.dom.getOwnerDocument(a),d=goog.dom.getDomHelper(c).isCss1CompatMode();if(goog.userAgent.IE&&(!d||!goog.userAgent.isVersion("8")))if(c=a.style,d){var d=goog.style.getPaddingBox(a),e=goog.style.getBorderBox(a);c.pixelWidth=b.width-e.left-d.left-d.right-e.right;c.pixelHeight=b.height-e.top-d.top-d.bottom-e.bottom}else c.pixelWidth=b.width,c.pixelHeight=b.height;else goog.style.setBoxSizingSize_(a,b,"border-box")};
goog.style.getContentBoxSize=function(a){var b=goog.dom.getOwnerDocument(a),c=goog.userAgent.IE&&a.currentStyle;if(c&&goog.dom.getDomHelper(b).isCss1CompatMode()&&"auto"!=c.width&&"auto"!=c.height&&!c.boxSizing)return b=goog.style.getIePixelValue_(a,c.width,"width","pixelWidth"),a=goog.style.getIePixelValue_(a,c.height,"height","pixelHeight"),new goog.math.Size(b,a);c=goog.style.getBorderBoxSize(a);b=goog.style.getPaddingBox(a);a=goog.style.getBorderBox(a);return new goog.math.Size(c.width-a.left-
b.left-b.right-a.right,c.height-a.top-b.top-b.bottom-a.bottom)};
goog.style.setContentBoxSize=function(a,b){var c=goog.dom.getOwnerDocument(a),d=goog.dom.getDomHelper(c).isCss1CompatMode();if(goog.userAgent.IE&&(!d||!goog.userAgent.isVersion("8")))if(c=a.style,d)c.pixelWidth=b.width,c.pixelHeight=b.height;else{var d=goog.style.getPaddingBox(a),e=goog.style.getBorderBox(a);c.pixelWidth=b.width+e.left+d.left+d.right+e.right;c.pixelHeight=b.height+e.top+d.top+d.bottom+e.bottom}else goog.style.setBoxSizingSize_(a,b,"content-box")};
goog.style.setBoxSizingSize_=function(a,b,c){a=a.style;goog.userAgent.GECKO?a.MozBoxSizing=c:goog.userAgent.WEBKIT?a.WebkitBoxSizing=c:a.boxSizing=c;a.width=Math.max(b.width,0)+"px";a.height=Math.max(b.height,0)+"px"};goog.style.getIePixelValue_=function(a,b,c,d){if(/^\d+px?$/.test(b))return parseInt(b,10);var e=a.style[c],f=a.runtimeStyle[c];a.runtimeStyle[c]=a.currentStyle[c];a.style[c]=b;b=a.style[d];a.style[c]=e;a.runtimeStyle[c]=f;return b};
goog.style.getIePixelDistance_=function(a,b){return goog.style.getIePixelValue_(a,goog.style.getCascadedStyle(a,b),"left","pixelLeft")};
goog.style.getBox_=function(a,b){if(goog.userAgent.IE){var c=goog.style.getIePixelDistance_(a,b+"Left"),d=goog.style.getIePixelDistance_(a,b+"Right"),e=goog.style.getIePixelDistance_(a,b+"Top"),f=goog.style.getIePixelDistance_(a,b+"Bottom");return new goog.math.Box(e,d,f,c)}c=goog.style.getComputedStyle(a,b+"Left");d=goog.style.getComputedStyle(a,b+"Right");e=goog.style.getComputedStyle(a,b+"Top");f=goog.style.getComputedStyle(a,b+"Bottom");return new goog.math.Box(parseFloat(e),parseFloat(d),parseFloat(f),
parseFloat(c))};goog.style.getPaddingBox=function(a){return goog.style.getBox_(a,"padding")};goog.style.getMarginBox=function(a){return goog.style.getBox_(a,"margin")};goog.style.ieBorderWidthKeywords_={thin:2,medium:4,thick:6};
goog.style.getIePixelBorder_=function(a,b){if("none"==goog.style.getCascadedStyle(a,b+"Style"))return 0;var c=goog.style.getCascadedStyle(a,b+"Width");return c in goog.style.ieBorderWidthKeywords_?goog.style.ieBorderWidthKeywords_[c]:goog.style.getIePixelValue_(a,c,"left","pixelLeft")};
goog.style.getBorderBox=function(a){if(goog.userAgent.IE){var b=goog.style.getIePixelBorder_(a,"borderLeft"),c=goog.style.getIePixelBorder_(a,"borderRight"),d=goog.style.getIePixelBorder_(a,"borderTop"),a=goog.style.getIePixelBorder_(a,"borderBottom");return new goog.math.Box(d,c,a,b)}b=goog.style.getComputedStyle(a,"borderLeftWidth");c=goog.style.getComputedStyle(a,"borderRightWidth");d=goog.style.getComputedStyle(a,"borderTopWidth");a=goog.style.getComputedStyle(a,"borderBottomWidth");return new goog.math.Box(parseFloat(d),
parseFloat(c),parseFloat(a),parseFloat(b))};goog.style.getFontFamily=function(a){var b=goog.dom.getOwnerDocument(a),c="";if(b.body.createTextRange){b=b.body.createTextRange();b.moveToElementText(a);try{c=b.queryCommandValue("FontName")}catch(d){c=""}}c||(c=goog.style.getStyle_(a,"fontFamily"));a=c.split(",");1<a.length&&(c=a[0]);return goog.string.stripQuotes(c,"\"'")};goog.style.lengthUnitRegex_=/[^\d]+$/;
goog.style.getLengthUnits=function(a){return(a=a.match(goog.style.lengthUnitRegex_))&&a[0]||null};goog.style.ABSOLUTE_CSS_LENGTH_UNITS_={cm:1,"in":1,mm:1,pc:1,pt:1};goog.style.CONVERTIBLE_RELATIVE_CSS_UNITS_={em:1,ex:1};
goog.style.getFontSize=function(a){var b=goog.style.getStyle_(a,"fontSize"),c=goog.style.getLengthUnits(b);if(b&&"px"==c)return parseInt(b,10);if(goog.userAgent.IE){if(c in goog.style.ABSOLUTE_CSS_LENGTH_UNITS_)return goog.style.getIePixelValue_(a,b,"left","pixelLeft");if(a.parentNode&&a.parentNode.nodeType==goog.dom.NodeType.ELEMENT&&c in goog.style.CONVERTIBLE_RELATIVE_CSS_UNITS_)return a=a.parentNode,c=goog.style.getStyle_(a,"fontSize"),goog.style.getIePixelValue_(a,b==c?"1em":b,"left","pixelLeft")}c=
goog.dom.createDom("span",{style:"visibility:hidden;position:absolute;line-height:0;padding:0;margin:0;border:0;height:1em;"});goog.dom.appendChild(a,c);b=c.offsetHeight;goog.dom.removeNode(c);return b};goog.style.parseStyleAttribute=function(a){var b={};goog.array.forEach(a.split(/\s*;\s*/),function(a){a=a.split(/\s*:\s*/);2==a.length&&(b[goog.string.toCamelCase(a[0].toLowerCase())]=a[1])});return b};
goog.style.toStyleAttribute=function(a){var b=[];goog.object.forEach(a,function(a,d){b.push(goog.string.toSelectorCase(d),":",a,";")});return b.join("")};goog.style.setFloat=function(a,b){a.style[goog.userAgent.IE?"styleFloat":"cssFloat"]=b};goog.style.getFloat=function(a){return a.style[goog.userAgent.IE?"styleFloat":"cssFloat"]||""};
goog.style.getScrollbarWidth=function(a){var b=goog.dom.createElement("div");a&&(b.className=a);b.style.cssText="visiblity:hidden;overflow:auto;position:absolute;top:0;width:100px;height:100px";a=goog.dom.createElement("div");goog.style.setSize(a,"200px","200px");b.appendChild(a);goog.dom.appendChild(goog.dom.getDocument().body,b);a=b.offsetWidth-b.clientWidth;goog.dom.removeNode(b);return a};fyre.v1.util._bi={};fyre.v1.util.base64={};fyre.v1.util.jsoncookie={};fyre.v1.util.functions=function(a){var b=[],c;for(c in a)goog.isFunction(a[c])&&b.push(c);return b.sort()};fyre.v1.util.sortBy=function(a,b,c){var d=goog.isFunction(b)?b:function(a){return a[b]};return fyre.v1.util.pluck(fyre.v1.util.map(a,function(a,b,g){return{value:a,criteria:d.call(c,a,b,g)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return void 0===c?1:void 0===d?-1:c<d?-1:c>d?1:0}),"value")};
fyre.v1.util.pluck=function(a,b){return goog.array.map(a,function(a){return a[b]})};
fyre.v1.util._eq=function(a,b,c){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a._chain&&(a=a._wrapped);b._chain&&(b=b._wrapped);if(a.isEqual&&goog.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&goog.isFunction(b.isEqual))return b.isEqual(a);var d=Object.prototype.toString.call(a);if(d!=Object.prototype.toString.call(b))return!1;switch(d){case "[object String]":return a==""+b;case "[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==
+b;case "[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var e=c.length;e--;)if(c[e]==a)return!0;c.push(a);var e=0,f=!0;if("[object Array]"==d){if(e=a.length,f=e==b.length)for(;e--&&(f=e in a==e in b&&fyre.v1.util._eq(a[e],b[e],c)););}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var g in a)if(goog.object.containsKey(a,g)&&(e++,!(f=goog.object.containsKey(b,
g)&&fyre.v1.util._eq(a[g],b[g],c))))break;if(f){for(g in b)if(goog.object.containsKey(b,g)&&!e--)break;f=!e}}c.pop();return f};fyre.v1.util.isEqual=function(a,b){return fyre.v1.util._eq(a,b,[])};fyre.v1.util.uniqueId=function(){var a=0;return function(b){var c=a++;return b?b+c:c}}();fyre.v1.util.isRegExp=function(a){return"[object RegExp]"==Object.prototype.toString.call(a)};
fyre.v1.util.toArray=function(a){return!a?[]:a.toArray?a.toArray():goog.isArray(a)||fyre.v1.util.isArguments(a)?goog.array.slice(a):goog.object.getValues(a)};fyre.v1.util.isArguments=function(a){return goog.isDefAndNotNull(a)&&("[object Arguments]"==Object.prototype.toString.call(a)||!!a.callee)};fyre.v1.util.forEach=function(a,b,c){return goog.isArray(a)?goog.array.forEach(a,b,c):goog.object.forEach(a,b,c)};
fyre.v1.util.map=function(a,b,c){return goog.isArray(a)?goog.array.map(a,b,c):goog.object.map(a,b,c)};fyre.v1.util.every=function(a,b,c){return goog.isArray(a)?goog.array.every(a,b,c):goog.object.every(a,b,c)};fyre.v1.util.some=function(a,b,c){return goog.isArray(a)?goog.array.some(a,b,c):goog.object.some(a,b,c)};fyre.v1.util.extend=function(a,b){fyre.v1.util.forEach(Array.prototype.slice.call(arguments,1),function(b){for(var d in b)a[d]=b[d]});return a};
fyre.v1.util.getTLD=function(a){var a=a||document.location.href,b=a.indexOf("://"),a=a.slice(-1==b?0:b+3);return a=a.slice(0,a.indexOf("/"))};fyre.v1.util.base64.encodeString=function(a){return goog.crypt.base64.encodeString(a)};fyre.v1.util.base64.decodeString=function(a){return goog.crypt.base64.decodeString(a.replace(/\"/g,""))};
fyre.v1.util.handler=function(a,b,c){goog.asserts.assert(goog.isArray(a)&&goog.isFunction(b),"Handler only takes events+functions; try fyre.v1.util.handlerize().");b.HANDLES_EVENTS=a;b.EVENT_BUS=c;return b};
fyre.v1.util.handlerize=function(a,b){goog.asserts.assert(goog.isObject(a),"Handlerize only takes objects; try fyre.v1.util.handler().");b=b||a.context;goog.asserts.assert(b&&b.subscribe);if(goog.DEBUG)var c=a.HANDLER_DEBUG={};goog.object.forEach(a,function(d){if(goog.isFunction(d)&&d.HANDLES_EVENTS){goog.asserts.assert(goog.isArray(d.HANDLES_EVENTS));for(var e=0,f=d.HANDLES_EVENTS.length;e<f;++e){var g=d.HANDLES_EVENTS[e];(d.EVENT_BUS?d.EVENT_BUS:b.bus&&goog.isFunction(b.bus.subscribe)?b.bus:b).subscribe(g,
d,a);goog.DEBUG&&(c[g]?c[g].push(d):c[g]=[d])}}})};
fyre.v1.util.unhandlerize=function(a,b){goog.asserts.assert(goog.isObject(a),"Handlerize only takes objects; try fyre.v1.util.handler().");b=b||a.context;goog.asserts.assert(b&&b.subscribe);var c;goog.object.forEach(a,function(d){if(goog.isFunction(d)&&d.HANDLES_EVENTS){goog.asserts.assert(goog.isArray(d.HANDLES_EVENTS));for(var e=0,f=d.HANDLES_EVENTS.length;e<f;++e){var g=d.HANDLES_EVENTS[e];c=d.EVENT_BUS?d.EVENT_BUS:b.bus&&goog.isFunction(b.bus.subscribe)?b.bus:b;c.unsubscribe(g,d,a)}}})};
fyre.v1.util.handleError=function(a,b){if(!a.isinstance)throw a;var c=goog.array.slice(arguments,1);goog.asserts.assert(0===c.length%2);for(var d=0,e=c.length;d<e;d+=2)a.isinstance(c[d])&&c[d+1].call(null,a)};fyre.v1.util.noop=function(){};fyre.v1.util.isFalsy=function(a){return!a||goog.isObject(a)&&goog.object.isEmpty(a)||goog.isArray(a)&&goog.array.isEmpty(a)?!0:!1};fyre.v1.util.allFalsy=function(a){return!goog.object.some(a,function(a){return!fyre.v1.util.isFalsy(a)})};
fyre.v1.util.jsoncookie.setb64=function(a,b,c,d,e,f){goog.net.cookies.set(a,fyre.v1.util.base64.encodeString(goog.json.serialize(b)),c,d,e,f)};fyre.v1.util.jsoncookie.getb64=function(a,b){var c=goog.net.cookies.get(a,b);return c===b?c:goog.json.parse(fyre.v1.util.base64.decodeString(c))};fyre.v1.util.getDefault=function(a,b){return 0===a?a:a||b};
fyre.v1.util.makeCallback=function(a){for(var b=[],c=0,d=arguments.length;c<d;c+=2)b.push(goog.bind(arguments[c]||goog.nullFunction,arguments[c+1]));return goog.functions.sequence.apply(null,b)};fyre.v1.util.stripHtml=function(a){var b=a;goog.isString(a)&&(b=document.createElement("div"),b.innerHTML=a);return"innerText"in b?b.innerText:b.textContent};
fyre.v1.util.stripEmptyHtml=function(a){var b=function(a){if(!(a.nodeType!==goog.dom.NodeType.ELEMENT||!goog.dom.canHaveChildren(a)&&a.nodeName!==goog.dom.TagName.BR)){var c=a.firstChild,f=a.parentNode,g;if(a.nodeName===goog.dom.TagName.BR)g=!1;else{g=0===a.children.length;var h=fyre.v1.util.stripHtml(a),h=goog.string.isEmpty(goog.string.collapseWhitespace(h));g=a&&g&&h}if(g)goog.dom.removeNode(a),f&&b(f);else for(;c;)b(c),c=c.nextSibling}},c=document.createElement("div");c.innerHTML=a.replace(/<p>&nbsp;/,
"<p>");b(c);return c.innerHTML};fyre.v1.util.hasTextContent=function(a){a=a.replace(/&nbsp;/g," ");a=goog.string.trim(fyre.v1.util.stripHtml(a));return""!==a};
fyre.v1.util.htmlExtractNodes=function(a,b){var c={html:"",all:[]};b||(b=[goog.dom.TagName.SCRIPT]);b=goog.array.map(b,function(a){a=a.toLowerCase();c[a]=[];return a});if(goog.string.isEmptySafe(a))return c;var d=goog.dom.createDom(goog.dom.TagName.DIV,null,goog.dom.htmlToDocumentFragment(a));goog.dom.findNodes(d,function(a){if(goog.dom.isElement(a)){var d=a.tagName.toLowerCase();goog.array.contains(b,d)&&(goog.dom.removeNode(a),c.all.push(a),c.all.push(a),c[d].push(a))}});c.html=goog.dom.getOuterHtml(d);
return c};fyre.v1.util.toTitleCase=function(a,b){var c=goog.isString(b)?goog.string.regExpEscape(b):"\\s";return a.replace(RegExp("(^"+(c?"|["+c+"]+":"")+")([a-z])","g"),function(a,b,c){return b+c.toUpperCase()})};fyre.v1.util.formatJson=function(a){for(var b="",c=0,d=a.length,e="",f=0;f<d;f++){e=a.substring(f,f+1);if("}"==e||"]"==e)for(var b=b+"<br />",c=c-1,g=0;g<c;g++)b+="&nbsp;&nbsp;&nbsp;&nbsp;";b+=e;if("{"==e||"["==e||","==e){b+="<br />";if("{"==e||"["==e)c+=1;for(e=0;e<c;e++)b+="&nbsp;&nbsp;&nbsp;&nbsp;"}}return b};fyre.v1.lib.Backbone=function(){var a=Array.prototype.slice,b=Array.prototype.splice,c={VERSION:"0.9.1",Events:{on:function(a,b,c){for(var d,a=a.split(/\s+/),e=this._callbacks||(this._callbacks={});d=a.shift();){d=e[d]||(e[d]={});var f=d.tail||(d.tail=d.next={});f.callback=b;f.context=c;d.tail=f.next={}}return this},off:function(a,b,c){var d,e,f,m,n,o;if(e=this._callbacks){if(!a&&!b&&!c)return delete this._callbacks,this;for(a=a?a.split(/\s+/):goog.object.getKeys(e);d=a.shift();)if(f=e[d],delete e[d],
f&&(b||c))for(m=f.tail;(f=f.next)!==m;)if(n=f.callback,o=f.context,b&&n!==b||c&&o!==c)this.on(d,n,o);return this}},trigger:function(b){var c,d,e,f;if(!(e=this._callbacks))return this;f=e.all;for((b=b.split(/\s+/)).push(null);c=b.shift();)f&&b.push({next:f.next,tail:f.tail,event:c}),(d=e[c])&&b.push({next:d.next,tail:d.tail});for(f=a.call(arguments,1);d=b.pop();){c=d.tail;for(e=d.event?[d.event].concat(f):f;(d=d.next)!==c;)d.callback.apply(d.context||this,e)}return this}}};c.Events.bind=c.Events.on;
c.Events.unbind=c.Events.off;c.Model=function(a,b){var c;a||(a={});if(c=goog.isFunction(this.defaults)?this.defaults():this.defaults||{})a=fyre.v1.util.extend({},c,a);b&&b.collection&&(this.collection=b.collection);this.attributes={};this._escapedAttributes={};this.cid=fyre.v1.util.uniqueId("c");if(!this.set(a,{silent:!0}))throw Error("Can't create an invalid model");delete this._changed;this._previousAttributes=goog.object.clone(this.attributes);this.initialize.apply(this,arguments)};fyre.v1.util.extend(c.Model.prototype,
c.Events,{idAttribute:"id",initialize:function(){},toJSON:function(){return goog.object.clone(this.attributes)},get:function(a){return this.attributes[a]},has:function(a){return null!=this.attributes[a]},set:function(a,b,d){var e,f;goog.isObject(a)||null==a?(e=a,d=b):(e={},e[a]=b);d||(d={});if(!e)return this;e instanceof c.Model&&(e=e.attributes);if(d.unset)for(f in e)e[f]=void 0;this.idAttribute in e&&(this.id=e[this.idAttribute]);var b=this.attributes,l=this._escapedAttributes,m=this._previousAttributes||
{},n=this._setting;this._changed||(this._changed={});this._setting=!0;for(f in e)if(a=e[f],fyre.v1.util.isEqual(b[f],a)||delete l[f],d.unset?delete b[f]:b[f]=a,this._changing&&!fyre.v1.util.isEqual(this._changed[f],a)&&(this.trigger("change:"+f,this,a,d),this._moreChanges=!0),delete this._changed[f],!fyre.v1.util.isEqual(m[f],a)||goog.object.containsKey(b,f)!=goog.object.containsKey(m,f)||d.force)this._changed[f]=a;n||(!d.silent&&(this.hasChanged()||d.force)&&this.change(d),this._setting=!1);return this},
unset:function(a,b){(b||(b={})).unset=!0;return this.set(a,null,b)},clear:function(a){(a||(a={})).unset=!0;return this.set(goog.object.clone(this.attributes),a)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},merge:function(a){a instanceof this.constructor&&goog.object.forEach(a.attributes,function(a,b){this.set(b,a)},this)},change:function(a){if(this._changing||!this.hasChanged())return this;this._moreChanges=this._changing=!0;for(var b in this._changed)this.trigger("change:"+
b,this,this._changed[b],a);for(;this._moreChanges;)this._moreChanges=!1,this.trigger("change",this,a);this._previousAttributes=goog.object.clone(this.attributes);delete this._changed;this._changing=!1;return this},hasChanged:function(a){return!arguments.length?!goog.object.isEmpty(this._changed):this._changed&&goog.object.containsKey(this._changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?goog.object.clone(this._changed):!1;var b,c=!1,d=this._previousAttributes,e;for(e in a)if(!fyre.v1.util.isEqual(d[e],
b=a[e]))(c||(c={}))[e]=b;return c},previous:function(a){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return goog.object.clone(this._previousAttributes)}});c.Collection=function(a,b){b||(b={});b.comparator&&(this.comparator=b.comparator);this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,{silent:!0})};fyre.v1.util.extend(c.Collection.prototype,c.Events,{model:c.Model,initialize:function(){},toJSON:function(){return this.map(function(a){return a.toJSON()})},
add:function(a,c){var d,e,f,l,m,n={},o={};c||(c={});a=goog.isArray(a)?a.slice():[a];for(d=0,e=a.length;d<e;d++){if(!(f=a[d]=this._prepareModel(a[d],c)))throw Error("Can't add an invalid model to a collection");if(n[l=f.cid]||this._byCid[l]||null!=(m=f.id)&&(o[m]||this._byId[m]))throw Error("Can't add the same model to a collection twice");n[l]=o[m]=f}for(d=0;d<e;d++)(f=a[d]).on("all",this._onModelEvent,this),this._byCid[f.cid]=f,null!=f.id&&(this._byId[f.id]=f);this.length+=e;b.apply(this.models,
[null!=c.at?c.at:this.models.length,0].concat(a));this.comparator&&this.sort({silent:!0});if(c.silent)return this;for(d=0,e=this.models.length;d<e;d++)if(n[(f=this.models[d]).cid])c.index=d,f.trigger("add",f,this,c);return this},remove:function(a,b){var c,d,e,f;b||(b={});a=goog.isArray(a)?a.slice():[a];for(c=0,d=a.length;c<d;c++)if(f=this.getByCid(a[c])||this.get(a[c]))delete this._byId[f.id],delete this._byCid[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",
f,this,b)),this._removeReference(f);return this},get:function(a){return null==a?null:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");var b=goog.bind(this.comparator,this);1==this.comparator.length?this.models=this.sortBy(b):this.models.sort(b);a.silent||this.trigger("reset",this,a);return this},reset:function(a,b){a||(a=[]);
b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);this._reset();this.add(a,{silent:!0});b.silent||this.trigger("reset",this,b);return this},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(a,b){a instanceof c.Model?a.collection||(a.collection=this):(b.collection=this,a=new this.model(a,b));return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,
b,c,d){("add"==a||"remove"==a)&&c!=this||("destroy"==a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments))}});var d={forEach:fyre.v1.util.forEach,each:fyre.v1.util.forEach,map:fyre.v1.util.map,filter:goog.object.filter,every:fyre.v1.util.every,some:fyre.v1.util.some,contains:goog.array.contains,sortBy:fyre.v1.util.sortBy,toArray:goog.array.toArray,indexOf:goog.array.indexOf};fyre.v1.util.forEach(d,
function(a,b){c.Collection.prototype[b]=function(){return d[b].apply(a,[this.models].concat(fyre.v1.util.toArray(arguments)))}});c.Model.extend=c.Collection.extend=function(a,b){var c=f(this,a,b);c.extend=this.extend;return c};c.wrapError=function(a,b,c){return function(d,e){e=d===b?e:d;a?a(b,e,c):b.trigger("error",b,e,c)}};var e=function(){},f=function(a,b,c){var d;d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){a.apply(this,arguments)};fyre.v1.util.extend(d,a);e.prototype=a.prototype;
d.prototype=new e;b&&fyre.v1.util.extend(d.prototype,b);c&&fyre.v1.util.extend(d,c);d.prototype.constructor=d;d.__super__=a.prototype;return d};return c}();fyre.v1.model={};fyre.v1.model.DEBUG_MODEL=!1;fyre.v1.model.DEBUG_MODEL_VERBOSE=!0;fyre.v1.model.Model=function(){fyre.v1.lib.Backbone.Model.apply(this,arguments);fyre.v1.model.DEBUG_MODEL&&goog.DEBUG&&(this.logger=fyre.v1.logging.getLogger(this.getName_()),this.on(fyre.v1.model.Model.EVENTS.ALL,function(a){this.logger.finer('Model update "'+a+'"')}))};goog.inherits(fyre.v1.model.Model,fyre.v1.lib.Backbone.Model);
fyre.v1.model.Model.prototype.getName_=function(){var a=this.constructor.toString(),a=a.slice(a.search(/ATTRIBUTES = (.*)\.ATTRIBUTES/)+13);return a=a.slice(0,a.search(/\.ATTRIBUTES/))};fyre.v1.model.Model.EVENTS=fyre.v1.model.Model.prototype.EVENTS={ALL:"all",ADD:"add",CHANGE:"change",DESTROY:"destroy",ERROR:"error",REMOVE:"remove",RESET:"reset",SYNC:"sync"};fyre.v1.model.Model.attributeChangeEvent=function(a){return fyre.v1.model.Model.EVENTS.CHANGE+":"+a};
fyre.v1.model.Model.prototype.onChange=function(a,b,c){var d;goog.isString(a)?(d=this.attributeChangeEvent(a),a=b):(d=this.EVENTS.CHANGE,c=b);goog.asserts.assertFunction(a);this.on(d,a,c)};fyre.v1.model.Model.prototype.attributeChangeEvent=fyre.v1.model.Model.attributeChangeEvent;fyre.v1.model.Model.prototype.increment=function(a,b){this.set(a,this.get(a)+(b||0===b?b:1))};fyre.v1.model.Model.prototype.decrement=function(a,b){this.increment(a,-1*(b||0===b?b:1))};
fyre.v1.model.Model.prototype.destroy=function(){this.trigger(this.EVENTS.DESTROY)};fyre.v1.model.Model.CHECK_ATTRIBUTES=!0;fyre.v1.model.Model.prototype.set=function(a,b){return fyre.v1.lib.Backbone.Model.prototype.set.apply(this,arguments)};fyre.v1.model.Model.prototype.update=function(a,b,c){var d;goog.isObject(a)||null==a?(d=a,c=b):(d={},d[a]=b);return this.changedAttributes(d)?this.set(d,c):this};
fyre.v1.model.Model.prototype.get=function(a){return fyre.v1.lib.Backbone.Model.prototype.get.apply(this,arguments)};
fyre.v1.model.Model.prototype.checkArguments_=function(a,b){if(goog.DEBUG&&fyre.v1.model.Model.CHECK_ATTRIBUTES){try{if(goog.isObject(b[0]))var c=b[0];else c={},c[b[0]]=b[1]}catch(d){goog.asserts.assert(!1,"Improper arguments for fyre.v1.model.Model."+a)}c=goog.array.filter(goog.object.getKeys(c),function(a){return"id"==a?!1:!goog.array.contains(goog.object.getValues(this.ATTRIBUTES),a)},this);goog.asserts.assert(!c.length,"Tried to "+a+' model attribute(s) not declared in this.ATTRIBUTES: missing "'+
c.join('", "')+'"')}};fyre.v1.model.Model.prototype.on=function(){fyre.v1.lib.Backbone.Model.prototype.on.apply(this,arguments)};fyre.v1.model.Model.prototype.reset=function(a){var b=this.defaults;if(goog.isArray(a))for(var c=0;c<a.length;c++)delete b[a[c]];this.set(b)};goog.fx={};goog.fx.easing={};goog.fx.easing.easeIn=function(a){return a*a*a};goog.fx.easing.easeOut=function(a){return 1-Math.pow(1-a,3)};goog.fx.easing.inAndOut=function(a){return 3*a*a-2*a*a*a};goog.color={};
goog.color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",
darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",
ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",
lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",
moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",
seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};goog.math.randomInt=function(a){return Math.floor(Math.random()*a)};goog.math.uniformRandom=function(a,b){return a+Math.random()*(b-a)};goog.math.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};goog.math.modulo=function(a,b){var c=a%b;return 0>c*b?c+b:c};goog.math.lerp=function(a,b,c){return a+c*(b-a)};goog.math.nearlyEquals=function(a,b,c){return Math.abs(a-b)<=(c||1.0E-6)};goog.math.standardAngle=function(a){return goog.math.modulo(a,360)};
goog.math.toRadians=function(a){return a*Math.PI/180};goog.math.toDegrees=function(a){return 180*a/Math.PI};goog.math.angleDx=function(a,b){return b*Math.cos(goog.math.toRadians(a))};goog.math.angleDy=function(a,b){return b*Math.sin(goog.math.toRadians(a))};goog.math.angle=function(a,b,c,d){return goog.math.standardAngle(goog.math.toDegrees(Math.atan2(d-b,c-a)))};goog.math.angleDifference=function(a,b){var c=goog.math.standardAngle(b)-goog.math.standardAngle(a);180<c?c-=360:-180>=c&&(c=360+c);return c};
goog.math.sign=function(a){return 0==a?0:0>a?-1:1};goog.math.longestCommonSubsequence=function(a,b,c,d){for(var c=c||function(a,b){return a==b},d=d||function(b){return a[b]},e=a.length,f=b.length,g=[],h=0;h<e+1;h++)g[h]=[],g[h][0]=0;for(var i=0;i<f+1;i++)g[0][i]=0;for(h=1;h<=e;h++)for(i=1;i<=e;i++)g[h][i]=c(a[h-1],b[i-1])?g[h-1][i-1]+1:Math.max(g[h-1][i],g[h][i-1]);for(var j=[],h=e,i=f;0<h&&0<i;)c(a[h-1],b[i-1])?(j.unshift(d(h-1,i-1)),h--,i--):g[h-1][i]>g[h][i-1]?h--:i--;return j};
goog.math.sum=function(a){return goog.array.reduce(arguments,function(a,c){return a+c},0)};goog.math.average=function(a){return goog.math.sum.apply(null,arguments)/arguments.length};goog.math.standardDeviation=function(a){var b=arguments.length;if(2>b)return 0;var c=goog.math.average.apply(null,arguments),b=goog.math.sum.apply(null,goog.array.map(arguments,function(a){return Math.pow(a-c,2)}))/(b-1);return Math.sqrt(b)};goog.math.isInt=function(a){return isFinite(a)&&0==a%1};
goog.math.isFiniteNumber=function(a){return isFinite(a)&&!isNaN(a)};goog.color.parse=function(a){var b={},a=""+a,c=goog.color.prependHashIfNecessaryHelper(a);if(goog.color.isValidHexColor_(c))return b.hex=goog.color.normalizeHex(c),b.type="hex",b;c=goog.color.isValidRgbColor_(a);if(c.length)return b.hex=goog.color.rgbArrayToHex(c),b.type="rgb",b;if(goog.color.names&&(c=goog.color.names[a.toLowerCase()]))return b.hex=c,b.type="named",b;throw Error(a+" is not a valid color string");};
goog.color.isValidColor=function(a){var b=goog.color.prependHashIfNecessaryHelper(a);return!(!goog.color.isValidHexColor_(b)&&!(goog.color.isValidRgbColor_(a).length||goog.color.names&&goog.color.names[a.toLowerCase()]))};goog.color.parseRgb=function(a){var b=goog.color.isValidRgbColor_(a);if(!b.length)throw Error(a+" is not a valid RGB color");return b};goog.color.hexToRgbStyle=function(a){return goog.color.rgbStyle_(goog.color.hexToRgb(a))};goog.color.hexTripletRe_=/#(.)(.)(.)/;
goog.color.normalizeHex=function(a){if(!goog.color.isValidHexColor_(a))throw Error("'"+a+"' is not a valid hex color");4==a.length&&(a=a.replace(goog.color.hexTripletRe_,"#$1$1$2$2$3$3"));return a.toLowerCase()};goog.color.hexToRgb=function(a){var a=goog.color.normalizeHex(a),b=parseInt(a.substr(1,2),16),c=parseInt(a.substr(3,2),16),a=parseInt(a.substr(5,2),16);return[b,c,a]};
goog.color.rgbToHex=function(a,b,c){a=Number(a);b=Number(b);c=Number(c);if(isNaN(a)||0>a||255<a||isNaN(b)||0>b||255<b||isNaN(c)||0>c||255<c)throw Error('"('+a+","+b+","+c+'") is not a valid RGB color');a=goog.color.prependZeroIfNecessaryHelper(a.toString(16));b=goog.color.prependZeroIfNecessaryHelper(b.toString(16));c=goog.color.prependZeroIfNecessaryHelper(c.toString(16));return"#"+a+b+c};goog.color.rgbArrayToHex=function(a){return goog.color.rgbToHex(a[0],a[1],a[2])};
goog.color.rgbToHsl=function(a,b,c){var a=a/255,b=b/255,c=c/255,d=Math.max(a,b,c),e=Math.min(a,b,c),f=0,g=0,h=0.5*(d+e);d!=e&&(d==a?f=60*(b-c)/(d-e):d==b?f=60*(c-a)/(d-e)+120:d==c&&(f=60*(a-b)/(d-e)+240),g=0<h&&0.5>=h?(d-e)/(2*h):(d-e)/(2-2*h));return[Math.round(f+360)%360,g,h]};goog.color.rgbArrayToHsl=function(a){return goog.color.rgbToHsl(a[0],a[1],a[2])};goog.color.hueToRgb_=function(a,b,c){0>c?c+=1:1<c&&(c-=1);return 1>6*c?a+6*(b-a)*c:1>2*c?b:2>3*c?a+6*(b-a)*(2/3-c):a};
goog.color.hslToRgb=function(a,b,c){var d=0,e=0,f=0,a=a/360;if(0==b)d=e=f=255*c;else var g=f=0,g=0.5>c?c*(1+b):c+b-b*c,f=2*c-g,d=255*goog.color.hueToRgb_(f,g,a+1/3),e=255*goog.color.hueToRgb_(f,g,a),f=255*goog.color.hueToRgb_(f,g,a-1/3);return[Math.round(d),Math.round(e),Math.round(f)]};goog.color.hslArrayToRgb=function(a){return goog.color.hslToRgb(a[0],a[1],a[2])};goog.color.validHexColorRe_=/^#(?:[0-9a-f]{3}){1,2}$/i;goog.color.isValidHexColor_=function(a){return goog.color.validHexColorRe_.test(a)};
goog.color.normalizedHexColorRe_=/^#[0-9a-f]{6}$/;goog.color.isNormalizedHexColor_=function(a){return goog.color.normalizedHexColorRe_.test(a)};goog.color.rgbColorRe_=/^(?:rgb)?\((0|[1-9]\d{0,2}),\s?(0|[1-9]\d{0,2}),\s?(0|[1-9]\d{0,2})\)$/i;goog.color.isValidRgbColor_=function(a){var b=a.match(goog.color.rgbColorRe_);if(b){var a=Number(b[1]),c=Number(b[2]),b=Number(b[3]);if(0<=a&&255>=a&&0<=c&&255>=c&&0<=b&&255>=b)return[a,c,b]}return[]};
goog.color.prependZeroIfNecessaryHelper=function(a){return 1==a.length?"0"+a:a};goog.color.prependHashIfNecessaryHelper=function(a){return"#"==a.charAt(0)?a:"#"+a};goog.color.rgbStyle_=function(a){return"rgb("+a.join(",")+")"};
goog.color.hsvToRgb=function(a,b,c){var d=0,e=0,f=0;if(0==b)f=e=d=c;else{var g=Math.floor(a/60),h=a/60-g,a=c*(1-b),i=c*(1-b*h),b=c*(1-b*(1-h));switch(g){case 1:d=i;e=c;f=a;break;case 2:d=a;e=c;f=b;break;case 3:d=a;e=i;f=c;break;case 4:d=b;e=a;f=c;break;case 5:d=c;e=a;f=i;break;case 6:case 0:d=c,e=b,f=a}}return[Math.floor(d),Math.floor(e),Math.floor(f)]};
goog.color.rgbToHsv=function(a,b,c){var d=Math.max(Math.max(a,b),c),e=Math.min(Math.min(a,b),c);if(e==d)e=a=0;else{var f=d-e,e=f/d,a=60*(a==d?(b-c)/f:b==d?2+(c-a)/f:4+(a-b)/f);0>a&&(a+=360);360<a&&(a-=360)}return[a,e,d]};goog.color.rgbArrayToHsv=function(a){return goog.color.rgbToHsv(a[0],a[1],a[2])};goog.color.hsvArrayToRgb=function(a){return goog.color.hsvToRgb(a[0],a[1],a[2])};goog.color.hexToHsl=function(a){a=goog.color.hexToRgb(a);return goog.color.rgbToHsl(a[0],a[1],a[2])};
goog.color.hslToHex=function(a,b,c){return goog.color.rgbArrayToHex(goog.color.hslToRgb(a,b,c))};goog.color.hslArrayToHex=function(a){return goog.color.rgbArrayToHex(goog.color.hslToRgb(a[0],a[1],a[2]))};goog.color.hexToHsv=function(a){return goog.color.rgbArrayToHsv(goog.color.hexToRgb(a))};goog.color.hsvToHex=function(a,b,c){return goog.color.rgbArrayToHex(goog.color.hsvToRgb(a,b,c))};goog.color.hsvArrayToHex=function(a){return goog.color.hsvToHex(a[0],a[1],a[2])};
goog.color.hslDistance=function(a,b){var c,d;c=0.5>=a[2]?a[1]*a[2]:a[1]*(1-a[2]);d=0.5>=b[2]?b[1]*b[2]:b[1]*(1-b[2]);return(a[2]-b[2])*(a[2]-b[2])+c*c+d*d-2*c*d*Math.cos(2*(a[0]/360-b[0]/360)*Math.PI)};goog.color.blend=function(a,b,c){c=goog.math.clamp(c,0,1);return[Math.round(c*a[0]+(1-c)*b[0]),Math.round(c*a[1]+(1-c)*b[1]),Math.round(c*a[2]+(1-c)*b[2])]};goog.color.darken=function(a,b){return goog.color.blend([0,0,0],a,b)};
goog.color.lighten=function(a,b){return goog.color.blend([255,255,255],a,b)};goog.color.highContrast=function(a,b){for(var c=[],d=0;d<b.length;d++)c.push({color:b[d],diff:goog.color.yiqBrightnessDiff_(b[d],a)+goog.color.colorDiff_(b[d],a)});c.sort(function(a,b){return b.diff-a.diff});return c[0].color};goog.color.yiqBrightness_=function(a){return Math.round((299*a[0]+587*a[1]+114*a[2])/1E3)};goog.color.yiqBrightnessDiff_=function(a,b){return Math.abs(goog.color.yiqBrightness_(a)-goog.color.yiqBrightness_(b))};
goog.color.colorDiff_=function(a,b){return Math.abs(a[0]-b[0])+Math.abs(a[1]-b[1])+Math.abs(a[2]-b[2])};goog.debug.entryPointRegistry={};goog.debug.EntryPointMonitor=function(){};goog.debug.entryPointRegistry.refList_=[];goog.debug.entryPointRegistry.monitors_=[];goog.debug.entryPointRegistry.monitorsMayExist_=!1;goog.debug.entryPointRegistry.register=function(a){goog.debug.entryPointRegistry.refList_[goog.debug.entryPointRegistry.refList_.length]=a;if(goog.debug.entryPointRegistry.monitorsMayExist_)for(var b=goog.debug.entryPointRegistry.monitors_,c=0;c<b.length;c++)a(goog.bind(b[c].wrap,b[c]))};
goog.debug.entryPointRegistry.monitorAll=function(a){goog.debug.entryPointRegistry.monitorsMayExist_=!0;for(var b=goog.bind(a.wrap,a),c=0;c<goog.debug.entryPointRegistry.refList_.length;c++)goog.debug.entryPointRegistry.refList_[c](b);goog.debug.entryPointRegistry.monitors_.push(a)};
goog.debug.entryPointRegistry.unmonitorAllIfPossible=function(a){var b=goog.debug.entryPointRegistry.monitors_;goog.asserts.assert(a==b[b.length-1],"Only the most recent monitor can be unwrapped.");for(var a=goog.bind(a.unwrap,a),c=0;c<goog.debug.entryPointRegistry.refList_.length;c++)goog.debug.entryPointRegistry.refList_[c](a);b.length--};goog.debug.errorHandlerWeakDep={protectEntryPoint:function(a){return a}};goog.events={};
goog.events.BrowserFeature={HAS_W3C_BUTTON:!goog.userAgent.IE||goog.userAgent.isDocumentMode(9),HAS_W3C_EVENT_SUPPORT:!goog.userAgent.IE||goog.userAgent.isDocumentMode(9),SET_KEY_CODE_TO_PREVENT_DEFAULT:goog.userAgent.IE&&!goog.userAgent.isVersion("8"),HAS_NAVIGATOR_ONLINE_PROPERTY:!goog.userAgent.WEBKIT||goog.userAgent.isVersion("528"),HAS_HTML5_NETWORK_EVENT_SUPPORT:goog.userAgent.GECKO&&goog.userAgent.isVersion("1.9b")||goog.userAgent.IE&&goog.userAgent.isVersion("8")||goog.userAgent.OPERA&&goog.userAgent.isVersion("9.5")||
goog.userAgent.WEBKIT&&goog.userAgent.isVersion("528"),HTML5_NETWORK_EVENTS_FIRE_ON_WINDOW:!goog.userAgent.GECKO||goog.userAgent.isVersion("8")};goog.events.Event=function(a,b){goog.Disposable.call(this);this.type=a;this.currentTarget=this.target=b};goog.inherits(goog.events.Event,goog.Disposable);goog.events.Event.prototype.disposeInternal=function(){delete this.type;delete this.target;delete this.currentTarget};goog.events.Event.prototype.propagationStopped_=!1;goog.events.Event.prototype.returnValue_=!0;goog.events.Event.prototype.stopPropagation=function(){this.propagationStopped_=!0};
goog.events.Event.prototype.preventDefault=function(){this.returnValue_=!1};goog.events.Event.stopPropagation=function(a){a.stopPropagation()};goog.events.Event.preventDefault=function(a){a.preventDefault()};goog.events.EventType={CLICK:"click",DBLCLICK:"dblclick",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",SELECTSTART:"selectstart",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",BLUR:"blur",FOCUS:"focus",DEACTIVATE:"deactivate",FOCUSIN:goog.userAgent.IE?"focusin":"DOMFocusIn",FOCUSOUT:goog.userAgent.IE?"focusout":"DOMFocusOut",CHANGE:"change",SELECT:"select",SUBMIT:"submit",INPUT:"input",PROPERTYCHANGE:"propertychange",DRAGSTART:"dragstart",
DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",TOUCHCANCEL:"touchcancel",CONTEXTMENU:"contextmenu",ERROR:"error",HELP:"help",LOAD:"load",LOSECAPTURE:"losecapture",READYSTATECHANGE:"readystatechange",RESIZE:"resize",SCROLL:"scroll",UNLOAD:"unload",HASHCHANGE:"hashchange",PAGEHIDE:"pagehide",PAGESHOW:"pageshow",POPSTATE:"popstate",COPY:"copy",PASTE:"paste",CUT:"cut",BEFORECOPY:"beforecopy",BEFORECUT:"beforecut",
BEFOREPASTE:"beforepaste",MESSAGE:"message",CONNECT:"connect",TRANSITIONEND:goog.userAgent.WEBKIT?"webkitTransitionEnd":goog.userAgent.OPERA?"oTransitionEnd":"transitionend"};goog.reflect={};goog.reflect.object=function(a,b){return b};goog.reflect.sinkValue=function(a){goog.reflect.sinkValue[" "](a);return a};goog.reflect.sinkValue[" "]=goog.nullFunction;goog.reflect.canAccessProperty=function(a,b){try{return goog.reflect.sinkValue(a[b]),!0}catch(c){}return!1};goog.events.BrowserEvent=function(a,b){a&&this.init(a,b)};goog.inherits(goog.events.BrowserEvent,goog.events.Event);goog.events.BrowserEvent.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2};goog.events.BrowserEvent.IEButtonMap=[1,4,2];goog.events.BrowserEvent.prototype.target=null;goog.events.BrowserEvent.prototype.relatedTarget=null;goog.events.BrowserEvent.prototype.offsetX=0;goog.events.BrowserEvent.prototype.offsetY=0;goog.events.BrowserEvent.prototype.clientX=0;
goog.events.BrowserEvent.prototype.clientY=0;goog.events.BrowserEvent.prototype.screenX=0;goog.events.BrowserEvent.prototype.screenY=0;goog.events.BrowserEvent.prototype.button=0;goog.events.BrowserEvent.prototype.keyCode=0;goog.events.BrowserEvent.prototype.charCode=0;goog.events.BrowserEvent.prototype.ctrlKey=!1;goog.events.BrowserEvent.prototype.altKey=!1;goog.events.BrowserEvent.prototype.shiftKey=!1;goog.events.BrowserEvent.prototype.metaKey=!1;
goog.events.BrowserEvent.prototype.platformModifierKey=!1;goog.events.BrowserEvent.prototype.event_=null;
goog.events.BrowserEvent.prototype.init=function(a,b){var c=this.type=a.type;goog.events.Event.call(this,c);this.target=a.target||a.srcElement;this.currentTarget=b;var d=a.relatedTarget;d?goog.userAgent.GECKO&&(goog.reflect.canAccessProperty(d,"nodeName")||(d=null)):c==goog.events.EventType.MOUSEOVER?d=a.fromElement:c==goog.events.EventType.MOUSEOUT&&(d=a.toElement);this.relatedTarget=d;this.offsetX=goog.userAgent.WEBKIT||void 0!==a.offsetX?a.offsetX:a.layerX;this.offsetY=goog.userAgent.WEBKIT||void 0!==
a.offsetY?a.offsetY:a.layerY;this.clientX=void 0!==a.clientX?a.clientX:a.pageX;this.clientY=void 0!==a.clientY?a.clientY:a.pageY;this.screenX=a.screenX||0;this.screenY=a.screenY||0;this.button=a.button;this.keyCode=a.keyCode||0;this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.platformModifierKey=goog.userAgent.MAC?a.metaKey:a.ctrlKey;this.state=a.state;this.event_=a;delete this.returnValue_;delete this.propagationStopped_};
goog.events.BrowserEvent.prototype.isButton=function(a){return goog.events.BrowserFeature.HAS_W3C_BUTTON?this.event_.button==a:"click"==this.type?a==goog.events.BrowserEvent.MouseButton.LEFT:!!(this.event_.button&goog.events.BrowserEvent.IEButtonMap[a])};goog.events.BrowserEvent.prototype.isMouseActionButton=function(){return this.isButton(goog.events.BrowserEvent.MouseButton.LEFT)&&!(goog.userAgent.WEBKIT&&goog.userAgent.MAC&&this.ctrlKey)};
goog.events.BrowserEvent.prototype.stopPropagation=function(){goog.events.BrowserEvent.superClass_.stopPropagation.call(this);this.event_.stopPropagation?this.event_.stopPropagation():this.event_.cancelBubble=!0};
goog.events.BrowserEvent.prototype.preventDefault=function(){goog.events.BrowserEvent.superClass_.preventDefault.call(this);var a=this.event_;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,goog.events.BrowserFeature.SET_KEY_CODE_TO_PREVENT_DEFAULT)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};goog.events.BrowserEvent.prototype.getBrowserEvent=function(){return this.event_};
goog.events.BrowserEvent.prototype.disposeInternal=function(){goog.events.BrowserEvent.superClass_.disposeInternal.call(this);this.relatedTarget=this.currentTarget=this.target=this.event_=null};goog.events.EventWrapper=function(){};goog.events.EventWrapper.prototype.listen=function(){};goog.events.EventWrapper.prototype.unlisten=function(){};goog.events.Listener=function(){};goog.events.Listener.counter_=0;goog.events.Listener.prototype.key=0;goog.events.Listener.prototype.removed=!1;goog.events.Listener.prototype.callOnce=!1;
goog.events.Listener.prototype.init=function(a,b,c,d,e,f){if(goog.isFunction(a))this.isFunctionListener_=!0;else if(a&&a.handleEvent&&goog.isFunction(a.handleEvent))this.isFunctionListener_=!1;else throw Error("Invalid listener argument");this.listener=a;this.proxy=b;this.src=c;this.type=d;this.capture=!!e;this.handler=f;this.callOnce=!1;this.key=++goog.events.Listener.counter_;this.removed=!1};
goog.events.Listener.prototype.handleEvent=function(a){return this.isFunctionListener_?this.listener.call(this.handler||this.src,a):this.listener.handleEvent.call(this.listener,a)};goog.events.ASSUME_GOOD_GC=!1;goog.events.listeners_={};goog.events.listenerTree_={};goog.events.sources_={};goog.events.onString_="on";goog.events.onStringMap_={};goog.events.keySeparator_="_";
goog.events.listen=function(a,b,c,d,e){if(b){if(goog.isArray(b)){for(var f=0;f<b.length;f++)goog.events.listen(a,b[f],c,d,e);return null}var d=!!d,g=goog.events.listenerTree_;b in g||(g[b]={count_:0,remaining_:0});g=g[b];d in g||(g[d]={count_:0,remaining_:0},g.count_++);var g=g[d],h=goog.getUid(a),i;g.remaining_++;if(g[h]){i=g[h];for(f=0;f<i.length;f++)if(g=i[f],g.listener==c&&g.handler==e){if(g.removed)break;return i[f].key}}else i=g[h]=[],g.count_++;f=goog.events.getProxy();f.src=a;g=new goog.events.Listener;
g.init(c,f,a,b,d,e);c=g.key;f.key=c;i.push(g);goog.events.listeners_[c]=g;goog.events.sources_[h]||(goog.events.sources_[h]=[]);goog.events.sources_[h].push(g);a.addEventListener?(a==goog.global||!a.customEvent_)&&a.addEventListener(b,f,d):a.attachEvent(goog.events.getOnString_(b),f);return c}throw Error("Invalid event type");};
goog.events.getProxy=function(){var a=goog.events.handleBrowserEvent_,b=goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT?function(c){return a.call(b.src,b.key,c)}:function(c){c=a.call(b.src,b.key,c);if(!c)return c};return b};goog.events.listenOnce=function(a,b,c,d,e){if(goog.isArray(b)){for(var f=0;f<b.length;f++)goog.events.listenOnce(a,b[f],c,d,e);return null}a=goog.events.listen(a,b,c,d,e);goog.events.listeners_[a].callOnce=!0;return a};
goog.events.listenWithWrapper=function(a,b,c,d,e){b.listen(a,c,d,e)};goog.events.unlisten=function(a,b,c,d,e){if(goog.isArray(b)){for(var f=0;f<b.length;f++)goog.events.unlisten(a,b[f],c,d,e);return null}d=!!d;a=goog.events.getListeners_(a,b,d);if(!a)return!1;for(f=0;f<a.length;f++)if(a[f].listener==c&&a[f].capture==d&&a[f].handler==e)return goog.events.unlistenByKey(a[f].key);return!1};
goog.events.unlistenByKey=function(a){if(!goog.events.listeners_[a])return!1;var b=goog.events.listeners_[a];if(b.removed)return!1;var c=b.src,d=b.type,e=b.proxy,f=b.capture;c.removeEventListener?(c==goog.global||!c.customEvent_)&&c.removeEventListener(d,e,f):c.detachEvent&&c.detachEvent(goog.events.getOnString_(d),e);c=goog.getUid(c);e=goog.events.listenerTree_[d][f][c];if(goog.events.sources_[c]){var g=goog.events.sources_[c];goog.array.remove(g,b);0==g.length&&delete goog.events.sources_[c]}b.removed=
!0;e.needsCleanup_=!0;goog.events.cleanUp_(d,f,c,e);delete goog.events.listeners_[a];return!0};goog.events.unlistenWithWrapper=function(a,b,c,d,e){b.unlisten(a,c,d,e)};
goog.events.cleanUp_=function(a,b,c,d){if(!d.locked_&&d.needsCleanup_){for(var e=0,f=0;e<d.length;e++)d[e].removed?d[e].proxy.src=null:(e!=f&&(d[f]=d[e]),f++);d.length=f;d.needsCleanup_=!1;0==f&&(delete goog.events.listenerTree_[a][b][c],goog.events.listenerTree_[a][b].count_--,0==goog.events.listenerTree_[a][b].count_&&(delete goog.events.listenerTree_[a][b],goog.events.listenerTree_[a].count_--),0==goog.events.listenerTree_[a].count_&&delete goog.events.listenerTree_[a])}};
goog.events.removeAll=function(a,b,c){var d=0,e=null==b,f=null==c,c=!!c;if(null==a)goog.object.forEach(goog.events.sources_,function(a){for(var g=a.length-1;0<=g;g--){var h=a[g];if((e||b==h.type)&&(f||c==h.capture))goog.events.unlistenByKey(h.key),d++}});else if(a=goog.getUid(a),goog.events.sources_[a])for(var a=goog.events.sources_[a],g=a.length-1;0<=g;g--){var h=a[g];if((e||b==h.type)&&(f||c==h.capture))goog.events.unlistenByKey(h.key),d++}return d};
goog.events.getListeners=function(a,b,c){return goog.events.getListeners_(a,b,c)||[]};goog.events.getListeners_=function(a,b,c){var d=goog.events.listenerTree_;return b in d&&(d=d[b],c in d&&(d=d[c],a=goog.getUid(a),d[a]))?d[a]:null};goog.events.getListener=function(a,b,c,d,e){d=!!d;if(a=goog.events.getListeners_(a,b,d))for(b=0;b<a.length;b++)if(!a[b].removed&&a[b].listener==c&&a[b].capture==d&&a[b].handler==e)return a[b];return null};
goog.events.hasListener=function(a,b,c){var a=goog.getUid(a),d=goog.events.sources_[a];if(d){var e=goog.isDef(b),f=goog.isDef(c);return e&&f?(d=goog.events.listenerTree_[b],!!d&&!!d[c]&&a in d[c]):!e&&!f?!0:goog.array.some(d,function(a){return e&&a.type==b||f&&a.capture==c})}return!1};goog.events.expose=function(a){var b=[],c;for(c in a)a[c]&&a[c].id?b.push(c+" = "+a[c]+" ("+a[c].id+")"):b.push(c+" = "+a[c]);return b.join("\n")};
goog.events.getOnString_=function(a){return a in goog.events.onStringMap_?goog.events.onStringMap_[a]:goog.events.onStringMap_[a]=goog.events.onString_+a};goog.events.fireListeners=function(a,b,c,d){var e=goog.events.listenerTree_;return b in e&&(e=e[b],c in e)?goog.events.fireListeners_(e[c],a,b,c,d):!0};
goog.events.fireListeners_=function(a,b,c,d,e){var f=1,b=goog.getUid(b);if(a[b]){a.remaining_--;a=a[b];a.locked_?a.locked_++:a.locked_=1;try{for(var g=a.length,h=0;h<g;h++){var i=a[h];i&&!i.removed&&(f&=!1!==goog.events.fireListener(i,e))}}finally{a.locked_--,goog.events.cleanUp_(c,d,b,a)}}return Boolean(f)};goog.events.fireListener=function(a,b){var c=a.handleEvent(b);a.callOnce&&goog.events.unlistenByKey(a.key);return c};goog.events.getTotalListenerCount=function(){return goog.object.getCount(goog.events.listeners_)};
goog.events.dispatchEvent=function(a,b){var c=b.type||b,d=goog.events.listenerTree_;if(!(c in d))return!0;if(goog.isString(b))b=new goog.events.Event(b,a);else if(b instanceof goog.events.Event)b.target=b.target||a;else{var e=b,b=new goog.events.Event(c,a);goog.object.extend(b,e)}var e=1,f,d=d[c],c=!0 in d,g;if(c){f=[];for(g=a;g;g=g.getParentEventTarget())f.push(g);g=d[!0];g.remaining_=g.count_;for(var h=f.length-1;!b.propagationStopped_&&0<=h&&g.remaining_;h--)b.currentTarget=f[h],e&=goog.events.fireListeners_(g,
f[h],b.type,!0,b)&&!1!=b.returnValue_}if(!1 in d)if(g=d[!1],g.remaining_=g.count_,c)for(h=0;!b.propagationStopped_&&h<f.length&&g.remaining_;h++)b.currentTarget=f[h],e&=goog.events.fireListeners_(g,f[h],b.type,!1,b)&&!1!=b.returnValue_;else for(d=a;!b.propagationStopped_&&d&&g.remaining_;d=d.getParentEventTarget())b.currentTarget=d,e&=goog.events.fireListeners_(g,d,b.type,!1,b)&&!1!=b.returnValue_;return Boolean(e)};
goog.events.protectBrowserEventEntryPoint=function(a){goog.events.handleBrowserEvent_=a.protectEntryPoint(goog.events.handleBrowserEvent_)};
goog.events.handleBrowserEvent_=function(a,b){if(!goog.events.listeners_[a])return!0;var c=goog.events.listeners_[a],d=c.type,e=goog.events.listenerTree_;if(!(d in e))return!0;var e=e[d],f,g;if(!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){f=b||goog.getObjectByName("window.event");var h=!0 in e,i=!1 in e;if(h){if(goog.events.isMarkedIeEvent_(f))return!0;goog.events.markIeEvent_(f)}var j=new goog.events.BrowserEvent;j.init(f,this);f=!0;try{if(h){for(var k=[],l=j.currentTarget;l;l=l.parentNode)k.push(l);
g=e[!0];g.remaining_=g.count_;for(var m=k.length-1;!j.propagationStopped_&&0<=m&&g.remaining_;m--)j.currentTarget=k[m],f&=goog.events.fireListeners_(g,k[m],d,!0,j);if(i){g=e[!1];g.remaining_=g.count_;for(m=0;!j.propagationStopped_&&m<k.length&&g.remaining_;m++)j.currentTarget=k[m],f&=goog.events.fireListeners_(g,k[m],d,!1,j)}}else f=goog.events.fireListener(c,j)}finally{k&&(k.length=0),j.dispose()}return f}d=new goog.events.BrowserEvent(b,this);try{f=goog.events.fireListener(c,d)}finally{d.dispose()}return f};
goog.events.markIeEvent_=function(a){var b=!1;if(0==a.keyCode)try{a.keyCode=-1;return}catch(c){b=!0}if(b||void 0==a.returnValue)a.returnValue=!0};goog.events.isMarkedIeEvent_=function(a){return 0>a.keyCode||void 0!=a.returnValue};goog.events.uniqueIdCounter_=0;goog.events.getUniqueId=function(a){return a+"_"+goog.events.uniqueIdCounter_++};goog.debug.entryPointRegistry.register(function(a){goog.events.handleBrowserEvent_=a(goog.events.handleBrowserEvent_)});goog.fx.Transition=function(){};goog.fx.Transition.EventType={PLAY:"play",BEGIN:"begin",RESUME:"resume",END:"end",STOP:"stop",FINISH:"finish",PAUSE:"pause"};goog.events.EventTarget=function(){goog.Disposable.call(this)};goog.inherits(goog.events.EventTarget,goog.Disposable);goog.events.EventTarget.prototype.customEvent_=!0;goog.events.EventTarget.prototype.parentEventTarget_=null;goog.events.EventTarget.prototype.getParentEventTarget=function(){return this.parentEventTarget_};goog.events.EventTarget.prototype.setParentEventTarget=function(a){this.parentEventTarget_=a};
goog.events.EventTarget.prototype.addEventListener=function(a,b,c,d){goog.events.listen(this,a,b,c,d)};goog.events.EventTarget.prototype.removeEventListener=function(a,b,c,d){goog.events.unlisten(this,a,b,c,d)};goog.events.EventTarget.prototype.dispatchEvent=function(a){return goog.events.dispatchEvent(this,a)};goog.events.EventTarget.prototype.disposeInternal=function(){goog.events.EventTarget.superClass_.disposeInternal.call(this);goog.events.removeAll(this);this.parentEventTarget_=null};goog.fx.TransitionBase=function(){goog.events.EventTarget.call(this);this.state_=goog.fx.TransitionBase.State.STOPPED;this.endTime=this.startTime=null};goog.inherits(goog.fx.TransitionBase,goog.events.EventTarget);goog.fx.TransitionBase.State={STOPPED:0,PAUSED:-1,PLAYING:1};goog.fx.TransitionBase.prototype.getStateInternal=function(){return this.state_};goog.fx.TransitionBase.prototype.setStatePlaying=function(){this.state_=goog.fx.TransitionBase.State.PLAYING};
goog.fx.TransitionBase.prototype.setStatePaused=function(){this.state_=goog.fx.TransitionBase.State.PAUSED};goog.fx.TransitionBase.prototype.setStateStopped=function(){this.state_=goog.fx.TransitionBase.State.STOPPED};goog.fx.TransitionBase.prototype.isPlaying=function(){return this.state_==goog.fx.TransitionBase.State.PLAYING};goog.fx.TransitionBase.prototype.isPaused=function(){return this.state_==goog.fx.TransitionBase.State.PAUSED};
goog.fx.TransitionBase.prototype.isStopped=function(){return this.state_==goog.fx.TransitionBase.State.STOPPED};goog.fx.TransitionBase.prototype.onBegin=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.BEGIN)};goog.fx.TransitionBase.prototype.onEnd=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.END)};goog.fx.TransitionBase.prototype.onFinish=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.FINISH)};
goog.fx.TransitionBase.prototype.onPause=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.PAUSE)};goog.fx.TransitionBase.prototype.onPlay=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.PLAY)};goog.fx.TransitionBase.prototype.onResume=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.RESUME)};goog.fx.TransitionBase.prototype.onStop=function(){this.dispatchAnimationEvent(goog.fx.Transition.EventType.STOP)};
goog.fx.TransitionBase.prototype.dispatchAnimationEvent=function(a){this.dispatchEvent(a)};goog.Timer=function(a,b){goog.events.EventTarget.call(this);this.interval_=a||1;this.timerObject_=b||goog.Timer.defaultTimerObject;this.boundTick_=goog.bind(this.tick_,this);this.last_=goog.now()};goog.inherits(goog.Timer,goog.events.EventTarget);goog.Timer.MAX_TIMEOUT_=2147483647;goog.Timer.prototype.enabled=!1;goog.Timer.defaultTimerObject=goog.global.window;goog.Timer.intervalScale=0.8;goog.Timer.prototype.timer_=null;goog.Timer.prototype.getInterval=function(){return this.interval_};
goog.Timer.prototype.setInterval=function(a){this.interval_=a;this.timer_&&this.enabled?(this.stop(),this.start()):this.timer_&&this.stop()};goog.Timer.prototype.tick_=function(){if(this.enabled){var a=goog.now()-this.last_;0<a&&a<this.interval_*goog.Timer.intervalScale?this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_-a):(this.dispatchTick(),this.enabled&&(this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_),this.last_=goog.now()))}};
goog.Timer.prototype.dispatchTick=function(){this.dispatchEvent(goog.Timer.TICK)};goog.Timer.prototype.start=function(){this.enabled=!0;this.timer_||(this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_),this.last_=goog.now())};goog.Timer.prototype.stop=function(){this.enabled=!1;this.timer_&&(this.timerObject_.clearTimeout(this.timer_),this.timer_=null)};goog.Timer.prototype.disposeInternal=function(){goog.Timer.superClass_.disposeInternal.call(this);this.stop();delete this.timerObject_};
goog.Timer.TICK="tick";goog.Timer.callOnce=function(a,b,c){if(goog.isFunction(a))c&&(a=goog.bind(a,c));else if(a&&"function"==typeof a.handleEvent)a=goog.bind(a.handleEvent,a);else throw Error("Invalid listener argument");return b>goog.Timer.MAX_TIMEOUT_?-1:goog.Timer.defaultTimerObject.setTimeout(a,b||0)};goog.Timer.clear=function(a){goog.Timer.defaultTimerObject.clearTimeout(a)};goog.fx.anim={};goog.fx.anim.Animated=function(){};goog.fx.anim.TIMEOUT=20;goog.fx.anim.MOZ_BEFORE_PAINT_EVENT_="MozBeforePaint";goog.fx.anim.activeAnimations_={};goog.fx.anim.animationWindow_=null;goog.fx.anim.requestAnimationFrameFn_=null;goog.fx.anim.cancelRequestAnimationFrameFn_=null;goog.fx.anim.animationTimer_=null;goog.fx.anim.registerAnimation=function(a){var b=goog.getUid(a);b in goog.fx.anim.activeAnimations_||(goog.fx.anim.activeAnimations_[b]=a);goog.fx.anim.requestAnimationTimer_()};
goog.fx.anim.unregisterAnimation=function(a){a=goog.getUid(a);delete goog.fx.anim.activeAnimations_[a];goog.object.isEmpty(goog.fx.anim.activeAnimations_)&&goog.fx.anim.cancelAnimationTimer_()};
goog.fx.anim.setAnimationWindow=function(a){goog.fx.anim.animationWindow_=a;var b=!!goog.fx.anim.animationTimer_;b&&goog.fx.anim.cancelAnimationTimer_();a?(goog.fx.anim.requestAnimationFrameFn_=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||null,goog.fx.anim.cancelRequestAnimationFrameFn_=a.cancelRequestAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||
a.msCancelRequestAnimationFrame||null):(goog.fx.anim.requestAnimationFrameFn_=null,goog.fx.anim.cancelRequestAnimationFrameFn_=null);goog.fx.anim.requestAnimationFrameFn_&&a.mozRequestAnimationFrame&&!goog.fx.anim.cancelRequestAnimationFrameFn_?(goog.fx.anim.requestAnimationTimer_=goog.fx.anim.requestMozAnimationFrame_,goog.fx.anim.cancelAnimationTimer_=goog.fx.anim.cancelMozAnimationFrame_):goog.fx.anim.requestAnimationFrameFn_&&goog.fx.anim.cancelRequestAnimationFrameFn_?(goog.fx.anim.requestAnimationTimer_=
goog.fx.anim.requestAnimationFrame_,goog.fx.anim.cancelAnimationTimer_=goog.fx.anim.cancelAnimationFrame_):(goog.fx.anim.requestAnimationTimer_=goog.fx.anim.requestTimer_,goog.fx.anim.cancelAnimationTimer_=goog.fx.anim.cancelTimer_);b&&goog.fx.anim.requestAnimationTimer_()};goog.fx.anim.requestTimer_=function(){goog.fx.anim.animationTimer_||(goog.fx.anim.animationTimer_=goog.Timer.callOnce(function(){goog.fx.anim.animationTimer_=null;goog.fx.anim.cycleAnimations_(goog.now())},goog.fx.anim.TIMEOUT))};
goog.fx.anim.cancelTimer_=function(){goog.fx.anim.animationTimer_&&(goog.Timer.clear(goog.fx.anim.animationTimer_),goog.fx.anim.animationTimer_=null)};goog.fx.anim.requestAnimationFrame_=function(){goog.fx.anim.animationTimer_||(goog.fx.anim.animationTimer_=goog.fx.anim.requestAnimationFrameFn_.call(goog.fx.anim.animationWindow_,function(a){goog.fx.anim.animationTimer_=null;goog.fx.anim.cycleAnimations_(a)}))};
goog.fx.anim.cancelAnimationFrame_=function(){goog.fx.anim.animationTimer_&&(goog.fx.anim.cancelRequestAnimationFrameFn_.call(goog.fx.anim.animationWindow_,goog.fx.anim.animationTimer_),goog.fx.anim.animationTimer_=null)};
goog.fx.anim.requestMozAnimationFrame_=function(){goog.fx.anim.animationTimer_||(goog.fx.anim.animationTimer_=goog.events.listen(goog.fx.anim.animationWindow_,goog.fx.anim.MOZ_BEFORE_PAINT_EVENT_,function(a){goog.fx.anim.cycleAnimations_(a.timeStamp||goog.now())},!1));goog.fx.anim.requestAnimationFrameFn_.call(goog.fx.anim.animationWindow_,null)};
goog.fx.anim.cancelMozAnimationFrame_=function(){goog.fx.anim.animationTimer_&&(goog.events.unlistenByKey(goog.fx.anim.animationTimer_),goog.fx.anim.animationTimer_=null)};goog.fx.anim.requestAnimationTimer_=goog.fx.anim.requestTimer_;goog.fx.anim.cancelAnimationTimer_=goog.fx.anim.cancelTimer_;goog.fx.anim.cycleAnimations_=function(a){goog.object.forEach(goog.fx.anim.activeAnimations_,function(b){b.onAnimationFrame(a)});goog.object.isEmpty(goog.fx.anim.activeAnimations_)||goog.fx.anim.requestAnimationTimer_()};goog.fx.Animation=function(a,b,c,d){goog.fx.TransitionBase.call(this);if(!goog.isArray(a)||!goog.isArray(b))throw Error("Start and end parameters must be arrays");if(a.length!=b.length)throw Error("Start and end points must be the same length");this.startPoint=a;this.endPoint=b;this.duration=c;this.accel_=d;this.coords=[]};goog.inherits(goog.fx.Animation,goog.fx.TransitionBase);
goog.fx.Animation.EventType={PLAY:goog.fx.Transition.EventType.PLAY,BEGIN:goog.fx.Transition.EventType.BEGIN,RESUME:goog.fx.Transition.EventType.RESUME,END:goog.fx.Transition.EventType.END,STOP:goog.fx.Transition.EventType.STOP,FINISH:goog.fx.Transition.EventType.FINISH,PAUSE:goog.fx.Transition.EventType.PAUSE,ANIMATE:"animate",DESTROY:"destroy"};goog.fx.Animation.TIMEOUT=goog.fx.anim.TIMEOUT;goog.fx.Animation.State=goog.fx.TransitionBase.State;goog.fx.Animation.setAnimationWindow=function(a){goog.fx.anim.setAnimationWindow(a)};
goog.fx.Animation.prototype.fps_=0;goog.fx.Animation.prototype.progress=0;goog.fx.Animation.prototype.lastFrame=null;
goog.fx.Animation.prototype.play=function(a){if(a||this.isStopped())this.progress=0,this.coords=this.startPoint;else if(this.isPlaying())return!1;goog.fx.anim.unregisterAnimation(this);this.startTime=a=goog.now();this.isPaused()&&(this.startTime-=this.duration*this.progress);this.endTime=this.startTime+this.duration;this.lastFrame=this.startTime;if(!this.progress)this.onBegin();this.onPlay();if(this.isPaused())this.onResume();this.setStatePlaying();goog.fx.anim.registerAnimation(this);this.cycle(a);
return!0};goog.fx.Animation.prototype.stop=function(a){goog.fx.anim.unregisterAnimation(this);this.setStateStopped();a&&(this.progress=1);this.updateCoords_(this.progress);this.onStop();this.onEnd()};goog.fx.Animation.prototype.pause=function(){this.isPlaying()&&(goog.fx.anim.unregisterAnimation(this),this.setStatePaused(),this.onPause())};
goog.fx.Animation.prototype.setProgress=function(a){this.progress=a;this.isPlaying()&&(this.startTime=goog.now()-this.duration*this.progress,this.endTime=this.startTime+this.duration)};goog.fx.Animation.prototype.disposeInternal=function(){this.isStopped()||this.stop(!1);this.onDestroy();goog.fx.Animation.superClass_.disposeInternal.call(this)};goog.fx.Animation.prototype.destroy=function(){this.dispose()};goog.fx.Animation.prototype.onAnimationFrame=function(a){this.cycle(a)};
goog.fx.Animation.prototype.cycle=function(a){this.progress=(a-this.startTime)/(this.endTime-this.startTime);1<=this.progress&&(this.progress=1);this.fps_=1E3/(a-this.lastFrame);this.lastFrame=a;this.updateCoords_(this.progress);if(1==this.progress)this.setStateStopped(),goog.fx.anim.unregisterAnimation(this),this.onFinish(),this.onEnd();else if(this.isPlaying())this.onAnimate()};
goog.fx.Animation.prototype.updateCoords_=function(a){goog.isFunction(this.accel_)&&(a=this.accel_(a));this.coords=Array(this.startPoint.length);for(var b=0;b<this.startPoint.length;b++)this.coords[b]=(this.endPoint[b]-this.startPoint[b])*a+this.startPoint[b]};goog.fx.Animation.prototype.onAnimate=function(){this.dispatchAnimationEvent(goog.fx.Animation.EventType.ANIMATE)};goog.fx.Animation.prototype.onDestroy=function(){this.dispatchAnimationEvent(goog.fx.Animation.EventType.DESTROY)};
goog.fx.Animation.prototype.dispatchAnimationEvent=function(a){this.dispatchEvent(new goog.fx.AnimationEvent(a,this))};goog.fx.AnimationEvent=function(a,b){goog.events.Event.call(this,a);this.coords=b.coords;this.x=b.coords[0];this.y=b.coords[1];this.z=b.coords[2];this.duration=b.duration;this.progress=b.progress;this.fps=b.fps_;this.state=b.getStateInternal();this.anim=b};goog.inherits(goog.fx.AnimationEvent,goog.events.Event);
goog.fx.AnimationEvent.prototype.coordsAsInts=function(){return goog.array.map(this.coords,Math.round)};goog.fx.dom={};goog.fx.dom.PredefinedEffect=function(a,b,c,d,e){goog.fx.Animation.call(this,b,c,d,e);this.element=a};goog.inherits(goog.fx.dom.PredefinedEffect,goog.fx.Animation);goog.fx.dom.PredefinedEffect.prototype.updateStyle=goog.nullFunction;goog.fx.dom.PredefinedEffect.prototype.onAnimate=function(){this.updateStyle();goog.fx.dom.PredefinedEffect.superClass_.onAnimate.call(this)};goog.fx.dom.PredefinedEffect.prototype.onEnd=function(){this.updateStyle();goog.fx.dom.PredefinedEffect.superClass_.onEnd.call(this)};
goog.fx.dom.PredefinedEffect.prototype.onBegin=function(){this.updateStyle();goog.fx.dom.PredefinedEffect.superClass_.onBegin.call(this)};goog.fx.dom.Slide=function(a,b,c,d,e){if(2!=b.length||2!=c.length)throw Error("Start and end points must be 2D");goog.fx.dom.PredefinedEffect.apply(this,arguments)};goog.inherits(goog.fx.dom.Slide,goog.fx.dom.PredefinedEffect);
goog.fx.dom.Slide.prototype.updateStyle=function(){this.element.style.left=Math.round(this.coords[0])+"px";this.element.style.top=Math.round(this.coords[1])+"px"};goog.fx.dom.SlideFrom=function(a,b,c,d){goog.fx.dom.Slide.call(this,a,[a.offsetLeft,a.offsetTop],b,c,d)};goog.inherits(goog.fx.dom.SlideFrom,goog.fx.dom.Slide);goog.fx.dom.SlideFrom.prototype.onBegin=function(){this.startPoint=[this.element.offsetLeft,this.element.offsetTop];goog.fx.dom.SlideFrom.superClass_.onBegin.call(this)};
goog.fx.dom.Swipe=function(a,b,c,d,e){if(2!=b.length||2!=c.length)throw Error("Start and end points must be 2D");goog.fx.dom.PredefinedEffect.apply(this,arguments);this.maxWidth_=Math.max(this.endPoint[0],this.startPoint[0]);this.maxHeight_=Math.max(this.endPoint[1],this.startPoint[1])};goog.inherits(goog.fx.dom.Swipe,goog.fx.dom.PredefinedEffect);
goog.fx.dom.Swipe.prototype.updateStyle=function(){var a=this.coords[0],b=this.coords[1];this.clip_(Math.round(a),Math.round(b),this.maxWidth_,this.maxHeight_);this.element.style.width=Math.round(a)+"px";this.element.style.marginLeft=Math.round(a)-this.maxWidth_+"px";this.element.style.marginTop=Math.round(b)-this.maxHeight_+"px"};goog.fx.dom.Swipe.prototype.clip_=function(a,b,c,d){this.element.style.clip="rect("+(d-b)+"px "+c+"px "+d+"px "+(c-a)+"px)"};
goog.fx.dom.Scroll=function(a,b,c,d,e){if(2!=b.length||2!=c.length)throw Error("Start and end points must be 2D");goog.fx.dom.PredefinedEffect.apply(this,arguments)};goog.inherits(goog.fx.dom.Scroll,goog.fx.dom.PredefinedEffect);goog.fx.dom.Scroll.prototype.updateStyle=function(){this.element.scrollLeft=Math.round(this.coords[0]);this.element.scrollTop=Math.round(this.coords[1])};
goog.fx.dom.Resize=function(a,b,c,d,e){if(2!=b.length||2!=c.length)throw Error("Start and end points must be 2D");goog.fx.dom.PredefinedEffect.apply(this,arguments)};goog.inherits(goog.fx.dom.Resize,goog.fx.dom.PredefinedEffect);goog.fx.dom.Resize.prototype.updateStyle=function(){this.element.style.width=Math.round(this.coords[0])+"px";this.element.style.height=Math.round(this.coords[1])+"px"};goog.fx.dom.ResizeWidth=function(a,b,c,d,e){goog.fx.dom.PredefinedEffect.call(this,a,[b],[c],d,e)};
goog.inherits(goog.fx.dom.ResizeWidth,goog.fx.dom.PredefinedEffect);goog.fx.dom.ResizeWidth.prototype.updateStyle=function(){this.element.style.width=Math.round(this.coords[0])+"px"};goog.fx.dom.ResizeHeight=function(a,b,c,d,e){goog.fx.dom.PredefinedEffect.call(this,a,[b],[c],d,e)};goog.inherits(goog.fx.dom.ResizeHeight,goog.fx.dom.PredefinedEffect);goog.fx.dom.ResizeHeight.prototype.updateStyle=function(){this.element.style.height=Math.round(this.coords[0])+"px"};
goog.fx.dom.Fade=function(a,b,c,d,e){goog.isNumber(b)&&(b=[b]);goog.isNumber(c)&&(c=[c]);goog.fx.dom.PredefinedEffect.call(this,a,b,c,d,e);if(1!=b.length||1!=c.length)throw Error("Start and end points must be 1D");};goog.inherits(goog.fx.dom.Fade,goog.fx.dom.PredefinedEffect);goog.fx.dom.Fade.prototype.updateStyle=function(){goog.style.setOpacity(this.element,this.coords[0])};goog.fx.dom.Fade.prototype.show=function(){this.element.style.display=""};
goog.fx.dom.Fade.prototype.hide=function(){this.element.style.display="none"};goog.fx.dom.FadeOut=function(a,b,c){goog.fx.dom.Fade.call(this,a,1,0,b,c)};goog.inherits(goog.fx.dom.FadeOut,goog.fx.dom.Fade);goog.fx.dom.FadeIn=function(a,b,c){goog.fx.dom.Fade.call(this,a,0,1,b,c)};goog.inherits(goog.fx.dom.FadeIn,goog.fx.dom.Fade);goog.fx.dom.FadeOutAndHide=function(a,b,c){goog.fx.dom.Fade.call(this,a,1,0,b,c)};goog.inherits(goog.fx.dom.FadeOutAndHide,goog.fx.dom.Fade);
goog.fx.dom.FadeOutAndHide.prototype.onBegin=function(){this.show();goog.fx.dom.FadeOutAndHide.superClass_.onBegin.call(this)};goog.fx.dom.FadeOutAndHide.prototype.onEnd=function(){this.hide();goog.fx.dom.FadeOutAndHide.superClass_.onEnd.call(this)};goog.fx.dom.FadeInAndShow=function(a,b,c){goog.fx.dom.Fade.call(this,a,0,1,b,c)};goog.inherits(goog.fx.dom.FadeInAndShow,goog.fx.dom.Fade);goog.fx.dom.FadeInAndShow.prototype.onBegin=function(){this.show();goog.fx.dom.FadeInAndShow.superClass_.onBegin.call(this)};
goog.fx.dom.BgColorTransform=function(a,b,c,d,e){if(3!=b.length||3!=c.length)throw Error("Start and end points must be 3D");goog.fx.dom.PredefinedEffect.apply(this,arguments)};goog.inherits(goog.fx.dom.BgColorTransform,goog.fx.dom.PredefinedEffect);goog.fx.dom.BgColorTransform.prototype.setColor=function(){for(var a=[],b=0;b<this.coords.length;b++)a[b]=Math.round(this.coords[b]);this.element.style.backgroundColor="rgb("+a.join(",")+")"};goog.fx.dom.BgColorTransform.prototype.updateStyle=function(){this.setColor()};
goog.fx.dom.bgColorFadeIn=function(a,b,c,d){function e(){a.style.backgroundColor=f}var f=a.style.backgroundColor||"",g=goog.style.getBackgroundColor(a),g=g&&"transparent"!=g&&"rgba(0, 0, 0, 0)"!=g?goog.color.hexToRgb(goog.color.parse(g).hex):[255,255,255],b=new goog.fx.dom.BgColorTransform(a,b,g,c);d?d.listen(b,goog.fx.Transition.EventType.END,e):goog.events.listen(b,goog.fx.Transition.EventType.END,e);b.play()};
goog.fx.dom.ColorTransform=function(a,b,c,d,e){if(3!=b.length||3!=c.length)throw Error("Start and end points must be 3D");goog.fx.dom.PredefinedEffect.apply(this,arguments)};goog.inherits(goog.fx.dom.ColorTransform,goog.fx.dom.PredefinedEffect);goog.fx.dom.ColorTransform.prototype.updateStyle=function(){for(var a=[],b=0;b<this.coords.length;b++)a[b]=Math.round(this.coords[b]);this.element.style.color="rgb("+a.join(",")+")"};fyre.v1.dom=function(a){if(!(this instanceof fyre.v1.dom))return new fyre.v1.dom(a);this.element=a?fyre.v1.dom.getElement(a):[]};fyre.v1.dom.listDecorator=function(a,b){if(goog.isFunction(b))return goog.isArray(a)||goog.dom.isNodeList(a)?goog.array.map(a,function(a){return b(a)||a}):b(a)||a};
fyre.v1.dom.getElement=function(a){if(goog.isString(a))return document.getElementById(a);if(goog.isDef(a))!goog.isObject(a)&&!goog.isArray(a)&&goog.asserts.assert(!1,"Invalid argument to fyre.v1.dom.getElement: "+a);else return[];if(goog.dom.isElement(a)||goog.dom.isWindow(a))return a;if(a.element&&goog.dom.isElement(a.element))return a.element;if((goog.isArray(a)||goog.dom.isNodeList(a))&&goog.array.every(a,function(a){return goog.dom.isElement(a)}))return a;goog.asserts.assert(!1,"Invalid argument to fyre.v1.dom.getElement: "+
a)};fyre.v1.dom.prototype.exists=function(){return this.element&&(!goog.isArray(this.element)||this.element.length)};fyre.v1.dom.prototype.addClass=function(a){fyre.v1.dom.listDecorator(this.element,function(b){goog.dom.classes.add(b,a)});return this};fyre.v1.dom.prototype.toggleClass=function(a){goog.dom.classes.toggle(this.element,a);return this};fyre.v1.dom.prototype.setClass=function(a){goog.dom.classes.set(this.element,a);return this};
fyre.v1.dom.prototype.swapClass=function(a,b){goog.dom.classes.swap(this.element,a,b);return this};fyre.v1.dom.prototype.removeClass=function(a){fyre.v1.dom.listDecorator(this.element,function(b){"undefined"===typeof a?b.className="":goog.dom.classes.remove(b,a)});return this};fyre.v1.dom.prototype.next=function(){var a=goog.dom.getNextElementSibling(this.element);return a?new fyre.v1.dom(a):null};
fyre.v1.dom.prototype.prev=function(){var a=new fyre.v1.dom(goog.dom.getPreviousElementSibling(this.element));return a?new fyre.v1.dom(a):null};fyre.v1.dom.prototype.parent=function(){return new fyre.v1.dom(this.element.parentNode)};fyre.v1.dom.prototype.after=function(a){a instanceof fyre.v1.dom&&(a=a.element);goog.dom.insertSiblingAfter(a,this.element);return this};fyre.v1.dom.prototype.all=function(){return this.element};
fyre.v1.dom.prototype.append=function(a){a instanceof fyre.v1.dom&&(a=a.element);goog.isArray(this.element)?goog.array.forEach(this.element,function(b){goog.dom.append(b,a)}):goog.dom.append(this.element,a);return this};fyre.v1.dom.prototype.extend=function(a){goog.array.forEach(a,this.append,this);return this};fyre.v1.dom.prototype.appendTo=function(a){goog.dom.append(a,this.element);return this};
fyre.v1.dom.prototype.attr=function(a,b){if("undefined"===typeof b)return this.element.getAttribute(a);var c={};c[a]=b;goog.dom.setProperties(this.element,c);return this};fyre.v1.dom.prototype.before=function(a){goog.dom.insertSiblingBefore(this.element,a);return this};fyre.v1.dom.create=function(a,b){var c,a=goog.string.trim(a);return"<"===a[0]?(c=goog.dom.createDom("div"),c.innerHTML=a,new fyre.v1.dom(c.childNodes[0])):new fyre.v1.dom(goog.dom.createDom.apply(window,arguments))};
fyre.v1.dom.prototype.clone=function(){return new fyre.v1.dom(this.element.cloneNode())};fyre.v1.dom.prototype.css=function(a){if(0===arguments.length)return this.attr("style");var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c+":"+a[c]+";");this.attr("style",b.join(""));return this};fyre.v1.dom.prototype.getStyle=function(a){return goog.style.getStyle_(this.element,a)};fyre.v1.dom.prototype.empty=function(){goog.dom.removeChildren(this.element);return this};
fyre.v1.dom.prototype.fadeIn=function(a,b){var c=this.element,d=new goog.fx.dom.FadeInAndShow(c,a||250);d.onEnd=function(){c.style.opacity=1;goog.isFunction(b)&&b(fyre.v1.dom(this))};d.play();return this};fyre.v1.dom.prototype.fadeOut=function(a,b){var c=new goog.fx.dom.FadeOutAndHide(this.element,a||250);c.onEnd=function(){goog.isFunction(b)&&b(fyre.v1.dom(this))};c.play();return this};
fyre.v1.dom.prototype.getByClass=function(a){return(a=goog.dom.getElementByClass(a,this.element))?new fyre.v1.dom(a):null};fyre.v1.dom.getByClass=function(a){return new fyre.v1.dom(goog.dom.getElementByClass(a))};fyre.v1.dom.prototype.getNByClass=function(a){var b=[];goog.array.forEach(goog.dom.getElementsByClass(a,this.element),function(a){b.push(new fyre.v1.dom(a))});return b};fyre.v1.dom.prototype.hasClass=function(a){return goog.dom.classes.has(this.element,a)};fyre.v1.dom.prototype.isEmpty=function(){return goog.string.isEmpty(this.html())};
fyre.v1.dom.prototype.hide=function(){fyre.v1.dom.listDecorator(this.element,function(a){a.style.display="none"});return this};fyre.v1.dom.cashOut=function(a){function b(a){a instanceof fyre.v1.dom?c(a.element):d.push(a)}function c(a){goog.isArray(a)?goog.array.forEach(a,b):b(a)}var d=[];c(a);return d};fyre.v1.dom.prototype.findElementsByTagName=function(a){for(var b=[],a=goog.dom.getElementsByTagNameAndClass(a,null,this.element),c=0;c<a.length;c++)b.push(a[c]);return new fyre.v1.dom(b)};
fyre.v1.dom.firstEl=function(a){return fyre.v1.dom.cashOut(a)[0]||null};fyre.v1.dom.prototype.firstEl=function(){return fyre.v1.dom.firstEl(this)};fyre.v1.dom.prototype.html=function(a){if(0===arguments.length)return this.element.innerHTML;this.element.innerHTML=a;return this};fyre.v1.dom.prototype.value=function(a){fyre.v1.dom.listDecorator(this.element,function(b){b.value=a});return this};fyre.v1.dom.prototype.removeChildren=function(){goog.dom.removeChildren(this.element);return this};
fyre.v1.dom.prototype.getParent=function(){return new fyre.v1.dom(this.element.parentNode)};fyre.v1.dom.prototype.hasAncestorByClass=function(a){return null!==goog.dom.getAncestor(this.element,function(b){return!(b instanceof Element)&&!goog.isString(b.className)?!1:goog.string.contains(b.className,a)},!0,10)};fyre.v1.dom.prototype.hasSibling=function(a){return goog.array.some(this.element.parentNode.childNodes,function(b){return b instanceof Text?!1:goog.string.contains(b.className,a)})};
fyre.v1.dom.prototype.prepend=function(a){goog.dom.insertChildAt(this.element,fyre.v1.dom.getElement(a),0);return this};fyre.v1.dom.prototype.children=fyre.v1.dom.prototype.getChildren=function(){return goog.array.map(goog.dom.getChildren(this.element),fyre.v1.dom)};fyre.v1.dom.prototype.last=function(){return new fyre.v1.dom(goog.dom.getLastElementChild(this.element))};fyre.v1.dom.prototype.replace=function(a){goog.dom.replaceNode(a,this.element);this.element=a;return this};
fyre.v1.dom.prototype.first=function(){return new fyre.v1.dom(goog.dom.getFirstElementChild(this.element))};fyre.v1.dom.prototype.remove=function(){fyre.v1.dom.listDecorator(this.element,function(a){goog.dom.removeNode(a)})};fyre.v1.dom.prototype.show=function(a){a?this.css({display:a}):fyre.v1.dom.listDecorator(this.element,function(a){goog.style.showElement(a,!0)});return this};
fyre.v1.dom.prototype.slideY=function(a,b,c,d){var a=a||250,b=b||function(){},e=this,f=goog.style.getComputedOverflowX(this.element),g=goog.style.getComputedOverflowY(this.element);goog.style.getSize(this.element);a=new goog.fx.dom.ResizeHeight(this.element,c,d,a);a.onBegin=function(){this.element.style.overflow="hidden"};a.onEnd=function(){goog.style.setHeight(e.element,d);e.element.style.overflowX=f;e.element.style.overflowY=g;goog.isFunction(b)&&b(e)};a.play()};fyre.v1.dom.prototype.isHidden=function(){return!goog.style.isElementShown(this.element)};
fyre.v1.dom.prototype.showToggle=function(a){this.isHidden()?this.show(a):this.hide();return this};fyre.v1.dom.prototype.height=function(){return this.element.clientHeight};fyre.v1.dom.prototype.getSiblingOrParent=function(){for(var a,b=this.element;a=b.previousElementSibling;)if("none"===a.style.display)b=a;else return new fyre.v1.dom(a);return new fyre.v1.dom(b.parentNode)};
fyre.v1.dom.prototype.resize=function(a,b,c,d,e){var f=this.element.offsetHeight,g=this.element.offsetWidth,a=new goog.fx.dom.Resize(this.element,[g,f],[fyre.v1.util.getDefault(b,g),fyre.v1.util.getDefault(a,f)],fyre.v1.util.getDefault(c,1E3),goog.fx.easing.easeOut);goog.events.listen(a,goog.fx.Transition.EventType.END,goog.bind(d||goog.nullFunction,e));a.play()};
fyre.v1.dom.prototype.fadeout=function(a,b){var b=b||goog.nullFunction,c=new goog.fx.dom.FadeOut(this.element,fyre.v1.util.getDefault(a,1E3),goog.fx.easing.easeOut);goog.events.listen(c,goog.fx.Transition.EventType.END,function(){b();goog.events.removeAll(c);c.dispose()});c.play()};fyre.v1.dom.pageYOffset=function(a){return a==window?"pageYOffset"in window?window.pageYOffset:document.documentElement?document.documentElement.scrollTop:document.body.scrollTop:goog.style.getPageOffsetTop(a)};fyre.conv.model={};fyre.conv.model.Collection=function(a){this.STREAM_TYPES=fyre.conv.model.Collection.STREAM_TYPES;fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.Collection,fyre.v1.model.Model);
fyre.conv.model.Collection.prototype.ATTRIBUTES=fyre.conv.model.Collection.ATTRIBUTES={BOOTSTRAP_URL:"bootstrapUrl",NUM_VISIBLE:"numVisible",GUEST:"allowGuestComments",EDIT:"allowEditComments",EDIT_COMMENT_INTERVAL:"editCommentInterval",ID:"id",PAGES:"pages",SITE_ID:"siteId",STREAM_TYPE:"streamType",CHECKSUM:"checksum",MODIFIED:"__modified__",HEAD_DOCUMENT:"headDocument",HEAD_IS_COMPLETE:"headIsComplete",RAW_HTML:"rawHtml",STREAM_HASH_THRESHOLD:"streamHashThreshold",COMMENTS_ENABLED:"commentsEnabled",
REPLIES_ENABLED:"repliesEnabled",ARCHIVE_INFO:"archiveInfo",HEAD_DOCUMENT:"headDocument",HOVERCARDS_ENABLED:"hovercardsEnabled",HIGH_VELOCITY_MODE:"highVelocityMode",MEDIA_DISPLAY:"mediaDisplay",THROTTLE_STREAM:"throttleStream",TOP_CONTENT_DISPLAY:"topContentDisplay",LISTENER_COUNT:"listener_count",EVENT:"event",COMMENT_TEXT:"comment_text",CREATED:"created",TITLE:"title",LISTENER_TEXT:"listener_text",MESSAGE_CLASS:"message_class",LOGIN_TYPES:"login_types",LOGGEDOUT:"loggedout",SOURCE:"source",NEST_LEVEL:"nestLevel",
NUM_VISIBLE:"numVisible",LOGGEDIN:"loggedin",LOGO:"logo",FOLLOWER_COUNT:"followers",MESSAGE:"message",PREMOD:"premoderated"};fyre.conv.model.Collection.MEDIA_DISPLAY_TYPES={UNSET:0,EXPANDED:1,LINKS:2};fyre.conv.model.Collection.TOP_CONTENT_DISPLAY_TYPES={UNSET:0,NONE:1,TOP_COMMENTS:2,HOT_THREADS:3};fyre.conv.model.Collection.STREAM_TYPES={THREADED:1,LIVEBLOG:2,LIVECHAT:3};
fyre.conv.model.Collection.prototype.defaults=function(){var a=fyre.conv.model.Collection.ATTRIBUTES,b={};b[a.LOGGEDOUT]=!0;b[a.EVENT]=null;b[a.EDIT]=!1;b[a.EDIT_COMMENT_INTERVAL]=5;b[a.SOURCE]=null;b[a.NEST_LEVEL]=1E4;b[a.NUM_VISIBLE]=0;b[a.LOGGEDIN]=!1;b[a.COMMENTS_ENABLED]=!0;b[a.REPLIES_ENABLED]=!0;b[a.STREAM_TYPE]=fyre.conv.model.Collection.STREAM_TYPES.THREADED;b[a.LOGO]="";b[a.FOLLOWER_COUNT]=0;b[a.MESSAGE]="Connecting live stream";b[a.ID]=null;b[a.SITE_ID]=null;b[a.PREMOD]=!1;b[a.PAGES]=[];
b[a.BOOTSTRAP_URL]="";b[a.NUM_VISIBLE]=0;b[a.STREAM_HASH_THRESHOLD]=2400;b[a.THROTTLE_STREAM]=!1;return b}();fyre.conv.model.Collection.prototype.isLiveBlog=function(){return this.get(this.ATTRIBUTES.STREAM_TYPE)===this.STREAM_TYPES.LIVEBLOG};fyre.conv.model.Collection.prototype.isLiveChat=function(){return this.get(this.ATTRIBUTES.STREAM_TYPE)===this.STREAM_TYPES.LIVECHAT};fyre.conv.events={};fyre.conv.events.COMMENT_COUNT_UPDATED="commentCountUpdated";fyre.conv.events.PAGEINIT_RECEIVED="pageinitRecv";fyre.conv.events.PAGE_INITIALIZED="pageInit";fyre.conv.events.COLLECTION_CREATED="collCreated";fyre.conv.events.DOM_READY="dom_ready";fyre.conv.events.HEAD_DATA_FETCHED="head_fetched";fyre.conv.events.COLLECTION_SORT_NEW="collection_sort_new";fyre.conv.events.COLLECTION_SORT_OLD="collection_sort_old";fyre.conv.events.USER_LOGGED_IN="user_logged_in";
fyre.conv.events.USER_LOGGED_OUT="user_logged_out";fyre.conv.events.STREAM_DATA_RECEIVED="stream_data_received";fyre.conv.events.STREAM_DATA_RECEIVED_RAW="stream_data_received_raw";fyre.conv.events.NEW_COMMENT_POSTED="new_comment_posted";fyre.conv.events.CONV_SHOW_MORE="conv_show_more";fyre.conv.events.CONV_NO_PAGES="conv_no_pages";fyre.conv.events.AUTH_LOGIN_INIT="auth_login_init";fyre.conv.events.AUTH_LOGIN_SUCCESS="auth_login_success";fyre.conv.events.AUTH_LOGIN_FAILURE="auth_login_failure";
fyre.conv.events.AUTH_LOGIN_COMPLETE="auth_login_complete";fyre.conv.events.AUTH_LOGOUT_INIT="auth_logout_init";fyre.conv.events.AUTH_LOGOUT_ERROR="auth_logout_error";fyre.conv.events.AUTH_LOGOUT_COMPLETE="auth_logout_complete";fyre.conv.events.AUTH_VIEW_PROFILE_INIT="auth_view_profile";fyre.conv.events.STREAM_START="stream_start";fyre.conv.events.STREAM_STOP="stream_stop";fyre.conv.events.STREAM_SUCCESS="stream_success";fyre.conv.events.STREAM_FAILURE="stream_failure";
fyre.conv.events.STREAM_VIEW_RESET="stream_view_reset";fyre.conv.events.COMMENT_ADDED="comment_added";fyre.conv.events.COMMENT_COLLAPSED="comment_collapsed";fyre.conv.events.COMMENT_EXPANDED="comment_expanded";fyre.conv.events.COMMENTS="comments";fyre.conv.events.USER_INFO="user_info";fyre.conv.events.USER_ADDED="user_added";fyre.conv.events.COMMENT_RENDERED="comment_rendered";fyre.conv.events.COMMENT_HIDDEN="comment_hidden";fyre.conv.events.COMMENT_POST_INIT="comment_post_init";
fyre.conv.events.COMMENT_POST_SUCCESS="comment_post_success";fyre.conv.events.COMMENT_POST_FAILURE="comment_post_failure";fyre.conv.events.COMMENT_POST_COMPLETE="comment_post_complete";fyre.conv.events.LIVECOUNT_COMPLETE="livecount_complete";fyre.conv.events.FOLLOWERS_COMPLETE="followers_complete";fyre.conv.events.AUTHOR_DATA_RECEIVED="author_data_received";fyre.conv.events.BS_EREF_MESSAGE_RECV="bsErefMsgRecv";fyre.conv.events.STR_EREF_MESSAGE_RECV="strErefMsgRecv";
fyre.conv.events.EREF_AUTHOR_RECEIVED="eref_author_received";fyre.conv.events.EREF_DECRYPTION_FAILED="eref_decryption_failed";fyre.conv.events.STREAM_MESSAGE_RECEIVED="stream_message_received";fyre.conv.events.STREAM_OPINE_RECEIVED="stream_opine_received";fyre.conv.events.BOOTSTRAP_AUTHOR_RECEIVED="bootstrap_author_received";fyre.conv.events.STREAM_AUTHOR_RECEIVED="stream_author_received";fyre.conv.events.BOOTSTRAP_FOLLOWER_RECEIVED="bootstrap_like_received";
fyre.conv.events.LOGIN_AUTHOR_RECEIVED="login_author_received";fyre.conv.events.QUILL_FOLLOWER_ADDED="quill_follow_added";fyre.conv.events.QUILL_FOLLOWER_REMOVED="quill_follow_removed";fyre.conv.events.QUILL_MESSAGE_RECEIVED="quill_message_received";fyre.conv.events.QUILL_AUTHOR_RECEIVED="quill_author_received";fyre.conv.events.QUILL_FLAG_RECEIVED="quill_flag_recv";fyre.conv.events.QUILL_LIKE_RECEIVED="quill_like_recv";fyre.conv.events.QUILL_UNLIKE_RECEIVED="quill_unlike_recv";
fyre.conv.events.QUILL_COMMENT_SHARED="quill_comment_shared";fyre.conv.events.MENTIONS_SHARED="mentions_shared";fyre.conv.events.MESSAGE_ADDED_TO_DOM="message_add_dom";fyre.conv.events.MESSAGE_REMOVED_FROM_DOM="message_remove_dom";fyre.conv.events.MESSAGE_DISPLAYED="message_displayed";fyre.conv.events.EMBEDLY_CODE_RECEIVED="embedly_code_received";fyre.conv.events.STREAM_MEDIA_RECEIVED="stream_media_received";fyre.conv.events.COLLECTION_INITIALIZED="coll_init";fyre.conv.events.RENDER_COMPLETE="render_complete";
fyre.conv.events.STREAM_SETTING_RECEIVED="streamSettingReceived";fyre.conv.events.STREAM_FOLLOWER_RECEIVED="streamFollowerReceived";fyre.conv.events.WINDOW_NAVIGATION="window_nav";fyre.v1.model.Collection=fyre.v1.lib.Backbone.Collection.extend({initialize:function(){fyre.v1.model.DEBUG_MODEL&&this.NAME&&(this.logger=fyre.v1.logging.getLogger(fyre.v1.model.Model.prototype.getName_.apply(this)))}});fyre.v1.model.Collection.EVENTS=fyre.v1.model.Collection.prototype.EVENTS=fyre.v1.model.Model.EVENTS;fyre.v1.model.Mention=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.v1.model.Mention,fyre.v1.model.Model);fyre.v1.model.Mention.prototype.ATTRIBUTES=fyre.v1.model.Mention.ATTRIBUTES={AVATAR:"avatar",CUSTOM:"custom",DISPLAY_NAME:"display_name",HANDLE:"handle",ID:"id",JID:"jid",NAME:"name",PREFIX:"prefix",PROFILE_URL:"profile_url",PROVIDER:"provider",REPLY:"reply",TYPE:"type",UID:"uid"};
fyre.v1.model.Mention.prototype.PROVIDERS=fyre.v1.model.Mention.PROVIDERS={FACEBOOK:"facebook",LIVEFYRE:"livefyre",TWITTER:"twitter"};fyre.v1.model.Mention.prototype.defaults=function(){var a=fyre.v1.model.Mention.ATTRIBUTES,b={};b[a.AVATAR]="";b[a.CUSTOM]=!1;b[a.DISPLAY_NAME]="";b[a.HANDLE]="";b[a.JID]="";b[a.NAME]=null;b[a.PROFILE_URL]="";b[a.PROVIDER]="";b[a.PREFIX]="@";return b}();goog.memoize=function(a,b){var c=goog.getUid(a),d=b||goog.memoize.simpleSerializer;return function(){if(goog.memoize.ENABLE_MEMOIZE){var b=this||goog.global,b=b[goog.memoize.CACHE_PROPERTY_]||(b[goog.memoize.CACHE_PROPERTY_]={}),f=d(c,arguments);return b.hasOwnProperty(f)?b[f]:b[f]=a.apply(this,arguments)}return a.apply(this,arguments)}};goog.memoize.ENABLE_MEMOIZE=!0;goog.memoize.clearCache=function(a){a[goog.memoize.CACHE_PROPERTY_]={}};goog.memoize.CACHE_PROPERTY_="closure_memoize_cache_";
goog.memoize.simpleSerializer=function(a,b){for(var c=[a],d=b.length-1;0<=d;--d)c.push(typeof b[d],b[d]);return c.join("\x0B")};fyre.conv.model.Author=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.Author,fyre.v1.model.Model);fyre.conv.model.Author.TYPES={DEFAULT:1,FEED:2,TWITTER:3,FACEBOOK:4,YOUTUBE:5,GPLUS:6,LINKEDIN:7,INSTAGRAM:8,TUMBLR:9};fyre.conv.model.Author.SOURCE_DISPLAY_NAMES={};fyre.conv.model.Author.SOURCE_DISPLAY_NAMES[fyre.conv.model.Author.TYPES.DEFAULT]="Livefyre";fyre.conv.model.Author.SOURCE_DISPLAY_NAMES[fyre.conv.model.Author.TYPES.TWITTER]="Twitter";
fyre.conv.model.Author.SOURCE_DISPLAY_NAMES[fyre.conv.model.Author.TYPES.FACEBOOK]="Facebook";fyre.conv.model.Author.SOURCE_DISPLAY_NAMES[fyre.conv.model.Author.TYPES.INSTAGRAM]="Instagram";fyre.conv.model.Author.SOURCE_DISPLAY_NAMES[fyre.conv.model.Author.TYPES.YOUTUBE]="YouTube";fyre.conv.model.Author.SOURCE_DISPLAY_NAMES[fyre.conv.model.Author.TYPES.GPLUS]="Google+";fyre.conv.model.Author.SOURCE_DISPLAY_NAMES[fyre.conv.model.Author.TYPES.LINKEDIN]="LinkedIn";
fyre.conv.model.Author.SOURCE_DISPLAY_NAMES[fyre.conv.model.Author.TYPES.TUMBLR]="Tumblr";fyre.conv.model.Author.prototype.ATTRIBUTES=fyre.conv.model.Author.ATTRIBUTES={AVATAR:"avatar",BIO:"bio",CONNECTIONS:"connections",CREATED_AT:"createdAt",DEFAULT_AVATAR:"defaultAvatar",DISPLAY_NAME:"displayName",EREF_KEY:"key",FIRST_NAME:"firstName",HANDLE:"handle",ID:"id",LAST_NAME:"lastName",LIKES:"likes",PROFILE_URL:"profileUrl",RATING:"rating",TAGS:"tags",TYPE:"type",URL:"url",USER_ID:"userId"};
fyre.conv.model.Author.prototype.defaults=function(){var a=fyre.conv.model.Author.ATTRIBUTES,b={};b[a.AVATAR]=fyre.conv.config.defaultAvatar;b[a.DEFAULT_AVATAR]=fyre.conv.config.defaultAvatar;b[a.RATING]=5;b[a.TAGS]=[];b[a.TYPE]=fyre.conv.model.Author.TYPES.DEFAULT;return b};
fyre.conv.model.Author.prototype.getSourceDisplayName=goog.memoize(function(){var a=this.get(this.ATTRIBUTES.TYPE),b=fyre.conv.model.Author.SOURCE_DISPLAY_NAMES;return!goog.object.containsKey(b,a)?b[fyre.conv.model.Author.TYPES.DEFAULT]:b[a]});
fyre.conv.model.Author.prototype.toMention=function(){var a=fyre.conv.model.Author.ATTRIBUTES,b=fyre.conv.model.Author.TYPES,c=fyre.v1.model.Mention.ATTRIBUTES,d=fyre.v1.model.Mention.PROVIDERS,e={},f=this.get(this.ATTRIBUTES.TYPE);e[c.AVATAR]=this.get(a.AVATAR);e[c.DISPLAY_NAME]=this.get(a.DISPLAY_NAME);e[c.JID]=this.get(a.ID);e[c.NAME]=this.get(a.HANDLE);e[c.PROFILE_URL]=this.get(a.PROFILE_URL);switch(f){case b.DEFAULT:case b.FEED:case b.INSTAGRAM:case b.TUMBLR:e[c.PROVIDER]=d.LIVEFYRE;break;case b.TWITTER:e[c.PROVIDER]=
d.TWITTER;break;case b.FACEBOOK:e[c.PROVIDER]=d.FACEBOOK;break;default:goog.asserts.fail("Unsupported source")}e[c.ID]=e[c.DISPLAY_NAME]+":"+e[c.PROVIDER];return new fyre.v1.model.Mention(e)};fyre.conv.model.Author.prototype.isGuest=function(){return/^guest-/.test(this.get(this.ATTRIBUTES.ID))};fyre.conv.model.Author.VALID_TWITTER_DOMAINS_REGEX=RegExp(/(tw\.gw\.livefyre\.com|twitter\.com)$/);
fyre.conv.model.Author.prototype.isTwitter=function(){var a=this.get(this.ATTRIBUTES.TYPE)===fyre.conv.model.Author.TYPES.TWITTER,b=!!this.id.match(fyre.conv.model.Author.VALID_TWITTER_DOMAINS_REGEX);return a||b};fyre.conv.model.Author.VALID_FACEBOOK_DOMAINS_REGEX=RegExp(/(fb\.gw\.livefyre\.com|facebook\.com)$/);
fyre.conv.model.Author.prototype.isFacebook=function(){var a=this.get(this.ATTRIBUTES.TYPE)===fyre.conv.model.Author.TYPES.FACEBOOK,b=!!this.id.match(fyre.conv.model.Author.VALID_FACEBOOK_DOMAINS_REGEX);return a||b};fyre.conv.model.Author.prototype.isFeed=function(){return(new goog.structs.Set([fyre.conv.model.Author.TYPES.FEED,fyre.conv.model.Author.TYPES.TUMBLR])).contains(this.get(this.ATTRIBUTES.TYPE))};
fyre.conv.model.Author.prototype.getTwitterHandle=function(){return!this.isTwitter()?null:this.get(fyre.conv.model.Author.ATTRIBUTES.PROFILE_URL).split("#!/")[1]||null};fyre.conv.model.Author.prototype.isCuratedAuthor=function(){return this.get(this.ATTRIBUTES.TYPE)!==fyre.conv.model.Author.TYPES.DEFAULT||this.isTwitter()||this.isFacebook()};fyre.conv.model.AuthorCollection=function(a,b){fyre.v1.model.Collection.call(this,a,b)};goog.inherits(fyre.conv.model.AuthorCollection,fyre.v1.model.Collection);fyre.conv.model.AuthorCollection.prototype.initialize=function(){this.model=fyre.conv.model.Author};fyre.conv.model.SocialFriend=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.SocialFriend,fyre.v1.model.Model);fyre.conv.model.SocialFriend.prototype.ATTRIBUTES=fyre.conv.model.SocialFriend.ATTRIBUTES={ID:"id",AVATAR:"avatar",NAME:"name",PROVIDER:"provider"};fyre.conv.model.SocialFriend.prototype.SOURCES={TWITTER:"tw",FACEBOOK:"fb"};
fyre.conv.model.SocialFriend.prototype.defaults=function(){var a={};a[fyre.conv.model.SocialFriend.ATTRIBUTES.AVATAR]=fyre.conv.config.defaultAvatar;return a};fyre.conv.model.SocialFriend.prototype.getSource=function(){return this.get(this.ATTRIBUTES.PROVIDER)};
fyre.conv.model.SocialFriend.prototype.toMention=function(){var a={},b=fyre.v1.model.Mention.ATTRIBUTES,c=this.ATTRIBUTES,d=fyre.v1.model.Mention.PROVIDERS,e=this.SOURCES;a[b.AVATAR]=this.get(c.AVATAR);a[b.DISPLAY_NAME]=this.get(c.NAME);a[b.HANDLE]=this.get(c.NAME);a[b.JID]=this.get(c.ID);a[b.NAME]=this.get(c.NAME);switch(this.getSource()){case e.TWITTER:a[b.PROVIDER]=d.TWITTER;break;case e.FACEBOOK:a[b.PROVIDER]=d.FACEBOOK;break;default:goog.asserts.assert(!1)}return new fyre.v1.model.Mention(a)};fyre.conv.model.User=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.User,fyre.v1.model.Model);
fyre.conv.model.User.prototype.ATTRIBUTES=fyre.conv.model.User.ATTRIBUTES={AVATAR:"avatar",BP_CHANNEL:"bp_channel",CONNECTIONS:"connections",DEFAULT_AVATAR:"defaultAvatar",DISPLAY_NAME:"displayName",EREF_KEYS:"eref_keys",FOLLOWERS:"followers",FYRE_AUTHOR:"fyre_author",GUEST:"guest",ID:"id",JID:"jid",MODERATOR:"moderator",OAUTH_TOKENS:"oauthTokens",PROFILE_URL:"profileUrl",RATING:"rating",SETTINGS_URL:"settingsUrl",TAGS:"tags",TOKEN:"token",TOKEN_EXPIRED:"tokeExp",TOKEN_TTL:"tokenTTL"};
fyre.conv.model.User.prototype.defaults=function(){var a=fyre.conv.model.User.ATTRIBUTES,b={};b[a.AVATAR]=fyre.conv.config.defaultAvatar;b[a.DEFAULT_AVATAR]=fyre.conv.config.defaultAvatar;b[a.BP_CHANNEL]=null;b[a.CONNECTIONS]={};b[a.DISPLAY_NAME]="";b[a.EREF_KEYS]=[];b[a.FOLLOWERS]=0;b[a.OAUTH_TOKENS]={};b[a.RATING]=5;b[a.TAGS]=[];b[a.TOKEN]="";return b};
fyre.conv.model.User.prototype.addLike=function(a){var b=fyre.conv.model.User.ATTRIBUTES,c=this.get(b.LIKES);-1===goog.array.indexOf(c,a)&&this.set(b.LIKES,c.push(a))};fyre.conv.model.User.prototype.getAvatar=function(a){return this.get(fyre.conv.model.User.ATTRIBUTES.AVATAR).replace(/__size__/g,a)};fyre.conv.model.User.prototype.toJSON=function(a){var b=fyre.conv.model.User.superClass_.toJSON.call(this);b.avatar=this.getAvatar(1<=arguments.length?a:fyre.v1.config.defaultAvatarSize);return b};
fyre.conv.model.User.prototype.isGuest=function(){return/^guest-/.test(this.get(fyre.conv.model.User.ATTRIBUTES.ID))};fyre.conv.model.User.prototype.isModerator=function(){return this.get(fyre.conv.model.User.ATTRIBUTES.MODERATOR)};fyre.conv.model.User.prototype.getTokenInfo=function(){var a=fyre.conv.model.User.ATTRIBUTES;return{token:this.get(a.TOKEN),guest:this.isGuest(),tokenTTL:this.get(a.TOKEN_TTL)}};
fyre.conv.model.User.prototype.isAnonymous=function(){var a=this.get(fyre.conv.model.User.ATTRIBUTES.JID);return goog.isString(a)&&goog.string.contains(a,"anonymous")};fyre.conv.model.User.prototype.toAuthor=function(){var a=fyre.conv.model.Author.ATTRIBUTES,b=fyre.conv.model.User.ATTRIBUTES,c={};c[a.ID]=this.id;c[a.AVATAR]=this.get(b.AVATAR);c[a.DISPLAY_NAME]=this.get(b.DISPLAY_NAME);c[a.PROFILE_URL]=this.get(b.PROFILE_URL);c[a.RATING]=this.get(b.RATING);return new fyre.conv.model.Author(c)};fyre.conv.service={};fyre.conv.service.AuthenticationAdapter={};fyre.conv.service.AuthenticationAdapter.adaptProfile=function(a){var b=fyre.conv.model.User.ATTRIBUTES,c=a.profile,d=a.permissions;if(!c)return{};c[b.EREF_KEYS]=[];d.moderator_key&&(c[b.EREF_KEYS].push(d.moderator_key),c[b.MODERATOR]=!0);c[b.TOKEN]=a[b.TOKEN].value||a[b.TOKEN];c[b.TOKEN_TTL]=a[b.TOKEN].ttl;goog.array.forEach(["type","sourceId"],function(a){goog.object.remove(c,a)});return c};
fyre.conv.service.AuthenticationAdapter.adaptAuthors=function(a){return(a.permissions||{}).authors||[]};fyre.v1.handler={};fyre.v1.handler.HandlerBase=function(a,b){fyre.v1.object.Base.call(this,a,b)};goog.inherits(fyre.v1.handler.HandlerBase,fyre.v1.object.Base);fyre.v1.handler.HandlerBase.prototype.initialize=function(a,b){this.context=b.context;this.parent=b;fyre.v1.util.handlerize(this,b.context)};fyre.v1.handler.HandlerBase.prototype.dispose=function(){this.disposeInternal();fyre.v1.util.unhandlerize(this,this.parent.context,!0);delete this.context;delete this.parent};
fyre.v1.handler.HandlerBase.prototype.disposeInternal=function(){};fyre.conv.service.AuthenticationHandler=function(a,b){fyre.v1.handler.HandlerBase.call(this,a,b)};goog.inherits(fyre.conv.service.AuthenticationHandler,fyre.v1.handler.HandlerBase);fyre.conv.service.AuthenticationHandler.prototype.initialize=function(a,b){this.opts=a;this.service=b;fyre.conv.service.AuthenticationHandler.superClass_.initialize.call(this,a,b)};fyre.conv.service.AuthenticationHandler.prototype.handlePageInit=function(){this.service.loginByCookie()};
fyre.v1.util.handler([fyre.conv.events.PAGE_INITIALIZED],fyre.conv.service.AuthenticationHandler.prototype.handlePageInit);fyre.conv.service.AuthenticationHandler.prototype.loginSuccess=function(){this.service.fetchSocialFriends();this.service.setTokenTimeout()};fyre.v1.util.handler([fyre.conv.events.USER_LOGGED_IN],fyre.conv.service.AuthenticationHandler.prototype.loginSuccess);
fyre.conv.service.AuthenticationHandler.prototype.handleCollCreated=function(){var a=fyre.conv.service.LocalStorageService.getInstance();!fyre.conv.user.id&&a.getAuthData()&&this.service.loginByCookie(!0)};fyre.v1.util.handler([fyre.conv.events.COLLECTION_CREATED],fyre.conv.service.AuthenticationHandler.prototype.handleCollCreated);goog.storage={};goog.storage.mechanism={};goog.storage.mechanism.Mechanism=function(){};fyre.v1.storage={};fyre.v1.storage.cookie=function(){goog.storage.mechanism.Mechanism.call(this)};goog.inherits(fyre.v1.storage.cookie,goog.storage.mechanism.Mechanism);fyre.v1.storage.cookie.COOKIE_TTL=604800;fyre.v1.storage.cookie.get=function(a){return goog.net.cookies.get(a)};fyre.v1.storage.cookie.set=function(a,b){goog.net.cookies.set(a,b,fyre.v1.storage.cookie.COOKIE_TTL)};fyre.v1.storage.cookie.remove=function(a){goog.net.cookies.remove(a)};goog.storage.mechanism.ErrorCode={INVALID_VALUE:"Storage mechanism: Invalid value was encountered",QUOTA_EXCEEDED:"Storage mechanism: Quota exceeded"};goog.storage.mechanism.IterableMechanism=function(){goog.storage.mechanism.Mechanism.call(this)};goog.inherits(goog.storage.mechanism.IterableMechanism,goog.storage.mechanism.Mechanism);goog.storage.mechanism.IterableMechanism.prototype.getCount=function(){var a=0;goog.iter.forEach(this.__iterator__(!0),function(b){goog.asserts.assertString(b);a++});return a};
goog.storage.mechanism.IterableMechanism.prototype.clear=function(){var a=goog.iter.toArray(this.__iterator__(!0)),b=this;goog.array.forEach(a,function(a){b.remove(a)})};goog.storage.mechanism.HTML5WebStorage=function(a){goog.storage.mechanism.IterableMechanism.call(this);this.storage_=a};goog.inherits(goog.storage.mechanism.HTML5WebStorage,goog.storage.mechanism.IterableMechanism);goog.storage.mechanism.HTML5WebStorage.prototype.isAvailable=function(){try{return!!this.storage_&&!!this.storage_.getItem}catch(a){}return!1};
goog.storage.mechanism.HTML5WebStorage.prototype.set=function(a,b){try{this.storage_.setItem(a,b)}catch(c){throw goog.storage.mechanism.ErrorCode.QUOTA_EXCEEDED;}};goog.storage.mechanism.HTML5WebStorage.prototype.get=function(a){a=this.storage_.getItem(a);if(goog.isString(a)||goog.isNull(a))return a;throw goog.storage.mechanism.ErrorCode.INVALID_VALUE;};goog.storage.mechanism.HTML5WebStorage.prototype.remove=function(a){this.storage_.removeItem(a)};
goog.storage.mechanism.HTML5WebStorage.prototype.getCount=function(){return this.storage_.length};goog.storage.mechanism.HTML5WebStorage.prototype.__iterator__=function(a){var b=0,c=new goog.iter.Iterator,d=this;c.next=function(){if(b>=d.getCount())throw goog.iter.StopIteration;var c=goog.asserts.assertString(d.storage_.key(b++));if(a)return c;c=d.storage_.getItem(c);if(goog.isString(c))return c;throw goog.storage.mechanism.ErrorCode.INVALID_VALUE;};return c};
goog.storage.mechanism.HTML5WebStorage.prototype.clear=function(){this.storage_.clear()};goog.storage.mechanism.HTML5LocalStorage=function(){var a=null;try{a=window.localStorage||null}catch(b){}goog.storage.mechanism.HTML5WebStorage.call(this,a)};goog.inherits(goog.storage.mechanism.HTML5LocalStorage,goog.storage.mechanism.HTML5WebStorage);goog.storage.mechanism.IEUserData=function(a,b){goog.storage.mechanism.IterableMechanism.call(this);if(goog.userAgent.IE&&!goog.userAgent.isVersion(9)){goog.storage.mechanism.IEUserData.storageMap_||(goog.storage.mechanism.IEUserData.storageMap_=new goog.structs.Map);this.storageNode_=goog.storage.mechanism.IEUserData.storageMap_.get(a);this.storageNode_||(b?this.storageNode_=document.getElementById(b):(this.storageNode_=document.createElement("userdata"),this.storageNode_.addBehavior("#default#userData"),
document.body.appendChild(this.storageNode_)),goog.storage.mechanism.IEUserData.storageMap_.set(a,this.storageNode_));this.storageKey_=a;try{this.loadNode_()}catch(c){this.storageNode_=null}}};goog.inherits(goog.storage.mechanism.IEUserData,goog.storage.mechanism.IterableMechanism);goog.storage.mechanism.IEUserData.ENCODE_MAP={".":".2E","!":".21","~":".7E","*":".2A","'":".27","(":".28",")":".29","%":"."};goog.storage.mechanism.IEUserData.storageMap_=null;
goog.storage.mechanism.IEUserData.prototype.storageNode_=null;goog.storage.mechanism.IEUserData.prototype.storageKey_=null;goog.storage.mechanism.IEUserData.encodeKey_=function(a){return"_"+encodeURIComponent(a).replace(/[.!~*'()%]/g,function(a){return goog.storage.mechanism.IEUserData.ENCODE_MAP[a]})};goog.storage.mechanism.IEUserData.decodeKey_=function(a){return decodeURIComponent(a.replace(/\./g,"%")).substr(1)};goog.storage.mechanism.IEUserData.prototype.isAvailable=function(){return!!this.storageNode_};
goog.storage.mechanism.IEUserData.prototype.set=function(a,b){this.storageNode_.setAttribute(goog.storage.mechanism.IEUserData.encodeKey_(a),b);this.saveNode_()};goog.storage.mechanism.IEUserData.prototype.get=function(a){a=this.storageNode_.getAttribute(goog.storage.mechanism.IEUserData.encodeKey_(a));if(goog.isString(a)||goog.isNull(a))return a;throw goog.storage.mechanism.ErrorCode.INVALID_VALUE;};
goog.storage.mechanism.IEUserData.prototype.remove=function(a){this.storageNode_.removeAttribute(goog.storage.mechanism.IEUserData.encodeKey_(a));this.saveNode_()};goog.storage.mechanism.IEUserData.prototype.getCount=function(){return this.getNode_().attributes.length};
goog.storage.mechanism.IEUserData.prototype.__iterator__=function(a){var b=0,c=this.getNode_().attributes,d=new goog.iter.Iterator;d.next=function(){if(b>=c.length)throw goog.iter.StopIteration;var d=goog.asserts.assert(c[b++]);if(a)return goog.storage.mechanism.IEUserData.decodeKey_(d.nodeName);d=d.nodeValue;if(goog.isString(d))return d;throw goog.storage.mechanism.ErrorCode.INVALID_VALUE;};return d};
goog.storage.mechanism.IEUserData.prototype.clear=function(){for(var a=this.getNode_(),b=a.attributes.length;0<b;b--)a.removeAttribute(a.attributes[b-1].nodeName);this.saveNode_()};goog.storage.mechanism.IEUserData.prototype.loadNode_=function(){this.storageNode_.load(this.storageKey_)};goog.storage.mechanism.IEUserData.prototype.saveNode_=function(){try{this.storageNode_.save(this.storageKey_)}catch(a){throw goog.storage.mechanism.ErrorCode.QUOTA_EXCEEDED;}};
goog.storage.mechanism.IEUserData.prototype.getNode_=function(){return this.storageNode_.XMLDocument.documentElement};fyre.v1.storage.api=function(){if(window.localStorage&&(this.storage_=new goog.storage.mechanism.HTML5LocalStorage,this.storage_.isAvailable()))return this;this.storage_=goog.userAgent.IE?new goog.storage.mechanism.IEUserData("fyre-store"):new fyre.v1.storage.cookie};goog.addSingletonGetter(fyre.v1.storage.api);
fyre.v1.storage.api.prototype.get=function(a){var b=goog.json.parse(this.storage_.get(a));if(!b)return null;var c=b.value,d=(new Date).getTime();return(b=b.ttl)&&b<d?(this.remove(a),null):c};fyre.v1.storage.api.prototype.set=function(a,b,c){var d=null;c&&(d=(new Date).getTime()+1E3*c);this.storage_.set(a,goog.json.serialize({value:b,ttl:d}))};fyre.v1.storage.api.prototype.remove=function(a){this.storage_.remove(a)};fyre.conv.service.LocalStorageService=function(a){a=a||{};goog.Disposable.call(this,a);this.storageApi=a.storageApi||fyre.v1.storage.api.getInstance()};goog.inherits(fyre.conv.service.LocalStorageService,goog.Disposable);fyre.conv.service.LocalStorageService.configure=function(a){goog.asserts.assert(!fyre.conv.service.LocalStorageService.instance_);fyre.conv.service.LocalStorageService.instance_=a};
fyre.conv.service.LocalStorageService.getInstance=function(){return fyre.conv.service.LocalStorageService.instance_||goog.asserts.fail()};fyre.conv.service.LocalStorageService.KEYS={ACTION_QUEUE:"fyre-action-queue",AUTH:fyre.conv.config.AUTH_COOKIE,BACKPLANE_MESSAGE:"fyre-backplane-cache"};fyre.conv.service.LocalStorageService.prototype.saveAuthData=function(a,b){this.storageApi.set(fyre.conv.service.LocalStorageService.KEYS.AUTH,a,b)};fyre.conv.service.LocalStorageService.prototype.getAuthData=function(){return this.storageApi.get(fyre.conv.service.LocalStorageService.KEYS.AUTH)};
fyre.conv.service.LocalStorageService.prototype.removeAuthData=function(){this.storageApi.remove(fyre.conv.service.LocalStorageService.KEYS.AUTH)};fyre.conv.service.LocalStorageService.prototype.saveBackplaneMessage=function(a){this.storageApi.set(fyre.conv.service.LocalStorageService.KEYS.BACKPLANE_MESSAGE,a)};fyre.conv.service.LocalStorageService.prototype.getBackplaneMessage=function(){return this.storageApi.get(fyre.conv.service.LocalStorageService.KEYS.BACKPLANE_MESSAGE)};
fyre.conv.service.LocalStorageService.prototype.removeBackplaneMessage=function(){this.storageApi.remove(fyre.conv.service.LocalStorageService.KEYS.BACKPLANE_MESSAGE)};fyre.conv.service.LocalStorageService.prototype.saveAction=function(a){this.storageApi.set(fyre.conv.service.LocalStorageService.KEYS.ACTION_QUEUE,a)};fyre.conv.service.LocalStorageService.prototype.getAction=function(){return this.storageApi.get(fyre.conv.service.LocalStorageService.KEYS.ACTION_QUEUE)};
fyre.conv.service.LocalStorageService.prototype.removeAction=function(){this.storageApi.remove(fyre.conv.service.LocalStorageService.KEYS.ACTION_QUEUE)};fyre.conv.service.RemoteAuthDelegate=function(){};goog.exportSymbol("fyre.conv.service.RemoteAuthDelegate",fyre.conv.service.RemoteAuthDelegate);fyre.conv.service.RemoteAuthDelegate.prototype.loginByCookie=function(a,b){if(b){var c=fyre.conv.service.LocalStorageService.getInstance(),d=c.getAuthData(),e=fyre.conv.user.ATTRIBUTES;d&&d[e.TOKEN]==b?a.success(d):(c.removeAuthData(),fyre.conv.user.set(e.TOKEN,b),a.failure())}};
goog.exportProperty(fyre.conv.service.RemoteAuthDelegate.prototype,"loginByCookie",fyre.conv.service.RemoteAuthDelegate.prototype.loginByCookie);fyre.conv.service.RemoteAuthDelegate.prototype.login=function(){};goog.exportProperty(fyre.conv.service.RemoteAuthDelegate.prototype,"login",fyre.conv.service.RemoteAuthDelegate.prototype.login);fyre.conv.service.RemoteAuthDelegate.prototype.logout=function(a){a.success()};goog.exportProperty(fyre.conv.service.RemoteAuthDelegate.prototype,"logout",fyre.conv.service.RemoteAuthDelegate.prototype.logout);
fyre.conv.RemoteAuthDelegate.setBackend(fyre.conv.service.RemoteAuthDelegate);fyre.conv.test={};fyre.conv.test.FixtureLoader=function(a){goog.DEBUG&&(this.fixtures=a)};fyre.conv.test.FixtureLoader.prototype.loadFixture=function(a){if(goog.DEBUG)return this.fixtures[a]};fyre.conv.test.fixtureLoader=goog.DEBUG?new fyre.conv.test.FixtureLoader(goog.global.FYRE_FIXTURES||{}):new fyre.conv.test.FixtureLoader({});goog.window={};goog.window.DEFAULT_POPUP_HEIGHT=500;goog.window.DEFAULT_POPUP_WIDTH=690;goog.window.DEFAULT_POPUP_TARGET="google_popup";
goog.window.open=function(a,b,c){b||(b={});var d=c||window,c="undefined"!=typeof a.href?a.href:""+a,a=b.target||a.target,e=[],f;for(f in b)switch(f){case "width":case "height":case "top":case "left":e.push(f+"="+b[f]);break;case "target":case "noreferrer":break;default:e.push(f+"="+(b[f]?1:0))}f=e.join(",");if(b.noreferrer){if(b=d.open("",a,f))goog.userAgent.IE&&-1!=c.indexOf(";")&&(c="'"+c.replace(/'/g,"%27")+"'"),b.opener=null,goog.userAgent.WEBKIT?b.location.href=c:(c=goog.string.htmlEscape(c),
b.document.write('<META HTTP-EQUIV="refresh" content="0; url='+c+'">'),b.document.close())}else b=d.open(c,a,f);return b};goog.window.openBlank=function(a,b,c){a=a?goog.string.htmlEscape(a):"";return goog.window.open('javascript:"'+encodeURI(a)+'"',b,c)};
goog.window.popup=function(a,b){b||(b={});b.target=b.target||a.target||goog.window.DEFAULT_POPUP_TARGET;b.width=b.width||goog.window.DEFAULT_POPUP_WIDTH;b.height=b.height||goog.window.DEFAULT_POPUP_HEIGHT;var c=goog.window.open(a,b);if(!c)return!0;c.focus();return!1};fyre.conv.service.LivefyreAuthDelegate=function(a){this.pollTimeout_=null;this.appContext=a};goog.exportSymbol("fyre.conv.service.LivefyreAuthDelegate",fyre.conv.service.LivefyreAuthDelegate);fyre.conv.service.LivefyreAuthDelegate.MAX_SAFARI_LOGIN_RETRIES=25;
fyre.conv.service.LivefyreAuthDelegate.prototype.loginByCookie=function(a){if(goog.DEBUG){var b=fyre.conv.test.fixtureLoader.loadFixture("user");if(b){a.success(b);return}}(b=fyre.conv.service.LocalStorageService.getInstance().getAuthData())?a.success(b):a.failure(b)};goog.exportProperty(fyre.conv.service.LivefyreAuthDelegate.prototype,"loginByCookie",fyre.conv.service.LivefyreAuthDelegate.prototype.loginByCookie);
fyre.conv.service.LivefyreAuthDelegate.prototype.login=function(a){this.loginPopup_(function(b){goog.object.containsKey(b.data,"profile")?a.success.apply(a,arguments):a.failure.apply(a,arguments)},a.failure)};goog.exportProperty(fyre.conv.service.LivefyreAuthDelegate.prototype,"login",fyre.conv.service.LivefyreAuthDelegate.prototype.login);
fyre.conv.service.LivefyreAuthDelegate.prototype.loginPopup_=function(a,b){var c=this.getAuthPopupUrl_();this.safariLoginRetries_=-1;this.popup=goog.window.open(c,{target:"authWindow",width:530,height:365,location:!0,menubar:!1,resizable:!1,scrollbars:!1});this.pollAuthResult_(a,b)};fyre.conv.service.LivefyreAuthDelegate.prototype.pollAuthResult_=function(a,b){clearTimeout(this.pollTimeout);var c=goog.bind(this.testAuthResult_,this,a,b);this.pollTimeout_=setTimeout(c,100)};
fyre.conv.service.LivefyreAuthDelegate.prototype.getAuthPopupUrl_=function(){var a=this.appContext.collectionService.collection(),b=new goog.Uri(fyre.conv.config.servers.auth+"/auth/popup/"),c=goog.Uri.QueryData.createFromMap({start:!0,guest:!0,site_id:a.get(a.ATTRIBUTES.SITE_ID)});a.get(a.ATTRIBUTES.GUEST)?b.setQueryData(c):b.setPath(b.getPath()+"login/");goog.userAgent.product.SAFARI&&(a=encodeURI(window.location.href.split("#")[0]),b.setParameterValue("url",a));return b.toString()};
fyre.conv.service.LivefyreAuthDelegate.prototype.testAuthResult_=function(a,b){var c=this.appContext.authenticationService,d=100,e=fyre.conv.service.LivefyreAuthDelegate.MAX_SAFARI_LOGIN_RETRIES;if(goog.userAgent.product.SAFARI){if(fyre.conv.user.id){a();return}if(this.safariLoginRetries_>e){b();return}-1<this.safariLoginRetries_&&c.fetchAuthData(a,b);d=7500;this.safariLoginRetries_++}else if(!this.popupIsActive_()){clearTimeout(this._pollTimeout);c.fetchAuthData(a,b);return}this.pollTimeout_=setTimeout(goog.bind(this.testAuthResult_,
this,a,b),d)};fyre.conv.service.LivefyreAuthDelegate.prototype.popupIsActive_=function(){if(!this.popup)return!1;try{return!1===this.popup.closed}catch(a){if(goog.userAgent.product.OPERA)return!0;throw a;}};fyre.conv.service.LivefyreAuthDelegate.prototype.logout=function(a){fyre.conv.user.isGuest()?a.success():fyre.v1.client.AuthClient.getInstance().logout(goog.bind(a.success,a))};goog.exportProperty(fyre.conv.service.LivefyreAuthDelegate.prototype,"logout",fyre.conv.service.LivefyreAuthDelegate.prototype.logout);
fyre.conv.service.LivefyreAuthDelegate.prototype.viewProfile=function(a,b){goog.window.open(b.profileUrl,{target:"_blank"})};goog.exportProperty(fyre.conv.service.LivefyreAuthDelegate.prototype,"viewProfile",fyre.conv.service.LivefyreAuthDelegate.prototype.viewProfile);fyre.conv.service.LivefyreAuthDelegate.prototype.editProfile=function(){goog.window.open(fyre.conv.config.servers.topLevel+"/profile/edit/info/",{target:"_blank"})};
goog.exportProperty(fyre.conv.service.LivefyreAuthDelegate.prototype,"editProfile",fyre.conv.service.LivefyreAuthDelegate.prototype.editProfile);fyre.conv.LivefyreAuthDelegate.setBackend(fyre.conv.service.LivefyreAuthDelegate);fyre.v1.errors={};fyre.v1.errors.errorFactory=function(a){var b=function(b){this.name=a;this.message=b};goog.inherits(b,Error);return b};fyre.v1.errors.AuthenticationInProgress=fyre.v1.errors.errorFactory("AuthenticationInProgress");fyre.v1.errors.CommentCharacterLimitReached=fyre.v1.errors.errorFactory("CommentCharacterLimitReached");fyre.v1.client.AuthClient=function(a){fyre.v1.client.BaseClient.call(this,a)};goog.inherits(fyre.v1.client.AuthClient,fyre.v1.client.BaseClient);goog.addSingletonGetter(fyre.v1.client.AuthClient);fyre.v1.client.AuthClient.prototype.initialize=function(){this.active=!1;this.configureLogging("fyre.v1.client.AuthClient")};fyre.v1.client.AuthClient.prototype.getAuthUrl=function(){return fyre.v1.config.servers.auth+"/auth/login?next="+encodeURI(window.location.href)};
fyre.v1.client.AuthClient.prototype.getAuthPopupUrl=function(){var a=fyre.v1.config.servers.auth+"/auth/popup/?start=true&guest=true&site_id="+this.conv.get(this.conv.ATTRIBUTES.SITE_ID);goog.userAgent.product.SAFARI&&(a+="&url="+encodeURI(window.location.href.split("#")[0]));return a};fyre.v1.client.AuthClient.prototype.beginAuthentication=function(){if(this.active)throw new fyre.v1.errors.AuthenticationInProgress;this.active=!0};
fyre.v1.client.AuthClient.prototype.endAuthentication=function(){this.active=!1};fyre.v1.client.AuthClient.prototype.authenticateByCookie=function(a,b,c){this.logger.info("Requesting auth token via cookie auth.");b=new fyre.v1.io.Jsonp({url:fyre.v1.config.servers.web+"/auth/token.json/",success:b,failure:c});c={bn:a.conv.get(a.conv.ATTRIBUTES.SITE_ID),conv_id:a.conv.get(a.conv.ATTRIBUTES.ID),nocache:(new Date).getTime()};a.articleId&&(c.article_id=a.articleId);b.send(c)};
fyre.v1.client.AuthClient.prototype.logout=function(a,b){this.logger.info("Requesting logout.");(new fyre.v1.io.XDR({url:fyre.v1.config.servers.web+"/auth/logout/ajax/?nocache="+(new Date).getTime(),success:a,failure:b})).send()};
fyre.v1.client.AuthClient.prototype.getOAuthToken=function(a,b,c,d){var e=goog.Uri.parse(fyre.v1.config.servers.quill+fyre.conv.config.API1+"oauth/authorize/");e.setParameterValue("oauth_complete",fyre.v1.config.bootstrapS3Host+"/xd_receiver/oauth_final_page.html");e.setParameterValue(a.isGuest()?"lfgtoken":"lftoken",a.get(a.ATTRIBUTES.TOKEN));e.setParameterValue("provider",b.provider);e.setParameterValue("scope","publish_stream");a=goog.window.open(e,{width:770,height:400});b=goog.bind(this.getOAuthToken_,
this,a,b,c,d);fyre.v1.util.ScriptLoader.loadScript(fyre.v1.config.servers.assets+"/javascripts/livefyre_mod_iframe.js",goog.global.document,{},b)};fyre.v1.client.AuthClient.prototype.getOAuthToken_=function(a,b,c,d){var e=new fyre.v1.io.Iframe({child_page:fyre.v1.config.bootstrapS3Host+"/xd_receiver/oauth_cookie_poll_key.html",success:c,failure:d}),f=function(a){!0===e.running&&(null===a?e.abort():setTimeout(function(){f(a)},500))};f(a);e.send(b)};
fyre.v1.client.AuthClient.prototype.authenticateByBackplane=function(a,b,c){(new fyre.v1.io.Jsonp({url:a,success:b,failure:c})).send({})};fyre.v1.enums={};fyre.v1.enums.comment={};fyre.v1.enums.comment.state={};fyre.v1.enums.content={};fyre.v1.enums.content.source={};fyre.v1.enums.content.direction={};fyre.v1.enums.content.type={};fyre.v1.enums.content.flags={};fyre.v1.enums.social={};fyre.v1.enums.social.services={};fyre.v1.enums.comment.state.ACTIVE="active";fyre.v1.enums.comment.state.BOZO="bozo";fyre.v1.enums.comment.state.DELETED="deleted";fyre.v1.enums.comment.state.PENDING="pending";fyre.v1.enums.comment.state.SPAM="spam";
fyre.v1.enums.comment.state.HIDDEN="hidden";fyre.v1.enums.content.direction.NEW="new";fyre.v1.enums.content.direction.OLD="old";fyre.v1.enums.content.type.MESSAGE=0;fyre.v1.enums.content.type.OPINE=1;fyre.v1.enums.content.type.SHARE=2;fyre.v1.enums.content.type.OEMBED=3;fyre.v1.enums.content.source.LIVEFYRE=0;fyre.v1.enums.content.source.TWITTER_STREAM=1;fyre.v1.enums.content.source.TWITTER_GNIP=2;fyre.v1.enums.content.source.FACEBOOK_FANPAGE=3;fyre.v1.enums.content.source.IMPORT=4;
fyre.v1.enums.content.source.FYREHOSE_LIVEFYRE=5;fyre.v1.enums.content.source.FYREHOSE_FACEBOOK=6;fyre.v1.enums.content.source.FYREHOSE_TWITTER=7;fyre.v1.enums.content.source.FYREHOSE_IMPORT=8;fyre.v1.enums.content.source.GPLUS=10;fyre.v1.enums.content.source.FLICKR=11;fyre.v1.enums.content.source.UTUBE=12;fyre.v1.enums.content.source.FEED=13;fyre.v1.enums.content.source.DATASIFT_FACEBOOK=14;fyre.v1.enums.content.flags.SPAM="spam";fyre.v1.enums.content.flags.OFFENSIVE="offensive";
fyre.v1.enums.content.flags.DISAGREE="disagree";fyre.v1.enums.content.flags.OFFTOPIC="off-topic";fyre.v1.enums.content.visibility={NONE:0,EVERYONE:1,OWNER:2,GROUP:3};fyre.v1.enums.social.services.TWITTER=1;fyre.v1.enums.social.services.FACEBOOK=2;fyre.v1.enums.social.services.GOOGLE_PLUS=3;fyre.v1.enums.social.services.LINKEDIN=4;fyre.v1.enums.social.services.OPENID=5;fyre.v1.object.AppContextObject=function(a,b){goog.asserts.assert(arguments.length);this.context=a;this.initialize.call(this,b?b:{})};goog.inherits(fyre.v1.object.AppContextObject,fyre.v1.object.Base);fyre.v1.object.AppContextObject.prototype.subscribe=function(a,b){this.context.subscribe(a,b,this)};fyre.v1.object.AppContextObject.prototype.trigger=function(a,b){this.context.trigger(a,b)};goog.functions={};goog.functions.constant=function(a){return function(){return a}};goog.functions.FALSE=goog.functions.constant(!1);goog.functions.TRUE=goog.functions.constant(!0);goog.functions.NULL=goog.functions.constant(null);goog.functions.identity=function(a){return a};goog.functions.error=function(a){return function(){throw Error(a);}};goog.functions.lock=function(a){return function(){return a.call(this)}};goog.functions.withReturnValue=function(a,b){return goog.functions.sequence(a,goog.functions.constant(b))};
goog.functions.compose=function(a){var b=arguments,c=b.length;return function(){var a;c&&(a=b[c-1].apply(this,arguments));for(var e=c-2;0<=e;e--)a=b[e].call(this,a);return a}};goog.functions.sequence=function(a){var b=arguments,c=b.length;return function(){for(var a,e=0;e<c;e++)a=b[e].apply(this,arguments);return a}};goog.functions.and=function(a){var b=arguments,c=b.length;return function(){for(var a=0;a<c;a++)if(!b[a].apply(this,arguments))return!1;return!0}};
goog.functions.or=function(a){var b=arguments,c=b.length;return function(){for(var a=0;a<c;a++)if(b[a].apply(this,arguments))return!0;return!1}};goog.functions.not=function(a){return function(){return!a.apply(this,arguments)}};goog.functions.create=function(a,b){var c=function(){};c.prototype=a.prototype;c=new c;a.apply(c,Array.prototype.slice.call(arguments,1));return c};fyre.v1.service={};fyre.v1.service.ServiceBase=function(a,b){fyre.v1.object.AppContextObject.call(this,a,b||{})};goog.inherits(fyre.v1.service.ServiceBase,fyre.v1.object.AppContextObject);fyre.v1.service.ServiceBase.prototype.makeCallback=function(a,b,c){return fyre.v1.util.makeCallback(a,this,b,c)};fyre.v1.service.ServiceBase.prototype.isDisposed=function(){return this.context.isDisposed()};fyre.v1.util.DelegateHandler=function(a,b){this.base=goog.bind(a.base||goog.nullFunction,b);this.success=goog.bind(a.success||goog.nullFunction,b);this.failure=goog.bind(a.failure||goog.nullFunction,b)};goog.exportProperty(fyre.v1.util.DelegateHandler,"base",fyre.v1.util.DelegateHandler.base);goog.exportProperty(fyre.v1.util.DelegateHandler,"success",fyre.v1.util.DelegateHandler.success);goog.exportProperty(fyre.v1.util.DelegateHandler,"failure",fyre.v1.util.DelegateHandler.failure);
fyre.v1.util.delegate=function(a,b){b=b||{};return function(){var c=new fyre.v1.util.DelegateHandler(b,this),d=this.delegate&&this.delegate[a];d?d.apply(this.delegate,goog.array.concat(c,goog.array.clone(arguments))):c.base.apply(this,arguments)}};fyre.conv.service.AuthenticationService=function(a,b){this.socialFriends_=new fyre.v1.model.Collection;this.socialFriends_.model=fyre.conv.model.SocialFriend;this.fetchedSocialFriends_=!1;fyre.v1.service.ServiceBase.call(this,a,b)};goog.inherits(fyre.conv.service.AuthenticationService,fyre.v1.service.ServiceBase);
fyre.conv.service.AuthenticationService.getInstance=function(a){var b=fyre.conv.service.AuthenticationService.instance_;b.delegate=b.opts.authDelegate||(fyre.conv.config.customNetwork?new fyre.conv.service.RemoteAuthDelegate(b.opts):new fyre.conv.service.LivefyreAuthDelegate(a,b.opts));return b||goog.asserts.fail()};
fyre.conv.service.AuthenticationService.configure=function(a){goog.asserts.assert(!fyre.conv.service.AuthenticationService.instance_);fyre.conv.service.AuthenticationService.instance_=a};fyre.conv.service.AuthenticationService.prototype.initialize=function(a){this.handler=new (a.handler||fyre.conv.service.AuthenticationHandler)(a,this);this.configureLogging("fyre.conv.service.AuthenticationService");fyre.conv.service.AuthenticationService.superClass_.initialize.call(this,a)};
fyre.conv.service.AuthenticationService.prototype.ensureLogin=function(a,b,c){fyre.conv.user.id?b():this.login(a,b,c)};
fyre.conv.service.AuthenticationService.prototype.login=function(a,b,c){var d=function(){var a=fyre.conv.user;b=b||goog.nullFunction;if(a.id)a.off(a.attributeChangeEvent("id"),d),b();else a.on(a.attributeChangeEvent("id"),d)};fyre.v1.util.delegate("login",{base:function(){throw"Login delegate function must be provided";},success:d,failure:function(){(c||goog.nullFunction)();var a=fyre.conv.user;a.off(a.attributeChangeEvent("id"),d)}}).call(this)};
fyre.conv.service.AuthenticationService.prototype.loginByCookie=fyre.v1.util.delegate("loginByCookie",{success:function(a){var b=fyre.conv.service.AuthenticationAdapter.adaptProfile(a);b&&b.moderator&&a.articleId!=this.opts.articleId||a.siteId!=this.opts.siteId?this.fetchAuthData():goog.object.isEmpty(b)||fyre.conv.ready(goog.bind(this.loginUser_,this,b,a))},failure:function(){this.fetchAuthData()}});
fyre.conv.service.AuthenticationService.prototype.fetchAuthData=fyre.v1.util.delegate("fetchAuthData",{base:function(a,b){var c=fyre.conv.client.InitClient.getInstance(),d=goog.object.clone(this.opts),e=fyre.conv.user.ATTRIBUTES,f=fyre.conv.user.get(e.TOKEN),e=fyre.conv.user.get(e.BP_CHANNEL);d[c.CONSTANTS.token]=f;e&&(d[c.CONSTANTS.bpChannel]=e);c.initPage(d,fyre.v1.util.makeCallback(this.handleAuthData,this,a),b||goog.nullFunction)}});
fyre.conv.service.AuthenticationService.prototype.viewProfile=fyre.v1.util.delegate("viewProfile");fyre.conv.service.AuthenticationService.prototype.editProfile=fyre.v1.util.delegate("editProfile");
fyre.conv.service.AuthenticationService.prototype.handleAuthData=function(a){var b=fyre.conv.model.User.ATTRIBUTES,a=goog.object.clone(a.data),c=fyre.conv.service.AuthenticationAdapter.adaptProfile(a),b=c[b.TOKEN_TTL]||fyre.conv.config.AUTH_COOKIE_TTL;goog.object.isEmpty(c)||(a.siteId=this.opts.siteId,a.articleId=this.opts.articleId,fyre.conv.service.LocalStorageService.getInstance().saveAuthData(a,b),this.loginUser_(c,a))};
fyre.conv.service.AuthenticationService.prototype.loginUser_=function(a,b){this.handleUserAuthor(a,b);fyre.conv.user.set(a);this.trigger(fyre.conv.events.USER_LOGGED_IN)};fyre.conv.service.AuthenticationService.prototype.handleUserAuthor=function(a,b){var c=fyre.conv.service.AuthenticationAdapter.adaptAuthors(b);goog.array.forEach(c,goog.bind(this.handleUserAuthor_,this,a))};
fyre.conv.service.AuthenticationService.prototype.handleUserAuthor_=function(a,b){a[fyre.conv.model.User.ATTRIBUTES.EREF_KEYS].push(b[fyre.conv.model.Author.ATTRIBUTES.EREF_KEY]);this.trigger(fyre.conv.events.LOGIN_AUTHOR_RECEIVED,a)};fyre.conv.service.AuthenticationService.prototype.logout=fyre.v1.util.delegate("logout",{success:function(){this.logoutSuccess()}});
fyre.conv.service.AuthenticationService.prototype.logoutSuccess=function(){var a=fyre.conv.service.LocalStorageService.getInstance();this.fetchedSocialFriends_=null;this.socialFriends_.reset();fyre.conv.user.clear({silent:!0});fyre.conv.user.set(fyre.conv.user.defaults());a.removeAuthData();this.clearTokenTimeout();this.trigger(fyre.conv.events.USER_LOGGED_OUT)};
fyre.conv.service.AuthenticationService.prototype.getOAuthToken=function(a,b,c,d){var e=a.get(a.ATTRIBUTES.OAUTH_TOKENS)[b]||null,f=null;if(e)return c(e);a=goog.bind(this.handleOAuthTokenSuccess,this,c,a,b);switch(b){case fyre.v1.enums.social.services.TWITTER:f="tw";break;case fyre.v1.enums.social.services.FACEBOOK:f="fb";break;case fyre.v1.enums.social.services.LINKEDIN:f="li";break;case fyre.v1.enums.social.services.GOOGLE_PLUS:f="gp";break;default:goog.asserts.fail("unknown provider",b)}fyre.v1.client.AuthClient.getInstance().getOAuthToken(fyre.conv.user,
{name:"oauth_token",provider:f},a,goog.bind(this.handleOAuthTokenFailure,this,d,b))};fyre.conv.service.AuthenticationService.prototype.handleOAuthTokenSuccess=function(a,b,c,d){var e=b.get(b.ATTRIBUTES.OAUTH_TOKENS);e[c]=d;b.set(b.ATTRIBUTES.OAUTH_TOKENS,e);return a(d)};fyre.conv.service.AuthenticationService.prototype.handleOAuthTokenFailure=function(){};
fyre.conv.service.AuthenticationService.prototype.fetchSocialFriends=function(a,b){if((!this.fetchedSocialFriends_||a)&&fyre.conv.user.id&&!fyre.conv.user.isGuest())b=b||goog.nullFunction,fyre.v1.client.SocialClient.getInstance().getSocialFriends(fyre.conv.user,!1,goog.bind(this.handleSocialFriendsSuccess,this,b),b),this.fetchedSocialFriends_=!0};
fyre.conv.service.AuthenticationService.prototype.handleSocialFriendsSuccess=function(a,b){a(b);var c=fyre.conv.model.User.ATTRIBUTES,d=0,e=goog.object.getValueByKeys(b,"data","friends"),f=e.length;setTimeout(goog.bind(function(){if(d!==f){var a=e[d];this.socialFriends_.get(a.id)||this.socialFriends_.add(new fyre.conv.model.SocialFriend(a));d++;setTimeout(goog.bind(arguments.callee,this),0)}},this),0);fyre.conv.user.set(goog.object.create(c.CONNECTIONS,goog.object.getValueByKeys(b,"data","reconnect")));
fyre.conv.user.trigger("changed:"+c.CONNECTIONS)};fyre.conv.service.AuthenticationService.prototype.getSocialFriends=function(){return this.socialFriends_};fyre.conv.service.AuthenticationService.prototype.setTokenTimeout=function(){var a=fyre.conv.service.LocalStorageService.getInstance().getAuthData();this.clearTokenTimeout();this.tokenTimeout_=setTimeout(goog.bind(function(){a?this.setTokenTimeout():fyre.conv.user.set(fyre.conv.user.ATTRIBUTES.TOKEN_EXPIRED,!0)},this),3E5)};
fyre.conv.service.AuthenticationService.prototype.clearTokenTimeout=function(){this.tokenTimeout_&&clearTimeout(this.tokenTimeout_)};fyre.conv.service.AuthenticationService.prototype.isUserLoggedIn=function(){return!!fyre.conv.user.id};fyre.conv.service.ActionQueueService=function(a,b){fyre.v1.service.ServiceBase.call(this,a,b);this.storageSvc=fyre.conv.service.LocalStorageService.getInstance();this.authSvc=fyre.conv.service.AuthenticationService.getInstance();this.setEnabled(b);fyre.conv.bus.subscribe(fyre.conv.events.USER_LOGGED_IN,this.dequeue,this)};goog.inherits(fyre.conv.service.ActionQueueService,fyre.v1.service.ServiceBase);fyre.conv.service.ActionQueueService.ACTION_TYPES={POST:"post"};
fyre.conv.service.ActionQueueService.DELIMITERS={INNER:"::",OUTER:"|"};fyre.conv.service.ActionQueueService.prototype.enqueue=function(a,b){if(!this.authSvc.isUserLoggedIn()&&this.isEnabled()){var c=fyre.conv.service.ActionQueueService.DELIMITERS,d=this.serialize_(a,b),d=goog.string.subs("%s%s%s",a,c.INNER,d),e=this.storageSvc.getAction();e&&(d=goog.string.subs("%s%s%s",e,c.OUTER,d));this.storageSvc.saveAction(d)}};
fyre.conv.service.ActionQueueService.prototype.dequeue=function(){if(this.authSvc.isUserLoggedIn()){var a=fyre.conv.service.ActionQueueService.DELIMITERS,b=this.storageSvc.getAction();b&&(a=b.split(a.OUTER),goog.array.forEach(a,function(a){this.doAction_(a)},this),this.clear())}};fyre.conv.service.ActionQueueService.prototype.clear=function(){this.storageSvc.removeAction()};
fyre.conv.service.ActionQueueService.prototype.doAction_=function(a){var b=fyre.conv.service.ActionQueueService.ACTION_TYPES,a=a.split(fyre.conv.service.ActionQueueService.DELIMITERS.INNER),c=a[1];switch(a[0]){case b.POST:this.context.commentService.postMessage(new fyre.conv.model.Comment(goog.json.parse(c)))}};fyre.conv.service.ActionQueueService.prototype.serialize_=function(a,b){var c=fyre.conv.service.ActionQueueService.ACTION_TYPES,d={};switch(a){case c.POST:d=b.toStorageData()}return goog.json.serialize(d)};
fyre.conv.service.ActionQueueService.prototype.setEnabled=function(a){this.enabled=!!a.authPageReload};fyre.conv.service.ActionQueueService.prototype.isEnabled=function(){return this.enabled};fyre.conv.service.CollectionAdapter={};
fyre.conv.service.CollectionAdapter.adaptCollection=function(a){var b=fyre.conv.model.Collection.ATTRIBUTES,c=a.collectionSettings;if(!c)return null;var d=c.config;if(!d)return null;var e=a.networkSettings,f=a.siteSettings,g={},h={};if(!d)return null;goog.object.extend(g,e);goog.object.extend(g,f);goog.object.extend(g,d);h[b.HEAD_DOCUMENT]=a.headDocument;g.enabled=e.enabled&&goog.object.get(f,"enabled",!0);h.id=c.collectionId;h[b.BOOTSTRAP_URL]=c[b.BOOTSTRAP_URL];h[b.CHECKSUM]=c[b.CHECKSUM];h[b.COMMENTS_ENABLED]=
g[b.COMMENTS_ENABLED];h[b.EDIT]=g[b.EDIT];h[b.EDIT_COMMENT_INTERVAL]=g[b.EDIT_COMMENT_INTERVAL];h[b.EVENT]=c[b.EVENT];h[b.GUEST]=g[b.GUEST];h[b.HEAD_IS_COMPLETE]=h[b.HEAD_DOCUMENT].isComplete;h[b.HOVERCARDS_ENABLED]=g[b.HOVERCARDS_ENABLED];h[b.MEDIA_DISPLAY]=g[b.MEDIA_DISPLAY];h[b.MODIFIED]=g[b.MODIFIED];h[b.NEST_LEVEL]=g[b.NEST_LEVEL];h[b.NUM_VISIBLE]=c[b.NUM_VISIBLE];h[b.PAGES]=c.data;h[b.PREMOD]=g[b.PREMOD];h[b.RAW_HTML]=g.rawHtml;h[b.REPLIES_ENABLED]=g[b.REPLIES_ENABLED];h[b.STREAM_TYPE]=g[b.STREAM_TYPE]||
fyre.conv.model.Collection.STREAM_TYPES.THREADED;h[b.TOP_CONTENT_DISPLAY]=g[b.TOP_CONTENT_DISPLAY];h[b.HIGH_VELOCITY_MODE]=h[b.STREAM_TYPE]===fyre.conv.model.Collection.STREAM_TYPES.THREADED?g[b.HIGH_VELOCITY_MODE]:!1;h[b.THROTTLE_STREAM]=!1;h[b.STREAM_TYPE]!==fyre.conv.model.Collection.STREAM_TYPES.LIVEBLOG&&(h[b.THROTTLE_STREAM]=goog.isBoolean(g[b.THROTTLE_STREAM])?g[b.THROTTLE_STREAM]:!1);h[b.STREAM_TYPE]!==fyre.conv.model.Collection.STREAM_TYPES.THREADED&&(h[b.TOP_CONTENT_DISPLAY]=fyre.conv.model.Collection.TOP_CONTENT_DISPLAY_TYPES.NONE);
h[b.ARCHIVE_INFO]=c.archiveInfo?fyre.conv.service.CollectionAdapter.adaptArchiveInfo(c.archiveInfo):fyre.conv.service.CollectionAdapter.adaptArchiveInfoBackcompat(c.data);return h};fyre.conv.service.CollectionAdapter.adaptArchiveInfoBackcompat=function(a){var b={nPages:a.length,pageInfo:{}};goog.array.forEach(a,function(a,d){b.pageInfo[d]=fyre.conv.service.CollectionAdapter.adaptArchivePageInfo(a);b.pageInfo[d].idx=d});return b};
fyre.conv.service.CollectionAdapter.adaptArchiveInfo=function(a){return{nPages:a.nPages,pathBase:a.pathBase,pageInfo:goog.object.map(a.pageInfo,fyre.conv.service.CollectionAdapter.adaptArchivePageInfo)}};fyre.conv.service.CollectionAdapter.adaptArchivePageInfo=function(a){return{first:a.first,last:a.last,url:a.url,idx:a.idx}};
fyre.conv.service.CollectionAdapter.adaptStreamSetting=function(a){var b=a.name,c=goog.object.getValues(fyre.conv.model.Collection.ATTRIBUTES);goog.asserts.assert(goog.array.contains(c,b));return goog.object.create(b,a.value)};fyre.conv.service.CollectionAdapter.adaptFollowerSetting=function(a){return{authorId:a.authorId,isFollowing:a.following}};fyre.conv.author={};fyre.conv.author.AuthorAdapter={};fyre.conv.author.AuthorAdapter.AUTHOR_SOURCE_MAP={FB:"facebook",LF:"livefyre",TW:"twitter"};fyre.conv.author.AuthorAdapter.toFetchAuthorRequest=function(a){var b={},a=a.get(fyre.conv.model.Author.ATTRIBUTES.TYPE)||fyre.conv.model.Author.TYPES.DEFAULT;b.source=a;return b};
fyre.conv.author.AuthorAdapter.fromFetchAuthorResponse=function(a){var b=fyre.conv.model.Author.ATTRIBUTES,c={};c[b.BIO]=a.bio||"";c[b.CONNECTIONS]=fyre.conv.author.AuthorAdapter.connectionToSoyData(a.connections||[]);c[b.DISPLAY_NAME]=a.display_name;c[b.FIRST_NAME]=a.first_name;c[b.LAST_NAME]=a.last_name;c[b.PROFILE_URL]=a.profile_url||null;goog.object.containsKey(a,"rating")&&(c[b.RATING]=a.rating);c[b.URL]=a.website_url||null;return c};
fyre.conv.author.AuthorAdapter.connectionToSoyData=function(a){var b=[],c=fyre.conv.author.AuthorAdapter.PROVIDERS;goog.array.forEach(a,function(a){var e={};e.provider=a.provider;e.profileUrl=a.profileUrl;goog.object.contains(c,e.provider)&&b.push(e)});return b};
fyre.conv.author.AuthorAdapter.adaptAuthor=function(a){var b=fyre.conv.model.Author.ATTRIBUTES,c={};c[b.AVATAR]=a[b.AVATAR];c[b.DISPLAY_NAME]=a[b.DISPLAY_NAME];c[b.ID]=a[b.ID];c[b.PROFILE_URL]=a[b.PROFILE_URL];c[b.TAGS]=a[b.TAGS];c[b.TYPE]=a[b.TYPE];return c};fyre.conv.author.AuthorAdapter.PROVIDERS={FACEBOOK:"facebook",GOOGLE:"google",LINKEDIN:"linkedin",LIVEFYRE:"livefyre",OPENID:"openid",TWITTER:"twitter"};fyre.conv.model.ContentState=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.ContentState,fyre.v1.model.Model);fyre.conv.model.ContentState.prototype.ATTRIBUTES=fyre.conv.model.ContentState.ATTRIBUTES={VIS:"vis",TYPE:"type",EVENT:"event",SOURCE:"source",CONTENT:"content",EREFS:"erefs"};fyre.conv.model.ContentState.ENUM_VIS=fyre.conv.model.ContentState.prototype.ENUM_VIS={NONE:0,EVERYONE:1,OWNER:2,GROUP:3};
fyre.conv.model.ContentState.ENUM_TYPE=fyre.conv.model.ContentState.prototype.ENUM_TYPE={MESSAGE:0,OPINE:1,SHARE:2,OEMBED:3};fyre.conv.model.FeedEntry=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.FeedEntry,fyre.v1.model.Model);fyre.conv.model.FeedEntry.prototype.ATTRIBUTES=fyre.conv.model.FeedEntry.ATTRIBUTES={CHANNEL_ID:"channelId",CREATED_AT:"createdAt",DESCRIPTION:"description",FEED_TYPE:"feedType",ID:"id",LINK:"link",PUB_DATE:"pubDate",TITLE:"title",TRANSFORMER:"transformer"};fyre.conv.model.FeedEntry.FEED_TYPES={XML:1,RSS:2,ATOM:3};
fyre.conv.model.FeedEntry.prototype.isXML=function(){return this.get(fyre.conv.model.FeedEntry.ATTRIBUTES.FEED_TYPE)==fyre.conv.model.FeedEntry.FEED_TYPES.XML};fyre.conv.model.FeedEntry.prototype.isRSS=function(){return this.get(fyre.conv.model.FeedEntry.ATTRIBUTES.FEED_TYPE)==fyre.conv.model.FeedEntry.FEED_TYPES.RSS};fyre.conv.model.FeedEntry.prototype.isAtom=function(){return this.get(fyre.conv.model.FeedEntry.ATTRIBUTES.FEED_TYPE)==fyre.conv.model.FeedEntry.FEED_TYPES.ATOM};fyre.conv.model.Comment=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.Comment,fyre.v1.model.Model);
fyre.conv.model.Comment.fromState=function(a,b,c){var d=fyre.conv.model.Comment.ATTRIBUTES,e=a.content;c&&goog.object.add(e,d.AUTHOR,c);var c=new fyre.conv.model.Comment(e),f=fyre.conv.model.Comment.getDefaultSource(a),g=e[d.MENTIONS];c.set(d.SOURCE,f);c.set(d.VISIBILITY,a.vis);c.set(d.LAST_VISIBILITY,a.lastVis);c.set(d.COLLECTION,b);c.set(d.EVENT,a.event);c.set(d.TRANSPORT,a.transport);c.setSocialMsgId();if(g){var h=new fyre.v1.model.Collection;goog.array.forEach(g,function(a){h.add(new fyre.v1.model.Mention(a))});
c.set(d.MENTIONS,h)}a=a.descendents;goog.isDef(a)&&c.set(d.DESCENDENT_COUNT,a);e&&e.feedEntry&&c.set(fyre.conv.model.Comment.ATTRIBUTES.FEED_ENTRY,new fyre.conv.model.FeedEntry(e.feedEntry));return c};fyre.conv.model.Comment.getDefaultSource=function(a){var b=fyre.conv.model.Comment.ATTRIBUTES,c=fyre.v1.enums.content.source,d=a[b.SOURCE];d||(d=goog.isNumber(a[b.ID])?c.FYREHOSE_LIVEFYRE:c.LIVEFYRE);return d};fyre.conv.model.Comment.contentType=fyre.conv.model.Comment.prototype.contentType=fyre.conv.model.ContentState.ENUM_TYPE.MESSAGE;
fyre.conv.model.Comment.prototype.ATTRIBUTES=fyre.conv.model.Comment.ATTRIBUTES={LINKBACK:"linkback",RAW_HTML:"rawHtml",VISIBILITY:"vis",LAST_VISIBILITY:"lastVis",COLLECTION:"collection",LIKES:"likes",LEVEL:"level",UPDATED_BY:"updatedBy",MEDIA:"media",ATTACHMENTS:"attachments",SHARE_TYPES:"shareTypes",EMBEDDED_URLS:"embedded_urls",DESCENDENT_COUNT:"descendentCount",EXPANDING:"expanding",HAS_BEEN_EXPANDED:"hasBeenExpanded",REPLIES_ENABLED:"repliesEnabled",ANCESTOR_ID:"ancestorId",PARENT_ID:"parentId",
REPLACES:"replaces",SOCIAL_MSG_ID:"socialMsgId",SHARE_MODEL:"shareModel",AUTHOR:"author",TRANSPORT:"transport",ANNOTATIONS:"annotations",APPROVABLE:"approvable",AWAITING_APPROVAL:"awaiting_approval",AUTHOR_ID:"authorId",BODY_HTML:"bodyHtml",COMMENTS_ENABLED:"comments_enabled",CONV:"conv",CREATED:"createdAt",DELETED:"deleted",ELAPSED_TIME:"elapsed_time",EVENT:"event",FEED_ENTRY:"feedEntry",HAS_REPLIES:"has_replies",HIDDEN:"hidden",ID:"id",IMPORTED:"imported",MENTIONS:"mentions",MODERATOR:"moderator",
ORDER:"sort_order",ORDER_REVERSE:"sort_order_reverse",PERMISSION_SCOPE:"permissionScope",REMOVED:"removed",REPLIES:"replies",REPLY:"reply",SHARE_LINK:"shareLink",SOURCE:"source",TARGET_ID:"targetId",TIME_INTERVAL:"time_interval",TIME_INTERVAL_LENGTH:"time_interval_length",TYPE:"type",UPDATED:"updatedAt",VERSION:"version"};
fyre.conv.model.Comment.prototype.defaults=function(){var a={},b=fyre.conv.model.Comment.ATTRIBUTES;a[b.ANNOTATIONS]={};a[b.ANNOTATIONS][b.MODERATOR]=!1;a[b.ANNOTATIONS][b.SOCIAL_MSG_ID]=null;a[b.AUTHOR]=new fyre.conv.model.Author;a[b.COMMENTS_ENABLED]=!0;a[b.REPLIES_ENABLED]=!0;a[b.ELAPSED_TIME]=0;a[b.EMBEDDED_URLS]=[];a[b.LEVEL]=0;a[b.LIKES]=new fyre.v1.model.Collection([],{model:fyre.conv.model.Opine});a[b.MEDIA]=new fyre.v1.model.Collection([],{model:fyre.conv.model.MessageMedia});a[b.MENTIONS]=
new fyre.v1.model.Collection([],{model:fyre.v1.model.Mention});a[b.PERMISSION_SCOPE]=0;a[b.EXPANDING]=!1;a[b.HAS_BEEN_EXPANDED]=!1;a[b.REPLIES]=0;a[b.PARENT_ID]="";a[b.REPLACES]="";a[b.SHARE_TYPES]=0;a[b.VISIBILITY]=1;a[b.TIME_INTERVAL_LENGTH]=1E3;a[b.TYPE]="livefyre";a[b.VERSION]=1;return a};fyre.conv.model.Comment.VISIBILITY=fyre.conv.model.Comment.prototype.VISIBILITY=fyre.v1.enums.content.visibility;
fyre.conv.model.Comment.SHARE_TYPES=fyre.conv.model.Comment.prototype.SHARE_TYPES={FACEBOOK:1,TWITTER:2,LINKEDIN:4};fyre.conv.model.Comment.ANNOTATION_TYPES={SCORE:"score",THREAD_SCORE:"thread_score"};fyre.conv.model.Comment.prototype.isImported=function(){return this.get(this.ATTRIBUTES.SOURCE)===fyre.v1.enums.content.source.FYREHOSE_IMPORT};
fyre.conv.model.Comment.prototype.isTwitter=function(){var a=this.get(this.ATTRIBUTES.SOURCE),b=fyre.v1.enums.content.source;return goog.array.contains([b.TWITTER_STREAM,b.TWITTER_GNIP,b.FYREHOSE_TWITTER],a)};fyre.conv.model.Comment.prototype.isFacebook=function(){var a=this.get(this.ATTRIBUTES.SOURCE),b=fyre.v1.enums.content.source;return goog.array.contains([b.FACEBOOK_FANPAGE,b.FYREHOSE_FACEBOOK],a)};
fyre.conv.model.Comment.prototype.isFeed=function(){var a=this.get(this.ATTRIBUTES.SOURCE);return fyre.v1.enums.content.source.FEED==a};fyre.conv.model.Comment.prototype.isApproved=function(){return this.get(this.ATTRIBUTES.VISIBILITY)==fyre.conv.model.Comment.VISIBILITY.EVERYONE};
fyre.conv.model.Comment.prototype.setSocialMsgId=function(){if(this.isTwitter()||this.isFacebook()){var a=fyre.conv.model.Comment.ATTRIBUTES,b=this.get(a.ANNOTATIONS),c=b[a.SOCIAL_MSG_ID];if(c)return c;c=this.id.split("@")[0].split("-");c=c[c.length-1];b[a.SOCIAL_MSG_ID]=c;this.set(a.ANNOTATIONS,b)}};fyre.conv.model.Comment.prototype.getMentions=function(){var a=this.ATTRIBUTES,b=this.get(a.MENTIONS);if(0<b.length)return b.models;this.populateMentionsFromHTML_(b,this.get(a.BODY_HTML));return b.models};
fyre.conv.model.Comment.prototype.populateMentionsFromHTML_=function(a,b){var c=document.createElement("div");c.innerHTML=b;var d=fyre.v1.model.Mention.ATTRIBUTES,c=goog.dom.getElementsByClass("fyre-mention",c);goog.array.forEach(c||[],function(b){var c={},g=fyre.v1.dom(b);c[d.DISPLAY_NAME]=goog.dom.getFirstElementChild(b).innerHTML;c[d.JID]=g.attr("resource").split("acct:")[1]||"";c[d.NAME]=g.attr("data-lf-handle");c[d.PROFILE_URL]=g.attr("href");c[d.PROVIDER]=g.attr("data-lf-provider");c[d.ID]=
c[d.DISPLAY_NAME]+":"+c[d.PROVIDER];a.get(c[d.ID])||a.add(new fyre.v1.model.Mention(c))})};fyre.conv.model.Comment.STORAGE_ATTRIBUTES=function(){var a=fyre.conv.model.Comment.ATTRIBUTES;return[a.BODY_HTML,a.CONV,a.EMBEDDED_URLS,a.PARENT_ID,a.RAW_HTML,a.SHARE_TYPES]}();fyre.conv.model.Comment.prototype.toStorageData=function(){var a={};goog.array.forEach(fyre.conv.model.Comment.STORAGE_ATTRIBUTES,function(b){goog.object.extend(a,goog.object.create(b,this.get(b)))},this);return a};
fyre.conv.model.Comment.prototype.isLiveblogPost=function(){var a=this.get(this.ATTRIBUTES.COLLECTION),b=a.get(a.ATTRIBUTES.REPLIES_ENABLED),a=a&&a.isLiveBlog(),c=!this.get(this.ATTRIBUTES.PARENT_ID);return a&&c&&b};
fyre.conv.model.Comment.prototype.getShareModel=function(){var a=fyre.conv.model.Comment.ATTRIBUTES,b=fyre.conv.model.Share.ATTRIBUTES,c=this.get(a.SHARE_MODEL);if(c)return c;var c=fyre.conv.model.Author.ATTRIBUTES,d=this.get(a.COLLECTION);goog.asserts.assert(d);var e=this.get(a.AUTHOR);goog.asserts.assert(e);var f=e.get(c.DISPLAY_NAME),g={};g[b.AUTHOR_ID]=e.get(c.ID);g[b.DISPLAY_NAME]=f;g[b.COMMENT]=this;g[b.COLLECTION]=d;c=new fyre.conv.model.Share(g);this.set(a.SHARE_MODEL,c);return c};
fyre.conv.model.Comment.prototype.isTopLevel=function(){return!this.get(fyre.conv.model.Comment.ATTRIBUTES.PARENT_ID)};fyre.conv.model.MessageMedia=function(a){this.ATTRIBUTES=fyre.conv.model.MessageMedia.ATTRIBUTES;this.EMBEDLY_TYPES=fyre.conv.model.MessageMedia.EMBEDLY_TYPES;this.PROVIDER_NAMES=fyre.conv.model.MessageMedia.PROVIDER_NAMES;fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.MessageMedia,fyre.v1.model.Model);
fyre.conv.model.MessageMedia.fromState=function(a){var a=a.content,b=a.oembed;if(b){var c=fyre.conv.model.MessageMedia.ATTRIBUTES;goog.object.containsKey(b,c.THUMBNAIL_URL)&&!b[c.THUMBNAIL_URL]&&(b[c.EXPANDABLE]=!1,delete b[c.THUMBNAIL_URL]);b[c.ID]=a[c.ID];b[c.LINK]=a[c.LINK];b[c.TARGET_ID]=a[c.TARGET_ID];return new fyre.conv.model.MessageMedia(b)}};fyre.conv.model.MessageMedia.contentType=fyre.conv.model.MessageMedia.prototype.contentType=fyre.conv.model.ContentState.ENUM_TYPE.OEMBED;
fyre.conv.model.MessageMedia.EMBEDLY_TYPES={PHOTO:"photo",VIDEO:"video",RICH:"rich",LINK:"link",ERROR:"error"};
fyre.conv.model.MessageMedia.prototype.ATTRIBUTES=fyre.conv.model.MessageMedia.ATTRIBUTES={ID:"id",LINK:"link",TARGET_ID:"targetId",ANCESTOR_ID:"ancestorId",AUTHOR_NAME:"author_name",AUTHOR_URL:"author_url",EXPANDABLE:"expandable",HEIGHT:"height",HTML:"html",PROVIDER_NAME:"provider_name",PROVIDER_URL:"provider_url",THUMBNAIL_HEIGHT:"thumbnail_height",THUMBNAIL_URL:"thumbnail_url",THUMBNAIL_WIDTH:"thumbnail_width",TITLE:"title",TYPE:"type",URL:"url",VERSION:"version",WIDTH:"width"};
fyre.conv.model.MessageMedia.PROVIDER_NAMES={FACEBOOK:"Facebook",TWITTER:"Twitter"};fyre.conv.model.MessageMedia.prototype.defaults=function(){var a={},b=fyre.conv.model.MessageMedia.ATTRIBUTES;a[b.EXPANDABLE]=!0;a[b.WIDTH]=0;a[b.HEIGHT]=0;a[b.THUMBNAIL_URL]=fyre.v1.config.servers.assets+"/images/oembed_default_thumbnail.png";return a};fyre.conv.service.STATE_ENUM_TYPE={MESSAGE:0,OPINE:1,SHARE:2,OEMBED:3};fyre.conv.service.STATE_ENUM_VIS={NONE:0,EVERYONE:1,OWNER:2,GROUP:3};fyre.conv.service.STATE_ENUM_TRANSPORT={BOOTSTRAP:1,STREAM:2,QUILL:3,STREAM_ARCHIVE:4};fyre.conv.service.ContentAdapter={};fyre.conv.service.ContentAdapter.adaptErefResponse=function(a){a=a.data;return{authors:a.authors,states:goog.object.map(a.content,function(a){return{content:a}})}};fyre.conv.service.ContentAdapter.adaptContent=function(a){var b={},c;for(c in a)b[c]=a[c];b.oembed&&(b.oembed=fyre.conv.service.ContentAdapter.adaptOembed(b.oembed));return b};fyre.conv.service.ContentAdapter.FB_PHOTO_PHP_RE=/^https?:\/\/www\.facebook\.com\/photo\.php/;
fyre.conv.service.ContentAdapter.adaptOembed=function(a){var b=fyre.conv.model.MessageMedia.ATTRIBUTES,c=fyre.conv.model.MessageMedia.EMBEDLY_TYPES,d=fyre.conv.model.MessageMedia.PROVIDER_NAMES;if(!a)return a;a[b.PROVIDER_NAME]==d.FACEBOOK&&a[b.THUMBNAIL_URL]&&a[b.TYPE]==c.LINK&&fyre.conv.service.ContentAdapter.FB_PHOTO_PHP_RE.test(a[b.URL])&&(a[b.URL]=a[b.THUMBNAIL_URL],a[b.HEIGHT]=a[b.THUMBNAIL_HEIGHT],a[b.WIDTH]=a[b.THUMBNAIL_WIDTH],a[b.TYPE]=c.PHOTO);var e=a[b.TYPE]==c.RICH;a[b.PROVIDER_NAME]==
d.TWITTER&&a[b.THUMBNAIL_URL]&&e&&a[b.URL]&&(a[b.URL]=a[b.THUMBNAIL_URL],a[b.TYPE]=c.PHOTO);a[b.THUMBNAIL_URL]||(a[b.THUMBNAIL_URL]=a[b.URL]);return a};
fyre.conv.service.ContentAdapter.adaptState=function(a){var b={},c=a.content;b.id=c.id;b.source=a.source;b.type=a.type;b.event=a.event;b.vis=a.vis;b.lastVis=a.lastVis;b.erefs=a.erefs;b.descendents=a.descendents;b.transport=c.transport;b.content=fyre.conv.service.ContentAdapter.adaptContent(c);if(b.type!=fyre.conv.service.STATE_ENUM_TYPE.MESSAGE)return b;c.rawHtml=null;if(a=c.attachments)(a=a.rawHtml)&&(c.rawHtml={body:a.body});return b};
fyre.conv.service.ContentAdapter.adaptAttachments=function(a){var b={};if(a=a.rawHtml)b.rawHtml={body:a.body};return b};fyre.conv.service.ContentAdapter.adaptAuthor=function(a){var b=fyre.conv.model.Author.ATTRIBUTES;goog.string.isEmpty(a[b.AVATAR])&&delete a[b.AVATAR];return a};
fyre.conv.service.ContentAdapter.adaptBootstrapResponse=function(a,b){var c=fyre.conv.service.ContentAdapter.adaptBootstrapContents(a,b.content||[]);c.followers=b.followers||[];c.authors=goog.object.map(b.authors||{},fyre.conv.service.ContentAdapter.adaptAuthor);return c};fyre.conv.service.ContentAdapter.adaptBootstrapContents=function(a,b){var c={erefs:{},content:{}};goog.array.forEach(b,goog.partial(fyre.conv.service.ContentAdapter.adaptTopLevelBootstrapContent_,a,c));return c};
fyre.conv.service.ContentAdapter.adaptTopLevelBootstrapContent_=function(a,b,c){fyre.conv.service.ContentAdapter.adaptBootstrapContent_(a,c.content.id,b,c)};
fyre.conv.service.ContentAdapter.adaptBootstrapContent_=function(a,b,c,d){var e=fyre.conv.service.ContentAdapter.adaptState(d);e.content.ancestorId=b;e.pageIdx=a;e.transport=fyre.conv.service.STATE_ENUM_TRANSPORT.BOOTSTRAP;(e.erefs?c.erefs:c.content)[e.content.id]=e;goog.array.forEach(d.childContent||[],goog.partial(fyre.conv.service.ContentAdapter.adaptBootstrapContent_,a,b,c))};fyre.conv.service.CollectionHandler=function(a,b){fyre.v1.handler.HandlerBase.call(this,a,b)};goog.inherits(fyre.conv.service.CollectionHandler,fyre.v1.handler.HandlerBase);fyre.conv.service.CollectionHandler.prototype.initialize=function(a,b){this.opts=a;this.service=b;this._commentStates={};fyre.conv.user.onChange(fyre.conv.user.ATTRIBUTES.ID,this.addUserAuthor,this);fyre.conv.service.CollectionHandler.superClass_.initialize.call(this,a,b)};
fyre.conv.service.CollectionHandler.prototype.VISIBLE_STATES=[fyre.conv.model.ContentState.ENUM_VIS.EVERYONE];fyre.conv.service.CollectionHandler.prototype.handleFollow=function(a){!(fyre.conv.user.id===a&&!1===this.service.isFollowingViaCookie(a))&&!this.service.followers_.get(a)&&(a=this.service.authors().get(a))&&this.service.followers_.add(a)};fyre.v1.util.handler([fyre.conv.events.BOOTSTRAP_FOLLOWER_RECEIVED],fyre.conv.service.CollectionHandler.prototype.handleFollow);
fyre.conv.service.CollectionHandler.prototype.handleUserFollow=function(){var a=fyre.conv.user;this.addUserAuthor(a);this.handleFollow(a.id)};fyre.v1.util.handler([fyre.conv.events.QUILL_FOLLOWER_ADDED],fyre.conv.service.CollectionHandler.prototype.handleUserFollow);fyre.conv.service.CollectionHandler.prototype.handleUserUnfollow=function(){var a=fyre.conv.user,a=this.service.authors().get(a.id);goog.asserts.assert(a);a&&this.service.followers_.remove(a)};
fyre.v1.util.handler([fyre.conv.events.QUILL_FOLLOWER_REMOVED],fyre.conv.service.CollectionHandler.prototype.handleUserUnfollow);fyre.conv.service.CollectionHandler.prototype.addUserAuthor=function(a){a.id&&(a=a.toAuthor(),this.service.authors().get(a.id)||this.service.authors().add(a))};
fyre.conv.service.CollectionHandler.prototype.handleAuthor=function(a){var b=this.service.authors().get(a[fyre.conv.model.Author.ATTRIBUTES.ID]),a=fyre.conv.author.AuthorAdapter.adaptAuthor(a);b?b.set(a):(b=new fyre.conv.model.Author(a),this.service.authors().add(b))};fyre.v1.util.handler([fyre.conv.events.BOOTSTRAP_AUTHOR_RECEIVED,fyre.conv.events.STREAM_AUTHOR_RECEIVED,fyre.conv.events.EREF_AUTHOR_RECEIVED,fyre.conv.events.LOGIN_AUTHOR_RECEIVED,fyre.conv.events.QUILL_AUTHOR_RECEIVED],fyre.conv.service.CollectionHandler.prototype.handleAuthor);
fyre.conv.service.CollectionHandler.prototype.handleStreamMessage=function(a){var b=fyre.conv.service.ContentAdapter.adaptState(a),a=this.service.collection(),c=this.service.authors().get(b.content.authorId),b=fyre.conv.model.Comment.fromState(b,a,c),c=fyre.conv.model.Comment.ATTRIBUTES,d=b.get(c.ID),e=this._commentStates[d],f=goog.array.contains(this.VISIBLE_STATES,b.get(c.VISIBILITY)),g=0;if(!a.isLiveBlog()||!b.get(c.PARENT_ID))f&&g++,!e&&!f&&g--,this._commentStates[d]=b.get(c.VISIBILITY),a.set(a.ATTRIBUTES.NUM_VISIBLE,
Math.max(0,a.get(a.ATTRIBUTES.NUM_VISIBLE)+g))};fyre.v1.util.handler([fyre.conv.events.STREAM_MESSAGE_RECEIVED],fyre.conv.service.CollectionHandler.prototype.handleStreamMessage);fyre.conv.service.CollectionHandler.prototype.handleStreamSetting=function(a){this.service.collection_.set(fyre.conv.service.CollectionAdapter.adaptStreamSetting(a))};fyre.v1.util.handler([fyre.conv.events.STREAM_SETTING_RECEIVED],fyre.conv.service.CollectionHandler.prototype.handleStreamSetting);
fyre.conv.service.CollectionHandler.prototype.handleStreamFollower=function(a){var b=this.service.followers_,a=fyre.conv.service.CollectionAdapter.adaptFollowerSetting(a),c=a.authorId,d=this.service.authors_.get(c),e=b.get(c);!e&&a.isFollowing?b.add(d):e&&!a.isFollowing&&b.remove(c)};fyre.v1.util.handler([fyre.conv.events.STREAM_FOLLOWER_RECEIVED],fyre.conv.service.CollectionHandler.prototype.handleStreamFollower);fyre.conv.client={};fyre.conv.client.InitClient=function(a){fyre.v1.client.BaseClient.call(this,a);this.configureLogging("fyre.conv.client.InitClient")};goog.inherits(fyre.conv.client.InitClient,fyre.v1.client.BaseClient);goog.addSingletonGetter(fyre.conv.client.InitClient);fyre.conv.client.InitClient.CONSTANTS=fyre.conv.client.InitClient.prototype.CONSTANTS={siteId:"siteId",collectionId:"collectionId",articleId:"articleId",token:"lftoken",bpChannel:"bp_channel"};
fyre.conv.client.InitClient.prototype.initialize=function(){this.data={}};
fyre.conv.client.InitClient.prototype.initPage=function(a,b,c){var d,e={};d=fyre.conv.config.customNetwork?fyre.conv.config.servers.admin:fyre.conv.config.servers.web;d+=fyre.conv.config.API2+"auth/";a[this.CONSTANTS.token]&&(e[this.CONSTANTS.token]=a[this.CONSTANTS.token]);a[this.CONSTANTS.bpChannel]&&(e[this.CONSTANTS.bpChannel]=a[this.CONSTANTS.bpChannel]);a[this.CONSTANTS.collectionId]?e[this.CONSTANTS.collectionId]=a[this.CONSTANTS.collectionId]:(e[this.CONSTANTS.siteId]=a[this.CONSTANTS.siteId],
e[this.CONSTANTS.articleId]=goog.crypt.base64.encodeString(""+a[this.CONSTANTS.articleId],!0));(new fyre.v1.io.XDR({url:d,timeout:1E4,success:b,failure:c})).send(e)};
fyre.conv.client.InitClient.prototype.saveCollection=function(a,b,c,d){var e=a.siteId,f={};a.collectionMeta&&(f.collectionMeta=a.collectionMeta);a.checksum&&(f.checksum=a.checksum);goog.isDef(a.signed)&&(f.signed=a.signed);(new fyre.v1.io.XDR({url:fyre.conv.config.servers.quill+fyre.conv.config.API2+"site/"+e+"/collection/"+(b?"create":"update"),method:fyre.v1.io.POST,timeout:1E4,success:c,failure:d})).send(goog.json.serialize(f))};fyre.v1.Global={};fyre.v1.Global.BOOTSTRAP_JSON="LIVEFYRE_BOOTSTRAP_JSON";fyre.conv.client.BootstrapClient=function(a){this.xdCacheBusters_=[];fyre.v1.client.BaseClient.call(this,a);this.configureLogging("fyre.conv.client.BootstrapClient");this.data={};this.data.anon={};this.data.special={};goog.isObject(goog.global[fyre.v1.Global.BOOTSTRAP_JSON])&&(this.data.anon=goog.global[fyre.v1.Global.BOOTSTRAP_JSON])};goog.inherits(fyre.conv.client.BootstrapClient,fyre.v1.client.BaseClient);goog.addSingletonGetter(fyre.conv.client.BootstrapClient);
fyre.conv.client.BootstrapClient.CONSTANTS={AUTHORS:"authors",FOLLOWERS:"followers",CONTENT:"content"};fyre.conv.client.BootstrapClient.prototype.getAuthorData=function(a,b,c,d){(new fyre.v1.io.XDR({url:fyre.v1.config.servers.bootstrap+fyre.conv.config.API2+"author/"+a+"/",success:c,failure:d})).send(b)};fyre.conv.client.BootstrapClient.prototype.getBootstrapData=function(a,b,c){(new fyre.v1.io.XDR({url:fyre.conv.config.servers.bootstrap+"/bs3"+a,success:b,failure:c})).send()};
fyre.conv.client.BootstrapClient.prototype.getContentByErefs=function(a,b,c){a={ref:a.ref};(new fyre.v1.io.XDR({url:fyre.v1.config.servers.bootstrap+fyre.conv.config.API2+"content/eref/",success:b,failure:c})).send(a)};fyre.conv.client.BootstrapClient.prototype.getContentThread=function(a,b,c){(new fyre.v1.io.XDR({url:fyre.v1.config.servers.bootstrap+fyre.conv.config.API2+"content/thread/",success:b,failure:c})).send(a)};
fyre.conv.client.BootstrapClient.prototype.getAggregateContent=function(a,b,c){a=goog.string.subs("%s%scollection/%s/top/%s/",fyre.v1.config.servers.bootstrap,fyre.conv.config.API2,a.collectionId,a.aggregateType);(new fyre.v1.io.XDR({url:a,success:b,failure:c})).send({format:"stream"})};
fyre.conv.client.BootstrapClient.prototype.getHotThreads=function(a,b,c){a=goog.string.subs("%s%scollection/%s/hot/",fyre.v1.config.servers.bootstrap,fyre.conv.config.API2,a.collectionId);(new fyre.v1.io.XDR({url:a,success:b,failure:c})).send()};fyre.conv.client.BootstrapClient.prototype.getXdCacheParam=function(a){var b=goog.array.indexOf(this.xdCacheBusters_,a);-1==b&&(this.xdCacheBusters_.push(a),b=this.xdCacheBusters_.length-1);return b};
fyre.conv.client.BootstrapClient.prototype.initCollection=function(a,b,c){a=[fyre.conv.config.servers.bootstrap,"bs3"+fyre.conv.config.bootstrapS3Prefix,fyre.conv.config.network,a.siteId,goog.crypt.base64.encodeString(""+a.articleId,!0),"init"].join("/");goog.object.contains(this.data,a)?b(this.data[a]):(new fyre.v1.io.XDR({url:a,timeout:1E4,success:b,failure:c})).send()};fyre.v1.client.WriteClient=function(a){fyre.v1.client.BaseClient.call(this,a);this.configureLogging("fyre.v1.client.WriteClient")};goog.inherits(fyre.v1.client.WriteClient,fyre.v1.client.BaseClient);goog.addSingletonGetter(fyre.v1.client.WriteClient);
fyre.v1.client.WriteClient.prototype.getXhr=function(a,b,c,d,e){var f=new goog.Uri(fyre.v1.config.servers.quill+fyre.v1.config.API2+b),b={success:c||goog.nullFunction,failure:d||goog.nullFunction,method:"POST"};f.setParameterValue(a.guest?"lfgtoken":"lftoken",a.token);goog.object.forEach(e||{},function(a,b){f.setParameterValue(b,a)});b.url=f.toString();return new fyre.v1.io.XDR(b)};
fyre.v1.client.WriteClient.prototype.getMessageContent_=function(a){var b={};b.body=a.bodyHtml;a.parentId&&(b.parent_id=a.parentId);if(b.body.length>("jsonp"==fyre.v1.io.XDR.TRANSPORT?1500:8E3))throw new fyre.v1.errors.CommentCharacterLimitReached;goog.isArray(a.shareTypes)&&a.shareTypes.length&&(b.share_types=goog.json.serialize(a.shareTypes));goog.isObject(a.attachments)&&!goog.object.isEmpty(a.attachments)&&(b.attachments=goog.json.serialize(a.attachments));b._bi=fyre.v1.util.browser.hashed();
return b};fyre.v1.client.WriteClient.prototype.postMessage=function(a,b,c,d){var e=this.getMessageContent_(a);this.getXhr(b,"collection/"+a.collectionId+"/post/",c,d).send(e)};fyre.v1.client.WriteClient.prototype.likeMessage=function(a,b,c,d){var e={message_id:a.messageId,collection_id:a.collectionId};this.getXhr(b,"message/"+a.messageId+"/like/",c,d).send(e)};
fyre.v1.client.WriteClient.prototype.unlikeMessage=function(a,b,c,d){var e={message_id:a.messageId,collection_id:a.collectionId};this.getXhr(b,"message/"+a.messageId+"/unlike/",c,d).send(e)};fyre.v1.client.WriteClient.prototype.approveMessage=function(a,b,c,d){var e={message_id:a.messageId,collection_id:a.collectionId,site_id:a.siteId};this.getXhr(b,"message/"+a.messageId+"/approve/",c,d).send(e)};
fyre.v1.client.WriteClient.prototype.denyMessage=function(a,b,c,d){var e={message_id:a.messageId,collection_id:a.collectionId,site_id:a.siteId};this.getXhr(b,"message/"+a.messageId+"/delete/",c,d).send(e)};fyre.v1.client.WriteClient.prototype.banAuthor=function(a,b,c,d){var e={author_id:a.authorId,sites:a.sites};this.getXhr(b,"author/"+a.authorId+"/ban/",c,d).send(e)};
fyre.v1.client.WriteClient.prototype.bozoMessage=function(a,b,c,d){var e={message_id:a.messageId,collection_id:a.collectionId,site_id:a.siteId};this.getXhr(b,"message/"+a.messageId+"/bozo/",c,d).send(e)};fyre.v1.client.WriteClient.prototype.flagMessage=function(a,b,c,d){var e={message_id:a.messageId,collection_id:a.collectionId,flag:a.flag,notes:a.notes,email:a.email};this.getXhr(b,"message/"+a.messageId+"/flag/"+a.flag+"/",c,d).send(e)};
fyre.v1.client.WriteClient.prototype.deleteMessage=function(a,b,c,d){var e=a.messageId,a={message_id:e,collection_id:a.collectionId,site_id:a.siteId};this.getXhr(b,"message/"+e+"/delete/",c,d).send(a)};fyre.v1.client.WriteClient.prototype.shareMessage=function(a,b,c,d){var e={content:a.content,collection_id:a.collection_id,provider_tokens:a.provider_tokens};this.getXhr(b,"message/"+a.message_id+"/share/",c,d).send(e)};
fyre.v1.client.WriteClient.prototype.editMessage=function(a,b,c,d){var e=a.messageId,f=this.getMessageContent_(a);f.collection_id=a.collectionId;this.getXhr(b,"message/"+e+"/edit/",c,d).send(f)};fyre.v1.client.WriteClient.ACTIONS={FOLLOW:"follow",UNFOLLOW:"unfollow"};fyre.v1.client.WriteClient.prototype.followCollection=function(a,b,c,d){this._follow.call(this,fyre.v1.client.WriteClient.ACTIONS.FOLLOW,a,b,c,d)};
fyre.v1.client.WriteClient.prototype.unfollowCollection=function(a,b,c,d){this._follow.call(this,fyre.v1.client.WriteClient.ACTIONS.UNFOLLOW,a,b,c,d)};fyre.v1.client.WriteClient.prototype._follow=function(a,b,c,d,e){var f={collection_id:b.collectionId};this.getXhr(c,"collection/"+b.collectionId+"/"+a+"/",d,e).send(f)};fyre.v1.client.WriteClient.MENTION_KEYS={MENTION:"mention",COLLECTION_ID:"collection_id"};
fyre.v1.client.WriteClient.exportMentionData=function(a){var b={},c=fyre.v1.client.WriteClient.MENTION_KEYS;b[c.MENTION]=a.mentions;b[c.COLLECTION_ID]=a.collectionId;return b};fyre.v1.client.WriteClient.prototype.sendMentions=function(a,b,c,d){var e=a.messageId,a=fyre.v1.client.WriteClient.exportMentionData(a);this.getXhr(b,"message/"+e+"/mention/",c,d).send(a)};fyre.conv.service.CollectionService=function(a,b){this.logger=fyre.v1.logging.getLogger("CollectionService");fyre.v1.service.ServiceBase.call(this,a,b)};goog.inherits(fyre.conv.service.CollectionService,fyre.v1.service.ServiceBase);fyre.conv.service.CollectionService.FOLLOW_COOKIE_PREFIX="fyre_follow_";fyre.conv.service.CollectionService.FOLLOW_STATES={FOLLOW:"follow",UNFOLLOW:"unfollow"};
fyre.conv.service.CollectionService.prototype.initialize=function(a){this.opts=a;this.collection_=new fyre.conv.model.Collection;this.collection_.on(this.collection_.attributeChangeEvent(this.collection_.ATTRIBUTES.NUM_VISIBLE),function(){this.context.bus.trigger(fyre.conv.events.COMMENT_COUNT_UPDATED,this.collection_.get(this.collection_.ATTRIBUTES.NUM_VISIBLE))},this);this.followers_=new fyre.conv.model.AuthorCollection;this.authors_=new fyre.conv.model.AuthorCollection;this.handler=new (a.handler||
fyre.conv.service.CollectionHandler)(a,this);this.collAsync_=new goog.async.Deferred};fyre.conv.service.CollectionService.prototype.dispose=function(){this.collection_&&this.collection_.off(null,null,this);clearTimeout(this.collectionCreationPoll_);this.collAsync_.chain_=[]};fyre.conv.service.CollectionService.prototype.collection=function(){return this.collection_};fyre.conv.service.CollectionService.prototype.followers=function(){return this.followers_};
fyre.conv.service.CollectionService.prototype.getFollowCookieName_=function(a){return fyre.conv.service.CollectionService.FOLLOW_COOKIE_PREFIX+this.collection_.id+a};fyre.conv.service.CollectionService.prototype.isFollowingViaCookie=function(a){var b=fyre.conv.service.CollectionService.FOLLOW_STATES,a=this.getFollowCookieName_(a),a=goog.net.cookies.get(a);return!a?null:a===b.FOLLOW};
fyre.conv.service.CollectionService.prototype.setFollowCookie_=function(a,b){var c=this.getFollowCookieName_(b);goog.net.cookies.remove(c);goog.net.cookies.set(c,a,900)};fyre.conv.service.CollectionService.prototype.isFollowing=function(a){var b=this.isFollowingViaCookie(a),a=!!this.followers_.get(a);if(null===b)return a;b?this.handler.handleUserFollow():this.handler.handleUserUnfollow();return b};fyre.conv.service.CollectionService.prototype.authors=function(){return this.authors_};
fyre.conv.service.CollectionService.prototype.follow=function(a,b,c){var d=fyre.v1.client.WriteClient.getInstance(),e={collectionId:this.collection_.id},f=fyre.conv.user.getTokenInfo(),b=fyre.v1.util.makeCallback(this.handleFollowSuccess,this,b),c=fyre.v1.util.makeCallback(c);(a?d.followCollection:d.unfollowCollection).call(d,e,f,b,c)};
fyre.conv.service.CollectionService.prototype.handleFollowSuccess=function(a){var a=this.followResponseToState(a),b=fyre.conv.service.CollectionService.FOLLOW_STATES,c={};c[b.FOLLOW]=fyre.conv.events.QUILL_FOLLOWER_ADDED;c[b.UNFOLLOW]=fyre.conv.events.QUILL_FOLLOWER_REMOVED;b=fyre.conv.user.id;this.setFollowCookie_(a,b);this.context.bus.trigger(c[a],b)};
fyre.conv.service.CollectionService.prototype.followResponseToState=function(a){var a=goog.object.getValueByKeys(a,"data","type"),b=fyre.conv.service.CollectionService.FOLLOW_STATES;return a===b.FOLLOW?b.FOLLOW:b.UNFOLLOW};
fyre.conv.service.CollectionService.prototype.getCollection=function(a,b){if(goog.DEBUG){var c=fyre.conv.test.fixtureLoader.loadFixture("init");if(c){goog.functions.compose(a||goog.nullFunction,goog.bind(this.handleGetCollectionSuccess,this))(c);return}}this.collAsync_.inProgress||(this.collAsync_.inProgress=!0,fyre.conv.client.BootstrapClient.getInstance().initCollection(this.opts,goog.bind(this.handleGetCollectionSuccess,this),goog.bind(this.handleGetCollectionFailure,this)));this.collAsync_.addCallbacks(a||
goog.nullFunction,b||goog.nullFunction)};fyre.conv.service.CollectionService.prototype.shouldUpdateCollection_=function(a){var b=-1<window.location.href.indexOf("fyreForceUpdate"),a=a[fyre.conv.model.Collection.ATTRIBUTES.CHECKSUM],a=this.opts&&this.opts.checksum&&this.opts.checksum!==a,c=1===Math.round(10*Math.random())%9;return b?!0:a&&c};
fyre.conv.service.CollectionService.prototype.handleGetCollectionSuccess=function(a){(a=fyre.conv.service.CollectionAdapter.adaptCollection(a))?(a[fyre.conv.model.Collection.ATTRIBUTES.SITE_ID]=this.opts.siteId,this.shouldUpdateCollection_(a)&&fyre.conv.client.InitClient.getInstance().saveCollection(this.opts,!1),this.collection_.set(a),this.isDisposed()||this.context.bus.trigger(fyre.conv.events.COLLECTION_INITIALIZED,a),this.collAsync_.hasFired()||this.collAsync_.callback(this.collection_)):this.createCollection(goog.bind(this.handleGetCollectionSuccess,
this),goog.bind(this.handleGetCollectionFailure,this))};fyre.conv.service.CollectionService.prototype.handleGetCollectionFailure=function(){var a=this.collAsync_;this.collAsync_=new goog.async.Deferred;goog.array.forEach(a.chain_?a.chain_:a.sequence_,function(a){this.collAsync_.addCallback(a[0],a[2])},this);a.errback()};fyre.conv.service.CollectionService.prototype.getOrCreateCollection=function(a,b){this.getCollection(a,goog.bind(this.createCollection,this,a||goog.nullFunction,b||goog.nullFunction))};
fyre.conv.service.CollectionService.prototype.pollCollectionCreated=function(a,b,c){5<=c?b():this.collectionCreationPoll_=setTimeout(goog.bind(this.getCollection,this,fyre.v1.util.makeCallback(this.pollCollectionCreatedSuccess,this,a),goog.bind(this.pollCollectionCreatedFailure,this,a,b,c)),1E3+1500*c)};fyre.conv.service.CollectionService.prototype.pollCollectionCreatedSuccess=function(a){this.context.bus.trigger(fyre.conv.events.COLLECTION_CREATED,a)};
fyre.conv.service.CollectionService.prototype.pollCollectionCreatedFailure=function(a,b,c){this.pollCollectionCreated(a,b,c+1)};fyre.conv.service.CollectionService.prototype.createCollection=function(a,b){var c=goog.bind(this.pollCollectionCreated,this,fyre.v1.util.makeCallback(a),fyre.v1.util.makeCallback(b),0);fyre.conv.client.InitClient.getInstance().saveCollection(this.opts,!0,c,c)};fyre.conv.errors={};fyre.conv.errors.LIKED_OWN_COMMENT="liked_own_comment";fyre.conv.errors.INSUFFICIENT_PERMISSIONS="insufficient_permissions";fyre.conv.model.ContentFlag=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.ContentFlag,fyre.v1.model.Model);fyre.conv.model.ContentFlag.prototype.ATTRIBUTES=fyre.conv.model.ContentFlag.ATTRIBUTES={ID:"id",AUTHOR_ID:"authorId",TARGET_ID:"targetId",FLAG_TYPE:"flagType",NOTES:"notes"};fyre.conv.model.ContentFlag.FLAG_TYPES=fyre.conv.model.ContentFlag.prototype.FLAG_TYPES=fyre.v1.enums.content.flags;fyre.conv.model.Opine=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.Opine,fyre.v1.model.Model);fyre.conv.model.Opine.fromState=function(a){var b=fyre.conv.model.Opine.ATTRIBUTES,c=new fyre.conv.model.Opine(a.content);c.set(b.VISIBILITY,a.vis);return c};fyre.conv.model.Opine.contentType=fyre.conv.model.Opine.prototype.contentType=fyre.conv.model.ContentState.ENUM_TYPE.OPINE;
fyre.conv.model.Opine.prototype.ATTRIBUTES=fyre.conv.model.Opine.ATTRIBUTES={AUTHOR_ID:"authorId",AUTHOR:"author",TARGET_ID:"targetId",ANCESTOR_ID:"ancestorId",TARGET:"target",ID:"id",TYPE:"type",VISIBILITY:"vis"};fyre.conv.model.Opine.TYPES=fyre.conv.model.Opine.prototype.TYPES={LIKE:0,FLAG_OFFENSIVE:1,FLAG_SPAM:2,FLAG_DISAGREE:3,FLAG_OFF_TOPIC:4,FLAG_PROFANE:5};fyre.conv.model.Opine.VISIBILITY=fyre.conv.model.Opine.prototype.VISIBILITY=fyre.v1.enums.content.visibility;fyre.conv.service.CommentHandler=function(a,b){fyre.v1.handler.HandlerBase.call(this,a,b)};goog.inherits(fyre.conv.service.CommentHandler,fyre.v1.handler.HandlerBase);fyre.conv.service.CommentHandler.prototype.initialize=function(a,b){this.opts=a;this.service=b;fyre.conv.service.CommentHandler.superClass_.initialize.call(this,a,b)};goog.structs.InversionMap=function(a,b,c){if(a.length!=b.length)return null;this.storeInversion_(a,c);this.values=b};goog.structs.InversionMap.prototype.storeInversion_=function(a,b){this.rangeArray=a;for(var c=1;c<a.length;c++)null==a[c]?a[c]=a[c-1]+1:b&&(a[c]+=a[c-1])};
goog.structs.InversionMap.prototype.spliceInversion=function(a,b,c){var a=new goog.structs.InversionMap(a,b,c),c=a.rangeArray[0],d=goog.array.peek(a.rangeArray),b=this.getLeast(c),d=this.getLeast(d);c!=this.rangeArray[b]&&b++;c=d-b+1;goog.partial(goog.array.splice,this.rangeArray,b,c).apply(null,a.rangeArray);goog.partial(goog.array.splice,this.values,b,c).apply(null,a.values)};goog.structs.InversionMap.prototype.at=function(a){a=this.getLeast(a);return 0>a?null:this.values[a]};
goog.structs.InversionMap.prototype.getLeast=function(a){for(var b=this.rangeArray,c=0,d=b.length;8<d-c;){var e=d+c>>1;b[e]<=a?c=e:d=e}for(;c<d&&!(a<b[c]);++c);return c-1};goog.i18n={};goog.i18n.GraphemeBreak={};goog.i18n.GraphemeBreak.property={ANY:0,CONTROL:1,EXTEND:2,PREPEND:3,SPACING_MARK:4,L:5,V:6,T:7,LV:8,LVT:9,CR:10,LF:11};goog.i18n.GraphemeBreak.inversions_=null;
goog.i18n.GraphemeBreak.applyLegacyBreakRules_=function(a,b){var c=goog.i18n.GraphemeBreak.property;return a==c.CR&&b==c.LF?!1:a==c.CONTROL||a==c.CR||a==c.LF||b==c.CONTROL||b==c.CR||b==c.LF?!0:a==c.L&&(b==c.L||b==c.V||b==c.LV||b==c.LVT)||(a==c.LV||a==c.V)&&(b==c.V||b==c.T)||(a==c.LVT||a==c.T)&&b==c.T||b==c.EXTEND?!1:!0};
goog.i18n.GraphemeBreak.getBreakProp_=function(a){if(44032<=a&&55203>=a){var b=goog.i18n.GraphemeBreak.property;return 16==a%28?b.LV:b.LVT}goog.i18n.GraphemeBreak.inversions_||(goog.i18n.GraphemeBreak.inversions_=new goog.structs.InversionMap([0,10,1,2,1,18,95,33,13,1,594,112,275,7,263,45,1,1,1,2,1,2,1,1,56,4,12,11,48,20,17,1,101,7,1,7,2,2,1,4,33,1,1,1,30,27,91,11,58,9,269,2,1,56,1,1,3,8,4,1,3,4,13,2,29,1,2,56,1,1,1,2,6,6,1,9,1,10,2,29,2,1,56,2,3,17,30,2,3,14,1,56,1,1,3,8,4,1,20,2,29,1,2,56,1,1,2,
1,6,6,11,10,2,30,1,59,1,1,1,12,1,9,1,41,3,58,3,5,17,11,2,30,2,56,1,1,1,1,2,1,3,1,5,11,11,2,30,2,58,1,2,5,7,11,10,2,30,2,70,6,2,6,7,19,2,60,11,5,5,1,1,8,97,13,3,5,3,6,74,2,27,1,1,1,1,1,4,2,49,14,1,5,1,2,8,45,9,1,100,2,4,1,6,1,2,2,2,23,2,2,4,3,1,3,2,7,3,4,13,1,2,2,6,1,1,1,112,96,72,82,357,1,946,3,29,3,29,2,30,2,64,2,1,7,8,1,2,11,9,1,45,3,155,1,118,3,4,2,9,1,6,3,116,17,7,2,77,2,3,228,4,1,47,1,1,5,1,1,5,1,2,38,9,12,2,1,30,1,4,2,2,1,121,8,8,2,2,392,64,523,1,2,2,24,7,49,16,96,33,3311,32,554,6,105,2,30164,
4,9,2,388,1,3,1,4,1,23,2,2,1,88,2,50,16,1,97,8,25,11,2,213,6,2,2,2,2,12,1,8,1,1,434,11172,1116,1024,6942,1,737,16,16,7,216,1,158,2,89,3,513,1,2051,15,40,8,50981,1,1,3,3,1,5,8,8,2,7,30,4,148,3,798140,255],[1,11,1,10,1,0,1,0,1,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,1,0,2,0,2,0,2,0,2,1,2,0,2,0,2,0,1,0,2,0,2,0,2,0,2,0,2,4,0,2,0,4,2,4,2,0,2,0,2,0,2,4,0,2,0,2,4,2,4,2,0,2,0,2,0,2,4,0,2,4,2,0,2,0,2,4,0,2,0,4,2,4,2,0,2,0,2,4,0,2,0,2,4,2,4,2,0,2,0,2,0,2,4,2,4,2,0,2,0,4,0,2,4,2,0,2,0,4,0,2,0,4,2,4,2,4,2,4,2,0,2,0,4,
0,2,4,2,4,2,0,2,0,4,0,2,4,2,4,2,4,0,2,0,3,2,0,2,0,2,0,3,0,2,0,2,0,2,0,2,0,2,0,4,0,2,4,2,0,2,0,2,0,2,0,4,2,4,2,4,2,4,2,0,4,2,0,2,0,4,0,4,0,2,0,2,4,2,4,2,0,4,0,5,6,7,0,2,0,2,0,2,0,2,0,2,0,1,4,2,4,2,4,2,0,2,0,2,0,2,0,2,4,2,4,2,4,2,0,4,0,4,0,2,4,0,2,4,0,2,4,2,4,2,4,2,4,0,2,0,2,4,0,4,2,4,2,4,0,4,2,4,2,0,2,0,1,2,1,0,1,0,1,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,4,2,4,0,4,0,4,2,0,2,0,2,4,0,2,4,2,4,2,0,2,0,2,4,0,9,0,2,0,2,0,2,0,2,0,1,0,2,0,1,0,2,0,2,0,2,0,2,4,2,0,4,2,1,2,0,2,0,2,0,2,0,1,2],!0));return goog.i18n.GraphemeBreak.inversions_.at(a)};
goog.i18n.GraphemeBreak.hasGraphemeBreak=function(a,b,c){var a=goog.i18n.GraphemeBreak.getBreakProp_(a),b=goog.i18n.GraphemeBreak.getBreakProp_(b),d=goog.i18n.GraphemeBreak.property;return goog.i18n.GraphemeBreak.applyLegacyBreakRules_(a,b)&&!(c&&(a==d.PREPEND||b==d.SPACING_MARK))};goog.format={};goog.format.fileSize=function(a,b){return goog.format.numBytesToString(a,b,!1)};goog.format.isConvertableScaledNumber=function(a){return goog.format.SCALED_NUMERIC_RE_.test(a)};goog.format.stringToNumericValue=function(a){return goog.string.endsWith(a,"B")?goog.format.stringToNumericValue_(a,goog.format.NUMERIC_SCALES_BINARY_):goog.format.stringToNumericValue_(a,goog.format.NUMERIC_SCALES_SI_)};goog.format.stringToNumBytes=function(a){return goog.format.stringToNumericValue_(a,goog.format.NUMERIC_SCALES_BINARY_)};
goog.format.numericValueToString=function(a,b){return goog.format.numericValueToString_(a,goog.format.NUMERIC_SCALES_SI_,b)};goog.format.numBytesToString=function(a,b,c){var d="";if(!goog.isDef(c)||c)d="B";return goog.format.numericValueToString_(a,goog.format.NUMERIC_SCALES_BINARY_,b,d)};goog.format.stringToNumericValue_=function(a,b){var c=a.match(goog.format.SCALED_NUMERIC_RE_);return!c?NaN:c[1]*b[c[2]]};
goog.format.numericValueToString_=function(a,b,c,d){var e=goog.format.NUMERIC_SCALE_PREFIXES_,f=a,g="",h=1;0>a&&(a=-a);for(var i=0;i<e.length;i++){var j=e[i],h=b[j];if(a>=h||1>=h&&a>0.1*h){g=j;break}}g?d&&(g+=d):h=1;a=Math.pow(10,goog.isDef(c)?c:2);return Math.round(f/h*a)/a+g};goog.format.SCALED_NUMERIC_RE_=/^([-]?\d+\.?\d*)([K,M,G,T,P,k,m,u,n]?)[B]?$/;goog.format.NUMERIC_SCALE_PREFIXES_="P,T,G,M,K,,m,u,n".split(",");
goog.format.NUMERIC_SCALES_SI_={"":1,n:1.0E-9,u:1.0E-6,m:0.0010,k:1E3,K:1E3,M:1E6,G:1E9,T:1E12,P:1E15};goog.format.NUMERIC_SCALES_BINARY_={"":1,n:Math.pow(1024,-3),u:Math.pow(1024,-2),m:1/1024,k:1024,K:1024,M:Math.pow(1024,2),G:Math.pow(1024,3),T:Math.pow(1024,4),P:Math.pow(1024,5)};goog.format.FIRST_GRAPHEME_EXTEND_=768;
goog.format.insertWordBreaksGeneric_=function(a,b,c){c=c||10;if(c>a.length)return a;for(var d=[],e=0,f=0,g=0,h=0,i=0;i<a.length;i++){var j=h,h=a.charCodeAt(i),j=h>=goog.format.FIRST_GRAPHEME_EXTEND_&&!b(j,h,!0);e>=c&&h>goog.format.WbrToken_.SPACE&&!j&&(d.push(a.substring(g,i),goog.format.WORD_BREAK_HTML),g=i,e=0);f?h==goog.format.WbrToken_.GT&&f==goog.format.WbrToken_.LT?f=0:h==goog.format.WbrToken_.SEMI_COLON&&f==goog.format.WbrToken_.AMP&&(f=0,e++):h==goog.format.WbrToken_.LT||h==goog.format.WbrToken_.AMP?
f=h:h<=goog.format.WbrToken_.SPACE?e=0:e++}d.push(a.substr(g));return d.join("")};goog.format.insertWordBreaks=function(a,b){return goog.format.insertWordBreaksGeneric_(a,goog.i18n.GraphemeBreak.hasGraphemeBreak,b)};goog.format.conservativelyHasGraphemeBreak_=function(a,b){return 1024<=b&&1315>b};goog.format.insertWordBreaksBasic=function(a,b){return goog.format.insertWordBreaksGeneric_(a,goog.format.conservativelyHasGraphemeBreak_,b)};goog.format.IS_IE8_OR_ABOVE_=goog.userAgent.IE&&goog.userAgent.isVersion(8);
goog.format.WORD_BREAK_HTML=goog.userAgent.WEBKIT?"<wbr></wbr>":goog.userAgent.OPERA?"&shy;":goog.format.IS_IE8_OR_ABOVE_?"&#8203;":"<wbr>";goog.format.WbrToken_={LT:60,GT:62,AMP:38,SEMI_COLON:59,SPACE:32};goog.i18n.bidi={};goog.i18n.bidi.FORCE_RTL=!1;goog.i18n.bidi.IS_RTL=goog.i18n.bidi.FORCE_RTL||("ar"==goog.LOCALE.substring(0,2).toLowerCase()||"fa"==goog.LOCALE.substring(0,2).toLowerCase()||"he"==goog.LOCALE.substring(0,2).toLowerCase()||"iw"==goog.LOCALE.substring(0,2).toLowerCase()||"ur"==goog.LOCALE.substring(0,2).toLowerCase()||"yi"==goog.LOCALE.substring(0,2).toLowerCase())&&(2==goog.LOCALE.length||"-"==goog.LOCALE.substring(2,3)||"_"==goog.LOCALE.substring(2,3));
goog.i18n.bidi.Format={LRE:"\u202a",RLE:"\u202b",PDF:"\u202c",LRM:"\u200e",RLM:"\u200f"};goog.i18n.bidi.Dir={RTL:-1,UNKNOWN:0,LTR:1};goog.i18n.bidi.RIGHT="right";goog.i18n.bidi.LEFT="left";goog.i18n.bidi.I18N_RIGHT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.LEFT:goog.i18n.bidi.RIGHT;goog.i18n.bidi.I18N_LEFT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT;
goog.i18n.bidi.toDir=function(a){return"number"==typeof a?0<a?goog.i18n.bidi.Dir.LTR:0>a?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.UNKNOWN:a?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR};goog.i18n.bidi.ltrChars_="A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufe00-\ufe6f\ufefd-\uffff";goog.i18n.bidi.rtlChars_="\u0591-\u07ff\ufb1d-\ufdff\ufe70-\ufefc";goog.i18n.bidi.htmlSkipReg_=/<[^>]*>|&[^;]+;/g;
goog.i18n.bidi.stripHtmlIfNeeded_=function(a,b){return b?a.replace(goog.i18n.bidi.htmlSkipReg_," "):a};goog.i18n.bidi.rtlCharReg_=RegExp("["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.ltrCharReg_=RegExp("["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.hasAnyRtl=function(a,b){return goog.i18n.bidi.rtlCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.hasRtlChar=goog.i18n.bidi.hasAnyRtl;
goog.i18n.bidi.hasAnyLtr=function(a,b){return goog.i18n.bidi.ltrCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.ltrRe_=RegExp("^["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.rtlRe_=RegExp("^["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.isRtlChar=function(a){return goog.i18n.bidi.rtlRe_.test(a)};goog.i18n.bidi.isLtrChar=function(a){return goog.i18n.bidi.ltrRe_.test(a)};goog.i18n.bidi.isNeutralChar=function(a){return!goog.i18n.bidi.isLtrChar(a)&&!goog.i18n.bidi.isRtlChar(a)};
goog.i18n.bidi.ltrDirCheckRe_=RegExp("^[^"+goog.i18n.bidi.rtlChars_+"]*["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.rtlDirCheckRe_=RegExp("^[^"+goog.i18n.bidi.ltrChars_+"]*["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.startsWithRtl=function(a,b){return goog.i18n.bidi.rtlDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isRtlText=goog.i18n.bidi.startsWithRtl;
goog.i18n.bidi.startsWithLtr=function(a,b){return goog.i18n.bidi.ltrDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isLtrText=goog.i18n.bidi.startsWithLtr;goog.i18n.bidi.isRequiredLtrRe_=/^http:\/\/.*/;goog.i18n.bidi.isNeutralText=function(a,b){a=goog.i18n.bidi.stripHtmlIfNeeded_(a,b);return goog.i18n.bidi.isRequiredLtrRe_.test(a)||!goog.i18n.bidi.hasAnyLtr(a)&&!goog.i18n.bidi.hasAnyRtl(a)};
goog.i18n.bidi.ltrExitDirCheckRe_=RegExp("["+goog.i18n.bidi.ltrChars_+"][^"+goog.i18n.bidi.rtlChars_+"]*$");goog.i18n.bidi.rtlExitDirCheckRe_=RegExp("["+goog.i18n.bidi.rtlChars_+"][^"+goog.i18n.bidi.ltrChars_+"]*$");goog.i18n.bidi.endsWithLtr=function(a,b){return goog.i18n.bidi.ltrExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isLtrExitText=goog.i18n.bidi.endsWithLtr;
goog.i18n.bidi.endsWithRtl=function(a,b){return goog.i18n.bidi.rtlExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isRtlExitText=goog.i18n.bidi.endsWithRtl;goog.i18n.bidi.rtlLocalesRe_=RegExp("^(ar|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Arab|Hebr|Thaa|Nkoo|Tfng))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)");goog.i18n.bidi.isRtlLanguage=function(a){return goog.i18n.bidi.rtlLocalesRe_.test(a)};goog.i18n.bidi.bracketGuardHtmlRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(&lt;.*?(&gt;)+)/g;
goog.i18n.bidi.bracketGuardTextRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(<.*?>+)/g;goog.i18n.bidi.guardBracketInHtml=function(a,b){return(void 0===b?goog.i18n.bidi.hasAnyRtl(a):b)?a.replace(goog.i18n.bidi.bracketGuardHtmlRe_,"<span dir=rtl>$&</span>"):a.replace(goog.i18n.bidi.bracketGuardHtmlRe_,"<span dir=ltr>$&</span>")};
goog.i18n.bidi.guardBracketInText=function(a,b){var c=(void 0===b?goog.i18n.bidi.hasAnyRtl(a):b)?goog.i18n.bidi.Format.RLM:goog.i18n.bidi.Format.LRM;return a.replace(goog.i18n.bidi.bracketGuardTextRe_,c+"$&"+c)};goog.i18n.bidi.enforceRtlInHtml=function(a){return"<"==a.charAt(0)?a.replace(/<\w+/,"$& dir=rtl"):"\n<span dir=rtl>"+a+"</span>"};goog.i18n.bidi.enforceRtlInText=function(a){return goog.i18n.bidi.Format.RLE+a+goog.i18n.bidi.Format.PDF};
goog.i18n.bidi.enforceLtrInHtml=function(a){return"<"==a.charAt(0)?a.replace(/<\w+/,"$& dir=ltr"):"\n<span dir=ltr>"+a+"</span>"};goog.i18n.bidi.enforceLtrInText=function(a){return goog.i18n.bidi.Format.LRE+a+goog.i18n.bidi.Format.PDF};goog.i18n.bidi.dimensionsRe_=/:\s*([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)/g;goog.i18n.bidi.leftRe_=/left/gi;goog.i18n.bidi.rightRe_=/right/gi;goog.i18n.bidi.tempRe_=/%%%%/g;
goog.i18n.bidi.mirrorCSS=function(a){return a.replace(goog.i18n.bidi.dimensionsRe_,":$1 $4 $3 $2").replace(goog.i18n.bidi.leftRe_,"%%%%").replace(goog.i18n.bidi.rightRe_,goog.i18n.bidi.LEFT).replace(goog.i18n.bidi.tempRe_,goog.i18n.bidi.RIGHT)};goog.i18n.bidi.doubleQuoteSubstituteRe_=/([\u0591-\u05f2])"/g;goog.i18n.bidi.singleQuoteSubstituteRe_=/([\u0591-\u05f2])'/g;
goog.i18n.bidi.normalizeHebrewQuote=function(a){return a.replace(goog.i18n.bidi.doubleQuoteSubstituteRe_,"$1\u05f4").replace(goog.i18n.bidi.singleQuoteSubstituteRe_,"$1\u05f3")};goog.i18n.bidi.wordSeparatorRe_=/\s+/;goog.i18n.bidi.hasNumeralsRe_=/\d/;goog.i18n.bidi.rtlDetectionThreshold_=0.4;
goog.i18n.bidi.estimateDirection=function(a,b){for(var c=0,d=0,e=!1,f=goog.i18n.bidi.stripHtmlIfNeeded_(a,b).split(goog.i18n.bidi.wordSeparatorRe_),g=0;g<f.length;g++){var h=f[g];goog.i18n.bidi.startsWithRtl(h)?(c++,d++):goog.i18n.bidi.isRequiredLtrRe_.test(h)?e=!0:goog.i18n.bidi.hasAnyLtr(h)?d++:goog.i18n.bidi.hasNumeralsRe_.test(h)&&(e=!0)}return 0==d?e?goog.i18n.bidi.Dir.LTR:goog.i18n.bidi.Dir.UNKNOWN:c/d>goog.i18n.bidi.rtlDetectionThreshold_?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR};
goog.i18n.bidi.detectRtlDirectionality=function(a,b){return goog.i18n.bidi.estimateDirection(a,b)==goog.i18n.bidi.Dir.RTL};goog.i18n.bidi.setElementDirAndAlign=function(a,b){if(a&&(b=goog.i18n.bidi.toDir(b))!=goog.i18n.bidi.Dir.UNKNOWN)a.style.textAlign=b==goog.i18n.bidi.Dir.RTL?"right":"left",a.dir=b==goog.i18n.bidi.Dir.RTL?"rtl":"ltr"};goog.i18n.BidiFormatter=function(a,b){this.contextDir_=goog.i18n.bidi.toDir(a);this.alwaysSpan_=!!b};goog.i18n.BidiFormatter.prototype.getContextDir=function(){return this.contextDir_};goog.i18n.BidiFormatter.prototype.getAlwaysSpan=function(){return this.alwaysSpan_};goog.i18n.BidiFormatter.prototype.setContextDir=function(a){this.contextDir_=goog.i18n.bidi.toDir(a)};goog.i18n.BidiFormatter.prototype.setAlwaysSpan=function(a){this.alwaysSpan_=a};
goog.i18n.BidiFormatter.prototype.estimateDirection=goog.i18n.bidi.estimateDirection;goog.i18n.BidiFormatter.prototype.areDirectionalitiesOpposite_=function(a,b){return 0>a*b};
goog.i18n.BidiFormatter.prototype.dirResetIfNeeded_=function(a,b,c,d){return d&&(this.areDirectionalitiesOpposite_(b,this.contextDir_)||this.contextDir_==goog.i18n.bidi.Dir.LTR&&goog.i18n.bidi.endsWithRtl(a,c)||this.contextDir_==goog.i18n.bidi.Dir.RTL&&goog.i18n.bidi.endsWithLtr(a,c))?this.contextDir_==goog.i18n.bidi.Dir.LTR?goog.i18n.bidi.Format.LRM:goog.i18n.bidi.Format.RLM:""};goog.i18n.BidiFormatter.prototype.dirAttrValue=function(a,b){return this.knownDirAttrValue(this.estimateDirection(a,b))};
goog.i18n.BidiFormatter.prototype.knownDirAttrValue=function(a){a==goog.i18n.bidi.Dir.UNKNOWN&&(a=this.contextDir_);return a==goog.i18n.bidi.Dir.RTL?"rtl":"ltr"};goog.i18n.BidiFormatter.prototype.dirAttr=function(a,b){return this.knownDirAttr(this.estimateDirection(a,b))};goog.i18n.BidiFormatter.prototype.knownDirAttr=function(a){return a!=this.contextDir_?a==goog.i18n.bidi.Dir.RTL?"dir=rtl":a==goog.i18n.bidi.Dir.LTR?"dir=ltr":"":""};
goog.i18n.BidiFormatter.prototype.spanWrap=function(a,b,c){return this.spanWrapWithKnownDir(this.estimateDirection(a,b),a,b,c)};goog.i18n.BidiFormatter.prototype.spanWrapWithKnownDir=function(a,b,c,d){var d=d||void 0==d,e=a!=goog.i18n.bidi.Dir.UNKNOWN&&a!=this.contextDir_;c||(b=goog.string.htmlEscape(b));c=[];this.alwaysSpan_||e?(c.push("<span"),e&&c.push(a==goog.i18n.bidi.Dir.RTL?" dir=rtl":" dir=ltr"),c.push(">"+b+"</span>")):c.push(b);c.push(this.dirResetIfNeeded_(b,a,!0,d));return c.join("")};
goog.i18n.BidiFormatter.prototype.unicodeWrap=function(a,b,c){return this.unicodeWrapWithKnownDir(this.estimateDirection(a,b),a,b,c)};goog.i18n.BidiFormatter.prototype.unicodeWrapWithKnownDir=function(a,b,c,d){var d=d||void 0==d,e=[];a!=goog.i18n.bidi.Dir.UNKNOWN&&a!=this.contextDir_?(e.push(a==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.Format.RLE:goog.i18n.bidi.Format.LRE),e.push(b),e.push(goog.i18n.bidi.Format.PDF)):e.push(b);e.push(this.dirResetIfNeeded_(b,a,c,d));return e.join("")};
goog.i18n.BidiFormatter.prototype.markAfter=function(a,b){return this.dirResetIfNeeded_(a,this.estimateDirection(a,b),b,!0)};goog.i18n.BidiFormatter.prototype.mark=function(){switch(this.contextDir_){case goog.i18n.bidi.Dir.LTR:return goog.i18n.bidi.Format.LRM;case goog.i18n.bidi.Dir.RTL:return goog.i18n.bidi.Format.RLM;default:return""}};goog.i18n.BidiFormatter.prototype.startEdge=function(){return this.contextDir_==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT};
goog.i18n.BidiFormatter.prototype.endEdge=function(){return this.contextDir_==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.LEFT:goog.i18n.bidi.RIGHT};goog.soy={};goog.soy.renderElement=function(a,b,c,d){a.innerHTML=b(c||goog.soy.defaultTemplateData_,void 0,d)};goog.soy.renderAsFragment=function(a,b,c,d){return(d||goog.dom.getDomHelper()).htmlToDocumentFragment(a(b||goog.soy.defaultTemplateData_,void 0,c))};
goog.soy.renderAsElement=function(a,b,c,d){d=(d||goog.dom.getDomHelper()).createElement(goog.dom.TagName.DIV);d.innerHTML=a(b||goog.soy.defaultTemplateData_,void 0,c);return 1==d.childNodes.length&&(a=d.firstChild,a.nodeType==goog.dom.NodeType.ELEMENT)?a:d};goog.soy.defaultTemplateData_={};goog.userAgent.jscript={};goog.userAgent.jscript.ASSUME_NO_JSCRIPT=!1;goog.userAgent.jscript.init_=function(){goog.userAgent.jscript.DETECTED_HAS_JSCRIPT_="ScriptEngine"in goog.global&&"JScript"==goog.global.ScriptEngine();goog.userAgent.jscript.DETECTED_VERSION_=goog.userAgent.jscript.DETECTED_HAS_JSCRIPT_?goog.global.ScriptEngineMajorVersion()+"."+goog.global.ScriptEngineMinorVersion()+"."+goog.global.ScriptEngineBuildVersion():"0"};goog.userAgent.jscript.ASSUME_NO_JSCRIPT||goog.userAgent.jscript.init_();
goog.userAgent.jscript.HAS_JSCRIPT=goog.userAgent.jscript.ASSUME_NO_JSCRIPT?!1:goog.userAgent.jscript.DETECTED_HAS_JSCRIPT_;goog.userAgent.jscript.VERSION=goog.userAgent.jscript.ASSUME_NO_JSCRIPT?"0":goog.userAgent.jscript.DETECTED_VERSION_;goog.userAgent.jscript.isVersion=function(a){return 0<=goog.string.compareVersions(goog.userAgent.jscript.VERSION,a)};goog.string.StringBuffer=function(a,b){this.buffer_=goog.userAgent.jscript.HAS_JSCRIPT?[]:"";null!=a&&this.append.apply(this,arguments)};goog.string.StringBuffer.prototype.set=function(a){this.clear();this.append(a)};
goog.userAgent.jscript.HAS_JSCRIPT?(goog.string.StringBuffer.prototype.bufferLength_=0,goog.string.StringBuffer.prototype.append=function(a,b,c){null==b?this.buffer_[this.bufferLength_++]=a:(this.buffer_.push.apply(this.buffer_,arguments),this.bufferLength_=this.buffer_.length);return this}):goog.string.StringBuffer.prototype.append=function(a,b,c){this.buffer_+=a;if(null!=b)for(var d=1;d<arguments.length;d++)this.buffer_+=arguments[d];return this};
goog.string.StringBuffer.prototype.clear=function(){goog.userAgent.jscript.HAS_JSCRIPT?this.bufferLength_=this.buffer_.length=0:this.buffer_=""};goog.string.StringBuffer.prototype.getLength=function(){return this.toString().length};goog.string.StringBuffer.prototype.toString=function(){if(goog.userAgent.jscript.HAS_JSCRIPT){var a=this.buffer_.join("");this.clear();a&&this.append(a);return a}return this.buffer_};var soy={esc:{}},soydata={};soy.StringBuilder=goog.string.StringBuffer;soydata.SanitizedContentKind={HTML:0,JS_STR_CHARS:1,URI:2,HTML_ATTRIBUTE:3};soydata.SanitizedContent=function(a){this.content=a};soydata.SanitizedContent.prototype.toString=function(){return this.content};soydata.SanitizedHtml=function(a){soydata.SanitizedContent.call(this,a)};goog.inherits(soydata.SanitizedHtml,soydata.SanitizedContent);soydata.SanitizedHtml.prototype.contentKind=soydata.SanitizedContentKind.HTML;
soydata.SanitizedJsStrChars=function(a){soydata.SanitizedContent.call(this,a)};goog.inherits(soydata.SanitizedJsStrChars,soydata.SanitizedContent);soydata.SanitizedJsStrChars.prototype.contentKind=soydata.SanitizedContentKind.JS_STR_CHARS;soydata.SanitizedUri=function(a){soydata.SanitizedContent.call(this,a)};goog.inherits(soydata.SanitizedUri,soydata.SanitizedContent);soydata.SanitizedUri.prototype.contentKind=soydata.SanitizedContentKind.URI;
soydata.SanitizedHtmlAttribute=function(a){soydata.SanitizedContent.call(this,a)};goog.inherits(soydata.SanitizedHtmlAttribute,soydata.SanitizedContent);soydata.SanitizedHtmlAttribute.prototype.contentKind=soydata.SanitizedContentKind.HTML_ATTRIBUTE;soy.renderElement=goog.soy.renderElement;soy.renderAsFragment=function(a,b,c,d){return goog.soy.renderAsFragment(a,b,d,new goog.dom.DomHelper(c))};soy.renderAsElement=function(a,b,c,d){return goog.soy.renderAsElement(a,b,d,new goog.dom.DomHelper(c))};
soy.$$augmentData=function(a,b){function c(){}c.prototype=a;var d=new c,e;for(e in b)d[e]=b[e];return d};soy.$$getMapKeys=function(a){var b=[],c;for(c in a)b.push(c);return b};soy.$$getDelegateId=function(a){return a};soy.$$DELEGATE_REGISTRY_PRIORITIES_={};soy.$$DELEGATE_REGISTRY_FUNCTIONS_={};
soy.$$registerDelegateFn=function(a,b,c){var d="key_"+a,e=soy.$$DELEGATE_REGISTRY_PRIORITIES_[d];if(void 0===e||b>e)soy.$$DELEGATE_REGISTRY_PRIORITIES_[d]=b,soy.$$DELEGATE_REGISTRY_FUNCTIONS_[d]=c;else if(b==e)throw Error('Encountered two active delegates with same priority (id/name "'+a+'").');};soy.$$getDelegateFn=function(a){return(a=soy.$$DELEGATE_REGISTRY_FUNCTIONS_["key_"+a])?a:soy.$$EMPTY_TEMPLATE_FN_};soy.$$EMPTY_TEMPLATE_FN_=function(){return""};
soy.$$escapeHtml=function(a){return"object"===typeof a&&a&&a.contentKind===soydata.SanitizedContentKind.HTML?a.content:soy.esc.$$escapeHtmlHelper(a)};soy.$$escapeHtmlRcdata=function(a){return"object"===typeof a&&a&&a.contentKind===soydata.SanitizedContentKind.HTML?soy.esc.$$normalizeHtmlHelper(a.content):soy.esc.$$escapeHtmlHelper(a)};soy.$$stripHtmlTags=function(a){return(""+a).replace(soy.esc.$$HTML_TAG_REGEX_,"")};
soy.$$escapeHtmlAttribute=function(a){return"object"===typeof a&&a&&a.contentKind===soydata.SanitizedContentKind.HTML?soy.esc.$$normalizeHtmlHelper(soy.$$stripHtmlTags(a.content)):soy.esc.$$escapeHtmlHelper(a)};soy.$$escapeHtmlAttributeNospace=function(a){return"object"===typeof a&&a&&a.contentKind===soydata.SanitizedContentKind.HTML?soy.esc.$$normalizeHtmlNospaceHelper(soy.$$stripHtmlTags(a.content)):soy.esc.$$escapeHtmlNospaceHelper(a)};
soy.$$filterHtmlAttribute=function(a){return"object"===typeof a&&a&&a.contentKind===soydata.SanitizedContentKind.HTML_ATTRIBUTE?a.content.replace(/=([^"']*)$/,'="$1"'):soy.esc.$$filterHtmlAttributeHelper(a)};soy.$$filterHtmlElementName=function(a){return soy.esc.$$filterHtmlElementNameHelper(a)};soy.$$escapeJs=function(a){return soy.$$escapeJsString(a)};soy.$$escapeJsString=function(a){return"object"===typeof a&&a.contentKind===soydata.SanitizedContentKind.JS_STR_CHARS?a.content:soy.esc.$$escapeJsStringHelper(a)};
soy.$$escapeJsValue=function(a){if(null==a)return" null ";switch(typeof a){case "boolean":case "number":return" "+a+" ";default:return"'"+soy.esc.$$escapeJsStringHelper(""+a)+"'"}};soy.$$escapeJsRegex=function(a){return soy.esc.$$escapeJsRegexHelper(a)};soy.$$problematicUriMarks_=/['()]/g;soy.$$pctEncode_=function(a){return"%"+a.charCodeAt(0).toString(16)};
soy.$$escapeUri=function(a){if("object"===typeof a&&a.contentKind===soydata.SanitizedContentKind.URI)return soy.$$normalizeUri(a);a=soy.esc.$$escapeUriHelper(a);soy.$$problematicUriMarks_.lastIndex=0;return soy.$$problematicUriMarks_.test(a)?a.replace(soy.$$problematicUriMarks_,soy.$$pctEncode_):a};soy.$$normalizeUri=function(a){return soy.esc.$$normalizeUriHelper(a)};soy.$$filterNormalizeUri=function(a){return soy.esc.$$filterNormalizeUriHelper(a)};soy.$$escapeCssString=function(a){return soy.esc.$$escapeCssStringHelper(a)};
soy.$$filterCssValue=function(a){return null==a?"":soy.esc.$$filterCssValueHelper(a)};soy.$$changeNewlineToBr=function(a){return goog.string.newLineToBr(""+a,!1)};soy.$$insertWordBreaks=function(a,b){return goog.format.insertWordBreaks(""+a,b)};soy.$$truncate=function(a,b,c){a=""+a;if(a.length<=b)return a;c&&(3<b?b-=3:c=!1);soy.$$isHighSurrogate_(a.charAt(b-1))&&soy.$$isLowSurrogate_(a.charAt(b))&&(b-=1);a=a.substring(0,b);c&&(a+="...");return a};
soy.$$isHighSurrogate_=function(a){return 55296<=a&&56319>=a};soy.$$isLowSurrogate_=function(a){return 56320<=a&&57343>=a};soy.$$bidiFormatterCache_={};soy.$$getBidiFormatterInstance_=function(a){return soy.$$bidiFormatterCache_[a]||(soy.$$bidiFormatterCache_[a]=new goog.i18n.BidiFormatter(a))};soy.$$bidiTextDir=function(a,b){return!a?0:goog.i18n.bidi.detectRtlDirectionality(a,b)?-1:1};
soy.$$bidiDirAttr=function(a,b,c){return new soydata.SanitizedHtmlAttribute(soy.$$getBidiFormatterInstance_(a).dirAttr(b,c))};soy.$$bidiMarkAfter=function(a,b,c){return soy.$$getBidiFormatterInstance_(a).markAfter(b,c)};soy.$$bidiSpanWrap=function(a,b){return soy.$$getBidiFormatterInstance_(a).spanWrap(b+"",!0)};soy.$$bidiUnicodeWrap=function(a,b){return soy.$$getBidiFormatterInstance_(a).unicodeWrap(b+"",!0)};soy.esc.$$escapeUriHelper=function(a){return goog.string.urlEncode(""+a)};
soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_={"\x00":"&#0;",'"':"&quot;","&":"&amp;","'":"&#39;","<":"&lt;",">":"&gt;","\t":"&#9;","\n":"&#10;","\x0B":"&#11;","\u000c":"&#12;","\r":"&#13;"," ":"&#32;","-":"&#45;","/":"&#47;","=":"&#61;","`":"&#96;","\u0085":"&#133;","\u00a0":"&#160;","\u2028":"&#8232;","\u2029":"&#8233;"};
soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_=function(a){return soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_[a]};
soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_={"\x00":"\\x00","\u0008":"\\x08","\t":"\\t","\n":"\\n","\x0B":"\\x0b","\u000c":"\\f","\r":"\\r",'"':"\\x22","&":"\\x26","'":"\\x27","/":"\\/","<":"\\x3c","=":"\\x3d",">":"\\x3e","\\":"\\\\","\u0085":"\\x85","\u2028":"\\u2028","\u2029":"\\u2029",$:"\\x24","(":"\\x28",")":"\\x29","*":"\\x2a","+":"\\x2b",",":"\\x2c","-":"\\x2d",".":"\\x2e",":":"\\x3a","?":"\\x3f","[":"\\x5b","]":"\\x5d","^":"\\x5e","{":"\\x7b","|":"\\x7c","}":"\\x7d"};
soy.esc.$$REPLACER_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_=function(a){return soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_[a]};
soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_CSS_STRING_={"\x00":"\\0 ","\u0008":"\\8 ","\t":"\\9 ","\n":"\\a ","\x0B":"\\b ","\u000c":"\\c ","\r":"\\d ",'"':"\\22 ","&":"\\26 ","'":"\\27 ","(":"\\28 ",")":"\\29 ","*":"\\2a ","/":"\\2f ",":":"\\3a ",";":"\\3b ","<":"\\3c ","=":"\\3d ",">":"\\3e ","@":"\\40 ","\\":"\\5c ","{":"\\7b ","}":"\\7d ","\u0085":"\\85 ","\u00a0":"\\a0 ","\u2028":"\\2028 ","\u2029":"\\2029 "};soy.esc.$$REPLACER_FOR_ESCAPE_CSS_STRING_=function(a){return soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_CSS_STRING_[a]};
soy.esc.$$ESCAPE_MAP_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_={"\x00":"%00","\u0001":"%01","\u0002":"%02","\u0003":"%03","\u0004":"%04","\u0005":"%05","\u0006":"%06","\u0007":"%07","\u0008":"%08","\t":"%09","\n":"%0A","\x0B":"%0B","\u000c":"%0C","\r":"%0D","\u000e":"%0E","\u000f":"%0F","\u0010":"%10","\u0011":"%11","\u0012":"%12","\u0013":"%13","\u0014":"%14","\u0015":"%15","\u0016":"%16","\u0017":"%17","\u0018":"%18","\u0019":"%19","\u001a":"%1A","\u001b":"%1B","\u001c":"%1C","\u001d":"%1D",
"\u001e":"%1E","\u001f":"%1F"," ":"%20",'"':"%22","'":"%27","(":"%28",")":"%29","<":"%3C",">":"%3E","\\":"%5C","{":"%7B","}":"%7D","\u007f":"%7F","\u0085":"%C2%85","\u00a0":"%C2%A0","\u2028":"%E2%80%A8","\u2029":"%E2%80%A9","\uff01":"%EF%BC%81","\uff03":"%EF%BC%83","\uff04":"%EF%BC%84","\uff06":"%EF%BC%86","\uff07":"%EF%BC%87","\uff08":"%EF%BC%88","\uff09":"%EF%BC%89","\uff0a":"%EF%BC%8A","\uff0b":"%EF%BC%8B","\uff0c":"%EF%BC%8C","\uff0f":"%EF%BC%8F","\uff1a":"%EF%BC%9A","\uff1b":"%EF%BC%9B","\uff1d":"%EF%BC%9D",
"\uff1f":"%EF%BC%9F","\uff20":"%EF%BC%A0","\uff3b":"%EF%BC%BB","\uff3d":"%EF%BC%BD"};soy.esc.$$REPLACER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_=function(a){return soy.esc.$$ESCAPE_MAP_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_[a]};soy.esc.$$MATCHER_FOR_ESCAPE_HTML_=/[\x00\x22\x26\x27\x3c\x3e]/g;soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_=/[\x00\x22\x27\x3c\x3e]/g;soy.esc.$$MATCHER_FOR_ESCAPE_HTML_NOSPACE_=/[\x00\x09-\x0d \x22\x26\x27\x2d\/\x3c-\x3e`\x85\xa0\u2028\u2029]/g;
soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_NOSPACE_=/[\x00\x09-\x0d \x22\x27\x2d\/\x3c-\x3e`\x85\xa0\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_ESCAPE_JS_STRING_=/[\x00\x08-\x0d\x22\x26\x27\/\x3c-\x3e\\\x85\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_ESCAPE_JS_REGEX_=/[\x00\x08-\x0d\x22\x24\x26-\/\x3a\x3c-\x3f\x5b-\x5e\x7b-\x7d\x85\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_ESCAPE_CSS_STRING_=/[\x00\x08-\x0d\x22\x26-\x2a\/\x3a-\x3e@\\\x7b\x7d\x85\xa0\u2028\u2029]/g;
soy.esc.$$MATCHER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_=/[\x00- \x22\x27-\x29\x3c\x3e\\\x7b\x7d\x7f\x85\xa0\u2028\u2029\uff01\uff03\uff04\uff06-\uff0c\uff0f\uff1a\uff1b\uff1d\uff1f\uff20\uff3b\uff3d]/g;soy.esc.$$FILTER_FOR_FILTER_CSS_VALUE_=/^(?!-*(?:expression|(?:moz-)?binding))(?:[.#]?-?(?:[_a-z0-9-]+)(?:-[_a-z0-9-]+)*-?|-?(?:[0-9]+(?:\.[0-9]*)?|\.[0-9]+)(?:[a-z]{1,2}|%)?|!important|)$/i;soy.esc.$$FILTER_FOR_FILTER_NORMALIZE_URI_=/^(?:(?:https?|mailto):|[^&:\/?#]*(?:[\/?#]|$))/i;
soy.esc.$$FILTER_FOR_FILTER_HTML_ATTRIBUTE_=/^(?!style|on|action|archive|background|cite|classid|codebase|data|dsync|href|longdesc|src|usemap)(?:[a-z0-9_$:-]*)$/i;soy.esc.$$FILTER_FOR_FILTER_HTML_ELEMENT_NAME_=/^(?!script|style|title|textarea|xmp|no)[a-z0-9_$:-]*$/i;soy.esc.$$escapeHtmlHelper=function(a){return(""+a).replace(soy.esc.$$MATCHER_FOR_ESCAPE_HTML_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};
soy.esc.$$normalizeHtmlHelper=function(a){return(""+a).replace(soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};soy.esc.$$escapeHtmlNospaceHelper=function(a){return(""+a).replace(soy.esc.$$MATCHER_FOR_ESCAPE_HTML_NOSPACE_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};
soy.esc.$$normalizeHtmlNospaceHelper=function(a){return(""+a).replace(soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_NOSPACE_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};soy.esc.$$escapeJsStringHelper=function(a){return(""+a).replace(soy.esc.$$MATCHER_FOR_ESCAPE_JS_STRING_,soy.esc.$$REPLACER_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_)};
soy.esc.$$escapeJsRegexHelper=function(a){return(""+a).replace(soy.esc.$$MATCHER_FOR_ESCAPE_JS_REGEX_,soy.esc.$$REPLACER_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_)};soy.esc.$$escapeCssStringHelper=function(a){return(""+a).replace(soy.esc.$$MATCHER_FOR_ESCAPE_CSS_STRING_,soy.esc.$$REPLACER_FOR_ESCAPE_CSS_STRING_)};soy.esc.$$filterCssValueHelper=function(a){a=""+a;return!soy.esc.$$FILTER_FOR_FILTER_CSS_VALUE_.test(a)?(goog.asserts.fail("Bad value `%s` for |filterCssValue",[a]),"zSoyz"):a};
soy.esc.$$normalizeUriHelper=function(a){return(""+a).replace(soy.esc.$$MATCHER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_,soy.esc.$$REPLACER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_)};soy.esc.$$filterNormalizeUriHelper=function(a){a=""+a;return!soy.esc.$$FILTER_FOR_FILTER_NORMALIZE_URI_.test(a)?(goog.asserts.fail("Bad value `%s` for |filterNormalizeUri",[a]),"zSoyz"):a.replace(soy.esc.$$MATCHER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_,soy.esc.$$REPLACER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_)};
soy.esc.$$filterHtmlAttributeHelper=function(a){a=""+a;return!soy.esc.$$FILTER_FOR_FILTER_HTML_ATTRIBUTE_.test(a)?(goog.asserts.fail("Bad value `%s` for |filterHtmlAttribute",[a]),"zSoyz"):a};soy.esc.$$filterHtmlElementNameHelper=function(a){a=""+a;return!soy.esc.$$FILTER_FOR_FILTER_HTML_ELEMENT_NAME_.test(a)?(goog.asserts.fail("Bad value `%s` for |filterHtmlElementName",[a]),"zSoyz"):a};soy.esc.$$HTML_TAG_REGEX_=/<(?:!|\/?[a-zA-Z])(?:[^>'"]|"[^"]*"|'[^']*')*>/g;fyre.templates={};fyre.templates.conv={};fyre.templates.conv.post={};fyre.templates.conv.post.embeddedUrl=function(a){return'<a class="lf_embeddedUrl" href="'+a.url+'"></a>'};fyre.conv.i18n={};fyre.conv.i18n.TextEnumeration=function(a,b){this.KEYS=goog.object.clone(a||{});this.values_={};this.defaults_={};b&&this.setDefault(b)};
fyre.conv.i18n.TextEnumeration.KEYS={COMMENT:"commentCountLabel",COMMENTS:"commentCountLabelPlural",LIVEBLOG_POST:"liveblogPostCountLabel",LIVEBLOG_POSTS:"liveblogPostCountLabelPlural",LISTENER:"listenerCount",LISTENERS:"listenerCountPlural",SIGN_IN:"signIn",SIGN_IN_GUEST:"signInGuest",SIGN_OUT:"signOut",EDIT_PROFILE:"editProfile",NOTIFICATION_SETTINGS:"notificationSettings",SITE_ADMIN:"siteAdmin",POST:"postButton",POST_AS:"postAsButton",POST_EDIT:"postEditButton",POST_EDIT_CANCEL:"postEditCancelButton",
LIVECHAT_POST:"livechatPostButtonLabel",LIVECHAT_WINDOWS_INSTR:"livechatWindowsInstruction",LIVECHAT_OTHER_INSTR:"livechatOtherInstruction",LIVECHAT_POST_EDIT:"livechatPostEditButton",FOLLOW:"follow",UNFOLLOW:"unfollow",LIVEBLOG_FOLLOW:"liveblogFollow",LIVEBLOG_UNFOLLOW:"liveblogUnfollow",HOT_THREADS:"sortHotThreads",HOT_THREADS_BACK_BUTTON:"sortBackButton",NEWEST:"sortNewest",OLDEST:"sortOldest",SORT_SEP:"sortSeparator",TOP_COMMENTS:"sortTopComments",SHOW_MORE:"showMore",SHOW_MORE_LIVEBLOG:"showMoreLiveblog",
REFRESH:"refresh",NEW_COMMENT:"newComment",NEW_COMMENTS:"newComments",NEW_REPLY:"newReply",NEW_REPLIES:"newReplies",HOT_THREADS_CONTENT_NOT_FOUND_MSG:"hotThreadsContentNotFoundMsg",TOP_COMMENTS_CONTENT_NOT_FOUND_MSG:"topCommentsContentNotFoundMsg",TOP_CONTENT_REFRESH_MSG:"topContentRefreshMsg",THREAD_BREAKOUT_BUTTON:"threadBreakoutButton",LIKE:"likeButton",UNLIKE:"unlikeButton",EDIT:"editButton",REPLY:"replyButton",REPLIES_SINGULAR:"replyButtonSingular",REPLIES_PLURAL:"replyButtonPlural",BAN:"banUserButton",
DELETE:"deleteButton",FLAG:"flagButton",FLAG_OFFENSIVE:"flagOffensiveButton",FLAG_SPAM:"flagSpamButton",FLAG_OFFTOPIC:"flagOfftopicButton",FLAG_DISAGREE:"flagDisagreeButton",SHARE:"shareButton",BOZO:"bozoButton",BAN_USER_TOOLTIP:"banUserTooltip",DELETE_COMMENT_TOOLTIP:"deleteCommentTooltip",FLAG_COMMENT_TOOLTIP:"flagCommentTooltip",FLAG_OFFENSIVE_COMMENT_TOOLTIP:"flagOffensiveCommentTooltip",FLAG_SPAM_COMMENT_TOOLTIP:"flagSpamCommentTooltip",FLAG_OFFTOPIC_COMMENT_TOOLTIP:"flagOfftopicCommentTooltip",
FLAG_DISAGREE_COMMENT_TOOLTIP:"flagDisagreeCommentTooltip",SHARE_COMMENT_TOOLTIP:"shareCommentTooltip",BOZO_COMMENT_TOOLTIP:"bozoCommentTooltip",HOVERCARD_VIEW_PROFILE:"hovercardViewProfile",BAN_TITLE:"banTitle",BAN_CONFIRMATION:"banConfirmation",BAN_CONFIRM_BTN:"banConfirmButton",BAN_CANCEL_BTN:"banCancelButton",FLAG_SPAM:"flagSpam",FLAG_OFFENSIVE:"flagOffensive",FLAG_DISAGREE:"flagDisagree",FLAG_OFFTOPIC:"flagOffTopic",FLAG_TITLE:"flagTitle",FLAG_SUBTITLE:"flagSubtitle",FLAG_EMAIL:"flagEmail",FLAG_EMAIL_PLACEHOLDER:"flagEmailPlaceholder",
FLAG_NOTES:"flagNotes",FLAG_NOTES_PLACEHOLDER:"flagNotesPlaceholder",FLAG_CONFIRMATION_MESSAGE:"flagConfirmationMessage",FLAG_CONFIRM_BTN:"flagConfirmButton",FLAG_CANCEL_BTN:"flagCancelButton",FLAG_SUCCESS_MSG:"flagSuccessMsg",MENTION_TITLE:"mentionTitle",MENTION_SUBTITLE_FACEBOOK:"mentionSubtitleFacebook",MENTION_SUBTITLE_TWITTER:"mentionSubtitleTwitter",MENTION_DEFAULT_TEXT:"mentionDefaultText",MENTION_CONFIRM_BTN:"mentionConfirmButton",MENTION_CANCEL_BTN:"mentionCancelButton",MENTION_SUCCESS_MSG:"mentionSuccessMsg",
MENTION_ERROR_NONE_SELECTED:"mentionErrorNoneSelected",MENTION_ERROR_GENERAL:"mentionErrorGeneral",PERMALINK_HEADER:"permalinkHeader",PERMALINK_HEADER_DELETED:"permalinkHeaderDeleted",SHARE_DEFAULT_TEXT:"shareDefaultText",SHARE_TITLE:"shareTitle",SHARE_BUTTON_TEXT:"shareButtonText",SHARE_LABEL:"shareLabel",SHARE_PERMALINK:"sharePermalink",MODERATOR:"moderator",MODERATOR_EDIT_TIMESTAMP:"moderatorEditTimestamp",PENDING_COMMENT:"pendingComment",QUICK_PROFILE_TOOLTIP:"quickProfileTooltip",TIME_JUST_NOW:"timeJustNow",
TIME_MINUTES_AGO:"timeMinutesAgo",TIME_MINUTES_AGO_PLURAL:"timeMinutesAgoPlural",TIME_HOURS_AGO:"timeHoursAgo",TIME_HOURS_AGO_PLURAL:"timeHoursAgoPlural",TIME_DAYS_AGO:"timeDaysAgo",TIME_DAYS_AGO_PLURAL:"timeDaysAgoPlural",ERROR_AUTH_ERROR:"errorAuthError",ERROR_COMMENTS_NOT_ALLOWED:"errorCommentsNotAllowed",ERROR_DUPLICATE:"errorDuplicate",ERROR_EDIT_DUPLICATE:"errorEditDuplicate",ERROR_EDIT_NOT_ALLOWED:"errorEditNotAllowed",ERROR_EMPTY:"errorEmpty",ERROR_INSUFFICIENT_PERMISSIONS:"errorInsufficientPermissions",
ERROR_INVALID_CHAR:"errorInvalidChar",ERROR_LIKE_OWN_COMMENT:"errorLikeOwnComment",ERROR_MALFORMED:"errorMalformed",ERROR_MAX_CHARS:"errorMaxChars",ERROR_EXPIRED:"errorExpired",ERROR_EDIT_TIME_EXCEEDED:"errorEditTimeExceeded",ERROR_SHOW_MORE:"errorShowMore",DEFAULT_ERROR:"errorDefault",CUSTOM_HTML_DIALOG_TITLE:"customHtmlDialogTitle"};fyre.conv.i18n.TextEnumeration.prototype.checkEnum_=function(a){goog.asserts.assert(goog.object.containsValue(this.KEYS,a),"Text enumeration "+a+" not registered")};
fyre.conv.i18n.TextEnumeration.prototype.get=function(a){this.checkEnum_(a);return this.values_[a]||this.defaults_[a]};fyre.conv.i18n.TextEnumeration.prototype.set=function(a,b){this.set_(a,b,this.values_)};fyre.conv.i18n.TextEnumeration.prototype.setDefault=function(a,b){this.set_(a,b,this.defaults_)};fyre.conv.i18n.TextEnumeration.prototype.set_=function(a,b,c){goog.isObject(a)?goog.object.forEach(a,function(a,b){this.set_(b,a,c)},this):(this.checkEnum_(a),c[a]=b)};
fyre.conv.i18n.TextEnumeration.DEFAULTS=function(){var a=fyre.conv.i18n.TextEnumeration.KEYS,b={};b[a.COMMENT]="comment";b[a.COMMENTS]="comments";b[a.LIVEBLOG_POST]="post";b[a.LIVEBLOG_POSTS]="posts";b[a.LISTENER]="person listening";b[a.LISTENERS]="people listening";b[a.SIGN_IN]="Sign in";b[a.SIGN_IN_GUEST]="Sign in or Post as Guest";b[a.SIGN_OUT]="Sign out";b[a.EDIT_PROFILE]="Edit profile";b[a.NOTIFICATION_SETTINGS]="Notification settings";b[a.SITE_ADMIN]="Site admin";b[a.POST]="Post comment";b[a.POST_AS]=
"Post comment as...";b[a.POST_EDIT]="Edit comment";b[a.POST_EDIT_CANCEL]="Cancel";b[a.LIVECHAT_POST]="Post";b[a.LIVECHAT_WINDOWS_INSTR]="Press control+enter to post";b[a.LIVECHAT_OTHER_INSTR]="Press command+enter to post";b[a.LIVECHAT_POST_EDIT]="Edit";b[a.FOLLOW]="+ Follow";b[a.UNFOLLOW]="- Unfollow";b[a.LIVEBLOG_FOLLOW]="Follow Liveblog";b[a.LIVEBLOG_UNFOLLOW]="Unfollow Liveblog";b[a.HOT_THREADS]="Hot Threads";b[a.HOT_THREADS_BACK_BUTTON]="Back to Hot Threads";b[a.NEWEST]="Newest";b[a.OLDEST]="Oldest";
b[a.SORT_SEP]=" | ";b[a.TOP_COMMENTS]="Top Comments";b[a.SHOW_MORE]="Show More Comments";b[a.SHOW_MORE_LIVEBLOG]="Show More Posts";b[a.REFRESH]="Refresh";b[a.NEW_COMMENT]="New Comment";b[a.NEW_COMMENTS]="New Comments";b[a.NEW_REPLY]="new reply";b[a.NEW_REPLIES]="new replies";b[a.PERMALINK_HEADER]="Shared";b[a.PERMALINK_HEADER_DELETED]="This comment is no longer visible";b[a.HOT_THREADS_CONTENT_NOT_FOUND_MSG]="There are not enough threads yet.";b[a.TOP_COMMENTS_CONTENT_NOT_FOUND_MSG]="There are not enough likes yet.";
b[a.TOP_CONTENT_REFRESH_MSG]="See what's new.";b[a.THREAD_BREAKOUT_BUTTON]="Show entire Thread";b[a.LIKE]="Like";b[a.UNLIKE]="Unlike";b[a.REPLY]="Reply";b[a.REPLIES_SINGULAR]="Reply";b[a.REPLIES_PLURAL]="Replies";b[a.EDIT]="Edit";b[a.FLAG]="Flag";b[a.FLAG_OFFENSIVE]="Offensive";b[a.FLAG_SPAM]="Spam";b[a.FLAG_OFFTOPIC]="Off-Topic";b[a.FLAG_DISAGREE]="Disagree";b[a.BAN]="Ban user";b[a.DELETE]="Delete";b[a.SHARE]="Share";b[a.BOZO]="Bozo";b[a.FLAG_CONFIRMATION_MESSAGE]="Flag %s's comment as %s?";b[a.BAN_USER_TOOLTIP]=
"Ban user";b[a.DELETE_COMMENT_TOOLTIP]="Delete";b[a.FLAG_COMMENT_TOOLTIP]="Flag";b[a.FLAG_OFFENSIVE_COMMENT_TOOLTIP]="Offensive";b[a.FLAG_SPAM_COMMENT_TOOLTIP]="Spam";b[a.FLAG_OFFTOPIC_COMMENT_TOOLTIP]="Off-Topic";b[a.FLAG_DISAGREE_COMMENT_TOOLTIP]="Disagree";b[a.SHARE_COMMENT_TOOLTIP]="Share";b[a.BOZO_COMMENT_TOOLTIP]="Bozo";b[a.HOVERCARD_VIEW_PROFILE]="View Full Profile";b[a.BAN_TITLE]="Ban User";b[a.BAN_CONFIRMATION]="Are you sure you want to ban this user?";b[a.BAN_CONFIRM_BTN]="OK";b[a.BAN_CANCEL_BTN]=
"Cancel";b[a.FLAG_SPAM]="Spam";b[a.FLAG_OFFENSIVE]="Offensive";b[a.FLAG_DISAGREE]="Disagree";b[a.FLAG_OFFTOPIC]="Off Topic";b[a.FLAG_TITLE]="Flag %s's comment";b[a.FLAG_SUBTITLE]="Flag as";b[a.FLAG_EMAIL]="Email";b[a.FLAG_EMAIL_PLACEHOLDER]="you@example.com";b[a.FLAG_NOTES]="Notes";b[a.FLAG_NOTES_PLACEHOLDER]="Start typing here...";b[a.FLAG_CONFIRM_BTN]="OK";b[a.FLAG_CANCEL_BTN]="Cancel";b[a.FLAG_SUCCESS_MSG]="Comment has been flagged.";b[a.MENTION_TITLE]="Share Mention";b[a.MENTION_SUBTITLE_FACEBOOK]=
"Share Facebook post to:";b[a.MENTION_SUBTITLE_TWITTER]="Share Tweet to:";b[a.MENTION_DEFAULT_TEXT]="I mentioned you in a Livefyre comment!";b[a.MENTION_CONFIRM_BTN]="OK";b[a.MENTION_CANCEL_BTN]="Cancel";b[a.MENTION_SUCCESS_MSG]="Mentions have been successfully sent.";b[a.MENTION_ERROR_NONE_SELECTED]="You must have at least one mention enabled.";b[a.MENTION_ERROR_GENERAL]="Oops! Something went wrong! Livefyre has been alerted.";b[a.SHARE_DEFAULT_TEXT]="Check out %s's post!";b[a.SHARE_TITLE]="Share Comment";
b[a.SHARE_BUTTON_TEXT]="Share";b[a.SHARE_LABEL]="Share on:";b[a.SHARE_PERMALINK]="Permalink";b[a.MODERATOR]="moderator";b[a.MODERATOR_EDIT_TIMESTAMP]="Edited by a Moderator";b[a.PENDING_COMMENT]="pending";b[a.QUICK_PROFILE_TOOLTIP]="Quick Profile";b[a.TIME_JUST_NOW]="just now";b[a.TIME_MINUTES_AGO]="minute ago";b[a.TIME_MINUTES_AGO_PLURAL]="minutes ago";b[a.TIME_HOURS_AGO]="hour ago";b[a.TIME_HOURS_AGO_PLURAL]="hours ago";b[a.TIME_DAYS_AGO]="day ago";b[a.TIME_DAYS_AGO_PLURAL]="days ago";b[a.ERROR_AUTH_ERROR]=
"You're not authorized to post a comment on this conversation";b[a.ERROR_COMMENTS_NOT_ALLOWED]="Comments are not allowed on this conversation";b[a.ERROR_DUPLICATE]="As much as you liked your comment, you're not allowed to post it twice.";b[a.ERROR_EDIT_DUPLICATE]="You must change the body of the comment when you edit it.";b[a.ERROR_EDIT_NOT_ALLOWED]="You're not allowed to edit comments on this conversation.";b[a.ERROR_EMPTY]="It seems you're attempting to post an empty comment.";b[a.ERROR_INSUFFICIENT_PERMISSIONS]=
"Insufficient Permissions";b[a.ERROR_INVALID_CHAR]="It seems you're attempting to post an invalid character.";b[a.ERROR_LIKE_OWN_COMMENT]="You cannot like your own comment";b[a.ERROR_MALFORMED]="It seems you're attempting to post malformed content.";b[a.ERROR_MAX_CHARS]="Sorry, your comment is too long. Please edit and try again.";b[a.ERROR_EXPIRED]="Your session has expired. Please reload the page.";b[a.ERROR_EDIT_TIME_EXCEEDED]="Sorry, your comment editing period has expired.";b[a.ERROR_SHOW_MORE]=
"There was an error loading more comments.";b[a.DEFAULT_ERROR]="An error has occurred. Please try again.";b[a.CUSTOM_HTML_DIALOG_TITLE]="Add Custom HTML";return b}();fyre.conv.i18n.textEnumeration=new fyre.conv.i18n.TextEnumeration(fyre.conv.i18n.TextEnumeration.KEYS,fyre.conv.i18n.TextEnumeration.DEFAULTS);(function(){if(goog.global.FyreLoader){var a=null;goog.global.FyreLoader.opts&&(a=goog.global.FyreLoader.opts.strings);a&&fyre.conv.i18n.textEnumeration.setDefault(a)}})();fyre.templates.conv.misc={};fyre.templates.conv.misc.commentCount=function(a){var b="<span>";switch(a.numVisible){case 1:b+="1 "+soy.$$escapeHtml(a.strings.commentLabel);break;default:b+=soy.$$escapeHtml(a.numVisible)+" "+soy.$$escapeHtml(a.strings.commentsLabel)}return b+"</span>"};
fyre.templates.conv.misc.streamHeader=function(a){return'<div class="fyre-content-loading">Loading</div>'+(a.liveblogEnabled?fyre.templates.conv.misc.liveblogFollow(a):"")+'<div class="fyre-stream-sort"><div class="fyre-stream-sort-options"><a class="fyre-stream-sort-newest fyre-stream-sort-selected">'+soy.$$escapeHtml(a.strings.newest)+'</a><span class="fyre-stream-sort-bar">'+soy.$$escapeHtml(a.strings.sep)+'</span><a class="fyre-stream-sort-oldest">'+soy.$$escapeHtml(a.strings.oldest)+"</a>"+(a.displayTopCommentsTab?
'<span class="fyre-stream-sort-bar">'+soy.$$escapeHtml(a.strings.sep)+'</span><a class="fyre-stream-sort-top-comments">'+soy.$$escapeHtml(a.strings.topComments)+"</a>":"")+(a.displayHotThreadsTab?'<span class="fyre-stream-sort-bar">'+soy.$$escapeHtml(a.strings.sep)+'</span><a class="fyre-stream-sort-hot-threads">'+soy.$$escapeHtml(a.strings.hotThreads)+"</a>":"")+"</div>"+(a.displayHotThreadsTab?'<a class="fyre-stream-sort-back">'+soy.$$escapeHtml(a.strings.backButton)+"</a>":"")+"</div>"};
fyre.templates.conv.misc.commentStream=function(a){return'<div class="fyre-stream-content"></div>'+(a.displayShowMore?fyre.templates.conv.misc.showMore(a):"")};fyre.templates.conv.misc.topContentStream=function(){return'<div class="fyre-content-loading">Loading</div><div class="fyre-stream-content"></div><div class="fyre-stream-content-not-found"></div>'};
fyre.templates.conv.misc.topContentStreamContentNotFound=function(a){return"<div><div>"+soy.$$escapeHtml(a.strings.contentNotFoundMsg)+'</div><a class="fyre-stream-refresh">'+soy.$$escapeHtml(a.strings.refreshMsg)+"</a><div>"};
fyre.templates.conv.misc.showMore=function(a){return'<div class="fyre-stream-more"><div class="fyre-stream-more-container"><div class="fyre-text">'+soy.$$escapeHtml(a.strings.showMoreLabel)+'</div><div class="fyre-spinner"><div class="fyre-ball"><\!--[if IE]><img src="'+soy.$$escapeHtml(a.assetUrl)+'/images/fyre-spinner-ball.gif" alt="" /><![endif]--\><\!--[if !IE]><\!--\><img src="'+soy.$$escapeHtml(a.assetUrl)+'/images/fyre-spinner-ball.png" alt="" /><\!--<![endif]--\></div></div></div></div>'};
fyre.templates.conv.misc.permalinkStream=function(a){return'<div class="fyre-permalink-header"><table><tr><td class="fyre-permalink-td1"><span class="fyre-permalink-message">'+soy.$$escapeHtml(a.strings.permalinkHeader)+'</span></td><td class="fyre-permalink-td2"><div></div></td><td class="fyre-permalink-td3"><span class="fyre-permalink-close"></span></td></tr></table></div><div class="fyre-stream-content"></div>'};
fyre.templates.conv.misc.liveblogFollow=function(a){return'<a class="fyre-follow-conversation">'+(a.notModerator?a.isFollowing?soy.$$escapeHtml(a.strings.liveblogUnfollow):soy.$$escapeHtml(a.strings.liveblogFollow):"")+"</a>"};
fyre.templates.conv.misc.follower=function(a){return'<a href="'+a.profileUrl+'" title="'+soy.$$escapeHtml(a.displayName)+'" data-id="'+a.id+'" class="fyre-follower-'+a.ident+'"><img src="'+a.avatar+'" alt="'+soy.$$escapeHtml(a.displayName)+'" onerror="javascript:this.src=\''+soy.$$escapeHtml(a.defaultAvatar)+"';\" /></a>"};
fyre.templates.conv.misc.livecount=function(a){var b='<em class="fyre-stream-livecount">';if(!a.showMinimal)switch(a.num){case 1:b+="1 "+soy.$$escapeHtml(a.strings.listener);break;default:b+=soy.$$escapeHtml(a.num)+" "+soy.$$escapeHtml(a.strings.listeners)}return b+=(a.showMinimal?soy.$$escapeHtml(a.num)+'<span class="fyre-stream-livecount-icon"></span>':"")+"</em>"};
fyre.templates.conv.misc.mentionModal=function(a){return'<div class="fyre-mention">'+(a.isFirst?'<div class="fyre-modal-subtitle-u">'+soy.$$escapeHtml(a.strings.subtitle)+"</div>":"")+'<div class="fyre-modal-username">@'+soy.$$escapeHtml(a.displayName)+'<a class="fyre-mention-close"></a></div><textarea class="fyre-modal-textfield fyre-modal-mentiontext">@'+soy.$$escapeHtml(a.displayName)+" "+soy.$$escapeHtml(a.strings.defaultText)+" "+soy.$$escapeHtml(a.shareLink)+"</textarea>"+(a.characterLimit?
'<div class="fyre-modal-mention-tweetcounter"><div class="fyre-modal-charcounter"></div></div>':"")+"</div>"};
fyre.templates.conv.misc.notifier=function(a){return'<div class="fyre-notifier-container"><div class="fyre-notifier"><ul class="fyre-notifier-list"></ul><ul class="fyre-notifier-archive"></ul></div><div class="fyre-notifier-base-shadow"><div class="fyre-notifier-base"><div class="fyre-notifier-counter blue">0</div><div class="fyre-notifier-caption">New '+soy.$$escapeHtml(a.strings.commentsLabel)+'</div><div class="fyre-notifier-base-close"></div></div></div></div>'};
fyre.templates.conv.misc.notifierUser=function(a){return'<li class="fyre-notification"><div class="fyre-notifier-banner"><a class="fyre-notifier-close"></a><div class="fyre-notifier-avatar-container"><div class="fyre-notifier-avatar-shading"></div><img class="fyre-notifier-avatar" src="'+soy.$$escapeHtml(a.avatar)+'" alt="'+soy.$$escapeHtml(a.displayName)+'" /></div><div class="fyre-notifier-message-container"><div class="fyre-notifier-message">'+soy.$$truncate(soy.$$escapeHtml(a.preview),60,!1)+
"</div></div></div></li>"};
fyre.templates.conv.misc.share=function(a){return'<div class="fyre-modal-container fyre-modal-share"><form class="fyre-modal-flag-form"><textarea name="content" class="fyre-modal-textfield fyre-modal-content">'+soy.$$escapeHtml(a.strings.defaultText)+'</textarea><div class="fyre-modal-subtitle fyre-modal-shares">'+soy.$$escapeHtml(a.strings.label)+'<a href="#twitter" class="fyre-modal-twitter-icon">Twitter</a><a href="#fb" class="fyre-modal-facebook-icon">Facebook</a><div class="fyre-modal-buttons"><button name="share" class="fyre-modal-button-share">'+soy.$$escapeHtml(a.strings.button)+
'</button></div></div><div class="fyre-modal-shares-permalink"><div class="fyre-modal-subtitle">'+soy.$$escapeHtml(a.strings.permalink)+'</div><input class="fyre-modal-textfield fyre-modal-permalink" value="'+soy.$$escapeHtml(a.url)+'" disabled="disabled" /></div></form></div>'};
fyre.templates.conv.misc.highVelocity=function(a){return'<div class="fyre-velocity"><a class="fyre-velocity-next"><span class="fyre-velocity-count">'+soy.$$escapeHtml(a.count)+'</span><span class="fyre-velocity-text">'+soy.$$escapeHtml(a.strings.newComments)+'</span></a><a class="fyre-velocity-refresh">'+soy.$$escapeHtml(a.strings.refresh)+"</a></div>"};fyre.templates.core={};fyre.templates.core.misc={};fyre.templates.core.misc.charCountdown=function(a){var b="";switch(a.characters_left){case 1:b+="1 character left";break;default:b+=soy.$$escapeHtml(a.characters_left)+" characters left"}return b};fyre.templates.core.misc.confirmation=function(a){return'<div class="fyre-modal-container"><div class="fyre-modal-subtitle">'+soy.$$escapeHtml(a.msg)+"</div></div>"};
fyre.templates.core.misc.mention=function(a){return'<a vocab="http://schema.org" typeof="Person" rel="nofollow" resource="acct:'+soy.$$escapeHtml(a.jid)+'" data-lf-handle="'+soy.$$escapeHtml(a.handle)+'" data-lf-provider="'+soy.$$escapeHtml(a.provider)+'" property="url" href="'+soy.$$escapeHtml(a.profileUrl)+'" class="fyre-mention fyre-mention-'+soy.$$escapeHtml(a.provider)+'">'+soy.$$escapeHtml(a.prefix)+'<span property="name">'+soy.$$escapeHtml(a.displayName)+"</span></a>"};
fyre.templates.core.misc.tooltip=function(a){return'<div class="tooltip">'+soy.$$escapeHtml(a.message)+'</div><div class="arrow-down"></div>'};goog.events.EventHandler=function(a){goog.Disposable.call(this);this.handler_=a;this.keys_=[]};goog.inherits(goog.events.EventHandler,goog.Disposable);goog.events.EventHandler.typeArray_=[];goog.events.EventHandler.prototype.listen=function(a,b,c,d,e){goog.isArray(b)||(goog.events.EventHandler.typeArray_[0]=b,b=goog.events.EventHandler.typeArray_);for(var f=0;f<b.length;f++)this.keys_.push(goog.events.listen(a,b[f],c||this,d||!1,e||this.handler_||this));return this};
goog.events.EventHandler.prototype.listenOnce=function(a,b,c,d,e){if(goog.isArray(b))for(var f=0;f<b.length;f++)this.listenOnce(a,b[f],c,d,e);else this.keys_.push(goog.events.listenOnce(a,b,c||this,d,e||this.handler_||this));return this};goog.events.EventHandler.prototype.listenWithWrapper=function(a,b,c,d,e){b.listen(a,c,d,e||this.handler_,this);return this};goog.events.EventHandler.prototype.getListenerCount=function(){return this.keys_.length};
goog.events.EventHandler.prototype.unlisten=function(a,b,c,d,e){if(goog.isArray(b))for(var f=0;f<b.length;f++)this.unlisten(a,b[f],c,d,e);else if(a=goog.events.getListener(a,b,c||this,d,e||this.handler_||this))a=a.key,goog.events.unlistenByKey(a),goog.array.remove(this.keys_,a);return this};goog.events.EventHandler.prototype.unlistenWithWrapper=function(a,b,c,d,e){b.unlisten(a,c,d,e||this.handler_,this);return this};
goog.events.EventHandler.prototype.removeAll=function(){goog.array.forEach(this.keys_,goog.events.unlistenByKey);this.keys_.length=0};goog.events.EventHandler.prototype.disposeInternal=function(){goog.events.EventHandler.superClass_.disposeInternal.call(this);this.removeAll()};goog.events.EventHandler.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented");};goog.events.KeyCodes={WIN_KEY_FF_LINUX:0,MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,FF_SEMICOLON:59,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,
META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLL_LOCK:145,FIRST_MEDIA_KEY:166,LAST_MEDIA_KEY:183,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,TILDE:192,SINGLE_QUOTE:222,
OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,PHANTOM:255};
goog.events.KeyCodes.isTextModifyingKeyEvent=function(a){if(a.altKey&&!a.ctrlKey||a.metaKey||a.keyCode>=goog.events.KeyCodes.F1&&a.keyCode<=goog.events.KeyCodes.F12)return!1;switch(a.keyCode){case goog.events.KeyCodes.ALT:case goog.events.KeyCodes.CAPS_LOCK:case goog.events.KeyCodes.CONTEXT_MENU:case goog.events.KeyCodes.CTRL:case goog.events.KeyCodes.DOWN:case goog.events.KeyCodes.END:case goog.events.KeyCodes.ESC:case goog.events.KeyCodes.HOME:case goog.events.KeyCodes.INSERT:case goog.events.KeyCodes.LEFT:case goog.events.KeyCodes.MAC_FF_META:case goog.events.KeyCodes.META:case goog.events.KeyCodes.NUMLOCK:case goog.events.KeyCodes.NUM_CENTER:case goog.events.KeyCodes.PAGE_DOWN:case goog.events.KeyCodes.PAGE_UP:case goog.events.KeyCodes.PAUSE:case goog.events.KeyCodes.PHANTOM:case goog.events.KeyCodes.PRINT_SCREEN:case goog.events.KeyCodes.RIGHT:case goog.events.KeyCodes.SCROLL_LOCK:case goog.events.KeyCodes.SHIFT:case goog.events.KeyCodes.UP:case goog.events.KeyCodes.WIN_KEY:case goog.events.KeyCodes.WIN_KEY_RIGHT:return!1;case goog.events.KeyCodes.WIN_KEY_FF_LINUX:return!goog.userAgent.GECKO;
default:return a.keyCode<goog.events.KeyCodes.FIRST_MEDIA_KEY||a.keyCode>goog.events.KeyCodes.LAST_MEDIA_KEY}};
goog.events.KeyCodes.firesKeyPressEvent=function(a,b,c,d,e){if(!goog.userAgent.IE&&(!goog.userAgent.WEBKIT||!goog.userAgent.isVersion("525")))return!0;if(goog.userAgent.MAC&&e)return goog.events.KeyCodes.isCharacterKey(a);if(e&&!d||!c&&(b==goog.events.KeyCodes.CTRL||b==goog.events.KeyCodes.ALT)||goog.userAgent.IE&&d&&b==a)return!1;switch(a){case goog.events.KeyCodes.ENTER:return!(goog.userAgent.IE&&goog.userAgent.isDocumentMode(9));case goog.events.KeyCodes.ESC:return!goog.userAgent.WEBKIT}return goog.events.KeyCodes.isCharacterKey(a)};
goog.events.KeyCodes.isCharacterKey=function(a){if(a>=goog.events.KeyCodes.ZERO&&a<=goog.events.KeyCodes.NINE||a>=goog.events.KeyCodes.NUM_ZERO&&a<=goog.events.KeyCodes.NUM_MULTIPLY||a>=goog.events.KeyCodes.A&&a<=goog.events.KeyCodes.Z||goog.userAgent.WEBKIT&&0==a)return!0;switch(a){case goog.events.KeyCodes.SPACE:case goog.events.KeyCodes.QUESTION_MARK:case goog.events.KeyCodes.NUM_PLUS:case goog.events.KeyCodes.NUM_MINUS:case goog.events.KeyCodes.NUM_PERIOD:case goog.events.KeyCodes.NUM_DIVISION:case goog.events.KeyCodes.SEMICOLON:case goog.events.KeyCodes.FF_SEMICOLON:case goog.events.KeyCodes.DASH:case goog.events.KeyCodes.EQUALS:case goog.events.KeyCodes.COMMA:case goog.events.KeyCodes.PERIOD:case goog.events.KeyCodes.SLASH:case goog.events.KeyCodes.APOSTROPHE:case goog.events.KeyCodes.SINGLE_QUOTE:case goog.events.KeyCodes.OPEN_SQUARE_BRACKET:case goog.events.KeyCodes.BACKSLASH:case goog.events.KeyCodes.CLOSE_SQUARE_BRACKET:return!0;
default:return!1}};goog.events.InputHandler=function(a){goog.events.EventTarget.call(this);this.element_=a;this.inputEventEmulation_=goog.userAgent.IE||goog.userAgent.WEBKIT&&!goog.userAgent.isVersion("531")&&"TEXTAREA"==a.tagName;this.eventHandler_=new goog.events.EventHandler(this);this.eventHandler_.listen(this.element_,this.inputEventEmulation_?["keydown","paste","cut","drop"]:"input",this)};goog.inherits(goog.events.InputHandler,goog.events.EventTarget);goog.events.InputHandler.EventType={INPUT:"input"};
goog.events.InputHandler.prototype.timer_=null;
goog.events.InputHandler.prototype.handleEvent=function(a){if(this.inputEventEmulation_){if("keydown"!=a.type||goog.events.KeyCodes.isTextModifyingKeyEvent(a)){var b="keydown"==a.type?this.element_.value:null;goog.userAgent.IE&&a.keyCode==goog.events.KeyCodes.WIN_IME&&(b=null);var c=this.createInputEvent_(a);this.cancelTimerIfSet_();this.timer_=goog.Timer.callOnce(function(){this.timer_=null;this.element_.value!=b&&this.dispatchAndDisposeEvent_(c)},0,this)}}else(!goog.userAgent.OPERA||this.element_==
goog.dom.getOwnerDocument(this.element_).activeElement)&&this.dispatchAndDisposeEvent_(this.createInputEvent_(a))};goog.events.InputHandler.prototype.cancelTimerIfSet_=function(){null!=this.timer_&&(goog.Timer.clear(this.timer_),this.timer_=null)};goog.events.InputHandler.prototype.createInputEvent_=function(a){a=new goog.events.BrowserEvent(a.getBrowserEvent());a.type=goog.events.InputHandler.EventType.INPUT;return a};goog.events.InputHandler.prototype.dispatchAndDisposeEvent_=function(a){try{this.dispatchEvent(a)}finally{a.dispose()}};
goog.events.InputHandler.prototype.disposeInternal=function(){goog.events.InputHandler.superClass_.disposeInternal.call(this);this.eventHandler_.dispose();this.cancelTimerIfSet_();delete this.element_};goog.ui=goog.ui||{};goog.dom.a11y={};
goog.dom.a11y.State={ACTIVEDESCENDANT:"activedescendant",ATOMIC:"atomic",AUTOCOMPLETE:"autocomplete",BUSY:"busy",CHECKED:"checked",CONTROLS:"controls",DESCRIBEDBY:"describedby",DISABLED:"disabled",DROPEFFECT:"dropeffect",EXPANDED:"expanded",FLOWTO:"flowto",GRABBED:"grabbed",HASPOPUP:"haspopup",HIDDEN:"hidden",INVALID:"invalid",LABEL:"label",LABELLEDBY:"labelledby",LEVEL:"level",LIVE:"live",MULTILINE:"multiline",MULTISELECTABLE:"multiselectable",ORIENTATION:"orientation",OWNS:"owns",POSINSET:"posinset",
PRESSED:"pressed",READONLY:"readonly",RELEVANT:"relevant",REQUIRED:"required",SELECTED:"selected",SETSIZE:"setsize",SORT:"sort",VALUEMAX:"valuemax",VALUEMIN:"valuemin",VALUENOW:"valuenow",VALUETEXT:"valuetext"};
goog.dom.a11y.Role={ALERT:"alert",ALERTDIALOG:"alertdialog",APPLICATION:"application",ARTICLE:"article",BANNER:"banner",BUTTON:"button",CHECKBOX:"checkbox",COLUMNHEADER:"columnheader",COMBOBOX:"combobox",COMPLEMENTARY:"complementary",DIALOG:"dialog",DIRECTORY:"directory",DOCUMENT:"document",FORM:"form",GRID:"grid",GRIDCELL:"gridcell",GROUP:"group",HEADING:"heading",IMG:"img",LINK:"link",LIST:"list",LISTBOX:"listbox",LISTITEM:"listitem",LOG:"log",MAIN:"main",MARQUEE:"marquee",MATH:"math",MENU:"menu",
MENUBAR:"menubar",MENU_ITEM:"menuitem",MENU_ITEM_CHECKBOX:"menuitemcheckbox",MENU_ITEM_RADIO:"menuitemradio",NAVIGATION:"navigation",NOTE:"note",OPTION:"option",PRESENTATION:"presentation",PROGRESSBAR:"progressbar",RADIO:"radio",RADIOGROUP:"radiogroup",REGION:"region",ROW:"row",ROWGROUP:"rowgroup",ROWHEADER:"rowheader",SCROLLBAR:"scrollbar",SEARCH:"search",SEPARATOR:"separator",SLIDER:"slider",SPINBUTTON:"spinbutton",STATUS:"status",TAB:"tab",TAB_LIST:"tablist",TAB_PANEL:"tabpanel",TEXTBOX:"textbox",
TIMER:"timer",TOOLBAR:"toolbar",TOOLTIP:"tooltip",TREE:"tree",TREEGRID:"treegrid",TREEITEM:"treeitem"};goog.dom.a11y.LivePriority={OFF:"off",POLITE:"polite",ASSERTIVE:"assertive"};goog.dom.a11y.setRole=function(a,b){a.setAttribute("role",b);a.roleName=b};goog.dom.a11y.getRole=function(a){return a.roleName||""};goog.dom.a11y.setState=function(a,b,c){a.setAttribute("aria-"+b,c)};goog.dom.a11y.getState=function(a,b){var c=a.getAttribute("aria-"+b);return!0===c||!1===c?c?"true":"false":c?""+c:""};
goog.dom.a11y.getActiveDescendant=function(a){var b=goog.dom.a11y.getState(a,goog.dom.a11y.State.ACTIVEDESCENDANT);return goog.dom.getOwnerDocument(a).getElementById(b)};goog.dom.a11y.setActiveDescendant=function(a,b){goog.dom.a11y.setState(a,goog.dom.a11y.State.ACTIVEDESCENDANT,b?b.id:"")};goog.dom.a11y.Announcer=function(a){goog.Disposable.call(this);this.domHelper_=a;this.liveRegions_={}};goog.inherits(goog.dom.a11y.Announcer,goog.Disposable);
goog.dom.a11y.Announcer.prototype.disposeInternal=function(){goog.object.forEach(this.liveRegions_,this.domHelper_.removeNode,this.domHelper_);this.domHelper_=this.liveRegions_=null;goog.dom.a11y.Announcer.superClass_.disposeInternal.call(this)};goog.dom.a11y.Announcer.prototype.say=function(a,b){goog.dom.setTextContent(this.getLiveRegion_(b||goog.dom.a11y.LivePriority.POLITE),a)};
goog.dom.a11y.Announcer.prototype.getLiveRegion_=function(a){if(this.liveRegions_[a])return this.liveRegions_[a];var b;b=this.domHelper_.createElement("div");b.style.position="absolute";b.style.top="-1000px";goog.dom.a11y.setState(b,"live",a);goog.dom.a11y.setState(b,"atomic","true");this.domHelper_.getDocument().body.appendChild(b);return this.liveRegions_[a]=b};goog.ui.IdGenerator=function(){};goog.addSingletonGetter(goog.ui.IdGenerator);goog.ui.IdGenerator.prototype.nextId_=0;goog.ui.IdGenerator.prototype.getNextUniqueId=function(){return":"+(this.nextId_++).toString(36)};goog.ui.IdGenerator.instance=goog.ui.IdGenerator.getInstance();goog.ui.Component=function(a){goog.events.EventTarget.call(this);this.dom_=a||goog.dom.getDomHelper();this.rightToLeft_=goog.ui.Component.defaultRightToLeft_};goog.inherits(goog.ui.Component,goog.events.EventTarget);goog.ui.Component.prototype.idGenerator_=goog.ui.IdGenerator.getInstance();goog.ui.Component.defaultRightToLeft_=null;
goog.ui.Component.EventType={BEFORE_SHOW:"beforeshow",SHOW:"show",HIDE:"hide",DISABLE:"disable",ENABLE:"enable",HIGHLIGHT:"highlight",UNHIGHLIGHT:"unhighlight",ACTIVATE:"activate",DEACTIVATE:"deactivate",SELECT:"select",UNSELECT:"unselect",CHECK:"check",UNCHECK:"uncheck",FOCUS:"focus",BLUR:"blur",OPEN:"open",CLOSE:"close",ENTER:"enter",LEAVE:"leave",ACTION:"action",CHANGE:"change"};
goog.ui.Component.Error={NOT_SUPPORTED:"Method not supported",DECORATE_INVALID:"Invalid element to decorate",ALREADY_RENDERED:"Component already rendered",PARENT_UNABLE_TO_BE_SET:"Unable to set parent component",CHILD_INDEX_OUT_OF_BOUNDS:"Child component index out of bounds",NOT_OUR_CHILD:"Child is not in parent component",NOT_IN_DOCUMENT:"Operation not supported while component is not in document",STATE_INVALID:"Invalid component state"};
goog.ui.Component.State={ALL:255,DISABLED:1,HOVER:2,ACTIVE:4,SELECTED:8,CHECKED:16,FOCUSED:32,OPENED:64};
goog.ui.Component.getStateTransitionEvent=function(a,b){switch(a){case goog.ui.Component.State.DISABLED:return b?goog.ui.Component.EventType.DISABLE:goog.ui.Component.EventType.ENABLE;case goog.ui.Component.State.HOVER:return b?goog.ui.Component.EventType.HIGHLIGHT:goog.ui.Component.EventType.UNHIGHLIGHT;case goog.ui.Component.State.ACTIVE:return b?goog.ui.Component.EventType.ACTIVATE:goog.ui.Component.EventType.DEACTIVATE;case goog.ui.Component.State.SELECTED:return b?goog.ui.Component.EventType.SELECT:
goog.ui.Component.EventType.UNSELECT;case goog.ui.Component.State.CHECKED:return b?goog.ui.Component.EventType.CHECK:goog.ui.Component.EventType.UNCHECK;case goog.ui.Component.State.FOCUSED:return b?goog.ui.Component.EventType.FOCUS:goog.ui.Component.EventType.BLUR;case goog.ui.Component.State.OPENED:return b?goog.ui.Component.EventType.OPEN:goog.ui.Component.EventType.CLOSE}throw Error(goog.ui.Component.Error.STATE_INVALID);};
goog.ui.Component.setDefaultRightToLeft=function(a){goog.ui.Component.defaultRightToLeft_=a};goog.ui.Component.prototype.id_=null;goog.ui.Component.prototype.inDocument_=!1;goog.ui.Component.prototype.element_=null;goog.ui.Component.prototype.rightToLeft_=null;goog.ui.Component.prototype.model_=null;goog.ui.Component.prototype.parent_=null;goog.ui.Component.prototype.children_=null;goog.ui.Component.prototype.childIndex_=null;goog.ui.Component.prototype.wasDecorated_=!1;
goog.ui.Component.prototype.getId=function(){return this.id_||(this.id_=this.idGenerator_.getNextUniqueId())};goog.ui.Component.prototype.setId=function(a){this.parent_&&this.parent_.childIndex_&&(goog.object.remove(this.parent_.childIndex_,this.id_),goog.object.add(this.parent_.childIndex_,a,this));this.id_=a};goog.ui.Component.prototype.getElement=function(){return this.element_};goog.ui.Component.prototype.setElementInternal=function(a){this.element_=a};
goog.ui.Component.prototype.getElementsByClass=function(a){return this.element_?this.dom_.getElementsByClass(a,this.element_):[]};goog.ui.Component.prototype.getElementByClass=function(a){return this.element_?this.dom_.getElementByClass(a,this.element_):null};goog.ui.Component.prototype.getHandler=function(){return this.googUiComponentHandler_||(this.googUiComponentHandler_=new goog.events.EventHandler(this))};
goog.ui.Component.prototype.setParent=function(a){if(this==a)throw Error(goog.ui.Component.Error.PARENT_UNABLE_TO_BE_SET);if(a&&this.parent_&&this.id_&&this.parent_.getChild(this.id_)&&this.parent_!=a)throw Error(goog.ui.Component.Error.PARENT_UNABLE_TO_BE_SET);this.parent_=a;goog.ui.Component.superClass_.setParentEventTarget.call(this,a)};goog.ui.Component.prototype.getParent=function(){return this.parent_};
goog.ui.Component.prototype.setParentEventTarget=function(a){if(this.parent_&&this.parent_!=a)throw Error(goog.ui.Component.Error.NOT_SUPPORTED);goog.ui.Component.superClass_.setParentEventTarget.call(this,a)};goog.ui.Component.prototype.getDomHelper=function(){return this.dom_};goog.ui.Component.prototype.isInDocument=function(){return this.inDocument_};goog.ui.Component.prototype.createDom=function(){this.element_=this.dom_.createElement("div")};goog.ui.Component.prototype.render=function(a){this.render_(a)};
goog.ui.Component.prototype.renderBefore=function(a){this.render_(a.parentNode,a)};goog.ui.Component.prototype.render_=function(a,b){if(this.inDocument_)throw Error(goog.ui.Component.Error.ALREADY_RENDERED);this.element_||this.createDom();a?a.insertBefore(this.element_,b||null):this.dom_.getDocument().body.appendChild(this.element_);(!this.parent_||this.parent_.isInDocument())&&this.enterDocument()};
goog.ui.Component.prototype.decorate=function(a){if(this.inDocument_)throw Error(goog.ui.Component.Error.ALREADY_RENDERED);if(a&&this.canDecorate(a)){this.wasDecorated_=!0;if(!this.dom_||this.dom_.getDocument()!=goog.dom.getOwnerDocument(a))this.dom_=goog.dom.getDomHelper(a);this.decorateInternal(a);this.enterDocument()}else throw Error(goog.ui.Component.Error.DECORATE_INVALID);};goog.ui.Component.prototype.canDecorate=function(){return!0};goog.ui.Component.prototype.wasDecorated=function(){return this.wasDecorated_};
goog.ui.Component.prototype.decorateInternal=function(a){this.element_=a};goog.ui.Component.prototype.enterDocument=function(){this.inDocument_=!0;this.forEachChild(function(a){!a.isInDocument()&&a.getElement()&&a.enterDocument()})};goog.ui.Component.prototype.exitDocument=function(){this.forEachChild(function(a){a.isInDocument()&&a.exitDocument()});this.googUiComponentHandler_&&this.googUiComponentHandler_.removeAll();this.inDocument_=!1};
goog.ui.Component.prototype.disposeInternal=function(){goog.ui.Component.superClass_.disposeInternal.call(this);this.inDocument_&&this.exitDocument();this.googUiComponentHandler_&&(this.googUiComponentHandler_.dispose(),delete this.googUiComponentHandler_);this.forEachChild(function(a){a.dispose()});!this.wasDecorated_&&this.element_&&goog.dom.removeNode(this.element_);this.parent_=this.model_=this.element_=this.childIndex_=this.children_=null};
goog.ui.Component.prototype.makeId=function(a){return this.getId()+"."+a};goog.ui.Component.prototype.makeIds=function(a){var b={},c;for(c in a)b[c]=this.makeId(a[c]);return b};goog.ui.Component.prototype.getModel=function(){return this.model_};goog.ui.Component.prototype.setModel=function(a){this.model_=a};goog.ui.Component.prototype.getFragmentFromId=function(a){return a.substring(this.getId().length+1)};
goog.ui.Component.prototype.getElementByFragment=function(a){if(!this.inDocument_)throw Error(goog.ui.Component.Error.NOT_IN_DOCUMENT);return this.dom_.getElement(this.makeId(a))};goog.ui.Component.prototype.addChild=function(a,b){this.addChildAt(a,this.getChildCount(),b)};
goog.ui.Component.prototype.addChildAt=function(a,b,c){if(a.inDocument_&&(c||!this.inDocument_))throw Error(goog.ui.Component.Error.ALREADY_RENDERED);if(0>b||b>this.getChildCount())throw Error(goog.ui.Component.Error.CHILD_INDEX_OUT_OF_BOUNDS);if(!this.childIndex_||!this.children_)this.childIndex_={},this.children_=[];a.getParent()==this?(goog.object.set(this.childIndex_,a.getId(),a),goog.array.remove(this.children_,a)):goog.object.add(this.childIndex_,a.getId(),a);a.setParent(this);goog.array.insertAt(this.children_,
a,b);a.inDocument_&&this.inDocument_&&a.getParent()==this?(c=this.getContentElement(),c.insertBefore(a.getElement(),c.childNodes[b]||null)):c?(this.element_||this.createDom(),b=this.getChildAt(b+1),a.render_(this.getContentElement(),b?b.element_:null)):this.inDocument_&&!a.inDocument_&&a.element_&&a.enterDocument()};goog.ui.Component.prototype.getContentElement=function(){return this.element_};
goog.ui.Component.prototype.isRightToLeft=function(){null==this.rightToLeft_&&(this.rightToLeft_=goog.style.isRightToLeft(this.inDocument_?this.element_:this.dom_.getDocument().body));return this.rightToLeft_};goog.ui.Component.prototype.setRightToLeft=function(a){if(this.inDocument_)throw Error(goog.ui.Component.Error.ALREADY_RENDERED);this.rightToLeft_=a};goog.ui.Component.prototype.hasChildren=function(){return!!this.children_&&0!=this.children_.length};
goog.ui.Component.prototype.getChildCount=function(){return this.children_?this.children_.length:0};goog.ui.Component.prototype.getChildIds=function(){var a=[];this.forEachChild(function(b){a.push(b.getId())});return a};goog.ui.Component.prototype.getChild=function(a){return this.childIndex_&&a?goog.object.get(this.childIndex_,a)||null:null};goog.ui.Component.prototype.getChildAt=function(a){return this.children_?this.children_[a]||null:null};
goog.ui.Component.prototype.forEachChild=function(a,b){this.children_&&goog.array.forEach(this.children_,a,b)};goog.ui.Component.prototype.indexOfChild=function(a){return this.children_&&a?goog.array.indexOf(this.children_,a):-1};
goog.ui.Component.prototype.removeChild=function(a,b){if(a){var c=goog.isString(a)?a:a.getId(),a=this.getChild(c);c&&a&&(goog.object.remove(this.childIndex_,c),goog.array.remove(this.children_,a),b&&(a.exitDocument(),a.element_&&goog.dom.removeNode(a.element_)),a.setParent(null))}if(!a)throw Error(goog.ui.Component.Error.NOT_OUR_CHILD);return a};goog.ui.Component.prototype.removeChildAt=function(a,b){return this.removeChild(this.getChildAt(a),b)};
goog.ui.Component.prototype.removeChildren=function(a){for(;this.hasChildren();)this.removeChildAt(0,a)};goog.ui.ControlRenderer=function(){};goog.addSingletonGetter(goog.ui.ControlRenderer);goog.ui.ControlRenderer.getCustomRenderer=function(a,b){var c=new a;c.getCssClass=function(){return b};return c};goog.ui.ControlRenderer.CSS_CLASS="goog-control";goog.ui.ControlRenderer.IE6_CLASS_COMBINATIONS=[];goog.ui.ControlRenderer.prototype.getAriaRole=function(){};
goog.ui.ControlRenderer.prototype.createDom=function(a){var b=a.getDomHelper().createDom("div",this.getClassNames(a).join(" "),a.getContent());this.setAriaStates(a,b);return b};goog.ui.ControlRenderer.prototype.getContentElement=function(a){return a};
goog.ui.ControlRenderer.prototype.enableClassName=function(a,b,c){if(a=a.getElement?a.getElement():a)if(goog.userAgent.IE&&!goog.userAgent.isVersion("7")){var d=this.getAppliedCombinedClassNames_(goog.dom.classes.get(a),b);d.push(b);goog.partial(c?goog.dom.classes.add:goog.dom.classes.remove,a).apply(null,d)}else goog.dom.classes.enable(a,b,c)};goog.ui.ControlRenderer.prototype.enableExtraClassName=function(a,b,c){this.enableClassName(a,b,c)};goog.ui.ControlRenderer.prototype.canDecorate=function(){return!0};
goog.ui.ControlRenderer.prototype.decorate=function(a,b){b.id&&a.setId(b.id);var c=this.getContentElement(b);c&&c.firstChild?a.setContentInternal(c.firstChild.nextSibling?goog.array.clone(c.childNodes):c.firstChild):a.setContentInternal(null);var d=0,e=this.getCssClass(),f=this.getStructuralCssClass(),g=!1,h=!1,c=!1,i=goog.dom.classes.get(b);goog.array.forEach(i,function(a){!g&&a==e?(g=!0,f==e&&(h=!0)):!h&&a==f?h=!0:d|=this.getStateFromClass(a)},this);a.setStateInternal(d);g||(i.push(e),f==e&&(h=
!0));h||i.push(f);var j=a.getExtraClassNames();j&&i.push.apply(i,j);if(goog.userAgent.IE&&!goog.userAgent.isVersion("7")){var k=this.getAppliedCombinedClassNames_(i);0<k.length&&(i.push.apply(i,k),c=!0)}(!g||!h||j||c)&&goog.dom.classes.set(b,i.join(" "));this.setAriaStates(a,b);return b};goog.ui.ControlRenderer.prototype.initializeDom=function(a){a.isRightToLeft()&&this.setRightToLeft(a.getElement(),!0);a.isEnabled()&&this.setFocusable(a,a.isVisible())};
goog.ui.ControlRenderer.prototype.setAriaRole=function(a,b){var c=b||this.getAriaRole();c&&goog.dom.a11y.setRole(a,c)};
goog.ui.ControlRenderer.prototype.setAriaStates=function(a,b){goog.asserts.assert(a);goog.asserts.assert(b);a.isEnabled()||this.updateAriaState(b,goog.ui.Component.State.DISABLED,!0);a.isSelected()&&this.updateAriaState(b,goog.ui.Component.State.SELECTED,!0);a.isSupportedState(goog.ui.Component.State.CHECKED)&&this.updateAriaState(b,goog.ui.Component.State.CHECKED,a.isChecked());a.isSupportedState(goog.ui.Component.State.OPENED)&&this.updateAriaState(b,goog.ui.Component.State.OPENED,a.isOpen())};
goog.ui.ControlRenderer.prototype.setAllowTextSelection=function(a,b){goog.style.setUnselectable(a,!b,!goog.userAgent.IE&&!goog.userAgent.OPERA)};goog.ui.ControlRenderer.prototype.setRightToLeft=function(a,b){this.enableClassName(a,this.getStructuralCssClass()+"-rtl",b)};goog.ui.ControlRenderer.prototype.isFocusable=function(a){var b;return a.isSupportedState(goog.ui.Component.State.FOCUSED)&&(b=a.getKeyEventTarget())?goog.dom.isFocusableTabIndex(b):!1};
goog.ui.ControlRenderer.prototype.setFocusable=function(a,b){var c;if(a.isSupportedState(goog.ui.Component.State.FOCUSED)&&(c=a.getKeyEventTarget())){if(!b&&a.isFocused()){try{c.blur()}catch(d){}a.isFocused()&&a.handleBlur(null)}goog.dom.isFocusableTabIndex(c)!=b&&goog.dom.setFocusableTabIndex(c,b)}};goog.ui.ControlRenderer.prototype.setVisible=function(a,b){goog.style.showElement(a,b)};
goog.ui.ControlRenderer.prototype.setState=function(a,b,c){var d=a.getElement();if(d){var e=this.getClassForState(b);e&&this.enableClassName(a,e,c);this.updateAriaState(d,b,c)}};
goog.ui.ControlRenderer.prototype.updateAriaState=function(a,b,c){goog.ui.ControlRenderer.ARIA_STATE_MAP_||(goog.ui.ControlRenderer.ARIA_STATE_MAP_=goog.object.create(goog.ui.Component.State.DISABLED,goog.dom.a11y.State.DISABLED,goog.ui.Component.State.SELECTED,goog.dom.a11y.State.SELECTED,goog.ui.Component.State.CHECKED,goog.dom.a11y.State.CHECKED,goog.ui.Component.State.OPENED,goog.dom.a11y.State.EXPANDED));(b=goog.ui.ControlRenderer.ARIA_STATE_MAP_[b])&&goog.dom.a11y.setState(a,b,c)};
goog.ui.ControlRenderer.prototype.setContent=function(a,b){var c=this.getContentElement(a);if(c&&(goog.dom.removeChildren(c),b))if(goog.isString(b))goog.dom.setTextContent(c,b);else{var d=function(a){if(a){var b=goog.dom.getOwnerDocument(c);c.appendChild(goog.isString(a)?b.createTextNode(a):a)}};goog.isArray(b)?goog.array.forEach(b,d):goog.isArrayLike(b)&&!("nodeType"in b)?goog.array.forEach(goog.array.clone(b),d):d(b)}};goog.ui.ControlRenderer.prototype.getKeyEventTarget=function(a){return a.getElement()};
goog.ui.ControlRenderer.prototype.getCssClass=function(){return goog.ui.ControlRenderer.CSS_CLASS};goog.ui.ControlRenderer.prototype.getIe6ClassCombinations=function(){return[]};goog.ui.ControlRenderer.prototype.getStructuralCssClass=function(){return this.getCssClass()};
goog.ui.ControlRenderer.prototype.getClassNames=function(a){var b=this.getCssClass(),c=[b],d=this.getStructuralCssClass();d!=b&&c.push(d);b=this.getClassNamesForState(a.getState());c.push.apply(c,b);(a=a.getExtraClassNames())&&c.push.apply(c,a);goog.userAgent.IE&&!goog.userAgent.isVersion("7")&&c.push.apply(c,this.getAppliedCombinedClassNames_(c));return c};
goog.ui.ControlRenderer.prototype.getAppliedCombinedClassNames_=function(a,b){var c=[];b&&(a=a.concat([b]));goog.array.forEach(this.getIe6ClassCombinations(),function(d){goog.array.every(d,goog.partial(goog.array.contains,a))&&(!b||goog.array.contains(d,b))&&c.push(d.join("_"))});return c};goog.ui.ControlRenderer.prototype.getClassNamesForState=function(a){for(var b=[];a;){var c=a&-a;b.push(this.getClassForState(c));a&=~c}return b};
goog.ui.ControlRenderer.prototype.getClassForState=function(a){this.classByState_||this.createClassByStateMap_();return this.classByState_[a]};goog.ui.ControlRenderer.prototype.getStateFromClass=function(a){this.stateByClass_||this.createStateByClassMap_();a=parseInt(this.stateByClass_[a],10);return isNaN(a)?0:a};
goog.ui.ControlRenderer.prototype.createClassByStateMap_=function(){var a=this.getStructuralCssClass();this.classByState_=goog.object.create(goog.ui.Component.State.DISABLED,a+"-disabled",goog.ui.Component.State.HOVER,a+"-hover",goog.ui.Component.State.ACTIVE,a+"-active",goog.ui.Component.State.SELECTED,a+"-selected",goog.ui.Component.State.CHECKED,a+"-checked",goog.ui.Component.State.FOCUSED,a+"-focused",goog.ui.Component.State.OPENED,a+"-open")};
goog.ui.ControlRenderer.prototype.createStateByClassMap_=function(){this.classByState_||this.createClassByStateMap_();this.stateByClass_=goog.object.transpose(this.classByState_)};goog.ui.MenuItemRenderer=function(){goog.ui.ControlRenderer.call(this);this.classNameCache_=[]};goog.inherits(goog.ui.MenuItemRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.MenuItemRenderer);goog.ui.MenuItemRenderer.CSS_CLASS="goog-menuitem";goog.ui.MenuItemRenderer.CompositeCssClassIndex_={HOVER:0,CHECKBOX:1,CONTENT:2};
goog.ui.MenuItemRenderer.prototype.getCompositeCssClass_=function(a){var b=this.classNameCache_[a];if(!b){switch(a){case goog.ui.MenuItemRenderer.CompositeCssClassIndex_.HOVER:b=this.getStructuralCssClass()+"-highlight";break;case goog.ui.MenuItemRenderer.CompositeCssClassIndex_.CHECKBOX:b=this.getStructuralCssClass()+"-checkbox";break;case goog.ui.MenuItemRenderer.CompositeCssClassIndex_.CONTENT:b=this.getStructuralCssClass()+"-content"}this.classNameCache_[a]=b}return b};
goog.ui.MenuItemRenderer.prototype.getAriaRole=function(){return goog.dom.a11y.Role.MENU_ITEM};goog.ui.MenuItemRenderer.prototype.createDom=function(a){var b=a.getDomHelper().createDom("div",this.getClassNames(a).join(" "),this.createContent(a.getContent(),a.getDomHelper()));this.setEnableCheckBoxStructure(a,b,a.isSupportedState(goog.ui.Component.State.SELECTED)||a.isSupportedState(goog.ui.Component.State.CHECKED));return b};
goog.ui.MenuItemRenderer.prototype.getContentElement=function(a){return a&&a.firstChild};goog.ui.MenuItemRenderer.prototype.decorate=function(a,b){this.hasContentStructure(b)||b.appendChild(this.createContent(b.childNodes,a.getDomHelper()));goog.dom.classes.has(b,"goog-option")&&(a.setCheckable(!0),this.setCheckable(a,b,!0));return goog.ui.MenuItemRenderer.superClass_.decorate.call(this,a,b)};
goog.ui.MenuItemRenderer.prototype.setContent=function(a,b){var c=this.getContentElement(a),d=this.hasCheckBoxStructure(a)?c.firstChild:null;goog.ui.MenuItemRenderer.superClass_.setContent.call(this,a,b);d&&!this.hasCheckBoxStructure(a)&&c.insertBefore(d,c.firstChild||null)};goog.ui.MenuItemRenderer.prototype.hasContentStructure=function(a){var a=goog.dom.getFirstElementChild(a),b=this.getCompositeCssClass_(goog.ui.MenuItemRenderer.CompositeCssClassIndex_.CONTENT);return!!a&&-1!=a.className.indexOf(b)};
goog.ui.MenuItemRenderer.prototype.createContent=function(a,b){var c=this.getCompositeCssClass_(goog.ui.MenuItemRenderer.CompositeCssClassIndex_.CONTENT);return b.createDom("div",c,a)};goog.ui.MenuItemRenderer.prototype.setSelectable=function(a,b,c){b&&(goog.dom.a11y.setRole(b,c?goog.dom.a11y.Role.MENU_ITEM_RADIO:this.getAriaRole()),this.setEnableCheckBoxStructure(a,b,c))};
goog.ui.MenuItemRenderer.prototype.setCheckable=function(a,b,c){b&&(goog.dom.a11y.setRole(b,c?goog.dom.a11y.Role.MENU_ITEM_CHECKBOX:this.getAriaRole()),this.setEnableCheckBoxStructure(a,b,c))};goog.ui.MenuItemRenderer.prototype.hasCheckBoxStructure=function(a){if(a=this.getContentElement(a)){var a=a.firstChild,b=this.getCompositeCssClass_(goog.ui.MenuItemRenderer.CompositeCssClassIndex_.CHECKBOX);return!!a&&!!a.className&&-1!=a.className.indexOf(b)}return!1};
goog.ui.MenuItemRenderer.prototype.setEnableCheckBoxStructure=function(a,b,c){c!=this.hasCheckBoxStructure(b)&&(goog.dom.classes.enable(b,"goog-option",c),b=this.getContentElement(b),c?(c=this.getCompositeCssClass_(goog.ui.MenuItemRenderer.CompositeCssClassIndex_.CHECKBOX),b.insertBefore(a.getDomHelper().createDom("div",c),b.firstChild||null)):b.removeChild(b.firstChild))};
goog.ui.MenuItemRenderer.prototype.getClassForState=function(a){switch(a){case goog.ui.Component.State.HOVER:return this.getCompositeCssClass_(goog.ui.MenuItemRenderer.CompositeCssClassIndex_.HOVER);case goog.ui.Component.State.CHECKED:case goog.ui.Component.State.SELECTED:return"goog-option-selected";default:return goog.ui.MenuItemRenderer.superClass_.getClassForState.call(this,a)}};
goog.ui.MenuItemRenderer.prototype.getStateFromClass=function(a){var b=this.getCompositeCssClass_(goog.ui.MenuItemRenderer.CompositeCssClassIndex_.HOVER);switch(a){case "goog-option-selected":return goog.ui.Component.State.CHECKED;case b:return goog.ui.Component.State.HOVER;default:return goog.ui.MenuItemRenderer.superClass_.getStateFromClass.call(this,a)}};goog.ui.MenuItemRenderer.prototype.getCssClass=function(){return goog.ui.MenuItemRenderer.CSS_CLASS};goog.ui.FilterObservingMenuItemRenderer=function(){goog.ui.MenuItemRenderer.call(this)};goog.inherits(goog.ui.FilterObservingMenuItemRenderer,goog.ui.MenuItemRenderer);goog.addSingletonGetter(goog.ui.FilterObservingMenuItemRenderer);goog.ui.FilterObservingMenuItemRenderer.CSS_CLASS="goog-filterobsmenuitem";goog.ui.FilterObservingMenuItemRenderer.prototype.getCssClass=function(){return goog.ui.FilterObservingMenuItemRenderer.CSS_CLASS};goog.events.KeyHandler=function(a,b){goog.events.EventTarget.call(this);a&&this.attach(a,b)};goog.inherits(goog.events.KeyHandler,goog.events.EventTarget);goog.events.KeyHandler.prototype.element_=null;goog.events.KeyHandler.prototype.keyPressKey_=null;goog.events.KeyHandler.prototype.keyDownKey_=null;goog.events.KeyHandler.prototype.keyUpKey_=null;goog.events.KeyHandler.prototype.lastKey_=-1;goog.events.KeyHandler.prototype.keyCode_=-1;goog.events.KeyHandler.EventType={KEY:"key"};
goog.events.KeyHandler.safariKey_={3:goog.events.KeyCodes.ENTER,12:goog.events.KeyCodes.NUMLOCK,63232:goog.events.KeyCodes.UP,63233:goog.events.KeyCodes.DOWN,63234:goog.events.KeyCodes.LEFT,63235:goog.events.KeyCodes.RIGHT,63236:goog.events.KeyCodes.F1,63237:goog.events.KeyCodes.F2,63238:goog.events.KeyCodes.F3,63239:goog.events.KeyCodes.F4,63240:goog.events.KeyCodes.F5,63241:goog.events.KeyCodes.F6,63242:goog.events.KeyCodes.F7,63243:goog.events.KeyCodes.F8,63244:goog.events.KeyCodes.F9,63245:goog.events.KeyCodes.F10,
63246:goog.events.KeyCodes.F11,63247:goog.events.KeyCodes.F12,63248:goog.events.KeyCodes.PRINT_SCREEN,63272:goog.events.KeyCodes.DELETE,63273:goog.events.KeyCodes.HOME,63275:goog.events.KeyCodes.END,63276:goog.events.KeyCodes.PAGE_UP,63277:goog.events.KeyCodes.PAGE_DOWN,63289:goog.events.KeyCodes.NUMLOCK,63302:goog.events.KeyCodes.INSERT};
goog.events.KeyHandler.keyIdentifier_={Up:goog.events.KeyCodes.UP,Down:goog.events.KeyCodes.DOWN,Left:goog.events.KeyCodes.LEFT,Right:goog.events.KeyCodes.RIGHT,Enter:goog.events.KeyCodes.ENTER,F1:goog.events.KeyCodes.F1,F2:goog.events.KeyCodes.F2,F3:goog.events.KeyCodes.F3,F4:goog.events.KeyCodes.F4,F5:goog.events.KeyCodes.F5,F6:goog.events.KeyCodes.F6,F7:goog.events.KeyCodes.F7,F8:goog.events.KeyCodes.F8,F9:goog.events.KeyCodes.F9,F10:goog.events.KeyCodes.F10,F11:goog.events.KeyCodes.F11,F12:goog.events.KeyCodes.F12,
"U+007F":goog.events.KeyCodes.DELETE,Home:goog.events.KeyCodes.HOME,End:goog.events.KeyCodes.END,PageUp:goog.events.KeyCodes.PAGE_UP,PageDown:goog.events.KeyCodes.PAGE_DOWN,Insert:goog.events.KeyCodes.INSERT};goog.events.KeyHandler.mozKeyCodeToKeyCodeMap_={61:187,59:186};goog.events.KeyHandler.USES_KEYDOWN_=goog.userAgent.IE||goog.userAgent.WEBKIT&&goog.userAgent.isVersion("525");
goog.events.KeyHandler.prototype.handleKeyDown_=function(a){if(goog.userAgent.WEBKIT&&(this.lastKey_==goog.events.KeyCodes.CTRL&&!a.ctrlKey||this.lastKey_==goog.events.KeyCodes.ALT&&!a.altKey))this.keyCode_=this.lastKey_=-1;goog.events.KeyHandler.USES_KEYDOWN_&&!goog.events.KeyCodes.firesKeyPressEvent(a.keyCode,this.lastKey_,a.shiftKey,a.ctrlKey,a.altKey)?this.handleEvent(a):this.keyCode_=goog.userAgent.GECKO&&a.keyCode in goog.events.KeyHandler.mozKeyCodeToKeyCodeMap_?goog.events.KeyHandler.mozKeyCodeToKeyCodeMap_[a.keyCode]:
a.keyCode};goog.events.KeyHandler.prototype.handleKeyup_=function(){this.keyCode_=this.lastKey_=-1};
goog.events.KeyHandler.prototype.handleEvent=function(a){var b=a.getBrowserEvent(),c,d;goog.userAgent.IE&&a.type==goog.events.EventType.KEYPRESS?(c=this.keyCode_,d=c!=goog.events.KeyCodes.ENTER&&c!=goog.events.KeyCodes.ESC?b.keyCode:0):goog.userAgent.WEBKIT&&a.type==goog.events.EventType.KEYPRESS?(c=this.keyCode_,d=0<=b.charCode&&63232>b.charCode&&goog.events.KeyCodes.isCharacterKey(c)?b.charCode:0):goog.userAgent.OPERA?(c=this.keyCode_,d=goog.events.KeyCodes.isCharacterKey(c)?b.keyCode:0):(c=b.keyCode||
this.keyCode_,d=b.charCode||0,goog.userAgent.MAC&&d==goog.events.KeyCodes.QUESTION_MARK&&!c&&(c=goog.events.KeyCodes.SLASH));var e=c,f=b.keyIdentifier;c?63232<=c&&c in goog.events.KeyHandler.safariKey_?e=goog.events.KeyHandler.safariKey_[c]:25==c&&a.shiftKey&&(e=9):f&&f in goog.events.KeyHandler.keyIdentifier_&&(e=goog.events.KeyHandler.keyIdentifier_[f]);a=e==this.lastKey_;this.lastKey_=e;b=new goog.events.KeyEvent(e,d,a,b);try{this.dispatchEvent(b)}finally{b.dispose()}};
goog.events.KeyHandler.prototype.getElement=function(){return this.element_};goog.events.KeyHandler.prototype.attach=function(a,b){this.keyUpKey_&&this.detach();this.element_=a;this.keyPressKey_=goog.events.listen(this.element_,goog.events.EventType.KEYPRESS,this,b);this.keyDownKey_=goog.events.listen(this.element_,goog.events.EventType.KEYDOWN,this.handleKeyDown_,b,this);this.keyUpKey_=goog.events.listen(this.element_,goog.events.EventType.KEYUP,this.handleKeyup_,b,this)};
goog.events.KeyHandler.prototype.detach=function(){this.keyPressKey_&&(goog.events.unlistenByKey(this.keyPressKey_),goog.events.unlistenByKey(this.keyDownKey_),goog.events.unlistenByKey(this.keyUpKey_),this.keyUpKey_=this.keyDownKey_=this.keyPressKey_=null);this.element_=null;this.keyCode_=this.lastKey_=-1};goog.events.KeyHandler.prototype.disposeInternal=function(){goog.events.KeyHandler.superClass_.disposeInternal.call(this);this.detach()};
goog.events.KeyEvent=function(a,b,c,d){goog.events.BrowserEvent.call(this,d);this.type=goog.events.KeyHandler.EventType.KEY;this.keyCode=a;this.charCode=b;this.repeat=c};goog.inherits(goog.events.KeyEvent,goog.events.BrowserEvent);goog.ui.registry={};goog.ui.registry.getDefaultRenderer=function(a){for(var b;a;){b=goog.getUid(a);if(b=goog.ui.registry.defaultRenderers_[b])break;a=a.superClass_?a.superClass_.constructor:null}return b?goog.isFunction(b.getInstance)?b.getInstance():new b:null};
goog.ui.registry.setDefaultRenderer=function(a,b){if(!goog.isFunction(a))throw Error("Invalid component class "+a);if(!goog.isFunction(b))throw Error("Invalid renderer class "+b);var c=goog.getUid(a);goog.ui.registry.defaultRenderers_[c]=b};goog.ui.registry.getDecoratorByClassName=function(a){return a in goog.ui.registry.decoratorFunctions_?goog.ui.registry.decoratorFunctions_[a]():null};
goog.ui.registry.setDecoratorByClassName=function(a,b){if(!a)throw Error("Invalid class name "+a);if(!goog.isFunction(b))throw Error("Invalid decorator function "+b);goog.ui.registry.decoratorFunctions_[a]=b};goog.ui.registry.getDecorator=function(a){for(var b=goog.dom.classes.get(a),c=0,d=b.length;c<d;c++)if(a=goog.ui.registry.getDecoratorByClassName(b[c]))return a;return null};goog.ui.registry.reset=function(){goog.ui.registry.defaultRenderers_={};goog.ui.registry.decoratorFunctions_={}};
goog.ui.registry.defaultRenderers_={};goog.ui.registry.decoratorFunctions_={};goog.ui.decorate=function(a){var b=goog.ui.registry.getDecorator(a);b&&b.decorate(a);return b};goog.ui.Control=function(a,b,c){goog.ui.Component.call(this,c);this.renderer_=b||goog.ui.registry.getDefaultRenderer(this.constructor);this.setContentInternal(a)};goog.inherits(goog.ui.Control,goog.ui.Component);goog.ui.Control.registerDecorator=goog.ui.registry.setDecoratorByClassName;goog.ui.Control.getDecorator=goog.ui.registry.getDecorator;goog.ui.Control.decorate=goog.ui.decorate;goog.ui.Control.prototype.content_=null;goog.ui.Control.prototype.state_=0;
goog.ui.Control.prototype.supportedStates_=goog.ui.Component.State.DISABLED|goog.ui.Component.State.HOVER|goog.ui.Component.State.ACTIVE|goog.ui.Component.State.FOCUSED;goog.ui.Control.prototype.autoStates_=goog.ui.Component.State.ALL;goog.ui.Control.prototype.statesWithTransitionEvents_=0;goog.ui.Control.prototype.visible_=!0;goog.ui.Control.prototype.extraClassNames_=null;goog.ui.Control.prototype.handleMouseEvents_=!0;goog.ui.Control.prototype.allowTextSelection_=!1;
goog.ui.Control.prototype.preferredAriaRole_=null;goog.ui.Control.prototype.isHandleMouseEvents=function(){return this.handleMouseEvents_};goog.ui.Control.prototype.setHandleMouseEvents=function(a){this.isInDocument()&&a!=this.handleMouseEvents_&&this.enableMouseEventHandling_(a);this.handleMouseEvents_=a};goog.ui.Control.prototype.getKeyEventTarget=function(){return this.renderer_.getKeyEventTarget(this)};
goog.ui.Control.prototype.getKeyHandler=function(){return this.keyHandler_||(this.keyHandler_=new goog.events.KeyHandler)};goog.ui.Control.prototype.getRenderer=function(){return this.renderer_};goog.ui.Control.prototype.setRenderer=function(a){if(this.isInDocument())throw Error(goog.ui.Component.Error.ALREADY_RENDERED);this.getElement()&&this.setElementInternal(null);this.renderer_=a};goog.ui.Control.prototype.getExtraClassNames=function(){return this.extraClassNames_};
goog.ui.Control.prototype.addClassName=function(a){a&&(this.extraClassNames_?goog.array.contains(this.extraClassNames_,a)||this.extraClassNames_.push(a):this.extraClassNames_=[a],this.renderer_.enableExtraClassName(this,a,!0))};goog.ui.Control.prototype.removeClassName=function(a){a&&this.extraClassNames_&&(goog.array.remove(this.extraClassNames_,a),0==this.extraClassNames_.length&&(this.extraClassNames_=null),this.renderer_.enableExtraClassName(this,a,!1))};
goog.ui.Control.prototype.enableClassName=function(a,b){b?this.addClassName(a):this.removeClassName(a)};goog.ui.Control.prototype.createDom=function(){var a=this.renderer_.createDom(this);this.setElementInternal(a);this.renderer_.setAriaRole(a,this.getPreferredAriaRole());this.isAllowTextSelection()||this.renderer_.setAllowTextSelection(a,!1);this.isVisible()||this.renderer_.setVisible(a,!1)};goog.ui.Control.prototype.getPreferredAriaRole=function(){return this.preferredAriaRole_};
goog.ui.Control.prototype.setPreferredAriaRole=function(a){this.preferredAriaRole_=a};goog.ui.Control.prototype.getContentElement=function(){return this.renderer_.getContentElement(this.getElement())};goog.ui.Control.prototype.canDecorate=function(a){return this.renderer_.canDecorate(a)};
goog.ui.Control.prototype.decorateInternal=function(a){a=this.renderer_.decorate(this,a);this.setElementInternal(a);this.renderer_.setAriaRole(a,this.getPreferredAriaRole());this.isAllowTextSelection()||this.renderer_.setAllowTextSelection(a,!1);this.visible_="none"!=a.style.display};
goog.ui.Control.prototype.enterDocument=function(){goog.ui.Control.superClass_.enterDocument.call(this);this.renderer_.initializeDom(this);if(this.supportedStates_&~goog.ui.Component.State.DISABLED&&(this.isHandleMouseEvents()&&this.enableMouseEventHandling_(!0),this.isSupportedState(goog.ui.Component.State.FOCUSED))){var a=this.getKeyEventTarget();if(a){var b=this.getKeyHandler();b.attach(a);this.getHandler().listen(b,goog.events.KeyHandler.EventType.KEY,this.handleKeyEvent).listen(a,goog.events.EventType.FOCUS,
this.handleFocus).listen(a,goog.events.EventType.BLUR,this.handleBlur)}}};
goog.ui.Control.prototype.enableMouseEventHandling_=function(a){var b=this.getHandler(),c=this.getElement();a?(b.listen(c,goog.events.EventType.MOUSEOVER,this.handleMouseOver).listen(c,goog.events.EventType.MOUSEDOWN,this.handleMouseDown).listen(c,goog.events.EventType.MOUSEUP,this.handleMouseUp).listen(c,goog.events.EventType.MOUSEOUT,this.handleMouseOut),goog.userAgent.IE&&b.listen(c,goog.events.EventType.DBLCLICK,this.handleDblClick)):(b.unlisten(c,goog.events.EventType.MOUSEOVER,this.handleMouseOver).unlisten(c,
goog.events.EventType.MOUSEDOWN,this.handleMouseDown).unlisten(c,goog.events.EventType.MOUSEUP,this.handleMouseUp).unlisten(c,goog.events.EventType.MOUSEOUT,this.handleMouseOut),goog.userAgent.IE&&b.unlisten(c,goog.events.EventType.DBLCLICK,this.handleDblClick))};goog.ui.Control.prototype.exitDocument=function(){goog.ui.Control.superClass_.exitDocument.call(this);this.keyHandler_&&this.keyHandler_.detach();this.isVisible()&&this.isEnabled()&&this.renderer_.setFocusable(this,!1)};
goog.ui.Control.prototype.disposeInternal=function(){goog.ui.Control.superClass_.disposeInternal.call(this);this.keyHandler_&&(this.keyHandler_.dispose(),delete this.keyHandler_);delete this.renderer_;this.extraClassNames_=this.content_=null};goog.ui.Control.prototype.getContent=function(){return this.content_};goog.ui.Control.prototype.setContent=function(a){this.renderer_.setContent(this.getElement(),a);this.setContentInternal(a)};
goog.ui.Control.prototype.setContentInternal=function(a){this.content_=a};goog.ui.Control.prototype.getCaption=function(){var a=this.getContent();if(!a)return"";a=goog.isString(a)?a:goog.isArray(a)?goog.array.map(a,goog.dom.getRawTextContent).join(""):goog.dom.getTextContent(a);return goog.string.collapseBreakingSpaces(a)};goog.ui.Control.prototype.setCaption=function(a){this.setContent(a)};
goog.ui.Control.prototype.setRightToLeft=function(a){goog.ui.Control.superClass_.setRightToLeft.call(this,a);var b=this.getElement();b&&this.renderer_.setRightToLeft(b,a)};goog.ui.Control.prototype.isAllowTextSelection=function(){return this.allowTextSelection_};goog.ui.Control.prototype.setAllowTextSelection=function(a){this.allowTextSelection_=a;var b=this.getElement();b&&this.renderer_.setAllowTextSelection(b,a)};goog.ui.Control.prototype.isVisible=function(){return this.visible_};
goog.ui.Control.prototype.setVisible=function(a,b){if(b||this.visible_!=a&&this.dispatchEvent(a?goog.ui.Component.EventType.SHOW:goog.ui.Component.EventType.HIDE)){var c=this.getElement();c&&this.renderer_.setVisible(c,a);this.isEnabled()&&this.renderer_.setFocusable(this,a);this.visible_=a;return!0}return!1};goog.ui.Control.prototype.isEnabled=function(){return!this.hasState(goog.ui.Component.State.DISABLED)};
goog.ui.Control.prototype.isParentDisabled_=function(){var a=this.getParent();return!!a&&"function"==typeof a.isEnabled&&!a.isEnabled()};goog.ui.Control.prototype.setEnabled=function(a){!this.isParentDisabled_()&&this.isTransitionAllowed(goog.ui.Component.State.DISABLED,!a)&&(a||(this.setActive(!1),this.setHighlighted(!1)),this.isVisible()&&this.renderer_.setFocusable(this,a),this.setState(goog.ui.Component.State.DISABLED,!a))};goog.ui.Control.prototype.isHighlighted=function(){return this.hasState(goog.ui.Component.State.HOVER)};
goog.ui.Control.prototype.setHighlighted=function(a){this.isTransitionAllowed(goog.ui.Component.State.HOVER,a)&&this.setState(goog.ui.Component.State.HOVER,a)};goog.ui.Control.prototype.isActive=function(){return this.hasState(goog.ui.Component.State.ACTIVE)};goog.ui.Control.prototype.setActive=function(a){this.isTransitionAllowed(goog.ui.Component.State.ACTIVE,a)&&this.setState(goog.ui.Component.State.ACTIVE,a)};goog.ui.Control.prototype.isSelected=function(){return this.hasState(goog.ui.Component.State.SELECTED)};
goog.ui.Control.prototype.setSelected=function(a){this.isTransitionAllowed(goog.ui.Component.State.SELECTED,a)&&this.setState(goog.ui.Component.State.SELECTED,a)};goog.ui.Control.prototype.isChecked=function(){return this.hasState(goog.ui.Component.State.CHECKED)};goog.ui.Control.prototype.setChecked=function(a){this.isTransitionAllowed(goog.ui.Component.State.CHECKED,a)&&this.setState(goog.ui.Component.State.CHECKED,a)};goog.ui.Control.prototype.isFocused=function(){return this.hasState(goog.ui.Component.State.FOCUSED)};
goog.ui.Control.prototype.setFocused=function(a){this.isTransitionAllowed(goog.ui.Component.State.FOCUSED,a)&&this.setState(goog.ui.Component.State.FOCUSED,a)};goog.ui.Control.prototype.isOpen=function(){return this.hasState(goog.ui.Component.State.OPENED)};goog.ui.Control.prototype.setOpen=function(a){this.isTransitionAllowed(goog.ui.Component.State.OPENED,a)&&this.setState(goog.ui.Component.State.OPENED,a)};goog.ui.Control.prototype.getState=function(){return this.state_};
goog.ui.Control.prototype.hasState=function(a){return!!(this.state_&a)};goog.ui.Control.prototype.setState=function(a,b){this.isSupportedState(a)&&b!=this.hasState(a)&&(this.renderer_.setState(this,a,b),this.state_=b?this.state_|a:this.state_&~a)};goog.ui.Control.prototype.setStateInternal=function(a){this.state_=a};goog.ui.Control.prototype.isSupportedState=function(a){return!!(this.supportedStates_&a)};
goog.ui.Control.prototype.setSupportedState=function(a,b){if(this.isInDocument()&&this.hasState(a)&&!b)throw Error(goog.ui.Component.Error.ALREADY_RENDERED);!b&&this.hasState(a)&&this.setState(a,!1);this.supportedStates_=b?this.supportedStates_|a:this.supportedStates_&~a};goog.ui.Control.prototype.isAutoState=function(a){return!!(this.autoStates_&a)&&this.isSupportedState(a)};goog.ui.Control.prototype.setAutoStates=function(a,b){this.autoStates_=b?this.autoStates_|a:this.autoStates_&~a};
goog.ui.Control.prototype.isDispatchTransitionEvents=function(a){return!!(this.statesWithTransitionEvents_&a)&&this.isSupportedState(a)};goog.ui.Control.prototype.setDispatchTransitionEvents=function(a,b){this.statesWithTransitionEvents_=b?this.statesWithTransitionEvents_|a:this.statesWithTransitionEvents_&~a};
goog.ui.Control.prototype.isTransitionAllowed=function(a,b){return this.isSupportedState(a)&&this.hasState(a)!=b&&(!(this.statesWithTransitionEvents_&a)||this.dispatchEvent(goog.ui.Component.getStateTransitionEvent(a,b)))&&!this.isDisposed()};goog.ui.Control.prototype.handleMouseOver=function(a){!goog.ui.Control.isMouseEventWithinElement_(a,this.getElement())&&this.dispatchEvent(goog.ui.Component.EventType.ENTER)&&this.isEnabled()&&this.isAutoState(goog.ui.Component.State.HOVER)&&this.setHighlighted(!0)};
goog.ui.Control.prototype.handleMouseOut=function(a){!goog.ui.Control.isMouseEventWithinElement_(a,this.getElement())&&this.dispatchEvent(goog.ui.Component.EventType.LEAVE)&&(this.isAutoState(goog.ui.Component.State.ACTIVE)&&this.setActive(!1),this.isAutoState(goog.ui.Component.State.HOVER)&&this.setHighlighted(!1))};goog.ui.Control.isMouseEventWithinElement_=function(a,b){return!!a.relatedTarget&&goog.dom.contains(b,a.relatedTarget)};
goog.ui.Control.prototype.handleMouseDown=function(a){this.isEnabled()&&(this.isAutoState(goog.ui.Component.State.HOVER)&&this.setHighlighted(!0),a.isMouseActionButton()&&(this.isAutoState(goog.ui.Component.State.ACTIVE)&&this.setActive(!0),this.renderer_.isFocusable(this)&&this.getKeyEventTarget().focus()));!this.isAllowTextSelection()&&a.isMouseActionButton()&&a.preventDefault()};
goog.ui.Control.prototype.handleMouseUp=function(a){this.isEnabled()&&(this.isAutoState(goog.ui.Component.State.HOVER)&&this.setHighlighted(!0),this.isActive()&&this.performActionInternal(a)&&this.isAutoState(goog.ui.Component.State.ACTIVE)&&this.setActive(!1))};goog.ui.Control.prototype.handleDblClick=function(a){this.isEnabled()&&this.performActionInternal(a)};
goog.ui.Control.prototype.performActionInternal=function(a){this.isAutoState(goog.ui.Component.State.CHECKED)&&this.setChecked(!this.isChecked());this.isAutoState(goog.ui.Component.State.SELECTED)&&this.setSelected(!0);this.isAutoState(goog.ui.Component.State.OPENED)&&this.setOpen(!this.isOpen());var b=new goog.events.Event(goog.ui.Component.EventType.ACTION,this);a&&(b.altKey=a.altKey,b.ctrlKey=a.ctrlKey,b.metaKey=a.metaKey,b.shiftKey=a.shiftKey,b.platformModifierKey=a.platformModifierKey);return this.dispatchEvent(b)};
goog.ui.Control.prototype.handleFocus=function(){this.isAutoState(goog.ui.Component.State.FOCUSED)&&this.setFocused(!0)};goog.ui.Control.prototype.handleBlur=function(){this.isAutoState(goog.ui.Component.State.ACTIVE)&&this.setActive(!1);this.isAutoState(goog.ui.Component.State.FOCUSED)&&this.setFocused(!1)};goog.ui.Control.prototype.handleKeyEvent=function(a){return this.isVisible()&&this.isEnabled()&&this.handleKeyEventInternal(a)?(a.preventDefault(),a.stopPropagation(),!0):!1};
goog.ui.Control.prototype.handleKeyEventInternal=function(a){return a.keyCode==goog.events.KeyCodes.ENTER&&this.performActionInternal(a)};goog.ui.registry.setDefaultRenderer(goog.ui.Control,goog.ui.ControlRenderer);goog.ui.registry.setDecoratorByClassName(goog.ui.ControlRenderer.CSS_CLASS,function(){return new goog.ui.Control(null)});goog.ui.MenuItem=function(a,b,c,d){goog.ui.Control.call(this,a,d||goog.ui.MenuItemRenderer.getInstance(),c);this.setValue(b)};goog.inherits(goog.ui.MenuItem,goog.ui.Control);goog.ui.MenuItem.MNEMONIC_WRAPPER_CLASS_="goog-menuitem-mnemonic-separator";goog.ui.MenuItem.ACCELERATOR_CLASS_="goog-menuitem-accel";goog.ui.MenuItem.prototype.getValue=function(){var a=this.getModel();return null!=a?a:this.getCaption()};goog.ui.MenuItem.prototype.setValue=function(a){this.setModel(a)};
goog.ui.MenuItem.prototype.setSelectable=function(a){this.setSupportedState(goog.ui.Component.State.SELECTED,a);this.isChecked()&&!a&&this.setChecked(!1);var b=this.getElement();b&&this.getRenderer().setSelectable(this,b,a)};goog.ui.MenuItem.prototype.setCheckable=function(a){this.setSupportedState(goog.ui.Component.State.CHECKED,a);var b=this.getElement();b&&this.getRenderer().setCheckable(this,b,a)};
goog.ui.MenuItem.prototype.getCaption=function(){var a=this.getContent();if(goog.isArray(a)){var b=goog.ui.MenuItem.ACCELERATOR_CLASS_,c=goog.ui.MenuItem.MNEMONIC_WRAPPER_CLASS_,a=goog.array.map(a,function(a){var e=goog.dom.classes.get(a);return goog.array.contains(e,b)||goog.array.contains(e,c)?"":goog.dom.getRawTextContent(a)}).join("");return goog.string.collapseBreakingSpaces(a)}return goog.ui.MenuItem.superClass_.getCaption.call(this)};
goog.ui.MenuItem.prototype.handleMouseUp=function(a){var b=this.getParent();if(b){var c=b.openingCoords;b.openingCoords=null;if(c&&goog.isNumber(a.clientX)&&(b=new goog.math.Coordinate(a.clientX,a.clientY),goog.math.Coordinate.equals(c,b)))return}goog.ui.MenuItem.superClass_.handleMouseUp.call(this,a)};goog.ui.MenuItem.prototype.handleKeyEventInternal=function(a){return a.keyCode==this.getMnemonic()&&this.performActionInternal(a)?!0:goog.ui.MenuItem.superClass_.handleKeyEventInternal.call(this,a)};
goog.ui.MenuItem.prototype.setMnemonic=function(a){this.mnemonicKey_=a};goog.ui.MenuItem.prototype.getMnemonic=function(){return this.mnemonicKey_};goog.ui.registry.setDecoratorByClassName(goog.ui.MenuItemRenderer.CSS_CLASS,function(){return new goog.ui.MenuItem(null)});goog.ui.FilterObservingMenuItem=function(a,b,c,d){goog.ui.MenuItem.call(this,a,b,c,d||new goog.ui.FilterObservingMenuItemRenderer)};goog.inherits(goog.ui.FilterObservingMenuItem,goog.ui.MenuItem);goog.ui.FilterObservingMenuItem.prototype.observer_=null;goog.ui.FilterObservingMenuItem.prototype.enterDocument=function(){goog.ui.FilterObservingMenuItem.superClass_.enterDocument.call(this);this.callObserver()};goog.ui.FilterObservingMenuItem.prototype.setObserver=function(a){this.observer_=a;this.callObserver()};
goog.ui.FilterObservingMenuItem.prototype.callObserver=function(a){this.observer_&&this.observer_(this,a||"")};goog.ui.registry.setDecoratorByClassName(goog.ui.FilterObservingMenuItemRenderer.CSS_CLASS,function(){return new goog.ui.FilterObservingMenuItem(null)});goog.ui.MenuSeparatorRenderer=function(){goog.ui.ControlRenderer.call(this)};goog.inherits(goog.ui.MenuSeparatorRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.MenuSeparatorRenderer);goog.ui.MenuSeparatorRenderer.CSS_CLASS="goog-menuseparator";goog.ui.MenuSeparatorRenderer.prototype.createDom=function(a){return a.getDomHelper().createDom("div",this.getCssClass())};
goog.ui.MenuSeparatorRenderer.prototype.decorate=function(a,b){b.id&&a.setId(b.id);if("HR"==b.tagName){var c=b,b=this.createDom(a);goog.dom.insertSiblingBefore(b,c);goog.dom.removeNode(c)}else goog.dom.classes.add(b,this.getCssClass());return b};goog.ui.MenuSeparatorRenderer.prototype.setContent=function(){};goog.ui.MenuSeparatorRenderer.prototype.getCssClass=function(){return goog.ui.MenuSeparatorRenderer.CSS_CLASS};goog.ui.Separator=function(a,b){goog.ui.Control.call(this,null,a||goog.ui.MenuSeparatorRenderer.getInstance(),b);this.setSupportedState(goog.ui.Component.State.DISABLED,!1);this.setSupportedState(goog.ui.Component.State.HOVER,!1);this.setSupportedState(goog.ui.Component.State.ACTIVE,!1);this.setSupportedState(goog.ui.Component.State.FOCUSED,!1);this.setStateInternal(goog.ui.Component.State.DISABLED)};goog.inherits(goog.ui.Separator,goog.ui.Control);
goog.ui.Separator.prototype.enterDocument=function(){goog.ui.Separator.superClass_.enterDocument.call(this);goog.dom.a11y.setRole(this.getElement(),"separator")};goog.ui.registry.setDecoratorByClassName(goog.ui.MenuSeparatorRenderer.CSS_CLASS,function(){return new goog.ui.Separator});goog.ui.ContainerRenderer=function(){};goog.addSingletonGetter(goog.ui.ContainerRenderer);goog.ui.ContainerRenderer.getCustomRenderer=function(a,b){var c=new a;c.getCssClass=function(){return b};return c};goog.ui.ContainerRenderer.CSS_CLASS="goog-container";goog.ui.ContainerRenderer.prototype.getAriaRole=function(){};goog.ui.ContainerRenderer.prototype.enableTabIndex=function(a,b){a&&(a.tabIndex=b?0:-1)};
goog.ui.ContainerRenderer.prototype.createDom=function(a){return a.getDomHelper().createDom("div",this.getClassNames(a).join(" "))};goog.ui.ContainerRenderer.prototype.getContentElement=function(a){return a};goog.ui.ContainerRenderer.prototype.canDecorate=function(a){return"DIV"==a.tagName};
goog.ui.ContainerRenderer.prototype.decorate=function(a,b){b.id&&a.setId(b.id);var c=this.getCssClass(),d=!1,e=goog.dom.classes.get(b);e&&goog.array.forEach(e,function(b){b==c?d=!0:b&&this.setStateFromClassName(a,b,c)},this);d||goog.dom.classes.add(b,c);this.decorateChildren(a,this.getContentElement(b));return b};
goog.ui.ContainerRenderer.prototype.setStateFromClassName=function(a,b,c){b==c+"-disabled"?a.setEnabled(!1):b==c+"-horizontal"?a.setOrientation(goog.ui.Container.Orientation.HORIZONTAL):b==c+"-vertical"&&a.setOrientation(goog.ui.Container.Orientation.VERTICAL)};
goog.ui.ContainerRenderer.prototype.decorateChildren=function(a,b,c){if(b)for(var c=c||b.firstChild,d;c&&c.parentNode==b;){d=c.nextSibling;if(c.nodeType==goog.dom.NodeType.ELEMENT){var e=this.getDecoratorForChild(c);e&&(e.setElementInternal(c),a.isEnabled()||e.setEnabled(!1),a.addChild(e),e.decorate(c))}else(!c.nodeValue||""==goog.string.trim(c.nodeValue))&&b.removeChild(c);c=d}};goog.ui.ContainerRenderer.prototype.getDecoratorForChild=function(a){return goog.ui.registry.getDecorator(a)};
goog.ui.ContainerRenderer.prototype.initializeDom=function(a){a=a.getElement();goog.style.setUnselectable(a,!0,goog.userAgent.GECKO);goog.userAgent.IE&&(a.hideFocus=!0);var b=this.getAriaRole();b&&goog.dom.a11y.setRole(a,b)};goog.ui.ContainerRenderer.prototype.getKeyEventTarget=function(a){return a.getElement()};goog.ui.ContainerRenderer.prototype.getCssClass=function(){return goog.ui.ContainerRenderer.CSS_CLASS};
goog.ui.ContainerRenderer.prototype.getClassNames=function(a){var b=this.getCssClass(),c=a.getOrientation()==goog.ui.Container.Orientation.HORIZONTAL,c=[b,c?b+"-horizontal":b+"-vertical"];a.isEnabled()||c.push(b+"-disabled");return c};goog.ui.ContainerRenderer.prototype.getDefaultOrientation=function(){return goog.ui.Container.Orientation.VERTICAL};goog.ui.Container=function(a,b,c){goog.ui.Component.call(this,c);this.renderer_=b||goog.ui.ContainerRenderer.getInstance();this.orientation_=a||this.renderer_.getDefaultOrientation()};goog.inherits(goog.ui.Container,goog.ui.Component);goog.ui.Container.EventType={AFTER_SHOW:"aftershow",AFTER_HIDE:"afterhide"};goog.ui.Container.Orientation={HORIZONTAL:"horizontal",VERTICAL:"vertical"};goog.ui.Container.prototype.keyEventTarget_=null;goog.ui.Container.prototype.keyHandler_=null;
goog.ui.Container.prototype.renderer_=null;goog.ui.Container.prototype.orientation_=null;goog.ui.Container.prototype.visible_=!0;goog.ui.Container.prototype.enabled_=!0;goog.ui.Container.prototype.focusable_=!0;goog.ui.Container.prototype.highlightedIndex_=-1;goog.ui.Container.prototype.openItem_=null;goog.ui.Container.prototype.mouseButtonPressed_=!1;goog.ui.Container.prototype.allowFocusableChildren_=!1;goog.ui.Container.prototype.openFollowsHighlight_=!0;
goog.ui.Container.prototype.childElementIdMap_=null;goog.ui.Container.prototype.getKeyEventTarget=function(){return this.keyEventTarget_||this.renderer_.getKeyEventTarget(this)};
goog.ui.Container.prototype.setKeyEventTarget=function(a){if(this.focusable_){var b=this.getKeyEventTarget(),c=this.isInDocument();this.keyEventTarget_=a;var d=this.getKeyEventTarget();c&&(this.keyEventTarget_=b,this.enableFocusHandling_(!1),this.keyEventTarget_=a,this.getKeyHandler().attach(d),this.enableFocusHandling_(!0))}else throw Error("Can't set key event target for container that doesn't support keyboard focus!");};
goog.ui.Container.prototype.getKeyHandler=function(){return this.keyHandler_||(this.keyHandler_=new goog.events.KeyHandler(this.getKeyEventTarget()))};goog.ui.Container.prototype.getRenderer=function(){return this.renderer_};goog.ui.Container.prototype.setRenderer=function(a){if(this.getElement())throw Error(goog.ui.Component.Error.ALREADY_RENDERED);this.renderer_=a};goog.ui.Container.prototype.createDom=function(){this.setElementInternal(this.renderer_.createDom(this))};
goog.ui.Container.prototype.getContentElement=function(){return this.renderer_.getContentElement(this.getElement())};goog.ui.Container.prototype.canDecorate=function(a){return this.renderer_.canDecorate(a)};goog.ui.Container.prototype.decorateInternal=function(a){this.setElementInternal(this.renderer_.decorate(this,a));"none"==a.style.display&&(this.visible_=!1)};
goog.ui.Container.prototype.enterDocument=function(){goog.ui.Container.superClass_.enterDocument.call(this);this.forEachChild(function(a){a.isInDocument()&&this.registerChildId_(a)},this);var a=this.getElement();this.renderer_.initializeDom(this);this.setVisible(this.visible_,!0);this.getHandler().listen(this,goog.ui.Component.EventType.ENTER,this.handleEnterItem).listen(this,goog.ui.Component.EventType.HIGHLIGHT,this.handleHighlightItem).listen(this,goog.ui.Component.EventType.UNHIGHLIGHT,this.handleUnHighlightItem).listen(this,
goog.ui.Component.EventType.OPEN,this.handleOpenItem).listen(this,goog.ui.Component.EventType.CLOSE,this.handleCloseItem).listen(a,goog.events.EventType.MOUSEDOWN,this.handleMouseDown).listen(goog.dom.getOwnerDocument(a),goog.events.EventType.MOUSEUP,this.handleDocumentMouseUp).listen(a,[goog.events.EventType.MOUSEDOWN,goog.events.EventType.MOUSEUP,goog.events.EventType.MOUSEOVER,goog.events.EventType.MOUSEOUT],this.handleChildMouseEvents);this.isFocusable()&&this.enableFocusHandling_(!0)};
goog.ui.Container.prototype.enableFocusHandling_=function(a){var b=this.getHandler(),c=this.getKeyEventTarget();a?b.listen(c,goog.events.EventType.FOCUS,this.handleFocus).listen(c,goog.events.EventType.BLUR,this.handleBlur).listen(this.getKeyHandler(),goog.events.KeyHandler.EventType.KEY,this.handleKeyEvent):b.unlisten(c,goog.events.EventType.FOCUS,this.handleFocus).unlisten(c,goog.events.EventType.BLUR,this.handleBlur).unlisten(this.getKeyHandler(),goog.events.KeyHandler.EventType.KEY,this.handleKeyEvent)};
goog.ui.Container.prototype.exitDocument=function(){this.setHighlightedIndex(-1);this.openItem_&&this.openItem_.setOpen(!1);this.mouseButtonPressed_=!1;goog.ui.Container.superClass_.exitDocument.call(this)};goog.ui.Container.prototype.disposeInternal=function(){goog.ui.Container.superClass_.disposeInternal.call(this);this.keyHandler_&&(this.keyHandler_.dispose(),this.keyHandler_=null);this.renderer_=this.openItem_=this.childElementIdMap_=this.keyEventTarget_=null};
goog.ui.Container.prototype.handleEnterItem=function(){return!0};
goog.ui.Container.prototype.handleHighlightItem=function(a){var b=this.indexOfChild(a.target);if(-1<b&&b!=this.highlightedIndex_){var c=this.getHighlighted();c&&c.setHighlighted(!1);this.highlightedIndex_=b;c=this.getHighlighted();this.isMouseButtonPressed()&&c.setActive(!0);this.openFollowsHighlight_&&this.openItem_&&c!=this.openItem_&&(c.isSupportedState(goog.ui.Component.State.OPENED)?c.setOpen(!0):this.openItem_.setOpen(!1))}goog.dom.a11y.setState(this.getElement(),goog.dom.a11y.State.ACTIVEDESCENDANT,
a.target.getElement().id)};goog.ui.Container.prototype.handleUnHighlightItem=function(a){a.target==this.getHighlighted()&&(this.highlightedIndex_=-1);goog.dom.a11y.setState(this.getElement(),goog.dom.a11y.State.ACTIVEDESCENDANT,"")};goog.ui.Container.prototype.handleOpenItem=function(a){if((a=a.target)&&a!=this.openItem_&&a.getParent()==this)this.openItem_&&this.openItem_.setOpen(!1),this.openItem_=a};
goog.ui.Container.prototype.handleCloseItem=function(a){a.target==this.openItem_&&(this.openItem_=null)};goog.ui.Container.prototype.handleMouseDown=function(a){this.enabled_&&this.setMouseButtonPressed(!0);var b=this.getKeyEventTarget();b&&goog.dom.isFocusableTabIndex(b)?b.focus():a.preventDefault()};goog.ui.Container.prototype.handleDocumentMouseUp=function(){this.setMouseButtonPressed(!1)};
goog.ui.Container.prototype.handleChildMouseEvents=function(a){var b=this.getOwnerControl(a.target);if(b)switch(a.type){case goog.events.EventType.MOUSEDOWN:b.handleMouseDown(a);break;case goog.events.EventType.MOUSEUP:b.handleMouseUp(a);break;case goog.events.EventType.MOUSEOVER:b.handleMouseOver(a);break;case goog.events.EventType.MOUSEOUT:b.handleMouseOut(a)}};
goog.ui.Container.prototype.getOwnerControl=function(a){if(this.childElementIdMap_)for(var b=this.getElement();a&&a!==b;){var c=a.id;if(c in this.childElementIdMap_)return this.childElementIdMap_[c];a=a.parentNode}return null};goog.ui.Container.prototype.handleFocus=function(){};goog.ui.Container.prototype.handleBlur=function(){this.setHighlightedIndex(-1);this.setMouseButtonPressed(!1);this.openItem_&&this.openItem_.setOpen(!1)};
goog.ui.Container.prototype.handleKeyEvent=function(a){return this.isEnabled()&&this.isVisible()&&(0!=this.getChildCount()||this.keyEventTarget_)&&this.handleKeyEventInternal(a)?(a.preventDefault(),a.stopPropagation(),!0):!1};
goog.ui.Container.prototype.handleKeyEventInternal=function(a){var b=this.getHighlighted();if(b&&"function"==typeof b.handleKeyEvent&&b.handleKeyEvent(a)||this.openItem_&&this.openItem_!=b&&"function"==typeof this.openItem_.handleKeyEvent&&this.openItem_.handleKeyEvent(a))return!0;if(a.shiftKey||a.ctrlKey||a.metaKey||a.altKey)return!1;switch(a.keyCode){case goog.events.KeyCodes.ESC:if(this.isFocusable())this.getKeyEventTarget().blur();else return!1;break;case goog.events.KeyCodes.HOME:this.highlightFirst();
break;case goog.events.KeyCodes.END:this.highlightLast();break;case goog.events.KeyCodes.UP:if(this.orientation_==goog.ui.Container.Orientation.VERTICAL)this.highlightPrevious();else return!1;break;case goog.events.KeyCodes.LEFT:if(this.orientation_==goog.ui.Container.Orientation.HORIZONTAL)this.isRightToLeft()?this.highlightNext():this.highlightPrevious();else return!1;break;case goog.events.KeyCodes.DOWN:if(this.orientation_==goog.ui.Container.Orientation.VERTICAL)this.highlightNext();else return!1;
break;case goog.events.KeyCodes.RIGHT:if(this.orientation_==goog.ui.Container.Orientation.HORIZONTAL)this.isRightToLeft()?this.highlightPrevious():this.highlightNext();else return!1;break;default:return!1}return!0};goog.ui.Container.prototype.registerChildId_=function(a){var b=a.getElement(),b=b.id||(b.id=a.getId());this.childElementIdMap_||(this.childElementIdMap_={});this.childElementIdMap_[b]=a};
goog.ui.Container.prototype.addChild=function(a,b){goog.ui.Container.superClass_.addChild.call(this,a,b)};
goog.ui.Container.prototype.addChildAt=function(a,b,c){a.setDispatchTransitionEvents(goog.ui.Component.State.HOVER,!0);a.setDispatchTransitionEvents(goog.ui.Component.State.OPENED,!0);(this.isFocusable()||!this.isFocusableChildrenAllowed())&&a.setSupportedState(goog.ui.Component.State.FOCUSED,!1);a.setHandleMouseEvents(!1);goog.ui.Container.superClass_.addChildAt.call(this,a,b,c);a.isInDocument()&&this.isInDocument()&&this.registerChildId_(a);b<=this.highlightedIndex_&&this.highlightedIndex_++};
goog.ui.Container.prototype.removeChild=function(a,b){if(a=goog.isString(a)?this.getChild(a):a){var c=this.indexOfChild(a);-1!=c&&(c==this.highlightedIndex_?a.setHighlighted(!1):c<this.highlightedIndex_&&this.highlightedIndex_--);(c=a.getElement())&&c.id&&this.childElementIdMap_&&goog.object.remove(this.childElementIdMap_,c.id)}a=goog.ui.Container.superClass_.removeChild.call(this,a,b);a.setHandleMouseEvents(!0);return a};goog.ui.Container.prototype.getOrientation=function(){return this.orientation_};
goog.ui.Container.prototype.setOrientation=function(a){if(this.getElement())throw Error(goog.ui.Component.Error.ALREADY_RENDERED);this.orientation_=a};goog.ui.Container.prototype.isVisible=function(){return this.visible_};
goog.ui.Container.prototype.setVisible=function(a,b){if(b||this.visible_!=a&&this.dispatchEvent(a?goog.ui.Component.EventType.SHOW:goog.ui.Component.EventType.HIDE)){this.visible_=a;var c=this.getElement();c&&(goog.style.showElement(c,a),this.isFocusable()&&this.renderer_.enableTabIndex(this.getKeyEventTarget(),this.enabled_&&this.visible_),b||this.dispatchEvent(this.visible_?goog.ui.Container.EventType.AFTER_SHOW:goog.ui.Container.EventType.AFTER_HIDE));return!0}return!1};
goog.ui.Container.prototype.isEnabled=function(){return this.enabled_};
goog.ui.Container.prototype.setEnabled=function(a){if(this.enabled_!=a&&this.dispatchEvent(a?goog.ui.Component.EventType.ENABLE:goog.ui.Component.EventType.DISABLE))a?(this.enabled_=!0,this.forEachChild(function(a){a.wasDisabled?delete a.wasDisabled:a.setEnabled(!0)})):(this.forEachChild(function(a){a.isEnabled()?a.setEnabled(!1):a.wasDisabled=!0}),this.enabled_=!1,this.setMouseButtonPressed(!1)),this.isFocusable()&&this.renderer_.enableTabIndex(this.getKeyEventTarget(),a&&this.visible_)};
goog.ui.Container.prototype.isFocusable=function(){return this.focusable_};goog.ui.Container.prototype.setFocusable=function(a){a!=this.focusable_&&this.isInDocument()&&this.enableFocusHandling_(a);this.focusable_=a;this.enabled_&&this.visible_&&this.renderer_.enableTabIndex(this.getKeyEventTarget(),a)};goog.ui.Container.prototype.isFocusableChildrenAllowed=function(){return this.allowFocusableChildren_};
goog.ui.Container.prototype.setFocusableChildrenAllowed=function(a){this.allowFocusableChildren_=a};goog.ui.Container.prototype.isOpenFollowsHighlight=function(){return this.openFollowsHighlight_};goog.ui.Container.prototype.setOpenFollowsHighlight=function(a){this.openFollowsHighlight_=a};goog.ui.Container.prototype.getHighlightedIndex=function(){return this.highlightedIndex_};
goog.ui.Container.prototype.setHighlightedIndex=function(a){(a=this.getChildAt(a))?a.setHighlighted(!0):-1<this.highlightedIndex_&&this.getHighlighted().setHighlighted(!1)};goog.ui.Container.prototype.setHighlighted=function(a){this.setHighlightedIndex(this.indexOfChild(a))};goog.ui.Container.prototype.getHighlighted=function(){return this.getChildAt(this.highlightedIndex_)};
goog.ui.Container.prototype.highlightFirst=function(){this.highlightHelper(function(a,b){return(a+1)%b},this.getChildCount()-1)};goog.ui.Container.prototype.highlightLast=function(){this.highlightHelper(function(a,b){a--;return 0>a?b-1:a},0)};goog.ui.Container.prototype.highlightNext=function(){this.highlightHelper(function(a,b){return(a+1)%b},this.highlightedIndex_)};goog.ui.Container.prototype.highlightPrevious=function(){this.highlightHelper(function(a,b){a--;return 0>a?b-1:a},this.highlightedIndex_)};
goog.ui.Container.prototype.highlightHelper=function(a,b){for(var c=0>b?this.indexOfChild(this.openItem_):b,d=this.getChildCount(),c=a.call(this,c,d),e=0;e<=d;){var f=this.getChildAt(c);if(f&&this.canHighlightItem(f))return this.setHighlightedIndexFromKeyEvent(c),!0;e++;c=a.call(this,c,d)}return!1};goog.ui.Container.prototype.canHighlightItem=function(a){return a.isVisible()&&a.isEnabled()&&a.isSupportedState(goog.ui.Component.State.HOVER)};
goog.ui.Container.prototype.setHighlightedIndexFromKeyEvent=function(a){this.setHighlightedIndex(a)};goog.ui.Container.prototype.getOpenItem=function(){return this.openItem_};goog.ui.Container.prototype.isMouseButtonPressed=function(){return this.mouseButtonPressed_};goog.ui.Container.prototype.setMouseButtonPressed=function(a){this.mouseButtonPressed_=a};goog.ui.MenuHeaderRenderer=function(){goog.ui.ControlRenderer.call(this)};goog.inherits(goog.ui.MenuHeaderRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.MenuHeaderRenderer);goog.ui.MenuHeaderRenderer.CSS_CLASS="goog-menuheader";goog.ui.MenuHeaderRenderer.prototype.getCssClass=function(){return goog.ui.MenuHeaderRenderer.CSS_CLASS};goog.ui.MenuHeader=function(a,b,c){goog.ui.Control.call(this,a,c||goog.ui.MenuHeaderRenderer.getInstance(),b);this.setSupportedState(goog.ui.Component.State.DISABLED,!1);this.setSupportedState(goog.ui.Component.State.HOVER,!1);this.setSupportedState(goog.ui.Component.State.ACTIVE,!1);this.setSupportedState(goog.ui.Component.State.FOCUSED,!1);this.setStateInternal(goog.ui.Component.State.DISABLED)};goog.inherits(goog.ui.MenuHeader,goog.ui.Control);
goog.ui.registry.setDecoratorByClassName(goog.ui.MenuHeaderRenderer.CSS_CLASS,function(){return new goog.ui.MenuHeader(null)});goog.ui.MenuRenderer=function(){goog.ui.ContainerRenderer.call(this)};goog.inherits(goog.ui.MenuRenderer,goog.ui.ContainerRenderer);goog.addSingletonGetter(goog.ui.MenuRenderer);goog.ui.MenuRenderer.CSS_CLASS="goog-menu";goog.ui.MenuRenderer.prototype.getAriaRole=function(){return goog.dom.a11y.Role.MENU};goog.ui.MenuRenderer.prototype.canDecorate=function(a){return"UL"==a.tagName||goog.ui.MenuRenderer.superClass_.canDecorate.call(this,a)};
goog.ui.MenuRenderer.prototype.getDecoratorForChild=function(a){return"HR"==a.tagName?new goog.ui.Separator:goog.ui.MenuRenderer.superClass_.getDecoratorForChild.call(this,a)};goog.ui.MenuRenderer.prototype.containsElement=function(a,b){return goog.dom.contains(a.getElement(),b)};goog.ui.MenuRenderer.prototype.getCssClass=function(){return goog.ui.MenuRenderer.CSS_CLASS};
goog.ui.MenuRenderer.prototype.initializeDom=function(a){goog.ui.MenuRenderer.superClass_.initializeDom.call(this,a);a=a.getElement();goog.dom.a11y.setState(a,goog.dom.a11y.State.HASPOPUP,"true")};goog.ui.MenuSeparator=function(a){goog.ui.Separator.call(this,goog.ui.MenuSeparatorRenderer.getInstance(),a)};goog.inherits(goog.ui.MenuSeparator,goog.ui.Separator);goog.ui.registry.setDecoratorByClassName(goog.ui.MenuSeparatorRenderer.CSS_CLASS,function(){return new goog.ui.Separator});goog.ui.Menu=function(a,b){goog.ui.Container.call(this,goog.ui.Container.Orientation.VERTICAL,b||goog.ui.MenuRenderer.getInstance(),a);this.setFocusable(!1)};goog.inherits(goog.ui.Menu,goog.ui.Container);goog.ui.Menu.EventType={BEFORE_SHOW:goog.ui.Component.EventType.BEFORE_SHOW,SHOW:goog.ui.Component.EventType.SHOW,BEFORE_HIDE:goog.ui.Component.EventType.HIDE,HIDE:goog.ui.Component.EventType.HIDE};goog.ui.Menu.CSS_CLASS=goog.ui.MenuRenderer.CSS_CLASS;goog.ui.Menu.prototype.allowAutoFocus_=!0;
goog.ui.Menu.prototype.allowHighlightDisabled_=!1;goog.ui.Menu.prototype.getCssClass=function(){return this.getRenderer().getCssClass()};goog.ui.Menu.prototype.containsElement=function(a){if(this.getRenderer().containsElement(this,a))return!0;for(var b=0,c=this.getChildCount();b<c;b++){var d=this.getChildAt(b);if("function"==typeof d.containsElement&&d.containsElement(a))return!0}return!1};goog.ui.Menu.prototype.addItem=function(a){this.addChild(a,!0)};
goog.ui.Menu.prototype.addItemAt=function(a,b){this.addChildAt(a,b,!0)};goog.ui.Menu.prototype.removeItem=function(a){(a=this.removeChild(a,!0))&&a.dispose()};goog.ui.Menu.prototype.removeItemAt=function(a){(a=this.removeChildAt(a,!0))&&a.dispose()};goog.ui.Menu.prototype.getItemAt=function(a){return this.getChildAt(a)};goog.ui.Menu.prototype.getItemCount=function(){return this.getChildCount()};goog.ui.Menu.prototype.getItems=function(){var a=[];this.forEachChild(function(b){a.push(b)});return a};
goog.ui.Menu.prototype.setPosition=function(a,b){var c=this.isVisible();c||goog.style.showElement(this.getElement(),!0);goog.style.setPageOffset(this.getElement(),a,b);c||goog.style.showElement(this.getElement(),!1)};goog.ui.Menu.prototype.getPosition=function(){return this.isVisible()?goog.style.getPageOffset(this.getElement()):null};goog.ui.Menu.prototype.setAllowAutoFocus=function(a){(this.allowAutoFocus_=a)&&this.setFocusable(!0)};goog.ui.Menu.prototype.getAllowAutoFocus=function(){return this.allowAutoFocus_};
goog.ui.Menu.prototype.setAllowHighlightDisabled=function(a){this.allowHighlightDisabled_=a};goog.ui.Menu.prototype.getAllowHighlightDisabled=function(){return this.allowHighlightDisabled_};goog.ui.Menu.prototype.setVisible=function(a,b,c){(b=goog.ui.Menu.superClass_.setVisible.call(this,a,b))&&a&&this.isInDocument()&&this.allowAutoFocus_&&this.getKeyEventTarget().focus();this.openingCoords=a&&c&&goog.isNumber(c.clientX)?new goog.math.Coordinate(c.clientX,c.clientY):null;return b};
goog.ui.Menu.prototype.handleEnterItem=function(a){this.allowAutoFocus_&&this.getKeyEventTarget().focus();return goog.ui.Menu.superClass_.handleEnterItem.call(this,a)};goog.ui.Menu.prototype.highlightNextPrefix=function(a){var b=RegExp("^"+goog.string.regExpEscape(a),"i");return this.highlightHelper(function(a,d){var e=0>a?0:a,f=!1;do{++a;a==d&&(a=0,f=!0);var g=this.getChildAt(a).getCaption();if(g&&g.match(b))return a}while(!f||a!=e);return this.getHighlightedIndex()},this.getHighlightedIndex())};
goog.ui.Menu.prototype.canHighlightItem=function(a){return(this.allowHighlightDisabled_||a.isEnabled())&&a.isVisible()&&a.isSupportedState(goog.ui.Component.State.HOVER)};goog.ui.Menu.prototype.decorateInternal=function(a){this.decorateContent(a);goog.ui.Menu.superClass_.decorateInternal.call(this,a)};
goog.ui.Menu.prototype.handleKeyEventInternal=function(a){var b=goog.ui.Menu.superClass_.handleKeyEventInternal.call(this,a);b||this.forEachChild(function(c){!b&&c.getMnemonic&&c.getMnemonic()==a.keyCode&&(this.isEnabled()&&this.setHighlighted(c),b=c.handleKeyEvent(a))},this);return b};
goog.ui.Menu.prototype.decorateContent=function(a){for(var b=this.getRenderer(),a=this.getDomHelper().getElementsByTagNameAndClass("div",b.getCssClass()+"-content",a),c=a.length,d=0;d<c;d++)b.decorateChildren(this,a[d])};goog.ui.FilteredMenu=function(a,b){goog.ui.Menu.call(this,b,a)};goog.inherits(goog.ui.FilteredMenu,goog.ui.Menu);goog.ui.FilteredMenu.EventType={FILTER_CHANGED:"filterchange"};goog.ui.FilteredMenu.prototype.maxLength_=0;goog.ui.FilteredMenu.prototype.label_="";goog.ui.FilteredMenu.prototype.allowMultiple_=!1;goog.ui.FilteredMenu.prototype.filterFromIndex_=0;
goog.ui.FilteredMenu.prototype.createDom=function(){goog.ui.FilteredMenu.superClass_.createDom.call(this);var a=this.getDomHelper(),b=a.createDom("div",this.getRenderer().getCssClass()+"-filter",this.labelEl_=a.createDom("div",null,this.label_),this.filterInput_=a.createDom("input",{type:"text"})),c=this.getElement();a.appendChild(c,b);this.contentElement_=a.createDom("div",this.getRenderer().getCssClass()+"-content");a.appendChild(c,this.contentElement_);this.initFilterInput_()};
goog.ui.FilteredMenu.prototype.initFilterInput_=function(){this.setFocusable(!0);this.setKeyEventTarget(this.filterInput_);goog.userAgent.GECKO&&this.filterInput_.setAttribute("autocomplete","off");this.maxLength_&&(this.filterInput_.maxLength=this.maxLength_)};
goog.ui.FilteredMenu.prototype.setUpFilterListeners_=function(){!this.inputHandler_&&this.filterInput_&&(this.inputHandler_=new goog.events.InputHandler(this.filterInput_),goog.style.setUnselectable(this.filterInput_,!1),goog.events.listen(this.inputHandler_,goog.events.InputHandler.EventType.INPUT,this.handleFilterEvent,!1,this),goog.events.listen(this.filterInput_.parentNode,goog.events.EventType.CLICK,this.onFilterLabelClick_,!1,this),this.allowMultiple_&&(this.enteredItems_=[]))};
goog.ui.FilteredMenu.prototype.tearDownFilterListeners_=function(){this.inputHandler_&&(goog.events.unlisten(this.inputHandler_,goog.events.InputHandler.EventType.INPUT,this.handleFilterEvent,!1,this),goog.events.unlisten(this.filterInput_.parentNode,goog.events.EventType.CLICK,this.onFilterLabelClick_,!1,this),this.inputHandler_.dispose(),this.enteredItems_=this.inputHandler_=void 0)};
goog.ui.FilteredMenu.prototype.setVisible=function(a,b,c){(b=goog.ui.FilteredMenu.superClass_.setVisible.call(this,a,b,c))&&a&&this.isInDocument()?(this.setFilter(""),this.setUpFilterListeners_()):b&&!a&&this.tearDownFilterListeners_();return b};goog.ui.FilteredMenu.prototype.disposeInternal=function(){this.tearDownFilterListeners_();this.labelEl_=this.filterInput_=void 0;goog.ui.FilteredMenu.superClass_.disposeInternal.call(this)};
goog.ui.FilteredMenu.prototype.setFilterLabel=function(a){this.label_=a||"";this.labelEl_&&goog.dom.setTextContent(this.labelEl_,this.label_)};goog.ui.FilteredMenu.prototype.getFilterLabel=function(){return this.label_};goog.ui.FilteredMenu.prototype.setFilter=function(a){this.filterInput_&&(this.filterInput_.value=a,this.filterItems_(a))};goog.ui.FilteredMenu.prototype.getFilter=function(){return this.filterInput_&&goog.isString(this.filterInput_.value)?this.filterInput_.value:""};
goog.ui.FilteredMenu.prototype.setFilterFromIndex=function(a){this.filterFromIndex_=a};goog.ui.FilteredMenu.prototype.getFilterFromIndex=function(){return this.filterFromIndex_};goog.ui.FilteredMenu.prototype.getEnteredItems=function(){return this.enteredItems_||[]};goog.ui.FilteredMenu.prototype.setAllowMultiple=function(a){this.allowMultiple_=a};goog.ui.FilteredMenu.prototype.getAllowMultiple=function(){return this.allowMultiple_};
goog.ui.FilteredMenu.prototype.setPersistentVisibility=function(a,b){this.persistentChildren_||(this.persistentChildren_={});this.persistentChildren_[a.getId()]=b};goog.ui.FilteredMenu.prototype.hasPersistentVisibility=function(a){return!(!this.persistentChildren_||!this.persistentChildren_[a.getId()])};goog.ui.FilteredMenu.prototype.handleFilterEvent=function(){this.filterItems_(this.filterInput_.value);var a=this.getHighlighted();(!a||!a.isVisible())&&this.highlightFirst();this.dispatchEvent(goog.ui.FilteredMenu.EventType.FILTER_CHANGED)};
goog.ui.FilteredMenu.prototype.filterItems_=function(a){if(this.filterStr_!=a){this.labelEl_&&(this.labelEl_.style.visibility=""==a?"visible":"hidden");if(this.allowMultiple_&&this.enteredItems_){var b=a.match(/^(.+),[ ]*([^,]*)$/),c=b&&b[1]?b[1].split(","):[];if(","==a.substr(a.length-1,1)||c.length!=this.enteredItems_.length){var d=c[c.length-1]||"";if(this.getHighlighted()&&""!=d){var e=this.getHighlighted().getCaption();0==e.toLowerCase().indexOf(d.toLowerCase())&&(c[c.length-1]=e,this.filterInput_.value=
c.join(",")+",")}this.enteredItems_=c;this.dispatchEvent(goog.ui.Component.EventType.CHANGE);this.setHighlightedIndex(-1)}b&&(a=2<b.length?goog.string.trim(b[2]):"")}b=RegExp("(^|[- ,_/.:])"+goog.string.regExpEscape(a),"i");for(d=this.filterFromIndex_;c=this.getChildAt(d);d++)if(c instanceof goog.ui.FilterObservingMenuItem)c.callObserver(a);else if(!this.hasPersistentVisibility(c))if(e=c.getCaption()){var f=e.match(b);""==a||f?(c.setVisible(!0),(f=e.indexOf(f[0]))&&f++,""==a?c.setContent(e):c.setContent(this.getDomHelper().createDom("span",
null,e.substr(0,f),this.getDomHelper().createDom("b",null,e.substr(f,a.length)),e.substr(f+a.length,e.length-a.length-f)))):c.setVisible(!1)}else c.setVisible(""==a);this.filterStr_=a}};
goog.ui.FilteredMenu.prototype.handleKeyEvent=function(a){if(a.shiftKey||a.ctrlKey||a.altKey||a.keyCode==goog.events.KeyCodes.HOME||a.keyCode==goog.events.KeyCodes.END)return!1;return a.keyCode==goog.events.KeyCodes.ESC?(this.dispatchEvent(goog.ui.Component.EventType.BLUR),!0):goog.ui.FilteredMenu.superClass_.handleKeyEvent.call(this,a)};
goog.ui.FilteredMenu.prototype.setHighlightedIndex=function(a){goog.ui.FilteredMenu.superClass_.setHighlightedIndex.call(this,a);var a=this.getContentElement(),b=this.getHighlighted()?this.getHighlighted().getElement():null;if(b&&goog.dom.contains(a,b)){var c=goog.userAgent.IE&&!goog.userAgent.isVersion(8)?0:a.offsetTop,d=b.offsetTop+b.offsetHeight-c-(a.clientHeight+a.scrollTop)+1;a.scrollTop+=Math.max(d,0);d=a.scrollTop-(b.offsetTop-c)+1;a.scrollTop-=Math.max(d,0)}};
goog.ui.FilteredMenu.prototype.onFilterLabelClick_=function(){this.filterInput_.focus()};goog.ui.FilteredMenu.prototype.getContentElement=function(){return this.contentElement_||this.getElement()};goog.ui.FilteredMenu.prototype.getFilterInputElement=function(){return this.filterInput_||null};
goog.ui.FilteredMenu.prototype.decorateInternal=function(a){this.setElementInternal(a);this.decorateContent(a);a=this.getDomHelper().getElementsByTagNameAndClass("div",this.getRenderer().getCssClass()+"-filter",a)[0];this.labelEl_=goog.dom.getFirstElementChild(a);this.filterInput_=goog.dom.getNextElementSibling(this.labelEl_);this.contentElement_=goog.dom.getNextElementSibling(a);this.getRenderer().decorateChildren(this,a.parentNode,this.contentElement_);this.initFilterInput_()};fyre.v1.ui={};
fyre.v1.ui.FyreComponentFactory=function(a){var b,c=function(){a.apply(this,arguments)};goog.inherits(c,a);b=a.prototype;c.prototype.initialize=function(){};c.prototype.decorateInternal=function(a){this.element_||(this.element_=a,this.$dom_=new fyre.v1.dom(a))};c.prototype.createDom=function(){b.createDom.call(this);this.createDomInternal()};c.prototype.decorate=function(a,c){c&&(this.element_=a,this.$dom_=new fyre.v1.dom(a),this.createDomInternal());b.decorate.call(this,a)};c.prototype.createDomInternal=function(){this.$dom_=
new fyre.v1.dom(this.element_)};c.EVENTS=c.prototype.EVENTS={ACTION:"action"};c.prototype.makeTrigger=function(){var a=goog.array.clone(arguments);a.splice(0,0,this.trigger,this);return goog.bind.apply(null,a)};c.prototype.disposeInternal=function(){this.off();this.$dom_=null;b.disposeInternal.call(this)};c.prototype.dispose=function(a){a&&this.removeDomInternal();b.dispose.call(this)};c.prototype.removeDomInternal=function(){this.wasDecorated_&&this.element_&&goog.dom.removeChildren(this.element_)};
goog.object.extend(c.prototype,fyre.v1.lib.Backbone.Events);return c};fyre.v1.ui.FyreComponent=fyre.v1.ui.FyreComponentFactory(goog.ui.Component);fyre.v1.ui.FyreFilteredMenu=fyre.v1.ui.FyreComponentFactory(goog.ui.FilteredMenu);fyre.v1.ui.CharCountdown=function(a,b){this.textarea_=a;this.maxChars_=b||160;this.template_=fyre.templates.core.misc.charCountdown;fyre.v1.ui.FyreComponent.call(this)};goog.inherits(fyre.v1.ui.CharCountdown,fyre.v1.ui.FyreComponent);fyre.v1.ui.CharCountdown.prototype.createDom=function(){this.$dom_=fyre.v1.dom.create("span");this.element_=this.$dom_.element;this.createDomInternal()};
fyre.v1.ui.CharCountdown.prototype.createDomInternal=function(){fyre.v1.ui.CharCountdown.superClass_.createDomInternal.call(this);this.setContent(this.textarea_.value.length);goog.dom.setProperties(this.textarea_,{maxlength:this.maxChars_})};fyre.v1.ui.CharCountdown.prototype.enterDocument=function(){fyre.v1.ui.CharCountdown.superClass_.enterDocument.call(this);var a=[goog.events.EventType.KEYUP,goog.events.EventType.BLUR];this.getHandler().listen(this.textarea_,a,this.handleKeyUp,!1,this)};
fyre.v1.ui.CharCountdown.prototype.setContent=function(a){this.element_.innerHTML=this.template_({characters_left:this.maxChars_-a})};fyre.v1.ui.CharCountdown.prototype.handleKeyUp=function(a){var b=this.textarea_.value.length;this.maxChars_===b&&(a.preventDefault(),a.stopPropagation());this.setContent(b)};fyre.conv.view={};fyre.conv.view.MentionBoxComponent=function(a,b,c){this.model_=a;this.view_=b;this.characterLimit_=!1;this.enabled=!0;fyre.v1.ui.FyreComponent.call(this,c)};goog.inherits(fyre.conv.view.MentionBoxComponent,fyre.v1.ui.FyreComponent);
fyre.conv.view.MentionBoxComponent.prototype.getSoyData=function(){var a=fyre.v1.model.Mention.ATTRIBUTES,b=this.view_.PROVIDERS,c=fyre.conv.i18n.textEnumeration,d={displayName:this.model_.get(a.DISPLAY_NAME)},a=this.model_.get(a.PROVIDER);d.strings={defaultText:c.get(c.KEYS.MENTION_DEFAULT_TEXT),subtitle:""};switch(a){case b.FB:d.strings.subtitle=c.get(c.KEYS.MENTION_SUBTITLE_FACEBOOK);break;case b.TW:d.strings.subtitle=c.get(c.KEYS.MENTION_SUBTITLE_TWITTER);this.characterLimit_=!0;break;case b.LF:break;
default:goog.asserts.fail("Provider not found: "+a)}d.shareLink=this.view_.shareLink;d.characterLimit=this.characterLimit_;d.isFirst=1===this.view_.counts[a];return d};
fyre.conv.view.MentionBoxComponent.prototype.createDomInternal=function(){fyre.conv.view.MentionBoxComponent.superClass_.createDomInternal.call(this);var a=this.getSoyData();this.$dom_.html(fyre.templates.conv.misc.mentionModal(a));this.closeBtn_=this.$dom_.getByClass("fyre-mention-close");this.userName_=this.$dom_.getByClass("fyre-modal-username");this.textarea_=this.$dom_.getByClass("fyre-modal-mentiontext");this.charCountdownElm_=this.$dom_.getByClass("fyre-modal-charcounter")};
fyre.conv.view.MentionBoxComponent.prototype.enterDocument=function(){fyre.conv.view.MentionBoxComponent.superClass_.enterDocument.call(this);this.characterLimit_&&(this.charCountdown_=new fyre.v1.ui.CharCountdown(this.textarea_.element),this.charCountdown_.decorate(this.charCountdownElm_.element,!0));this.getHandler().listen(this.closeBtn_.element,goog.events.EventType.CLICK,this.handleCloseClick,!1,this)};
fyre.conv.view.MentionBoxComponent.prototype.handleCloseClick=function(a){a.preventDefault();this.closeBtn_.toggleClass("fyre-mention-close-disable");this.userName_.toggleClass("fyre-modal-username-disable");this.textarea_.showToggle();this.charCountdownElm_&&this.charCountdownElm_.showToggle();this.enabled=!this.enabled};
fyre.conv.view.MentionBoxComponent.prototype.toExportFormat=function(){var a=this.model_.ATTRIBUTES;return{provider:this.model_.get(a.PROVIDER),display_name:this.model_.get(a.DISPLAY_NAME),message:goog.string.trim(this.textarea_.element.value),uid:this.model_.get(a.UID)}};goog.fx.Dragger=function(a,b,c){goog.events.EventTarget.call(this);this.target=a;this.handle=b||a;this.limits=c||new goog.math.Rect(NaN,NaN,NaN,NaN);this.document_=goog.dom.getOwnerDocument(a);this.eventHandler_=new goog.events.EventHandler(this);goog.events.listen(this.handle,[goog.events.EventType.TOUCHSTART,goog.events.EventType.MOUSEDOWN],this.startDrag,!1,this)};goog.inherits(goog.fx.Dragger,goog.events.EventTarget);goog.fx.Dragger.HAS_SET_CAPTURE_=goog.userAgent.IE||goog.userAgent.GECKO&&goog.userAgent.isVersion("1.9.3");
goog.fx.Dragger.EventType={EARLY_CANCEL:"earlycancel",START:"start",BEFOREDRAG:"beforedrag",DRAG:"drag",END:"end"};goog.fx.Dragger.prototype.clientX=0;goog.fx.Dragger.prototype.clientY=0;goog.fx.Dragger.prototype.screenX=0;goog.fx.Dragger.prototype.screenY=0;goog.fx.Dragger.prototype.startX=0;goog.fx.Dragger.prototype.startY=0;goog.fx.Dragger.prototype.deltaX=0;goog.fx.Dragger.prototype.deltaY=0;goog.fx.Dragger.prototype.enabled_=!0;goog.fx.Dragger.prototype.dragging_=!1;
goog.fx.Dragger.prototype.hysteresisDistanceSquared_=0;goog.fx.Dragger.prototype.mouseDownTime_=0;goog.fx.Dragger.prototype.ieDragStartCancellingOn_=!1;goog.fx.Dragger.prototype.getHandler=function(){return this.eventHandler_};goog.fx.Dragger.prototype.setLimits=function(a){this.limits=a||new goog.math.Rect(NaN,NaN,NaN,NaN)};goog.fx.Dragger.prototype.setHysteresis=function(a){this.hysteresisDistanceSquared_=Math.pow(a,2)};goog.fx.Dragger.prototype.getHysteresis=function(){return Math.sqrt(this.hysteresisDistanceSquared_)};
goog.fx.Dragger.prototype.setScrollTarget=function(a){this.scrollTarget_=a};goog.fx.Dragger.prototype.setCancelIeDragStart=function(a){this.ieDragStartCancellingOn_=a};goog.fx.Dragger.prototype.getEnabled=function(){return this.enabled_};goog.fx.Dragger.prototype.setEnabled=function(a){this.enabled_=a};
goog.fx.Dragger.prototype.disposeInternal=function(){goog.fx.Dragger.superClass_.disposeInternal.call(this);goog.events.unlisten(this.handle,[goog.events.EventType.TOUCHSTART,goog.events.EventType.MOUSEDOWN],this.startDrag,!1,this);this.eventHandler_.dispose();delete this.target;delete this.handle;delete this.eventHandler_};
goog.fx.Dragger.prototype.startDrag=function(a){var b=a.type==goog.events.EventType.MOUSEDOWN;if(this.enabled_&&!this.dragging_&&(!b||a.isMouseActionButton())){this.maybeReinitTouchEvent_(a);if(0==this.hysteresisDistanceSquared_)if(this.initializeDrag_(a),this.dragging_)a.preventDefault();else return;else a.preventDefault();this.setupDragHandlers();this.clientX=this.startX=a.clientX;this.clientY=this.startY=a.clientY;this.screenX=a.screenX;this.screenY=a.screenY;this.deltaX=this.target.offsetLeft;
this.deltaY=this.target.offsetTop;this.pageScroll=goog.dom.getDomHelper(this.document_).getDocumentScroll();this.mouseDownTime_=goog.now()}else this.dispatchEvent(goog.fx.Dragger.EventType.EARLY_CANCEL)};
goog.fx.Dragger.prototype.setupDragHandlers=function(){var a=this.document_,b=a.documentElement,c=!goog.fx.Dragger.HAS_SET_CAPTURE_;this.eventHandler_.listen(a,[goog.events.EventType.TOUCHMOVE,goog.events.EventType.MOUSEMOVE],this.handleMove_,c);this.eventHandler_.listen(a,[goog.events.EventType.TOUCHEND,goog.events.EventType.MOUSEUP],this.endDrag,c);goog.fx.Dragger.HAS_SET_CAPTURE_?(b.setCapture(!1),this.eventHandler_.listen(b,goog.events.EventType.LOSECAPTURE,this.endDrag)):this.eventHandler_.listen(goog.dom.getWindow(a),
goog.events.EventType.BLUR,this.endDrag);goog.userAgent.IE&&this.ieDragStartCancellingOn_&&this.eventHandler_.listen(a,goog.events.EventType.DRAGSTART,goog.events.Event.preventDefault);this.scrollTarget_&&this.eventHandler_.listen(this.scrollTarget_,goog.events.EventType.SCROLL,this.onScroll_,c)};goog.fx.Dragger.prototype.initializeDrag_=function(a){!1!==this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.START,this,a.clientX,a.clientY,a))&&(this.dragging_=!0)};
goog.fx.Dragger.prototype.endDrag=function(a,b){this.eventHandler_.removeAll();goog.fx.Dragger.HAS_SET_CAPTURE_&&this.document_.releaseCapture();var c=this.limitX(this.deltaX),d=this.limitY(this.deltaY);this.dragging_?(this.maybeReinitTouchEvent_(a),this.dragging_=!1,this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.END,this,a.clientX,a.clientY,a,c,d,b||a.type==goog.events.EventType.TOUCHCANCEL))):this.dispatchEvent(goog.fx.Dragger.EventType.EARLY_CANCEL);(a.type==goog.events.EventType.TOUCHEND||
a.type==goog.events.EventType.TOUCHCANCEL)&&a.preventDefault()};goog.fx.Dragger.prototype.endDragCancel=function(a){this.endDrag(a,!0)};goog.fx.Dragger.prototype.maybeReinitTouchEvent_=function(a){var b=a.type;b==goog.events.EventType.TOUCHSTART||b==goog.events.EventType.TOUCHMOVE?a.init(a.getBrowserEvent().targetTouches[0],a.currentTarget):(b==goog.events.EventType.TOUCHEND||b==goog.events.EventType.TOUCHCANCEL)&&a.init(a.getBrowserEvent().changedTouches[0],a.currentTarget)};
goog.fx.Dragger.prototype.handleMove_=function(a){if(this.enabled_){this.maybeReinitTouchEvent_(a);var b=a.clientX-this.clientX,c=a.clientY-this.clientY;this.clientX=a.clientX;this.clientY=a.clientY;this.screenX=a.screenX;this.screenY=a.screenY;if(!this.dragging_){var d=this.startX-this.clientX,e=this.startY-this.clientY;if(d*d+e*e>this.hysteresisDistanceSquared_&&(this.initializeDrag_(a),!this.dragging_)){this.endDrag(a);return}}c=this.calculatePosition_(b,c);b=c.x;c=c.y;this.dragging_&&!1!==this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.BEFOREDRAG,
this,a.clientX,a.clientY,a,b,c))&&(this.doDrag(a,b,c,!1),a.preventDefault())}};goog.fx.Dragger.prototype.calculatePosition_=function(a,b){var c=goog.dom.getDomHelper(this.document_).getDocumentScroll(),a=a+(c.x-this.pageScroll.x),b=b+(c.y-this.pageScroll.y);this.pageScroll=c;this.deltaX+=a;this.deltaY+=b;var c=this.limitX(this.deltaX),d=this.limitY(this.deltaY);return new goog.math.Coordinate(c,d)};
goog.fx.Dragger.prototype.onScroll_=function(a){var b=this.calculatePosition_(0,0);a.clientX=this.clientX;a.clientY=this.clientY;this.doDrag(a,b.x,b.y,!0)};goog.fx.Dragger.prototype.doDrag=function(a,b,c){this.defaultAction(b,c);this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.DRAG,this,a.clientX,a.clientY,a,b,c))};
goog.fx.Dragger.prototype.limitX=function(a){var b=this.limits,c=!isNaN(b.left)?b.left:null,b=!isNaN(b.width)?b.width:0;return Math.min(null!=c?c+b:Infinity,Math.max(null!=c?c:-Infinity,a))};goog.fx.Dragger.prototype.limitY=function(a){var b=this.limits,c=!isNaN(b.top)?b.top:null,b=!isNaN(b.height)?b.height:0;return Math.min(null!=c?c+b:Infinity,Math.max(null!=c?c:-Infinity,a))};goog.fx.Dragger.prototype.defaultAction=function(a,b){this.target.style.left=a+"px";this.target.style.top=b+"px"};
goog.fx.DragEvent=function(a,b,c,d,e,f,g,h){goog.events.Event.call(this,a);this.clientX=c;this.clientY=d;this.browserEvent=e;this.left=goog.isDef(f)?f:b.deltaX;this.top=goog.isDef(g)?g:b.deltaY;this.dragger=b;this.dragCanceled=!!h};goog.inherits(goog.fx.DragEvent,goog.events.Event);goog.dom.iframe={};goog.dom.iframe.BLANK_SOURCE='javascript:""';goog.dom.iframe.STYLES_="border:0;vertical-align:bottom;";goog.dom.iframe.createBlank=function(a,b){return a.createDom("iframe",{frameborder:0,style:goog.dom.iframe.STYLES_+(b||""),src:goog.dom.iframe.BLANK_SOURCE})};goog.dom.iframe.writeContent=function(a,b){var c=goog.dom.getFrameContentDocument(a);c.open();c.write(b);c.close()};
goog.dom.iframe.createWithContent=function(a,b,c,d,e){var f=goog.dom.getDomHelper(a),g=[];e||g.push("<!DOCTYPE html>");g.push("<html><head>",b,"</head><body>",c,"</body></html>");b=goog.dom.iframe.createBlank(f,d);a.appendChild(b);goog.dom.iframe.writeContent(b,g.join(""));return b};goog.events.FocusHandler=function(a){goog.events.EventTarget.call(this);this.element_=a;a=goog.userAgent.IE?"focusout":"blur";this.listenKeyIn_=goog.events.listen(this.element_,goog.userAgent.IE?"focusin":"focus",this,!goog.userAgent.IE);this.listenKeyOut_=goog.events.listen(this.element_,a,this,!goog.userAgent.IE)};goog.inherits(goog.events.FocusHandler,goog.events.EventTarget);goog.events.FocusHandler.EventType={FOCUSIN:"focusin",FOCUSOUT:"focusout"};
goog.events.FocusHandler.prototype.handleEvent=function(a){var b=a.getBrowserEvent(),b=new goog.events.BrowserEvent(b);b.type="focusin"==a.type||"focus"==a.type?goog.events.FocusHandler.EventType.FOCUSIN:goog.events.FocusHandler.EventType.FOCUSOUT;try{this.dispatchEvent(b)}finally{b.dispose()}};
goog.events.FocusHandler.prototype.disposeInternal=function(){goog.events.FocusHandler.superClass_.disposeInternal.call(this);goog.events.unlistenByKey(this.listenKeyIn_);goog.events.unlistenByKey(this.listenKeyOut_);delete this.element_};goog.ui.PopupBase=function(a,b){goog.events.EventTarget.call(this);this.handler_=new goog.events.EventHandler(this);this.setElement(a||null);b&&this.setType(b)};goog.inherits(goog.ui.PopupBase,goog.events.EventTarget);goog.ui.PopupBase.Type={TOGGLE_DISPLAY:"toggle_display",MOVE_OFFSCREEN:"move_offscreen"};goog.ui.PopupBase.prototype.element_=null;goog.ui.PopupBase.prototype.autoHide_=!0;goog.ui.PopupBase.prototype.autoHideRegion_=null;goog.ui.PopupBase.prototype.isVisible_=!1;
goog.ui.PopupBase.prototype.shouldHideAsync_=!1;goog.ui.PopupBase.prototype.lastShowTime_=-1;goog.ui.PopupBase.prototype.lastHideTime_=-1;goog.ui.PopupBase.prototype.hideOnEscape_=!1;goog.ui.PopupBase.prototype.enableCrossIframeDismissal_=!0;goog.ui.PopupBase.prototype.type_=goog.ui.PopupBase.Type.TOGGLE_DISPLAY;goog.ui.PopupBase.EventType={BEFORE_SHOW:"beforeshow",SHOW:"show",BEFORE_HIDE:"beforehide",HIDE:"hide"};goog.ui.PopupBase.DEBOUNCE_DELAY_MS=150;goog.ui.PopupBase.prototype.getType=function(){return this.type_};
goog.ui.PopupBase.prototype.setType=function(a){this.type_=a};goog.ui.PopupBase.prototype.shouldHideAsync=function(){return this.shouldHideAsync_};goog.ui.PopupBase.prototype.setShouldHideAsync=function(a){this.shouldHideAsync_=a};goog.ui.PopupBase.prototype.getElement=function(){return this.element_};goog.ui.PopupBase.prototype.setElement=function(a){this.ensureNotVisible_();this.element_=a};goog.ui.PopupBase.prototype.getAutoHide=function(){return this.autoHide_};
goog.ui.PopupBase.prototype.setAutoHide=function(a){this.ensureNotVisible_();this.autoHide_=a};goog.ui.PopupBase.prototype.getHideOnEscape=function(){return this.hideOnEscape_};goog.ui.PopupBase.prototype.setHideOnEscape=function(a){this.ensureNotVisible_();this.hideOnEscape_=a};goog.ui.PopupBase.prototype.getEnableCrossIframeDismissal=function(){return this.enableCrossIframeDismissal_};goog.ui.PopupBase.prototype.setEnableCrossIframeDismissal=function(a){this.enableCrossIframeDismissal_=a};
goog.ui.PopupBase.prototype.getAutoHideRegion=function(){return this.autoHideRegion_};goog.ui.PopupBase.prototype.setAutoHideRegion=function(a){this.autoHideRegion_=a};goog.ui.PopupBase.prototype.setTransition=function(a,b){this.showTransition_=a;this.hideTransition_=b};goog.ui.PopupBase.prototype.getLastShowTime=function(){return this.lastShowTime_};goog.ui.PopupBase.prototype.getLastHideTime=function(){return this.lastHideTime_};
goog.ui.PopupBase.prototype.ensureNotVisible_=function(){if(this.isVisible_)throw Error("Can not change this state of the popup while showing.");};goog.ui.PopupBase.prototype.isVisible=function(){return this.isVisible_};goog.ui.PopupBase.prototype.isOrWasRecentlyVisible=function(){return this.isVisible_||goog.now()-this.lastHideTime_<goog.ui.PopupBase.DEBOUNCE_DELAY_MS};
goog.ui.PopupBase.prototype.setVisible=function(a){this.showTransition_&&this.showTransition_.stop();this.hideTransition_&&this.hideTransition_.stop();a?this.show_():this.hide_()};goog.ui.PopupBase.prototype.reposition=goog.nullFunction;
goog.ui.PopupBase.prototype.show_=function(){if(!this.isVisible_&&this.onBeforeShow()){if(!this.element_)throw Error("Caller must call setElement before trying to show the popup");this.reposition();var a=goog.dom.getOwnerDocument(this.element_);this.hideOnEscape_&&this.handler_.listen(a,goog.events.EventType.KEYDOWN,this.onDocumentKeyDown_,!0);if(this.autoHide_)if(this.handler_.listen(a,goog.events.EventType.MOUSEDOWN,this.onDocumentMouseDown_,!0),goog.userAgent.IE){var b;try{b=a.activeElement}catch(c){}for(;b&&
"IFRAME"==b.nodeName;){try{var d=goog.dom.getFrameContentDocument(b)}catch(e){break}a=d;b=a.activeElement}this.handler_.listen(a,goog.events.EventType.MOUSEDOWN,this.onDocumentMouseDown_,!0);this.handler_.listen(a,goog.events.EventType.DEACTIVATE,this.onDocumentBlur_)}else this.handler_.listen(a,goog.events.EventType.BLUR,this.onDocumentBlur_);this.type_==goog.ui.PopupBase.Type.TOGGLE_DISPLAY?this.showPopupElement():this.type_==goog.ui.PopupBase.Type.MOVE_OFFSCREEN&&this.reposition();this.isVisible_=
!0;if(this.showTransition_)goog.events.listenOnce(this.showTransition_,goog.fx.Transition.EventType.END,this.onShow_,!1,this),this.showTransition_.play();else this.onShow_()}};
goog.ui.PopupBase.prototype.hide_=function(a){if(!this.isVisible_||!this.onBeforeHide_(a))return!1;this.handler_&&this.handler_.removeAll();this.hideTransition_?(goog.events.listenOnce(this.hideTransition_,goog.fx.Transition.EventType.END,goog.partial(this.continueHidingPopup_,a),!1,this),this.hideTransition_.play()):this.continueHidingPopup_(a);return!0};
goog.ui.PopupBase.prototype.continueHidingPopup_=function(a){this.type_==goog.ui.PopupBase.Type.TOGGLE_DISPLAY?this.shouldHideAsync_?goog.Timer.callOnce(this.hidePopupElement_,0,this):this.hidePopupElement_():this.type_==goog.ui.PopupBase.Type.MOVE_OFFSCREEN&&this.moveOffscreen_();this.isVisible_=!1;this.onHide_(a)};goog.ui.PopupBase.prototype.showPopupElement=function(){this.element_.style.visibility="visible";goog.style.showElement(this.element_,!0)};
goog.ui.PopupBase.prototype.hidePopupElement_=function(){this.element_.style.visibility="hidden";goog.style.showElement(this.element_,!1)};goog.ui.PopupBase.prototype.moveOffscreen_=function(){this.element_.style.left="-200px";this.element_.style.top="-200px"};goog.ui.PopupBase.prototype.onBeforeShow=function(){return this.dispatchEvent(goog.ui.PopupBase.EventType.BEFORE_SHOW)};goog.ui.PopupBase.prototype.onShow_=function(){this.lastShowTime_=goog.now();this.lastHideTime_=-1;this.dispatchEvent(goog.ui.PopupBase.EventType.SHOW)};
goog.ui.PopupBase.prototype.onBeforeHide_=function(a){return this.dispatchEvent({type:goog.ui.PopupBase.EventType.BEFORE_HIDE,target:a})};goog.ui.PopupBase.prototype.onHide_=function(a){this.lastHideTime_=goog.now();this.dispatchEvent({type:goog.ui.PopupBase.EventType.HIDE,target:a})};goog.ui.PopupBase.prototype.onDocumentMouseDown_=function(a){a=a.target;!goog.dom.contains(this.element_,a)&&(!this.autoHideRegion_||goog.dom.contains(this.autoHideRegion_,a))&&!this.shouldDebounce_()&&this.hide_(a)};
goog.ui.PopupBase.prototype.onDocumentKeyDown_=function(a){a.keyCode==goog.events.KeyCodes.ESC&&this.hide_(a.target)&&(a.preventDefault(),a.stopPropagation())};goog.ui.PopupBase.prototype.onDocumentBlur_=function(a){if(this.enableCrossIframeDismissal_){var b=goog.dom.getOwnerDocument(this.element_);if(goog.userAgent.IE||goog.userAgent.OPERA){if(a=b.activeElement,!a||goog.dom.contains(this.element_,a)||"BODY"==a.tagName)return}else if(a.target!=b)return;this.shouldDebounce_()||this.hide_()}};
goog.ui.PopupBase.prototype.shouldDebounce_=function(){return goog.now()-this.lastShowTime_<goog.ui.PopupBase.DEBOUNCE_DELAY_MS};goog.ui.PopupBase.prototype.disposeInternal=function(){goog.ui.PopupBase.superClass_.disposeInternal.call(this);this.handler_.dispose();goog.dispose(this.showTransition_);goog.dispose(this.hideTransition_);delete this.element_;delete this.handler_};goog.ui.ModalPopup=function(a,b){goog.ui.Component.call(this,b);this.useIframeMask_=!!a};goog.inherits(goog.ui.ModalPopup,goog.ui.Component);goog.ui.ModalPopup.prototype.focusHandler_=null;goog.ui.ModalPopup.prototype.visible_=!1;goog.ui.ModalPopup.prototype.bgEl_=null;goog.ui.ModalPopup.prototype.bgIframeEl_=null;goog.ui.ModalPopup.prototype.tabCatcherElement_=null;goog.ui.ModalPopup.prototype.getCssClass=function(){return"goog-modalpopup"};goog.ui.ModalPopup.prototype.getBackgroundIframe=function(){return this.bgIframeEl_};
goog.ui.ModalPopup.prototype.getBackgroundElement=function(){return this.bgEl_};goog.ui.ModalPopup.prototype.createDom=function(){goog.ui.ModalPopup.superClass_.createDom.call(this);var a=this.getElement();goog.dom.classes.add(a,this.getCssClass());goog.dom.setFocusableTabIndex(a,!0);goog.style.showElement(a,!1);this.manageBackgroundDom_();this.createTabCatcher_()};
goog.ui.ModalPopup.prototype.manageBackgroundDom_=function(){this.useIframeMask_&&!this.bgIframeEl_&&(this.bgIframeEl_=goog.dom.iframe.createBlank(this.getDomHelper()),this.bgIframeEl_.className=this.getCssClass()+"-bg",goog.style.showElement(this.bgIframeEl_,!1),goog.style.setOpacity(this.bgIframeEl_,0));this.bgEl_||(this.bgEl_=this.getDomHelper().createDom("div",this.getCssClass()+"-bg"),goog.style.showElement(this.bgEl_,!1))};
goog.ui.ModalPopup.prototype.createTabCatcher_=function(){this.tabCatcherElement_||(this.tabCatcherElement_=this.getDomHelper().createElement("span"),goog.style.showElement(this.tabCatcherElement_,!1),goog.dom.setFocusableTabIndex(this.tabCatcherElement_,!0),this.tabCatcherElement_.style.position="absolute")};
goog.ui.ModalPopup.prototype.renderBackground_=function(){goog.asserts.assert(!!this.bgEl_,"Background element must not be null.");this.bgIframeEl_&&goog.dom.insertSiblingBefore(this.bgIframeEl_,this.getElement());goog.dom.insertSiblingBefore(this.bgEl_,this.getElement())};goog.ui.ModalPopup.prototype.canDecorate=function(a){return!!a&&a.tagName==goog.dom.TagName.DIV};
goog.ui.ModalPopup.prototype.decorateInternal=function(a){goog.ui.ModalPopup.superClass_.decorateInternal.call(this,a);goog.dom.classes.add(this.getElement(),this.getCssClass());this.manageBackgroundDom_();this.createTabCatcher_();goog.style.showElement(this.getElement(),!1)};
goog.ui.ModalPopup.prototype.enterDocument=function(){this.renderBackground_();goog.ui.ModalPopup.superClass_.enterDocument.call(this);goog.dom.insertSiblingAfter(this.tabCatcherElement_,this.getElement());this.focusHandler_=new goog.events.FocusHandler(this.getDomHelper().getDocument());this.getHandler().listen(this.focusHandler_,goog.events.FocusHandler.EventType.FOCUSIN,this.onFocus_)};
goog.ui.ModalPopup.prototype.exitDocument=function(){this.isVisible()&&this.setVisible(!1);goog.dispose(this.focusHandler_);goog.ui.ModalPopup.superClass_.exitDocument.call(this);goog.dom.removeNode(this.bgIframeEl_);goog.dom.removeNode(this.bgEl_);goog.dom.removeNode(this.tabCatcherElement_)};
goog.ui.ModalPopup.prototype.setVisible=function(a){goog.asserts.assert(this.isInDocument(),"ModalPopup must be rendered first.");a!=this.visible_&&(this.popupShowTransition_&&this.popupShowTransition_.stop(),this.bgShowTransition_&&this.bgShowTransition_.stop(),this.popupHideTransition_&&this.popupHideTransition_.stop(),this.bgHideTransition_&&this.bgHideTransition_.stop(),a?this.show_():this.hide_())};
goog.ui.ModalPopup.prototype.setTransition=function(a,b,c,d){this.popupShowTransition_=a;this.popupHideTransition_=b;this.bgShowTransition_=c;this.bgHideTransition_=d};
goog.ui.ModalPopup.prototype.show_=function(){if(this.dispatchEvent(goog.ui.PopupBase.EventType.BEFORE_SHOW))if(this.resizeBackground_(),this.reposition(),this.getHandler().listen(this.getDomHelper().getWindow(),goog.events.EventType.RESIZE,this.resizeBackground_),this.showPopupElement_(!0),this.focus(),this.visible_=!0,this.popupShowTransition_&&this.bgShowTransition_)goog.events.listenOnce(this.popupShowTransition_,goog.fx.Transition.EventType.END,this.onShow_,!1,this),this.popupShowTransition_.play(),
this.bgShowTransition_.play();else this.onShow_()};goog.ui.ModalPopup.prototype.hide_=function(){if(this.dispatchEvent(goog.ui.PopupBase.EventType.BEFORE_HIDE))if(this.getHandler().unlisten(this.getDomHelper().getWindow(),goog.events.EventType.RESIZE,this.resizeBackground_),this.popupHideTransition_&&this.bgHideTransition_)goog.events.listenOnce(this.popupHideTransition_,goog.fx.Transition.EventType.END,this.onHide_,!1,this),this.popupHideTransition_.play(),this.bgHideTransition_.play();else this.onHide_()};
goog.ui.ModalPopup.prototype.showPopupElement_=function(a){this.bgIframeEl_&&goog.style.showElement(this.bgIframeEl_,a);this.bgEl_&&goog.style.showElement(this.bgEl_,a);goog.style.showElement(this.getElement(),a);goog.style.showElement(this.tabCatcherElement_,a)};goog.ui.ModalPopup.prototype.onShow_=function(){this.dispatchEvent(goog.ui.PopupBase.EventType.SHOW)};goog.ui.ModalPopup.prototype.onHide_=function(){this.showPopupElement_(!1);this.visible_=!1;this.dispatchEvent(goog.ui.PopupBase.EventType.HIDE)};
goog.ui.ModalPopup.prototype.isVisible=function(){return this.visible_};goog.ui.ModalPopup.prototype.focus=function(){this.focusElement_()};
goog.ui.ModalPopup.prototype.resizeBackground_=function(){this.bgIframeEl_&&goog.style.showElement(this.bgIframeEl_,!1);this.bgEl_&&goog.style.showElement(this.bgEl_,!1);var a=this.getDomHelper().getDocument(),b=goog.dom.getWindow(a)||window,c=goog.dom.getViewportSize(b),b=Math.max(a.body.scrollWidth,c.width),a=Math.max(a.body.scrollHeight,c.height);this.bgIframeEl_&&(goog.style.showElement(this.bgIframeEl_,!0),goog.style.setSize(this.bgIframeEl_,b,a));this.bgEl_&&(goog.style.showElement(this.bgEl_,
!0),goog.style.setSize(this.bgEl_,b,a))};
goog.ui.ModalPopup.prototype.reposition=function(){var a=this.getDomHelper().getDocument(),b=goog.dom.getWindow(a)||window;if("fixed"==goog.style.getComputedPosition(this.getElement()))var c=a=0;else c=this.getDomHelper().getDocumentScroll(),a=c.x,c=c.y;var d=goog.style.getSize(this.getElement()),b=goog.dom.getViewportSize(b),a=Math.max(a+b.width/2-d.width/2,0),c=Math.max(c+b.height/2-d.height/2,0);goog.style.setPosition(this.getElement(),a,c);goog.style.setPosition(this.tabCatcherElement_,a,c)};
goog.ui.ModalPopup.prototype.onFocus_=function(a){a.target==this.tabCatcherElement_&&goog.Timer.callOnce(this.focusElement_,0,this)};goog.ui.ModalPopup.prototype.focusElement_=function(){try{goog.userAgent.IE&&this.getDomHelper().getDocument().body.focus(),this.getElement().focus()}catch(a){}};
goog.ui.ModalPopup.prototype.disposeInternal=function(){goog.dispose(this.popupShowTransition_);this.popupShowTransition_=null;goog.dispose(this.popupHideTransition_);this.popupHideTransition_=null;goog.dispose(this.bgShowTransition_);this.bgShowTransition_=null;goog.dispose(this.bgHideTransition_);this.bgHideTransition_=null;goog.ui.ModalPopup.superClass_.disposeInternal.call(this)};goog.ui.Dialog=function(a,b,c){goog.ui.ModalPopup.call(this,b,c);this.class_=a||"modal-dialog";this.buttons_=goog.ui.Dialog.ButtonSet.createOkCancel()};goog.inherits(goog.ui.Dialog,goog.ui.ModalPopup);goog.ui.Dialog.prototype.escapeToCancel_=!0;goog.ui.Dialog.prototype.hasTitleCloseButton_=!0;goog.ui.Dialog.prototype.modal_=!0;goog.ui.Dialog.prototype.draggable_=!0;goog.ui.Dialog.prototype.backgroundElementOpacity_=0.5;goog.ui.Dialog.prototype.title_="";goog.ui.Dialog.prototype.content_="";
goog.ui.Dialog.prototype.dragger_=null;goog.ui.Dialog.prototype.disposeOnHide_=!1;goog.ui.Dialog.prototype.titleEl_=null;goog.ui.Dialog.prototype.titleTextEl_=null;goog.ui.Dialog.prototype.titleId_=null;goog.ui.Dialog.prototype.titleCloseEl_=null;goog.ui.Dialog.prototype.contentEl_=null;goog.ui.Dialog.prototype.buttonEl_=null;goog.ui.Dialog.prototype.getCssClass=function(){return this.class_};
goog.ui.Dialog.prototype.setTitle=function(a){this.title_=a;this.titleTextEl_&&goog.dom.setTextContent(this.titleTextEl_,a)};goog.ui.Dialog.prototype.getTitle=function(){return this.title_};goog.ui.Dialog.prototype.setContent=function(a){this.content_=a;this.contentEl_&&(this.contentEl_.innerHTML=a)};goog.ui.Dialog.prototype.getContent=function(){return this.content_};goog.ui.Dialog.prototype.renderIfNoDom_=function(){this.getElement()||this.render()};
goog.ui.Dialog.prototype.getContentElement=function(){this.renderIfNoDom_();return this.contentEl_};goog.ui.Dialog.prototype.getTitleElement=function(){this.renderIfNoDom_();return this.titleEl_};goog.ui.Dialog.prototype.getTitleTextElement=function(){this.renderIfNoDom_();return this.titleTextEl_};goog.ui.Dialog.prototype.getTitleCloseElement=function(){this.renderIfNoDom_();return this.titleCloseEl_};goog.ui.Dialog.prototype.getButtonElement=function(){this.renderIfNoDom_();return this.buttonEl_};
goog.ui.Dialog.prototype.getDialogElement=function(){this.renderIfNoDom_();return this.getElement()};goog.ui.Dialog.prototype.getBackgroundElement=function(){this.renderIfNoDom_();return goog.ui.Dialog.superClass_.getBackgroundElement.call(this)};goog.ui.Dialog.prototype.getBackgroundElementOpacity=function(){return this.backgroundElementOpacity_};
goog.ui.Dialog.prototype.setBackgroundElementOpacity=function(a){this.backgroundElementOpacity_=a;this.getElement()&&(a=this.getBackgroundElement())&&goog.style.setOpacity(a,this.backgroundElementOpacity_)};goog.ui.Dialog.prototype.setModal=function(a){a!=this.modal_&&this.setModalInternal_(a)};
goog.ui.Dialog.prototype.setModalInternal_=function(a){this.modal_=a;if(this.isInDocument()){var b=this.getDomHelper(),c=this.getBackgroundElement(),d=this.getBackgroundIframe();a?(d&&b.insertSiblingBefore(d,this.getElement()),b.insertSiblingBefore(c,this.getElement())):(b.removeNode(d),b.removeNode(c))}};goog.ui.Dialog.prototype.getModal=function(){return this.modal_};goog.ui.Dialog.prototype.getClass=function(){return this.getCssClass()};
goog.ui.Dialog.prototype.setDraggable=function(a){this.draggable_=a;this.setDraggingEnabled_(a&&this.isInDocument())};goog.ui.Dialog.prototype.createDragger=function(){return new goog.fx.Dragger(this.getElement(),this.titleEl_)};goog.ui.Dialog.prototype.getDraggable=function(){return this.draggable_};
goog.ui.Dialog.prototype.setDraggingEnabled_=function(a){this.getElement()&&goog.dom.classes.enable(this.titleEl_,this.class_+"-title-draggable",a);a&&!this.dragger_?(this.dragger_=this.createDragger(),goog.dom.classes.add(this.titleEl_,this.class_+"-title-draggable"),goog.events.listen(this.dragger_,goog.fx.Dragger.EventType.START,this.setDraggerLimits_,!1,this)):!a&&this.dragger_&&(this.dragger_.dispose(),this.dragger_=null)};
goog.ui.Dialog.prototype.createDom=function(){goog.ui.Dialog.superClass_.createDom.call(this);var a=this.getElement();goog.asserts.assert(a,"getElement() returns null");var b=this.getDomHelper();this.titleEl_=b.createDom("div",{className:this.class_+"-title",id:this.getId()},this.titleTextEl_=b.createDom("span",this.class_+"-title-text",this.title_),this.titleCloseEl_=b.createDom("span",this.class_+"-title-close"));goog.dom.append(a,this.titleEl_,this.contentEl_=b.createDom("div",this.class_+"-content"),
this.buttonEl_=b.createDom("div",this.class_+"-buttons"));this.titleId_=this.titleEl_.id;goog.dom.a11y.setRole(a,"dialog");goog.dom.a11y.setState(a,"labelledby",this.titleId_||"");this.content_&&(this.contentEl_.innerHTML=this.content_);goog.style.showElement(this.titleCloseEl_,this.hasTitleCloseButton_);this.buttons_&&this.buttons_.attachToElement(this.buttonEl_);goog.style.showElement(this.buttonEl_,!!this.buttons_);this.setBackgroundElementOpacity(this.backgroundElementOpacity_)};
goog.ui.Dialog.prototype.decorateInternal=function(a){goog.ui.Dialog.superClass_.decorateInternal.call(this,a);a=this.class_+"-content";(this.contentEl_=goog.dom.getElementsByTagNameAndClass(null,a,this.getElement())[0])?this.content_=this.contentEl_.innerHTML:(this.contentEl_=this.getDomHelper().createDom("div",a),this.content_&&(this.contentEl_.innerHTML=this.content_),this.getElement().appendChild(this.contentEl_));var a=this.class_+"-title",b=this.class_+"-title-text",c=this.class_+"-title-close";
(this.titleEl_=goog.dom.getElementsByTagNameAndClass(null,a,this.getElement())[0])?(this.titleTextEl_=goog.dom.getElementsByTagNameAndClass(null,b,this.titleEl_)[0],this.titleCloseEl_=goog.dom.getElementsByTagNameAndClass(null,c,this.titleEl_)[0],this.titleEl_.id||(this.titleEl_.id=this.getId())):(this.titleEl_=this.getDomHelper().createDom("div",{className:a,id:this.getId()}),this.getElement().insertBefore(this.titleEl_,this.contentEl_));this.titleId_=this.titleEl_.id;this.titleTextEl_?this.title_=
goog.dom.getTextContent(this.titleTextEl_):(this.titleTextEl_=this.getDomHelper().createDom("span",b,this.title_),this.titleEl_.appendChild(this.titleTextEl_));goog.dom.a11y.setState(this.getElement(),"labelledby",this.titleId_||"");this.titleCloseEl_||(this.titleCloseEl_=this.getDomHelper().createDom("span",c),this.titleEl_.appendChild(this.titleCloseEl_));goog.style.showElement(this.titleCloseEl_,this.hasTitleCloseButton_);a=this.class_+"-buttons";(this.buttonEl_=goog.dom.getElementsByTagNameAndClass(null,
a,this.getElement())[0])?(this.buttons_=new goog.ui.Dialog.ButtonSet(this.getDomHelper()),this.buttons_.decorate(this.buttonEl_)):(this.buttonEl_=this.getDomHelper().createDom("div",a),this.getElement().appendChild(this.buttonEl_),this.buttons_&&this.buttons_.attachToElement(this.buttonEl_),goog.style.showElement(this.buttonEl_,!!this.buttons_));this.setBackgroundElementOpacity(this.backgroundElementOpacity_)};
goog.ui.Dialog.prototype.enterDocument=function(){goog.ui.Dialog.superClass_.enterDocument.call(this);this.getHandler().listen(this,[goog.ui.PopupBase.EventType.SHOW,goog.ui.PopupBase.EventType.HIDE],this.setVisibleInternal_);this.setDraggingEnabled_(this.draggable_);this.getHandler().listen(this.titleCloseEl_,goog.events.EventType.CLICK,this.onTitleCloseClick_);goog.dom.a11y.setRole(this.getElement(),"dialog");""!==this.titleTextEl_.id&&goog.dom.a11y.setState(this.getElement(),"labelledby",this.titleTextEl_.id);
this.modal_||this.setModalInternal_(!1)};goog.ui.Dialog.prototype.exitDocument=function(){this.isVisible()&&this.setVisible(!1);this.setDraggingEnabled_(!1);goog.ui.Dialog.superClass_.exitDocument.call(this)};goog.ui.Dialog.prototype.setVisible=function(a){a!=this.isVisible()&&(this.isInDocument()||this.render(),goog.ui.Dialog.superClass_.setVisible.call(this,a))};
goog.ui.Dialog.prototype.setVisibleInternal_=function(a){a.target!=this||this.isDisposed()||(this.isVisible()?(this.getHandler().listen(this.getElement(),goog.events.EventType.KEYDOWN,this.onKey_).listen(this.getElement(),goog.events.EventType.KEYPRESS,this.onKey_),this.dispatchEvent(goog.ui.Dialog.EventType.AFTER_SHOW),this.getHandler().listen(this.buttonEl_,goog.events.EventType.CLICK,this.onButtonClick_)):(this.getHandler().unlisten(this.getElement(),goog.events.EventType.KEYDOWN,this.onKey_).unlisten(this.getElement(),
goog.events.EventType.KEYPRESS,this.onKey_).unlisten(this.buttonEl_,goog.events.EventType.CLICK,this.onButtonClick_),this.dispatchEvent(goog.ui.Dialog.EventType.AFTER_HIDE),this.disposeOnHide_&&this.dispose()))};
goog.ui.Dialog.prototype.focus=function(){goog.ui.Dialog.superClass_.focus.call(this);if(this.getButtonSet()){var a=this.getButtonSet().getDefault();if(a)for(var b=this.getDomHelper().getDocument(),c=this.buttonEl_.getElementsByTagName("button"),d=0,e;e=c[d];d++)if(e.name==a){try{if(goog.userAgent.WEBKIT||goog.userAgent.OPERA){var f=b.createElement("input");f.style.cssText="position:fixed;width:0;height:0;left:0;top:0;";this.getElement().appendChild(f);f.focus();this.getElement().removeChild(f)}e.focus()}catch(g){}break}}};
goog.ui.Dialog.prototype.setDraggerLimits_=function(){var a=this.getDomHelper().getDocument(),b=goog.dom.getWindow(a)||window,b=goog.dom.getViewportSize(b),c=Math.max(a.body.scrollWidth,b.width),a=Math.max(a.body.scrollHeight,b.height),d=goog.style.getSize(this.getElement());"fixed"==goog.style.getComputedPosition(this.getElement())?this.dragger_.setLimits(new goog.math.Rect(0,0,Math.max(0,b.width-d.width),Math.max(0,b.height-d.height))):this.dragger_.setLimits(new goog.math.Rect(0,0,c-d.width,a-
d.height))};goog.ui.Dialog.prototype.onTitleCloseClick_=function(){if(this.hasTitleCloseButton_){var a=this.getButtonSet(),b=a&&a.getCancel();b?(a=a.get(b),this.dispatchEvent(new goog.ui.Dialog.Event(b,a))&&this.setVisible(!1)):this.setVisible(!1)}};goog.ui.Dialog.prototype.getHasTitleCloseButton=function(){return this.hasTitleCloseButton_};goog.ui.Dialog.prototype.setHasTitleCloseButton=function(a){this.hasTitleCloseButton_=a;this.titleCloseEl_&&goog.style.showElement(this.titleCloseEl_,this.hasTitleCloseButton_)};
goog.ui.Dialog.prototype.isEscapeToCancel=function(){return this.escapeToCancel_};goog.ui.Dialog.prototype.setEscapeToCancel=function(a){this.escapeToCancel_=a};goog.ui.Dialog.prototype.setDisposeOnHide=function(a){this.disposeOnHide_=a};goog.ui.Dialog.prototype.getDisposeOnHide=function(){return this.disposeOnHide_};goog.ui.Dialog.prototype.disposeInternal=function(){this.buttonEl_=this.titleCloseEl_=null;goog.ui.Dialog.superClass_.disposeInternal.call(this)};
goog.ui.Dialog.prototype.setButtonSet=function(a){this.buttons_=a;this.buttonEl_&&(this.buttons_?this.buttons_.attachToElement(this.buttonEl_):this.buttonEl_.innerHTML="",goog.style.showElement(this.buttonEl_,!!this.buttons_))};goog.ui.Dialog.prototype.getButtonSet=function(){return this.buttons_};goog.ui.Dialog.prototype.onButtonClick_=function(a){if((a=this.findParentButton_(a.target))&&!a.disabled){var a=a.name,b=this.getButtonSet().get(a);this.dispatchEvent(new goog.ui.Dialog.Event(a,b))&&this.setVisible(!1)}};
goog.ui.Dialog.prototype.findParentButton_=function(a){for(;null!=a&&a!=this.buttonEl_;){if("BUTTON"==a.tagName)return a;a=a.parentNode}return null};
goog.ui.Dialog.prototype.onKey_=function(a){var b=!1,c=!1,d=this.getButtonSet(),e=a.target;if(a.type==goog.events.EventType.KEYDOWN)if(this.escapeToCancel_&&a.keyCode==goog.events.KeyCodes.ESC){var f=d&&d.getCancel(),e="SELECT"==e.tagName&&!e.disabled;f&&!e?(c=!0,b=d.get(f),b=this.dispatchEvent(new goog.ui.Dialog.Event(f,b))):e||(b=!0)}else a.keyCode==goog.events.KeyCodes.TAB&&a.shiftKey&&e==this.getElement()&&(c=!0);else if(a.keyCode==goog.events.KeyCodes.ENTER){if("BUTTON"==e.tagName)f=e.name;else if(d){var g=
d.getDefault(),h=g&&d.getButton(g),e=("TEXTAREA"==e.tagName||"SELECT"==e.tagName)&&!e.disabled;h&&!h.disabled&&!e&&(f=g)}f&&d&&(c=!0,b=this.dispatchEvent(new goog.ui.Dialog.Event(f,""+d.get(f))))}if(b||c)a.stopPropagation(),a.preventDefault();b&&this.setVisible(!1)};goog.ui.Dialog.Event=function(a,b){this.type=goog.ui.Dialog.EventType.SELECT;this.key=a;this.caption=b};goog.inherits(goog.ui.Dialog.Event,goog.events.Event);goog.ui.Dialog.SELECT_EVENT="dialogselect";
goog.ui.Dialog.EventType={SELECT:"dialogselect",AFTER_HIDE:"afterhide",AFTER_SHOW:"aftershow"};goog.ui.Dialog.ButtonSet=function(a){this.dom_=a||goog.dom.getDomHelper();goog.structs.Map.call(this)};goog.inherits(goog.ui.Dialog.ButtonSet,goog.structs.Map);goog.ui.Dialog.ButtonSet.prototype.class_="goog-buttonset";goog.ui.Dialog.ButtonSet.prototype.defaultButton_=null;goog.ui.Dialog.ButtonSet.prototype.element_=null;goog.ui.Dialog.ButtonSet.prototype.cancelButton_=null;
goog.ui.Dialog.ButtonSet.prototype.set=function(a,b,c,d){goog.structs.Map.prototype.set.call(this,a,b);c&&(this.defaultButton_=a);d&&(this.cancelButton_=a);return this};goog.ui.Dialog.ButtonSet.prototype.addButton=function(a,b,c){return this.set(a.key,a.caption,b,c)};goog.ui.Dialog.ButtonSet.prototype.attachToElement=function(a){this.element_=a;this.render()};
goog.ui.Dialog.ButtonSet.prototype.render=function(){if(this.element_){this.element_.innerHTML="";var a=goog.dom.getDomHelper(this.element_);goog.structs.forEach(this,function(b,c){var d=a.createDom("button",{name:c},b);c==this.defaultButton_&&(d.className=this.class_+"-default");this.element_.appendChild(d)},this)}};
goog.ui.Dialog.ButtonSet.prototype.decorate=function(a){if(a&&a.nodeType==goog.dom.NodeType.ELEMENT){this.element_=a;for(var a=this.element_.getElementsByTagName("button"),b=0,c,d,e;c=a[b];b++)if(d=c.name||c.id,e=goog.dom.getTextContent(c)||c.value,d){var f=0==b;this.set(d,e,f,c.name==goog.ui.Dialog.DefaultButtonKeys.CANCEL);f&&goog.dom.classes.add(c,this.class_+"-default")}}};goog.ui.Dialog.ButtonSet.prototype.getElement=function(){return this.element_};
goog.ui.Dialog.ButtonSet.prototype.getDomHelper=function(){return this.dom_};goog.ui.Dialog.ButtonSet.prototype.setDefault=function(a){this.defaultButton_=a};goog.ui.Dialog.ButtonSet.prototype.getDefault=function(){return this.defaultButton_};goog.ui.Dialog.ButtonSet.prototype.setCancel=function(a){this.cancelButton_=a};goog.ui.Dialog.ButtonSet.prototype.getCancel=function(){return this.cancelButton_};
goog.ui.Dialog.ButtonSet.prototype.getButton=function(a){for(var b=this.getAllButtons(),c=0,d;d=b[c];c++)if(d.name==a||d.id==a)return d;return null};goog.ui.Dialog.ButtonSet.prototype.getAllButtons=function(){return this.element_.getElementsByTagName(goog.dom.TagName.BUTTON)};goog.ui.Dialog.ButtonSet.prototype.setButtonEnabled=function(a,b){var c=this.getButton(a);c&&(c.disabled=!b)};
goog.ui.Dialog.ButtonSet.prototype.setAllButtonsEnabled=function(a){for(var b=this.getAllButtons(),c=0,d;d=b[c];c++)d.disabled=!a};goog.ui.Dialog.DefaultButtonKeys={OK:"ok",CANCEL:"cancel",YES:"yes",NO:"no",SAVE:"save",CONTINUE:"continue"};goog.ui.Dialog.MSG_DIALOG_OK_=goog.getMsg("OK");goog.ui.Dialog.MSG_DIALOG_CANCEL_=goog.getMsg("Cancel");goog.ui.Dialog.MSG_DIALOG_YES_=goog.getMsg("Yes");goog.ui.Dialog.MSG_DIALOG_NO_=goog.getMsg("No");goog.ui.Dialog.MSG_DIALOG_SAVE_=goog.getMsg("Save");
goog.ui.Dialog.MSG_DIALOG_CONTINUE_=goog.getMsg("Continue");goog.ui.Dialog.DefaultButtonCaptions={OK:goog.ui.Dialog.MSG_DIALOG_OK_,CANCEL:goog.ui.Dialog.MSG_DIALOG_CANCEL_,YES:goog.ui.Dialog.MSG_DIALOG_YES_,NO:goog.ui.Dialog.MSG_DIALOG_NO_,SAVE:goog.ui.Dialog.MSG_DIALOG_SAVE_,CONTINUE:goog.ui.Dialog.MSG_DIALOG_CONTINUE_};
goog.ui.Dialog.ButtonSet.DefaultButtons={OK:{key:goog.ui.Dialog.DefaultButtonKeys.OK,caption:goog.ui.Dialog.DefaultButtonCaptions.OK},CANCEL:{key:goog.ui.Dialog.DefaultButtonKeys.CANCEL,caption:goog.ui.Dialog.DefaultButtonCaptions.CANCEL},YES:{key:goog.ui.Dialog.DefaultButtonKeys.YES,caption:goog.ui.Dialog.DefaultButtonCaptions.YES},NO:{key:goog.ui.Dialog.DefaultButtonKeys.NO,caption:goog.ui.Dialog.DefaultButtonCaptions.NO},SAVE:{key:goog.ui.Dialog.DefaultButtonKeys.SAVE,caption:goog.ui.Dialog.DefaultButtonCaptions.SAVE},
CONTINUE:{key:goog.ui.Dialog.DefaultButtonKeys.CONTINUE,caption:goog.ui.Dialog.DefaultButtonCaptions.CONTINUE}};goog.ui.Dialog.ButtonSet.createOk=function(){return(new goog.ui.Dialog.ButtonSet).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.OK,!0,!0)};goog.ui.Dialog.ButtonSet.createOkCancel=function(){return(new goog.ui.Dialog.ButtonSet).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.OK,!0).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.CANCEL,!1,!0)};
goog.ui.Dialog.ButtonSet.createYesNo=function(){return(new goog.ui.Dialog.ButtonSet).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.YES,!0).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.NO,!1,!0)};goog.ui.Dialog.ButtonSet.createYesNoCancel=function(){return(new goog.ui.Dialog.ButtonSet).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.YES).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.NO,!0).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.CANCEL,!1,!0)};
goog.ui.Dialog.ButtonSet.createContinueSaveCancel=function(){return(new goog.ui.Dialog.ButtonSet).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.CONTINUE).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.SAVE).addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.CANCEL,!0,!0)};
(function(){"undefined"!=typeof document&&(goog.ui.Dialog.ButtonSet.OK=goog.ui.Dialog.ButtonSet.createOk(),goog.ui.Dialog.ButtonSet.OK_CANCEL=goog.ui.Dialog.ButtonSet.createOkCancel(),goog.ui.Dialog.ButtonSet.YES_NO=goog.ui.Dialog.ButtonSet.createYesNo(),goog.ui.Dialog.ButtonSet.YES_NO_CANCEL=goog.ui.Dialog.ButtonSet.createYesNoCancel(),goog.ui.Dialog.ButtonSet.CONTINUE_SAVE_CANCEL=goog.ui.Dialog.ButtonSet.createContinueSaveCancel())})();fyre.v1.ui.Alert=function(a){goog.ui.Dialog.call(this,a||"fyre-modal-alert");this.color_=null;this.setEscapeToCancel(!0);this.setDraggable(!1);this.setButtonSet(null);this.timer=null;goog.events.listen(this,goog.ui.Dialog.EventType.SELECT,this.close);return this};goog.inherits(fyre.v1.ui.Alert,goog.ui.Dialog);goog.addSingletonGetter(fyre.v1.ui.Alert);fyre.v1.ui.Alert.COLORS=fyre.v1.ui.Alert.prototype.COLORS={RED:"fyre-modal-alert-red",BLACK:"fyre-modal-alert-black",GREEN:"fyre-modal-alert-green"};
fyre.v1.ui.Alert.prototype.enterDocument=function(){fyre.v1.ui.Alert.superClass_.enterDocument.call(this);this.resetColor_()};fyre.v1.ui.Alert.prototype.open=function(){window.clearTimeout(this.timer);this.timer=window.setTimeout(goog.bind(this.close,this),5E3);this.setVisible(!0);return this};fyre.v1.ui.Alert.prototype.close=function(){window.clearTimeout(this.timer);this.resetColor_();this.setVisible(!1);return this};
fyre.v1.ui.Alert.prototype.setColor=function(a){this.isInDocument()||this.render();goog.dom.classes.addRemove(this.getElement(),this.color_,a);this.color_=a;return this};fyre.v1.ui.Alert.prototype.resetColor_=function(){this.setColor(this.COLORS.BLACK)};fyre.conv.view.MentionViewComponent=function(a,b,c,d){this.context=a;this.shareLink=c;this.msgId=b;this.counts={};this.counts[this.PROVIDERS.FB]=0;this.counts[this.PROVIDERS.TW]=0;this.mentions=goog.isArray(d)?this.buildMentionCollection_(d):d;fyre.v1.ui.FyreComponent.call(this)};goog.inherits(fyre.conv.view.MentionViewComponent,fyre.v1.ui.FyreComponent);goog.addSingletonGetter(fyre.conv.view.MentionViewComponent);
fyre.conv.view.MentionViewComponent.prototype.PROVIDERS=fyre.conv.view.MentionViewComponent.PROVIDERS={FB:"facebook",TW:"twitter",LF:"livefyre"};
fyre.conv.view.MentionViewComponent.prototype.buildMentionCollection_=function(a){var b=new fyre.v1.model.Collection,c=fyre.v1.model.Mention.ATTRIBUTES,d;fyre.v1.util.forEach(a,function(a){switch(a[c.PROVIDER]){case this.PROVIDERS.TW:d=new fyre.v1.model.Mention(a);b.add(d);break;case this.PROVIDERS.FB:break;case this.PROVIDERS.LF:break;default:goog.asserts.fail("No valid mentions.")}},this);return b};
fyre.conv.view.MentionViewComponent.prototype.createDom=function(){var a=fyre.v1.dom.create("div",{"class":"fyre-modal-container fyre-modal-mention"});this.$dom_=a;this.element_=a.element;this.createDomInternal()};fyre.conv.view.MentionViewComponent.prototype.enterDocument=function(){fyre.conv.view.MentionViewComponent.superClass_.enterDocument.call(this);this.buildView_()};
fyre.conv.view.MentionViewComponent.prototype.buildView_=function(){var a=fyre.v1.model.Mention.ATTRIBUTES;this.mentions.forEach(function(b){this.counts[b.get(a.PROVIDER)]++;this.addMention_(b)},this)};fyre.conv.view.MentionViewComponent.prototype.addMention_=function(a){this.addChild(new fyre.conv.view.MentionBoxComponent(a,this),!0)};
fyre.conv.view.MentionViewComponent.prototype.getCompletedMentions_=function(){var a=[];this.forEachChild(function(b){b.enabled&&(b=b.toExportFormat(),a.push(b))},this);return a};
fyre.conv.view.MentionViewComponent.prototype.sendMentions=function(a){var b=this.getCompletedMentions_();this.hideError_();goog.array.isEmpty(b)?(a.preventDefault(),a.stopPropagation(),a=fyre.conv.i18n.textEnumeration,this.showError_(a.get(a.KEYS.MENTION_ERROR_NONE_SELECTED))):this.context.commentService.sendMentions(this.msgId,b,goog.bind(this.handleMentionSuccess_,this),goog.bind(this.handleMentionFailure_,this))};
fyre.conv.view.MentionViewComponent.prototype.handleMentionSuccess_=function(){var a=fyre.conv.i18n.textEnumeration,b=new fyre.v1.ui.Alert;b.setColor(b.COLORS.GREEN);b.setContent(a.get(a.KEYS.MENTION_SUCCESS_MSG));b.open()};fyre.conv.view.MentionViewComponent.prototype.handleMentionFailure_=function(){var a=fyre.conv.i18n.textEnumeration,b=new fyre.v1.ui.Alert;b.setColor(b.COLORS.RED);b.setContent(a.get(a.KEYS.MENTION_ERROR_GENERAL));b.open()};
fyre.conv.view.MentionViewComponent.prototype.showError_=function(a){this.error_=fyre.v1.dom.create("div",{"class":"fyre-modal-error"});this.error_.html(a);this.$dom_.append(this.error_)};fyre.conv.view.MentionViewComponent.prototype.hideError_=function(){this.error_&&this.error_.remove()};fyre.v1.ui.Dialog=function(a){a=a||"fyre-modal";this.setEscapeToCancel(!0);this.setDraggable(!1);goog.ui.Dialog.call(this,a)};goog.inherits(fyre.v1.ui.Dialog,goog.ui.Dialog);goog.addSingletonGetter(fyre.v1.ui.Dialog);fyre.v1.ui.Dialog.prototype.addControl=function(a){fyre.v1.ui.Dialog.superClass_.addControl.call(this,a,!0);return this};
fyre.v1.ui.Dialog.prototype.addChild=function(a,b){this.setContent("");this.setButtonSet(goog.ui.Dialog.ButtonSet.createOkCancel());fyre.v1.ui.Dialog.superClass_.addChild.call(this,a,b)};fyre.v1.ui.Dialog.prototype.removeChildren=function(a){fyre.v1.ui.Dialog.superClass_.removeChildren.call(this,a)};
fyre.v1.ui.Dialog.prototype.setHiddenCancelButtonSet=function(){var a=new goog.ui.Dialog.ButtonSet;a.addButton(goog.ui.Dialog.ButtonSet.DefaultButtons.CANCEL,!0,!0);this.setButtonSet(a);goog.style.showElement(a.getElement(),!1)};fyre.v1.ui.Dialog.prototype.setContent=function(a){this.removeChildren(!0);this.setButtonSet(goog.ui.Dialog.ButtonSet.createOkCancel());fyre.v1.ui.Dialog.superClass_.setContent.call(this,a);return this};fyre.v1.ui.Dialog.prototype.getContent=function(){return fyre.v1.dom(this.getContentElement())};
fyre.v1.ui.Dialog.prototype.setElement=function(a){this.removeChildren(!0);fyre.v1.dom(this.getContentElement()).append(a);return this};fyre.v1.ui.Dialog.prototype.getOkButton=function(){return fyre.v1.dom(this.getButtonSet().getButton("ok"))};fyre.v1.ui.Dialog.prototype.handleOkClick=function(a,b){goog.events.listen(this.getOkButton().element,goog.events.EventType.CLICK,a,!1,b||this)};
fyre.v1.ui.Dialog.prototype.setButtonText=function(a,b){var c=this.getButtonSet();c.getButton(goog.ui.Dialog.ButtonSet.DefaultButtons.OK.key).innerHTML=a;c.getButton(goog.ui.Dialog.ButtonSet.DefaultButtons.CANCEL.key).innerHTML=b};fyre.v1.ui.Dialog.prototype.open=function(){this.setVisible(!0);return this};fyre.v1.ui.Dialog.prototype.close=function(a){this.setVisible(!1);!0===a&&this.removeChildren(!0);return this};
fyre.v1.ui.Dialog.prototype.decorate=function(a){var b=a.openInternal,c=a.closeInternal,d=a.repositionInternal,e=this;this.isInDocument()?this.setContent(""):this.createDom();a.openInternal=function(){b&&!1===b.call(a)||(e.setElement(a.el),e.open(),goog.events.listen(e,goog.ui.Dialog.EventType.SELECT,goog.bind(a.close,a)),a.reposition())};a.closeInternal=function(){c&&!1===c.call(a)||(e.close(),e.removeChildren(!0),e.getOkButton()&&goog.events.removeAll(e.getOkButton().element,goog.events.EventType.CLICK),
goog.events.unlisten(e,goog.ui.Dialog.EventType.SELECT,goog.bind(a.close,a)))};a.repositionInternal=function(){d&&!1===d.call(a)||e.reposition()};a.popupType=function(){return fyre.v1.ui.Dialog}};fyre.conv.service.CommentService=function(a,b){fyre.v1.service.ServiceBase.call(this,a,b);this.configureLogging("fyre.conv.service.CommentService")};goog.inherits(fyre.conv.service.CommentService,fyre.v1.service.ServiceBase);fyre.conv.service.CommentService.prototype.initialize=function(a){this.opts=a;this.handler=new (a.handler||fyre.conv.service.CommentHandler)(a,this)};
fyre.conv.service.CommentService.prototype.buildPostMessageData_=function(a){var b={shareTypes:[]},c=fyre.conv.model.Comment.ATTRIBUTES,d=this.context.collectionService.collection().id||a.get(c.CONV),e=a.get(c.BODY_HTML),f=a.get(c.SHARE_TYPES),g=a.get(c.EMBEDDED_URLS),h=a.get(c.RAW_HTML);b.collectionId=d;b.bodyHtml=fyre.v1.util.hasTextContent(e)?e:"";b.parentId=a.get(c.PARENT_ID);a.get(c.ID)&&(b.messageId=a.get(c.ID));goog.array.forEach(g||[],function(a){b.bodyHtml+=fyre.templates.conv.post.embeddedUrl({url:a})});
f&a.SHARE_TYPES.FACEBOOK&&b.shareTypes.push("facebook");f&a.SHARE_TYPES.TWITTER&&b.shareTypes.push("twitter");f&a.SHARE_TYPES.LINKEDIN&&b.shareTypes.push("linkedin");h&&(b.attachments={rawHtml:{body:h.body}});return b};fyre.conv.service.CommentService.prototype.postMessage=function(a,b,c){this.postMessageAs(a,fyre.conv.user.getTokenInfo(),b,c)};
fyre.conv.service.CommentService.prototype.postMessageAs=function(a,b,c,d){var e=goog.bind(this.handlePostedComment,this,{shareTypes:a.get(a.ATTRIBUTES.SHARE_TYPES)}),c=goog.functions.compose(c||goog.nullFunction,e),b=b||fyre.conv.user.getTokenInfo();fyre.v1.client.WriteClient.getInstance().postMessage(this.buildPostMessageData_(a),b,c,d||goog.nullFunction)};
fyre.conv.service.CommentService.prototype.likeMessage=function(a,b,c){var d=this.context.collectionService.collection();if(a.get(a.ATTRIBUTES.AUTHOR_ID)===fyre.conv.user.get(fyre.conv.user.ATTRIBUTES.ID))throw fyre.conv.errors.LIKED_OWN_COMMENT;fyre.v1.client.WriteClient.getInstance().likeMessage({messageId:a.id,collectionId:d.id},fyre.conv.user.getTokenInfo(),goog.functions.compose(b||goog.nullFunction,goog.bind(this.handleLikeSuccess,this,a)),fyre.v1.util.makeCallback(c))};
fyre.conv.service.CommentService.prototype.handleLikeSuccess=function(a,b){var c=fyre.conv.model.Opine.ATTRIBUTES,d=b.data,e={},f={content:e};e[c.AUTHOR_ID]=fyre.conv.user.id;e[c.TARGET_ID]=a.id;e[c.TARGET]=a;e[c.ID]=d.opinionId;f[c.TYPE]=fyre.conv.model.Opine.contentType;f[c.VISIBILITY]=fyre.conv.model.Opine.VISIBILITY.EVERYONE;this.trigger(fyre.conv.events.QUILL_LIKE_RECEIVED,f);return f};
fyre.conv.service.CommentService.prototype.unlikeMessage=function(a,b,c){if(a.get(a.ATTRIBUTES.OWNER_ID)===fyre.conv.user.get(fyre.conv.user.ATTRIBUTES.ID))throw fyre.conv.errors.LIKED_OWN_COMMENT;fyre.v1.client.WriteClient.getInstance().unlikeMessage({messageId:a.id,collectionId:this.context.collectionService.collection().id},fyre.conv.user.getTokenInfo(),goog.functions.compose(b||goog.nullFunction,goog.bind(this.handleUnlikeSuccess,this,a)),fyre.v1.util.makeCallback(c))};
fyre.conv.service.CommentService.prototype.handleUnlikeSuccess=function(a,b){var c=fyre.conv.model.Opine.ATTRIBUTES,d=b.data,e={},f={content:e};e[c.AUTHOR_ID]=fyre.conv.user.id;e[c.TARGET_ID]=a.id;e[c.TARGET]=a;e[c.ID]=d.opinionId;f[c.TYPE]=fyre.conv.model.Opine.contentType;f[c.VISIBILITY]=fyre.conv.model.Opine.VISIBILITY.NONE;this.trigger(fyre.conv.events.QUILL_UNLIKE_RECEIVED,f);return f};fyre.conv.service.CommentService.prototype._isMod=function(){var a=fyre.conv.user;return a&&a.get(a.ATTRIBUTES.MODERATOR)};
fyre.conv.service.CommentService.prototype.modApproveComment=function(a,b,c){var d=this.context.collectionService.collection();if(!this._isMod())throw fyre.conv.errors.INSUFFICIENT_PERMISSIONS;fyre.v1.client.WriteClient.getInstance().approveMessage({messageId:a.id,collectionId:d.id,siteId:d.get(d.ATTRIBUTES.SITE_ID)},fyre.conv.user.getTokenInfo(),fyre.v1.util.makeCallback(b),fyre.v1.util.makeCallback(c))};
fyre.conv.service.CommentService.prototype.modDenyComment=function(a,b,c){var d=this.context.collectionService.collection();if(!this._isMod())throw fyre.conv.errors.INSUFFICIENT_PERMISSIONS;fyre.v1.client.WriteClient.getInstance().denyMessage({messageId:a.id,collectionId:d.id,siteId:d.get(d.ATTRIBUTES.SITE_ID)},fyre.conv.user.getTokenInfo(),fyre.v1.util.makeCallback(b),fyre.v1.util.makeCallback(c))};
fyre.conv.service.CommentService.prototype.modBanAuthor=function(a,b,c){var d=this.context.collectionService.collection();if(!this._isMod())throw fyre.conv.errors.INSUFFICIENT_PERMISSIONS;fyre.v1.client.WriteClient.getInstance().banAuthor({sites:d.get(d.ATTRIBUTES.SITE_ID),authorId:a.id},fyre.conv.user.getTokenInfo(),fyre.v1.util.makeCallback(b),fyre.v1.util.makeCallback(c))};
fyre.conv.service.CommentService.prototype.flagMessage=function(a,b,c){var d=new fyre.conv.model.ContentFlag;d.set(d.ATTRIBUTES.AUTHOR_ID,fyre.conv.user.id);d.set(d.ATTRIBUTES.TARGET_ID,a.messageId);d.set(d.ATTRIBUTES.FLAG_TYPE,a.flagType);d.set(d.ATTRIBUTES.NOTES,a.notes);fyre.v1.client.WriteClient.getInstance().flagMessage({messageId:a.messageId,collectionId:a.collectionId,flag:a.flagType,notes:a.notes,email:a.email||""},fyre.conv.user.getTokenInfo(),fyre.v1.util.makeCallback(goog.partial(this.handleFlagSuccess,
d),this,b),fyre.v1.util.makeCallback(c))};fyre.conv.service.CommentService.prototype.handleFlagSuccess=function(a){this.context.trigger(fyre.conv.events.QUILL_FLAG_RECEIVED,a)};
fyre.conv.service.CommentService.prototype.deleteMessage=function(a,b,c){var d=fyre.conv.user,e=this.context.collectionService.collection();if(!d)throw fyre.conv.errors.INSUFFICIENT_PERMISSIONS;if(d.id!==a.get(a.ATTRIBUTES.AUTHOR_ID)&&!this._isMod())throw fyre.conv.errors.INSUFFICIENT_PERMISSIONS;fyre.v1.client.WriteClient.getInstance().deleteMessage({messageId:a.id,collectionId:e.id,siteId:e.get(e.ATTRIBUTES.SITE_ID)},fyre.conv.user.getTokenInfo(),fyre.v1.util.makeCallback(b),fyre.v1.util.makeCallback(c))};
fyre.conv.service.CommentService.prototype.bozoMessage=function(a,b,c){if(!this._isMod())throw fyre.conv.errors.INSUFFICIENT_PERMISSIONS;var d=this.context.collectionService.collection(),a={messageId:a.id,collectionId:d.id,siteId:d.get(d.ATTRIBUTES.SITE_ID)};fyre.v1.client.WriteClient.getInstance().bozoMessage(a,fyre.conv.user.getTokenInfo(),b,c)};
fyre.conv.service.CommentService.prototype.editMessage=function(a,b,c){var d=this.buildPostMessageData_(a);fyre.v1.client.WriteClient.getInstance().editMessage(d,fyre.conv.user.getTokenInfo(),goog.functions.compose(b||goog.nullFunction,goog.bind(this.handlePostedComment,this,{shareTypes:a.get(a.ATTRIBUTES.SHARE_TYPES)})),c||goog.nullFunction)};
fyre.conv.service.CommentService.prototype.getShortenedLink=function(a,b,c){var d=this.context.collectionService.collection(),e=fyre.conv.model.Collection.ATTRIBUTES;fyre.v1.client.SocialClient.getInstance().getShortenedLink({messageId:a,collectionId:d.get(e.ID)},fyre.conv.user,b,c)};
fyre.conv.service.CommentService.prototype.sendMentions=function(a,b,c,d){var e=goog.array.map(b,function(a){return goog.json.serialize(a)});fyre.v1.client.WriteClient.getInstance().sendMentions({messageId:a,collectionId:this.context.collectionService.collection().id,mentions:e},fyre.conv.user.getTokenInfo(),goog.bind(this.handleMentionsSuccess,this,c,b),fyre.v1.util.makeCallback(d))};
fyre.conv.service.CommentService.prototype.handleMentionsSuccess=function(a,b,c){a(c);this.context.bus.trigger(fyre.conv.events.MENTIONS_SHARED,b)};
fyre.conv.service.CommentService.prototype.handlePostedComment=function(a,b){var c=b.data,d=c.messages[0],e=fyre.conv.model.Comment.ATTRIBUTES,f=d.content;fyre.v1.util.forEach(c.authors,goog.bind(this.context.trigger,this.context,fyre.conv.events.QUILL_AUTHOR_RECEIVED));if(f[e.REPLACES]!=f[e.ID])return f[e.SHARE_TYPES]=a.shareTypes||0,this.context.trigger(fyre.conv.events.QUILL_MESSAGE_RECEIVED,d),this.displayMentionsModal_(f),d};
fyre.conv.service.CommentService.prototype.displayMentionsModal_=function(a){var b=a.mentions,c=a.shareLink,d=a.id;goog.isArray(b)&&!goog.array.isEmpty(b)&&(a=fyre.conv.i18n.textEnumeration,b=new fyre.conv.view.MentionViewComponent(this.context,d,c,b),b.mentions.length&&(c=fyre.v1.ui.Dialog.getInstance(),c.addChild(b,!0),c.setTitle(a.get(a.KEYS.MENTION_TITLE)),c.open(),c.setButtonText(a.get(a.KEYS.MENTION_CONFIRM_BTN),a.get(a.KEYS.MENTION_CANCEL_BTN)),c.handleOkClick(b.sendMentions,b)))};
fyre.conv.service.CommentService.prototype.getDatetimeOverride=function(){return this.opts.datetimeFormat.override||null};fyre.conv.service.CommentService.prototype.getDatetimeFormat=function(){return this.opts.datetimeFormat.absoluteFormat||"MMM d, yyyy"};fyre.conv.service.CommentService.prototype.getMinutesUntilAbsoluteTime=function(){return this.opts.datetimeFormat.minutesUntilAbsoluteTime||20160};goog.crypt.Arc4=function(){this.state_=[];this.index2_=this.index1_=0};goog.crypt.Arc4.prototype.setKey=function(a,b){goog.asserts.assertArray(a,"Key parameter must be a byte array");b||(b=a.length);for(var c=this.state_,d=0;256>d;++d)c[d]=d;for(var e=0,d=0;256>d;++d){var e=e+c[d]+a[d%b]&255,f=c[d];c[d]=c[e];c[e]=f}this.index2_=this.index1_=0};
goog.crypt.Arc4.prototype.discard=function(a){for(var b=this.index1_,c=this.index2_,d=this.state_,e=0;e<a;++e){var b=b+1&255,c=c+d[b]&255,f=d[b];d[b]=d[c];d[c]=f}this.index1_=b;this.index2_=c};goog.crypt.Arc4.prototype.crypt=function(a,b){b||(b=a.length);for(var c=this.index1_,d=this.index2_,e=this.state_,f=0;f<b;++f){var c=c+1&255,d=d+e[c]&255,g=e[c];e[c]=e[d];e[d]=g;a[f]^=e[e[c]+e[d]&255]}this.index1_=c;this.index2_=d};fyre.v1.util.crypt={};fyre.v1.util.crypt.arc4={};fyre.v1.util.crypt.arc4.decrypt=function(a,b){var c=new goog.crypt.Arc4,d=goog.crypt.stringToByteArray(a),e=goog.crypt.base64.decodeString(b),e=goog.crypt.stringToByteArray(e);c.setKey(d);c.crypt(e);return goog.crypt.byteArrayToString(e)};fyre.v1.util.crypt.md5=function(a){var b=new goog.crypt.Md5;b.update(""+a);return goog.crypt.byteArrayToHex(b.digest())};fyre.conv.eref={};fyre.conv.eref.decryptErefs=function(a,b){for(var c,d=0,e=a.length;d<e;d++)if(c=a[d],c=fyre.conv.eref.decryptEref(c,b))return c};fyre.conv.eref.decryptEref=function(a,b){for(var c,d=0,e=b.length;d<e;d++)if(c=fyre.conv.eref.decryptEref_(a,b[d]))return c};fyre.conv.eref.EREF_REGEX=/^eref:\/\/([^:\/]+:[^:\/]+\/[^:\/]+)$/;fyre.conv.eref.decryptEref_=function(a,b){var c=fyre.v1.util.crypt.arc4.decrypt(b,a).match(fyre.conv.eref.EREF_REGEX);return c?c[1]:null};
fyre.conv.eref.erefToContentId=function(a){return a.substr(0,a.indexOf(":"))};fyre.conv.eref.formatEref=function(a){a=goog.string.remove(a,"eref://");return{eref:a,contentId:a.substr(0,a.indexOf(":"))}};goog.pubsub={};goog.pubsub.PubSub=function(){goog.Disposable.call(this);this.subscriptions_=[];this.topics_={}};goog.inherits(goog.pubsub.PubSub,goog.Disposable);goog.pubsub.PubSub.prototype.key_=1;goog.pubsub.PubSub.prototype.publishDepth_=0;goog.pubsub.PubSub.prototype.subscribe=function(a,b,c){var d=this.topics_[a];d||(d=this.topics_[a]=[]);var e=this.key_;this.subscriptions_[e]=a;this.subscriptions_[e+1]=b;this.subscriptions_[e+2]=c;this.key_=e+3;d.push(e);return e};
goog.pubsub.PubSub.prototype.subscribeOnce=function(a,b,c){var d=this.subscribe(a,function(a){b.apply(c,arguments);this.unsubscribeByKey(d)},this);return d};goog.pubsub.PubSub.prototype.unsubscribe=function(a,b,c){if(a=this.topics_[a]){var d=this.subscriptions_;if(a=goog.array.find(a,function(a){return d[a+1]==b&&d[a+2]==c}))return this.unsubscribeByKey(a)}return!1};
goog.pubsub.PubSub.prototype.unsubscribeByKey=function(a){if(0!=this.publishDepth_)return this.pendingKeys_||(this.pendingKeys_=[]),this.pendingKeys_.push(a),!1;var b=this.subscriptions_[a];if(b){var c=this.topics_[b];c&&goog.array.remove(c,a);delete this.subscriptions_[a];delete this.subscriptions_[a+1];delete this.subscriptions_[a+2]}return!!b};
goog.pubsub.PubSub.prototype.publish=function(a,b){var c=this.topics_[a];if(c){this.publishDepth_++;for(var d=goog.array.slice(arguments,1),e=0,f=c.length;e<f;e++){var g=c[e];this.subscriptions_[g+1].apply(this.subscriptions_[g+2],d)}this.publishDepth_--;if(this.pendingKeys_&&0==this.publishDepth_)for(;c=this.pendingKeys_.pop();)this.unsubscribeByKey(c);return 0!=e}return!1};
goog.pubsub.PubSub.prototype.clear=function(a){if(a){var b=this.topics_[a];b&&(goog.array.forEach(b,this.unsubscribeByKey,this),delete this.topics_[a])}else this.subscriptions_.length=0,this.topics_={}};goog.pubsub.PubSub.prototype.getCount=function(a){if(a){var b=this.topics_[a];return b?b.length:0}a=0;for(b in this.topics_)a+=this.getCount(b);return a};
goog.pubsub.PubSub.prototype.disposeInternal=function(){goog.pubsub.PubSub.superClass_.disposeInternal.call(this);delete this.subscriptions_;delete this.topics_;delete this.pendingKeys_};fyre.v1.messenger={};fyre.v1.messenger.PubSub=function(a,b){this.name=a;this.channel=new goog.pubsub.PubSub;this.history=[];fyre.v1.object.Base.apply(this,arguments);this.configureLogging("fyre.v1.messenger.PubSub")};goog.inherits(fyre.v1.messenger.PubSub,fyre.v1.object.Base);fyre.v1.messenger.PubSub.SUBSCRIBE="subscribe";fyre.v1.messenger.PubSub.UNSUBSCRIBE="unsubscribe";
fyre.v1.messenger.PubSub.prototype.subscribe=function(a,b,c){goog.asserts.assert(goog.isString(a),"Invalid messenger channel "+a);var d={channel:this.channel,msg:a,callback:b};3<=arguments.length&&(d.context=c);this.trigger(fyre.v1.messenger.PubSub.SUBSCRIBE,d);this.channel.subscribe.apply(this.channel,arguments);this.logger.finer("Subscribe to message "+a+" on channel "+this.name)};
fyre.v1.messenger.PubSub.prototype.subscribeOnce=function(a,b,c){goog.asserts.assert(goog.isString(a),"Invalid messenger channel "+a);var d={channel:this.channel,msg:a,callback:b};3<=arguments.length&&(d.context=c);this.trigger(fyre.v1.messenger.PubSub.SUBSCRIBE,d);this.channel.subscribeOnce.apply(this.channel,arguments);this.logger.finer("Subscribe once to message "+a+" on channel "+this.name)};
fyre.v1.messenger.PubSub.prototype.unsubscribe=function(a,b,c){goog.asserts.assert(goog.isString(a),"Invalid messenger channel "+a);var d={channel:this.channel,msg:a,callback:b};3<=arguments.length&&(d.context=c);this.trigger(fyre.v1.messenger.PubSub.UNSUBSCRIBE,d);this.channel.unsubscribe.apply(this.channel,arguments);this.logger.finer("Unsubscribe to message "+a+" on channel "+this.name)};
fyre.v1.messenger.PubSub.prototype.trigger=function(a,b){goog.asserts.assert(goog.isString(a),"Invalid messenger channel "+a);this.channel.publish.apply(this.channel,arguments);this.history.push([a,b]);this.logger.finer("Trigger message "+a+" on channel "+this.name)};fyre.v1.messenger._Messenger=function(a){fyre.v1.messenger.PubSub.call(this,a);this.subchannels={}};goog.inherits(fyre.v1.messenger._Messenger,fyre.v1.messenger.PubSub);
fyre.v1.messenger._Messenger.prototype.createChannel=function(a){if(goog.object.containsKey(this.subchannels,a))throw Error("Cannot create new channel: Channel name already exists");this.subchannels[a]=new fyre.v1.messenger.SubChannel(a,this);return this.subchannels[a]};fyre.v1.messenger._Messenger.prototype.createSubChannel=function(a){return this.createChannel(this.name+"."+a)};fyre.v1.messenger.base=new fyre.v1.messenger._Messenger("main");fyre.v1.messenger._Messenger.prototype.getChannel=function(a){return this.subchannels[a]};
fyre.v1.messenger._Messenger.prototype.triggerAll=function(a,b){this.trigger(a,b);goog.object.forEach(this.subchannels,function(c){c.triggerAll(a,b)})};fyre.v1.messenger.SubChannel=function(a,b){fyre.v1.messenger._Messenger.call(this,a);this.publisher_funcs={on:this.subscribe,off:this.unsubscribe,trigger:this.trigger};this.publishers=[];this.parent=b};goog.inherits(fyre.v1.messenger.SubChannel,fyre.v1.messenger._Messenger);
fyre.v1.messenger.SubChannel.prototype.trigger=function(a,b){fyre.v1.messenger.SubChannel.superClass_.trigger.call(this,a,b);this.parent.trigger(a,b)};fyre.v1.messenger.SubChannel.prototype.decorate=function(a){goog.object.extend(a,this.publisher_funcs);this.publishers.push(a)};fyre.v1.messenger.SubChannel.prototype.undecorate=function(a){for(var b in this.publisher_funcs)a.hasOwnProperty[b]&&delete a[b];goog.array.remove(this.publishers,a)};
fyre.v1.messenger.SubChannel.prototype.dispose=function(){this.publishers=null;delete this.parent.subchannels[this.name];this.parent=null};fyre.v1.messenger.SubChannel.prototype.getPublishers=function(){return this.publishers};fyre.conv.bus=fyre.v1.messenger.base.createSubChannel("fyre.conv");fyre.v1.error.ExceptionHandler.getInstance().wrapBus(fyre.conv.bus);fyre.conv.service.backplane={};fyre.conv.service.backplane.Backplane=function(a){this.backplane=a;this.backplane(goog.bind(function(){fyre.conv.ready(goog.bind(this.initialize,this));this.currentBPChannel=goog.global.Backplane.getChannelID()},this))};fyre.conv.service.backplane.Backplane.BP_MSG_TYPES={LOGIN:"identity/login",LOGOUT:"identity/logout",UPDATE:"identity/update"};
fyre.conv.service.backplane.Backplane.prototype.setMessageUrl_=function(a){fyre.conv.user.set(goog.object.create(fyre.conv.user.ATTRIBUTES.BP_CHANNEL,a),{silent:!0})};fyre.conv.service.backplane.Backplane.prototype.setBackplaneHandlers_=function(){this.backplane.subscribe(goog.bind(this.handleBackplaneMessage,this))};
fyre.conv.service.backplane.Backplane.prototype.handleBackplaneMessage=function(a){var b=fyre.conv.service.backplane.Backplane.BP_MSG_TYPES,c=fyre.conv.service.AuthenticationService.getInstance(),d=this.checkBackplaneCacheForHit_(a),e=a.type;switch(e){case b.LOGIN:if(d){c.loginByCookie(!0);break}this.setBackplaneCache_(a);c.fetchAuthData();break;case b.LOGOUT:c.logout();break;case b.UPDATE:break;default:goog.asserts.fail("This Backplane message type is not supported: "+e)}};
fyre.conv.service.backplane.Backplane.prototype.login=function(){};fyre.conv.service.backplane.Backplane.prototype.logout=function(){this.poll(0)};fyre.conv.service.backplane.Backplane.prototype.poll=function(a){this.bpTimeout=setTimeout(goog.bind(this.poll_,this,a),100)};fyre.conv.service.backplane.Backplane.prototype.poll_=function(a){var b=this.currentBPChannel!==goog.global.Backplane.getChannelID();clearTimeout(this.bpTimeout);b||50===a?this.logoutSuccess():this.poll(a++)};
fyre.conv.service.backplane.Backplane.prototype.logoutSuccess=function(){var a=fyre.conv.service.AuthenticationService.getInstance(),b=fyre.conv.service.LocalStorageService.getInstance();a.logoutSuccess();b.removeBackplaneMessage();this.currentBPChannel=goog.global.Backplane.getChannelID()};
fyre.conv.service.backplane.Backplane.prototype.setBackplaneCache_=function(a){var b=fyre.conv.service.BackplaneAuthDelegate.STORAGE_ATTRIBUTES,c=fyre.conv.user.ATTRIBUTES,d=fyre.conv.service.LocalStorageService.getInstance(),c=a.messageURL||fyre.conv.user.get(c.BP_CHANNEL),a=fyre.v1.util.crypt.md5(goog.json.serialize(a)),b=goog.object.create(b.CHANNEL,c,b.CHECKSUM,a);d.saveBackplaneMessage(b)};
fyre.conv.service.backplane.Backplane.prototype.checkBackplaneCacheForHit_=function(a){var b=fyre.conv.service.BackplaneAuthDelegate.STORAGE_ATTRIBUTES,c=fyre.conv.user.ATTRIBUTES,d=fyre.conv.service.LocalStorageService.getInstance(),c=a.messageURL||fyre.conv.user.get(c.BP_CHANNEL),a=fyre.v1.util.crypt.md5(goog.json.serialize(a));return(d=d.getBackplaneMessage())&&c===d[b.CHANNEL]&&a===d[b.CHECKSUM]?!0:!1};fyre.conv.service.backplane.Backplane12=function(a){fyre.conv.service.backplane.Backplane.call(this,a);this.logger=fyre.v1.logging.getLogger("fyre.conv.service.backplane.Backplane12")};goog.inherits(fyre.conv.service.backplane.Backplane12,fyre.conv.service.backplane.Backplane);fyre.conv.service.backplane.Backplane12.prototype.initialize=function(){this.setMessageUrl_(goog.global.Backplane.getChannelID()||null);this.setBackplaneHandlers_();this.checkBackplaneOnLoad_()};
fyre.conv.service.backplane.Backplane12.prototype.checkBackplaneOnLoad_=function(){this.fetchBackplaneBusMessages_(goog.bind(this.handleBusResponse_,this))};fyre.conv.service.backplane.Backplane12.prototype.handleBusResponse_=function(a){a=a||[];goog.array.isEmpty(a)||this.handleBackplaneMessage(a[a.length-1].message)};
fyre.conv.service.backplane.Backplane12.prototype.fetchBackplaneBusMessages_=function(a){var b=fyre.conv.user.get(fyre.conv.user.ATTRIBUTES.BP_CHANNEL);fyre.v1.client.AuthClient.getInstance().authenticateByBackplane(b,a,goog.bind(function(){this.logger.warning("Fetch of backplane messages failed")},this))};
fyre.conv.service.backplane.Backplane12.prototype.logoutSuccess=function(){fyre.conv.service.backplane.Backplane12.superClass_.logoutSuccess.call(this);this.setMessageUrl_(goog.global.Backplane.getChannelID()||null)};fyre.conv.service.backplane.Backplane20=function(a){fyre.conv.service.backplane.Backplane.call(this,a);this.logger=fyre.v1.logging.getLogger("fyre.conv.service.backplane.Backplane20")};goog.inherits(fyre.conv.service.backplane.Backplane20,fyre.conv.service.backplane.Backplane);fyre.conv.service.backplane.Backplane20.prototype.initialize=function(){this.setBackplaneHandlers_()};
fyre.conv.service.backplane.Backplane20.prototype.handleBackplaneMessage=function(a){this.setMessageUrl_(a.messageURL);fyre.conv.service.backplane.Backplane20.superClass_.handleBackplaneMessage.call(this,a)};fyre.conv.service.backplane.Backplane20.prototype.logoutSuccess=function(){fyre.conv.service.backplane.Backplane20.superClass_.logoutSuccess.call(this);this.setMessageUrl_(null);this.clearCachedMessages_();this.setBackplaneHandlers_()};
fyre.conv.service.backplane.Backplane20.prototype.clearCachedMessages_=function(){this.backplane.cachedMessages={};this.backplane.cachedMessagesIndex=[]};fyre.conv.service.BackplaneAuthDelegate=function(a){a||goog.asserts.fail("Backplane object undefined");this.backplane=this.setBackplane(a);this.logger=fyre.v1.logging.getLogger("fyre.conv.service.BackplaneAuthDelegate")};goog.exportSymbol("fyre.conv.service.BackplaneAuthDelegate",fyre.conv.service.BackplaneAuthDelegate);fyre.conv.service.BackplaneAuthDelegate.STORAGE_ATTRIBUTES={CHANNEL:"channel",CHECKSUM:"checksum"};
fyre.conv.service.BackplaneAuthDelegate.BP_VERSION_REGEX={VERSION_12:/1\.2\.[0-9]/,VERSION_20:/2\.0\.[0-9]/};fyre.conv.service.BackplaneAuthDelegate.prototype.setBackplane=function(a){var b=fyre.conv.service.BackplaneAuthDelegate.BP_VERSION_REGEX,c=a.version,d;c.match(b.VERSION_12)?d=fyre.conv.service.backplane.Backplane12:c.match(b.VERSTION_20)?d=fyre.conv.service.backplane.Backplane20:goog.asserts.fail("Backplane version not supported: "+c);return new d(a)};
fyre.conv.service.BackplaneAuthDelegate.prototype.login=function(){};goog.exportProperty(fyre.conv.service.BackplaneAuthDelegate.prototype,"login",fyre.conv.service.BackplaneAuthDelegate.prototype.login);fyre.conv.service.BackplaneAuthDelegate.prototype.logout=function(){this.logoutInternal()};goog.exportProperty(fyre.conv.service.BackplaneAuthDelegate.prototype,"logout",fyre.conv.service.BackplaneAuthDelegate.prototype.logout);fyre.conv.service.BackplaneAuthDelegate.prototype.logoutInternal=function(){this.backplane.logout()};
fyre.conv.service.BackplaneAuthDelegate.prototype.loginByCookie=function(a,b){if(b){var c=fyre.conv.service.LocalStorageService.getInstance().getAuthData();c&&this.containsProfileData_(c)?a.success(c):a.failure(c)}};goog.exportProperty(fyre.conv.service.BackplaneAuthDelegate.prototype,"loginByCookie",fyre.conv.service.BackplaneAuthDelegate.prototype.loginByCookie);fyre.conv.service.BackplaneAuthDelegate.prototype.containsProfileData_=function(a){return goog.object.containsKey(a,"profile")};fyre.conv.BackplaneAuthDelegate.setBackend(fyre.conv.service.BackplaneAuthDelegate);fyre.conv.service.SPAuthDelegate=function(a){var a=a||{},b=a.engage||{},a=a.profiles||{};this.isRedirect_=fyre.v1.util.browser.isMobile();this.engage=new fyre.sp.app.Engage(b);this.profiles=new fyre.sp.app.Profile(a);this.setupListeners()};goog.inherits(fyre.conv.service.SPAuthDelegate,fyre.conv.service.RemoteAuthDelegate);goog.exportSymbol("fyre.conv.service.SPAuthDelegate",fyre.conv.service.SPAuthDelegate);
fyre.conv.service.SPAuthDelegate.SP_EVENTS={LOGIN_COMPLETE:"auth_login_complete",LOGOUT_COMPLETE:"auth_logout_complete",ENGAGE_AUTH_CLOSE:"engage_auth_close"};fyre.conv.service.SPAuthDelegate.prototype.setupListeners=function(){var a=fyre.conv.service.SPAuthDelegate.SP_EVENTS;fyre.sp.on(a.LOGIN_COMPLETE,function(a){fyre.conv.ready(function(){fyre.conv.service.AuthenticationService.getInstance().loginByCookie(a.token)})});fyre.sp.on(a.LOGOUT_COMPLETE,function(){fyre.conv.ready(function(){fyre.conv.service.AuthenticationService.getInstance().logoutSuccess()})})};
fyre.conv.service.SPAuthDelegate.prototype.handleRedirect_=function(){this.isRedirect_&&fyre.conv.bus.trigger(fyre.conv.events.WINDOW_NAVIGATION)};
fyre.conv.service.SPAuthDelegate.prototype.login=function(a){var b=fyre.conv.service.SPAuthDelegate.SP_EVENTS,c=function(){a.success();fyre.sp.off(b.LOGIN_COMPLETE,c);fyre.sp.off(b.ENGAGE_AUTH_CLOSE,d)},d=function(){a.failure();fyre.sp.off(b.ENGAGE_AUTH_CLOSE,d);fyre.sp.off(b.LOGIN_COMPLETE,c)};this.handleRedirect_();this.engage.signIn();fyre.sp.on(b.LOGIN_COMPLETE,c);fyre.sp.on(b.ENGAGE_AUTH_CLOSE,d)};goog.exportProperty(fyre.conv.service.SPAuthDelegate.prototype,"login",fyre.conv.service.SPAuthDelegate.prototype.login);
fyre.conv.service.SPAuthDelegate.prototype.logout=function(){this.handleRedirect_();this.engage.signOut()};goog.exportProperty(fyre.conv.service.SPAuthDelegate.prototype,"logout",fyre.conv.service.SPAuthDelegate.prototype.logout);fyre.conv.service.SPAuthDelegate.prototype.viewProfile=function(a,b){var c;this.handleRedirect_();b.isCuratedAuthor?this.handleViewCuratedAuthor_(b):(b.id!=fyre.conv.user.get(fyre.conv.user.ATTRIBUTES.ID)&&(c=b.id.split("@")[0]),this.profiles.viewProfile(c))};
goog.exportProperty(fyre.conv.service.SPAuthDelegate.prototype,"viewProfile",fyre.conv.service.SPAuthDelegate.prototype.viewProfile);fyre.conv.service.SPAuthDelegate.prototype.handleViewCuratedAuthor_=function(a){var b=a.profileUrl;b&&(this.isRedirect_?window.location.href=b:goog.window.open(a.profileUrl,{target:"_blank"}))};fyre.conv.service.SPAuthDelegate.prototype.editProfile=function(){this.handleRedirect_();this.profiles.editProfile()};
goog.exportProperty(fyre.conv.service.SPAuthDelegate.prototype,"editProfile",fyre.conv.service.SPAuthDelegate.prototype.editProfile);fyre.conv.SPAuthDelegate.setBackend(fyre.conv.service.SPAuthDelegate);fyre.conv.ENTRYPOINT={};fyre.conv.user=new fyre.conv.model.User;goog.crypt.base64.ENCODED_VALS_WEBSAFE=goog.crypt.base64.ENCODED_VALS_BASE+"-_=";fyre.conv.login=function(a){fyre.conv.service.AuthenticationService.getInstance().loginByCookie(a)};fyre.conv.logout=function(){fyre.conv.service.AuthenticationService.getInstance().logout()};
fyre.conv.initializeGlobalServices=fyre.conv.initializeAuthService=function(a){fyre.conv.service.LocalStorageService.configure(new fyre.conv.service.LocalStorageService(a));fyre.conv.service.AuthenticationService.configure(new fyre.conv.service.AuthenticationService(fyre.conv.bus,a))};fyre.conv.BackplaneAuthDelegate=fyre.conv.service.BackplaneAuthDelegate;fyre.conv.SPAuthDelegate=fyre.conv.service.SPAuthDelegate;fyre.v1.lib.Readability=function(a){a=goog.isArray(a)?a.join(" "):a;this.text=fyre.v1.lib.Readability.prepareText(a);this.wordArray=this.text.split(" ")};fyre.v1.lib.Readability.prepareText=function(a){a=fyre.v1.util.stripHtml(a);a=a.replace(/http:\/\/[\S]+/g,"");return goog.string.collapseWhitespace(a)};fyre.v1.lib.Readability.prototype.getFKGradeLevel=function(){var a=this.countWords(),b=this.countSentences(),c=this.countSyllables();return 0.39*(a/b)+11.8*(c/a)-11.59};
fyre.v1.lib.Readability.prototype.getFRES=function(){var a=this.countWords(),b=this.countSentences(),c=this.countSyllables();return 206.876-1.015*(a/b)-84.6*(c/a)};fyre.v1.lib.Readability.prototype.toCV_=function(a){for(var b=[],c=0,d=a.length;c<d;c++)-1<"aeiou".indexOf(a[c])?b.push("v"):b.push("c");return b};fyre.v1.lib.Readability.prototype.countCV_=function(a){for(var b=0,c=0,d=a.length-1;c<d;)"c"===a[c]&&"v"===a[c+1]&&(b+=1),c+=1;return b};
fyre.v1.lib.Readability.prototype.countVowelGroups_=function(a){var a=this.toCV_(a),b=this.countCV_(a);"v"===a[0]&&(b+=1);return b};fyre.v1.lib.Readability.prototype.countSyllablesInWord_=function(a){a=this.countVowelGroups_(a);return 0===a?1:a};fyre.v1.lib.Readability.prototype.countSyllables=function(){for(var a=this.wordArray,b=0,c=0,d=a.length;c<d;c++)b+=this.countSyllablesInWord_(a[c]);return b};fyre.v1.lib.Readability.prototype.countSentences=function(){return(this.text.match(/[\.!?]/g)||[0]).length};
fyre.v1.lib.Readability.prototype.countWords=function(){return this.wordArray.length};fyre.conv.manager={};fyre.conv.manager.BaseFilter=function(a){this.processFn=a;goog.asserts.assert(this.processFn);goog.Disposable.call(this)};goog.inherits(fyre.conv.manager.BaseFilter,goog.Disposable);fyre.conv.manager.BaseFilter.prototype.handleStates=function(a){this.processFn(a)};fyre.conv.manager.BaseFilter.prototype.disposeInternal=function(){this.processFn=null;fyre.conv.manager.BaseFilter.superClass_.disposeInternal.call(this)};
fyre.conv.manager.DecayFilter=function(a,b){this.weightIndex_=0;this.timer_=null;this.stateBucket_=[];this.initTime_=1E3*(new Date).getTime();this.logger_=fyre.v1.logging.getLogger("fyre.conv.manager.DecayFilter");fyre.conv.manager.BaseFilter.call(this,a,b)};goog.inherits(fyre.conv.manager.DecayFilter,fyre.conv.manager.BaseFilter);fyre.conv.manager.DecayFilter.STATE_WEIGHT=3;fyre.conv.manager.DecayFilter.MAX_THRESHOLD=8;fyre.conv.manager.DecayFilter.DECAY_FACTOR=0.667;
fyre.conv.manager.DecayFilter.getGradeLevelFromState=function(a){var b=a.score;b||(b=a.score=(new fyre.v1.lib.Readability(a.content.bodyHtml)).getFKGradeLevel());return b};fyre.conv.manager.DecayFilter.prototype.getMostRelevantIdx=function(){for(var a=this.stateBucket_.length,b=a-1,c=0,d,e=0;e<a;e++)d=goog.object.getAnyValue(this.stateBucket_[e]),d=fyre.conv.manager.DecayFilter.getGradeLevelFromState(d),d>=c&&(c=d,b=e);return b};
fyre.conv.manager.DecayFilter.prototype.getNextState=function(){var a=this.getMostRelevantIdx(),b=this.stateBucket_[a];this.stateBucket_=this.stateBucket_.slice(a+1);return b};fyre.conv.manager.DecayFilter.prototype.shouldInterceptState=function(){return this.weightIndex_>fyre.conv.manager.DecayFilter.MAX_THRESHOLD};fyre.conv.manager.DecayFilter.prototype.clearBucket=function(){this.stateBucket_=[]};
fyre.conv.manager.DecayFilter.prototype.processQueue=function(){this.weightIndex_*=fyre.conv.manager.DecayFilter.DECAY_FACTOR;this.logger_.info("decay filter index decayed to: ",this.weightIndex_);if(this.stateBucket_.length){var a=this.getNextState();a&&(this.logger_.info("decay filter releasing state: ",a),this.processFn(a))}else 1>this.weightIndex_&&(clearInterval(this.timer_),this.timer_=null,this.weightIndex_=0)};
fyre.conv.manager.DecayFilter.prototype.handleStates=function(a){var b={};goog.object.forEach(a,function(a){var d=fyre.conv.service.ContentAdapter.adaptState(a),e=d.id;d.content.parentId?b[e]=a:d.content.bodyHtml?d.type!==fyre.v1.enums.content.type.MESSAGE?b[e]=a:this.initTime_>d.event?b[e]=a:d.content.authorId===fyre.conv.user.id?(b[e]=a,this.weightIndex_=0,this.clearBucket()):goog.object.get(d.content.annotations,"moderator",!1)?b[e]=a:(this.weightIndex_+=fyre.conv.manager.DecayFilter.STATE_WEIGHT,
this.logger_.info("decay filter index increased to: ",this.weightIndex_),this.timer_||(this.timer_=setInterval(goog.bind(this.processQueue,this),3E3)),this.shouldInterceptState()?this.stateBucket_.push(goog.object.create(e,a)):(this.clearBucket(),b[e]=a)):b[e]=a},this);this.processFn(b)};fyre.conv.manager.DecayFilter.prototype.disposeInternal=function(){clearInterval(this.timer_);this.timer_=null;this.clearBucket();fyre.conv.manager.DecayFilter.superClass_.disposeInternal.call(this)};fyre.conv.model.BootstrapResponseModel=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.BootstrapResponseModel,fyre.v1.model.Model);fyre.conv.model.BootstrapResponseModel.prototype.ATTRIBUTES=fyre.conv.model.BootstrapResponseModel.ATTRIBUTES={BOOTSTRAP_REQUEST_COMPLETE:"bootstrapRequestComplete",CONTENT:"content",HAS_DATA:"hasData"};
fyre.conv.model.BootstrapResponseModel.prototype.defaults=function(){var a={};a[fyre.conv.model.BootstrapResponseModel.ATTRIBUTES.CONTENT]={};return a};fyre.conv.model.BootstrapResponseModel.prototype.updateContent=function(a){var b=fyre.conv.model.BootstrapResponseModel.ATTRIBUTES,c=fyre.conv.model.BootstrapResponseModel.EVENTS,a=this.filterContent(a);goog.object.extend(this.get(b.CONTENT)||{},a);this.trigger(c.CONTENT_UPDATED,a);return a};
fyre.conv.model.BootstrapResponseModel.prototype.filterContent=function(a){return a};fyre.conv.model.BootstrapResponseModel.prototype.EVENTS=fyre.conv.model.BootstrapResponseModel.EVENTS={CONTENT_UPDATED:"contentUpdated",REQ_COMPLETE:"reqComplete",REQ_FAILED:"reqFailed"};fyre.conv.manager.ContentManager=function(a){goog.Disposable.call(this);this.appContext=a;this.states_={};this.orphans_={};this.unpagedDescendents_={};this.pageIndex_={};this.erefPartials_={};this.failedErefs_={};this.promises_={};this.pendingOrComplete_={};fyre.conv.user.onChange(fyre.conv.user.ATTRIBUTES.EREF_KEYS,this.retryFailedErefs_,this);this.contentStreamFilter_=null;var b=fyre.conv.model.Collection.ATTRIBUTES;this.collection_=a.collectionService.collection();this.collection_.on(this.collection_.attributeChangeEvent(b.ID),
this.setStreamFilter_,this);a=goog.bind(this.processStreamContent_,this);this.contentStreamFilter_=new fyre.conv.manager.BaseFilter(a)};goog.inherits(fyre.conv.manager.ContentManager,goog.Disposable);fyre.conv.manager.ContentManager.HEAD=fyre.conv.manager.ContentManager.prototype.HEAD="head";fyre.conv.manager.ContentManager.UNPAGED=fyre.conv.manager.ContentManager.prototype.UNPAGED="unpaged";fyre.conv.manager.ContentManager.DIR=fyre.conv.manager.ContentManager.prototype.DIR=fyre.v1.enums.content.direction;
fyre.conv.manager.ContentManager.prototype.setStreamFilter_=function(){var a=fyre.conv.model.Collection.ATTRIBUTES,b=goog.bind(this.processStreamContent_,this);this.collection_.get(a.THROTTLE_STREAM)&&(this.contentStreamFilter_=new fyre.conv.manager.DecayFilter(b))};
fyre.conv.manager.ContentManager.prototype.addPageData=function(a,b){var c=goog.object.setIfUndefined(this.states_,a,{}),d=goog.object.map(b,function(a){a.transport==fyre.conv.service.STATE_ENUM_TRANSPORT.STREAM&&(a=goog.object.clone(a),a.transport=fyre.conv.service.STATE_ENUM_TRANSPORT.STREAM_ARCHIVE);return a},this);goog.object.extend(c,d);this.forEachPromise(a,function(a){a.updateContent(b)});a==this.HEAD&&this.appContext.collectionService.getCollection(goog.bind(function(a){this.isDisposed()||
(a=a.get(a.ATTRIBUTES.ARCHIVE_INFO).nPages-1,0>a&&(goog.asserts.assert(-1==a),a=0),this.addPageData(a,b))},this))};fyre.conv.manager.ContentManager.prototype.forEachPromise=function(a,b){var c=this.promises_[a];c&&goog.array.forEach(c,b,this)};fyre.conv.manager.ContentManager.prototype.handleStreamContent_=function(a){this.contentStreamFilter_.handleStates(a)};
fyre.conv.manager.ContentManager.prototype.processStreamContent_=function(a){var b={};goog.object.forEach(a,function(a,d){var e=fyre.conv.service.ContentAdapter.adaptState(a),f=e.content.parentId,g=e.content.ancestorId,h;f||(f=e.content.targetId);this.filterStreamContent(e)&&(h=g?this.pageIndex_[g]:this.HEAD,e.transport||(e.transport=fyre.conv.service.STATE_ENUM_TRANSPORT.STREAM),goog.isDefAndNotNull(h)?(g&&h==this.HEAD&&(goog.object.setIfUndefined(this.unpagedDescendents_,g,[]),this.unpagedDescendents_[g].push(d)),
e.pageIdx=h,this.pageIndex_[d]=h,goog.object.setIfUndefined(b,h,{}),goog.object.extend(b[h],this.removeOrphans(e)),(f=b[h][d])&&f.event>=e.event||(b[h][d]=e)):(goog.object.setIfUndefined(this.orphans_,f,{}),this.orphans_[f][d]=e))},this);goog.object.forEach(b,function(a,b){this.addPageData(b,a)},this)};fyre.conv.manager.ContentManager.prototype.filterStreamContent=function(){return!0};
fyre.conv.manager.ContentManager.prototype.handleStreamData=function(a){this.handleStreamContent_(a.content);goog.object.forEach(a.erefs,function(a){a.transport||(a.pageIdx=this.UNPAGED)},this);this.fetchErefs(a.erefs)};fyre.conv.manager.ContentManager.prototype.handleQuillData=function(a){var b={},c=a.content;c.transport=fyre.conv.service.STATE_ENUM_TRANSPORT.QUILL;b[c.id]=a;this.handleStreamContent_(b)};
fyre.conv.manager.ContentManager.prototype.removeOrphans=function(a){var b=this.orphans_[a.id]||{},c=this.unpagedDescendents_[a.id];c&&this.states_[this.HEAD]&&goog.array.forEach(c,function(a){var c=this.states_[this.HEAD][a];c&&(b[a]=c)},this);if(goog.object.isEmpty(b))return{};goog.object.forEach(b,function(b,c){c.pageIdx=this.pageIndex_[b]=a.pageIdx},this);delete this.orphans_[a.id];return b};fyre.conv.manager.ContentManager.EREF_BATCH_SIZE=20;
fyre.conv.manager.ContentManager.prototype.fetchErefs=function(a){var b=[],c={},d=fyre.conv.user.get(fyre.conv.user.ATTRIBUTES.EREF_KEYS);goog.object.forEach(a,function(a,f){var g=fyre.conv.eref.decryptErefs(a.erefs,d);g?(this.erefPartials_[f]=a,this.pageIndex_[f]=a.pageIdx,b.push(g)):(goog.object.setIfUndefined(c,a.pageIdx,{}),c[f]=a,this.failedErefs_[f]=a)},this);b.length&&this.fetchErefsByBatch(b);goog.object.forEach(c,this.handleFailedErefs,this);return b.length};
fyre.conv.manager.ContentManager.prototype.handleFailedErefs=function(a,b){var c=this.pageIndex_[b];if(c){var d=this.states_[c][b];if(!(d.event>a.event)){d.vis=a.vis;d.lastVis=a.lastVis;d.event=a.event;var e={};e[b]=d;this.addPageData(c,e)}}};
fyre.conv.manager.ContentManager.prototype.fetchErefsByBatch=function(a){var b=a.length,c=fyre.conv.manager.ContentManager.EREF_BATCH_SIZE,d=goog.bind(this.handleErefData,this),e;do e=goog.array.splice(a,0,c),fyre.conv.client.BootstrapClient.getInstance().getContentByErefs({ref:e},d);while(0<(b-=c))};
fyre.conv.manager.ContentManager.prototype.handleErefData=function(a){var a=fyre.conv.service.ContentAdapter.adaptErefResponse(a),b={};goog.object.forEach(a.authors,function(a){this.appContext.bus.trigger(fyre.conv.events.EREF_AUTHOR_RECEIVED,a)},this);goog.object.forEach(a.states,function(a,d){if(this.erefPartials_[d]){var e=this.erefPartials_[d].pageIdx;goog.object.setIfUndefined(b,e,{});b[e][d]=this.erefPartials_[d];goog.object.extend(b[e][d].content,a.content)}},this);goog.object.forEach(b,function(a,
b){b==this.UNPAGED?this.handleStreamContent_(a):this.addPageData(b,a)},this)};fyre.conv.manager.ContentManager.prototype.retryFailedErefs_=function(){var a=this.failedErefs_;this.failedErefs_={};this.fetchErefs(a)};fyre.conv.manager.ContentManager.prototype.getStateById=function(a){var b=this.pageIndex_[a];return!b?void 0:this.states_[b][a]};
fyre.conv.manager.ContentManager.prototype.disposeInternal=function(){fyre.conv.user.off(null,null,this);this.collection_.off(null,null,this);this.collection_=null;this.contentStreamFilter_.dispose();this.contentStreamFilter_=null;fyre.conv.manager.ContentManager.superClass_.disposeInternal.call(this)};fyre.conv.manager.TopContentContentManager=function(a,b){fyre.conv.manager.ContentManager.call(this,a);var c=fyre.conv.events;a.bus.subscribe(c.STREAM_DATA_RECEIVED,this.handleStreamData,this);a.bus.subscribe(c.QUILL_MESSAGE_RECEIVED,this.handleQuillData,this);a.bus.subscribe(c.QUILL_LIKE_RECEIVED,this.handleQuillData,this);a.bus.subscribe(c.QUILL_UNLIKE_RECEIVED,this.handleQuillData,this);this.streamContentManager_=a.contentService.streamManager;this.isThreadBreakout=b||!1};
goog.inherits(fyre.conv.manager.TopContentContentManager,fyre.conv.manager.ContentManager);fyre.conv.manager.TopContentContentManager.prototype.getAggregateContent=function(a,b){var c={collectionId:this.appContext.collectionService.collection().id,aggregateType:a};this.get_(fyre.conv.client.BootstrapClient.getInstance().getAggregateContent,c,b);return b};
fyre.conv.manager.TopContentContentManager.prototype.getHotThreads=function(a){var b={collectionId:this.appContext.collectionService.collection().id};this.get_(fyre.conv.client.BootstrapClient.getInstance().getHotThreads,b,a);return a};fyre.conv.manager.TopContentContentManager.prototype.getThread=function(a,b,c){a={collection_id:this.appContext.collectionService.collection().id,content_id:a,depth_only:b};this.get_(fyre.conv.client.BootstrapClient.getInstance().getContentThread,a,c);return c};
fyre.conv.manager.TopContentContentManager.prototype.get_=function(a,b,c){var d=this.HEAD;goog.object.setIfUndefined(this.promises_,d,[]);this.promises_[d].push(c);c=goog.bind(this.successFn_,this,d);a(b,c)};
fyre.conv.manager.TopContentContentManager.prototype.successFn_=function(a,b){if(!this.isDisposed()){var c=fyre.conv.service.ContentAdapter.adaptBootstrapResponse(a,b.data);goog.object.forEach(c.authors,goog.bind(this.appContext.bus.trigger,this.appContext.bus,fyre.conv.events.BOOTSTRAP_AUTHOR_RECEIVED));this.fastForwardBootstrapContent_(c.content,a);goog.object.extend(this.pageIndex_,goog.object.map(c.content,goog.functions.constant(a)));this.addPageData(a,c.content);this.fetchErefs(c.erefs);this.forEachPromise(a,
function(a){a.trigger(a.EVENTS.REQ_COMPLETE,{});a.set(a.ATTRIBUTES.HAS_DATA,!0)})}};fyre.conv.manager.TopContentContentManager.prototype.fastForwardBootstrapContent_=function(a,b){this.fastForwardContent_(a,b);this.fastForwardOpines_(a)};
fyre.conv.manager.TopContentContentManager.prototype.fastForwardContent_=function(a,b){goog.object.forEach(a,function(c,d){var e=this.streamContentManager_.getStateById(d)||c;e.pageIdx=b;e.transport=c.transport;c.content.annotations&&(e.content.annotations=c.content.annotations);a[d]=e},this)};
fyre.conv.manager.TopContentContentManager.prototype.fastForwardOpines_=function(a){var b=this.streamContentManager_.getOpineCache();goog.object.forEach(b,function(b,d){a[d]&&goog.array.forEach(b,function(b){a[b.id]||(a[b.id]=b)})})};
fyre.conv.manager.TopContentContentManager.prototype.filterStreamContent=function(a){if(a.transport===fyre.conv.service.STATE_ENUM_TRANSPORT.QUILL)return!0;var b=!1;this.isThreadBreakout&&(b=a.content,b=this.pageIndex_[b.ancestorId]||this.pageIndex_[b.targetId]);return b||this.pageIndex_[a.id]};
fyre.conv.manager.TopContentContentManager.prototype.disposeInternal=function(){var a=fyre.conv.events;this.appContext.bus.unsubscribe(a.STREAM_DATA_RECEIVED,this.handleStreamData,this);this.appContext.bus.unsubscribe(a.QUILL_MESSAGE_RECEIVED,this.handleQuillData,this);this.appContext.bus.unsubscribe(a.QUILL_LIKE_RECEIVED,this.handleQuillData,this);this.appContext.bus.unsubscribe(a.QUILL_UNLIKE_RECEIVED,this.handleQuillData,this);this.streamContentManager_=null;fyre.conv.manager.TopContentContentManager.superClass_.disposeInternal.call(this)};fyre.conv.manager.PermalinkContentManager=function(a){fyre.conv.manager.ContentManager.call(this,a);var b=fyre.conv.events;a.bus.subscribe(b.QUILL_MESSAGE_RECEIVED,this.handleQuillData,this);a.bus.subscribe(b.QUILL_LIKE_RECEIVED,this.handleQuillData,this);a.bus.subscribe(b.QUILL_UNLIKE_RECEIVED,this.handleQuillData,this)};goog.inherits(fyre.conv.manager.PermalinkContentManager,fyre.conv.manager.ContentManager);
fyre.conv.manager.PermalinkContentManager.prototype.getContentThread=function(a,b,c){var d=this.HEAD;goog.object.setIfUndefined(this.promises_,d,[]);this.promises_[d].push(b);a={content_id:a,collection_id:this.appContext.collectionService.collection().id,depth_only:c||!1};fyre.conv.client.BootstrapClient.getInstance().getContentThread(a,goog.bind(function(a){this.isDisposed()||(a=fyre.conv.service.ContentAdapter.adaptBootstrapResponse(d,a.data),goog.object.forEach(a.authors,goog.bind(this.appContext.bus.trigger,
this.appContext.bus,fyre.conv.events.BOOTSTRAP_AUTHOR_RECEIVED)),goog.object.extend(this.pageIndex_,goog.object.map(a.content,goog.functions.constant(d))),this.addPageData(d,a.content),this.fetchErefs(a.erefs),this.forEachPromise(d,function(a){a.trigger(a.EVENTS.REQ_COMPLETE,{});a.set(a.ATTRIBUTES.HAS_DATA,!0)}))},this));return b};
fyre.conv.manager.PermalinkContentManager.prototype.filterStreamContent=function(a){var b=a.content.targetId;return this.pageIndex_[a.content.ancestorId]||this.pageIndex_[b]?!0:!1};
fyre.conv.manager.PermalinkContentManager.prototype.disposeInternal=function(){var a=fyre.conv.events;this.appContext.bus.unsubscribe(a.QUILL_MESSAGE_RECEIVED,this.handleQuillData,this);this.appContext.bus.unsubscribe(a.QUILL_LIKE_RECEIVED,this.handleQuillData,this);this.appContext.bus.unsubscribe(a.QUILL_UNLIKE_RECEIVED,this.handleQuillData,this);fyre.conv.manager.PermalinkContentManager.superClass_.disposeInternal.call(this)};fyre.conv.manager.StreamContentManager=function(a){var b=fyre.conv.events;this.opineCache_={};a.bus.subscribe(b.STREAM_DATA_RECEIVED,this.handleStreamData,this);a.bus.subscribe(b.QUILL_MESSAGE_RECEIVED,this.handleQuillData,this);a.bus.subscribe(b.QUILL_LIKE_RECEIVED,this.handleQuillData,this);a.bus.subscribe(b.QUILL_UNLIKE_RECEIVED,this.handleQuillData,this);fyre.conv.manager.ContentManager.call(this,a)};goog.inherits(fyre.conv.manager.StreamContentManager,fyre.conv.manager.ContentManager);
fyre.conv.manager.StreamContentManager.prototype.getCommentData=function(a,b){goog.object.setIfUndefined(this.promises_,a,[]);this.promises_[a].push(b);this.states_[a]&&b.updateContent(this.states_[a]);this.pendingOrComplete_[a]?(b.trigger(b.EVENTS.REQ_COMPLETE,{pageIdx:a}),b.set(b.ATTRIBUTES.HAS_DATA,!0)):(this.pendingOrComplete_[a]=!0,this.appContext.collectionService.getCollection(goog.bind(this.fetchCommentData,this,a)))};
fyre.conv.manager.StreamContentManager.prototype.fetchCommentData=function(a,b){if(!this.isDisposed()){var c=goog.bind(this.handleFetchCommentDataSuccess,this,a),d=goog.bind(this.handleFetchCommentDataFailure,this,a);a>=b.get(b.ATTRIBUTES.ARCHIVE_INFO).nPages&&(0<a&&goog.asserts.fail(),a=this.HEAD);if(a==this.HEAD)c(b.get(b.ATTRIBUTES.HEAD_DOCUMENT));else{var e=this.getCommentPageUrl_(a,b);fyre.conv.client.BootstrapClient.getInstance().getBootstrapData(e,c,d)}}};
fyre.conv.manager.StreamContentManager.prototype.handleFetchCommentDataSuccess=function(a,b){if(!this.isDisposed()){var c=fyre.conv.service.ContentAdapter.adaptBootstrapResponse(a,b);goog.object.forEach(c.authors,goog.bind(this.appContext.bus.trigger,this.appContext.bus,fyre.conv.events.BOOTSTRAP_AUTHOR_RECEIVED));c.followers&&goog.array.forEach(c.followers,goog.bind(this.appContext.bus.trigger,this.appContext.bus,fyre.conv.events.BOOTSTRAP_FOLLOWER_RECEIVED));goog.object.forEach(c.content,function(a){goog.object.extend(c.content,
this.removeOrphans(a))},this);goog.object.extend(this.pageIndex_,goog.object.map(c.content,goog.functions.constant(a)));this.addPageData(a,c.content);this.fetchErefs(c.erefs);this.forEachPromise(a,function(b){b.trigger(b.EVENTS.REQ_COMPLETE,{pageIdx:a});b.set(b.ATTRIBUTES.HAS_DATA,!0)})}};fyre.conv.manager.StreamContentManager.prototype.handleFetchCommentDataFailure=function(a){this.isDisposed()||(this.pendingOrComplete_[a]=!1,this.forEachPromise(a,function(a){a.trigger(a.EVENTS.REQ_FAILED)}))};
fyre.conv.manager.StreamContentManager.prototype.addPageData=function(a,b){fyre.conv.manager.StreamContentManager.superClass_.addPageData.call(this,a,b);this.updateOpineCache_(b)};fyre.conv.manager.StreamContentManager.prototype.updateOpineCache_=function(a){goog.object.forEach(a,function(a){if(a.type===fyre.v1.enums.content.type.OPINE){var c=a.content.targetId;goog.object.setIfUndefined(this.opineCache_,c,[]);this.opineCache_[c].push(a)}},this)};
fyre.conv.manager.StreamContentManager.prototype.getOpineCache=function(){return this.opineCache_};fyre.conv.manager.StreamContentManager.prototype.filterMoreContentState_=function(a,b){var c=a.refComment.get(a.refComment.ATTRIBUTES.CREATED);if(a.oldestFirst&&b.content.createdAt>c||!a.oldestFirst&&b.content.createdAt<c||(c=b.content.ancestorId)&&c!=b.id)return!0};
fyre.conv.manager.StreamContentManager.prototype.handleMoreContentResponse_=function(a,b){var c=b.pageIdx;a.nRequests++;var d=goog.bind(function(b){if(b.type==fyre.conv.service.STATE_ENUM_TYPE.MESSAGE){var d=b;if(b=b.content.ancestorId||b.content.parentId)if(d=this.states_[c][b],!d){goog.asserts.fail();return}this.filterMoreContentState_(a,d)&&a.nFetched++}},this);this.states_[c]&&goog.object.forEach(this.states_[c],d,this);this.erefPartials_[c]&&goog.object.forEach(this.erefPartials_[c],d,this);
a.oldestFirst?c++:c--;this.getMoreContent(a,c)};fyre.conv.manager.StreamContentManager.prototype.fetchedAllData_=function(a,b){var c=this.appContext.collectionService.collection(),c=c.get(c.ATTRIBUTES.ARCHIVE_INFO);return 0>b||b>=c.nPages||a.nRequests>=a.maxRequests||a.nFetched>=a.targetResults||a.nFetched>=Math.max(a.minResults,0.8*a.targetResults)?!0:!1};
fyre.conv.manager.StreamContentManager.prototype.getMoreContent=function(a,b){var c=this.appContext.collectionService.collection();c.get(c.ATTRIBUTES.ARCHIVE_INFO);c=a.promise;c.filterContent=goog.bind(function(b){return goog.object.filter(b,goog.bind(this.filterMoreContentState_,this,a))},this);var d=goog.bind(this.handleMoreContentResponse_,this,a);c.on(c.EVENTS.REQ_COMPLETE,d);this.fetchedAllData_(a,b)?c.set(c.ATTRIBUTES.BOOTSTRAP_REQUEST_COMPLETE,!0):this.getCommentData(b,c)};
fyre.conv.manager.StreamContentManager.prototype.getArchivePageIndex=function(a){var b=this.pageIndex_[a.id];goog.asserts.assert(goog.isDefAndNotNull(b));if(b!=this.HEAD)return b;b=this.appContext.collectionService.collection();b=b.get(b.ATTRIBUTES.ARCHIVE_INFO);a=a.get(a.ATTRIBUTES.CREATED);if(!(0==b.nPages||a>b.pageInfo[b.nPages-1])){for(var c=b.nPages-1;0<=c;c--){var d=b.pageInfo[c];if(!d){goog.asserts.fail();return}if(a>=d.first)return c}goog.asserts.fail()}};
fyre.conv.manager.StreamContentManager.prototype.getCommentPageUrl_=function(a,b){var c=b.get(b.ATTRIBUTES.ARCHIVE_INFO);goog.asserts.assert(a!=this.HEAD,"The head document is integrated into init, we never need to get its URL.");var d=c.pageInfo[a];if(d&&d.url)return d.url;goog.asserts.assert(c.pathBase,"New-style init should always have pathBase, if this is old-style we shouldn't be here.");return c.pathBase+a+".json"};
fyre.conv.manager.StreamContentManager.prototype.hasMoreContent=function(a,b){var c=b==fyre.v1.enums.content.direction.OLD,d=this.appContext.collectionService.collection(),e=d.get(d.ATTRIBUTES.ARCHIVE_INFO),f=this.getArchivePageIndex(a,c);if(!goog.isDefAndNotNull(f)||!c&&d.get(d.ATTRIBUTES.HEAD_IS_COMPLETE))return!1;for(d=0;5>d;d++){var g=d;c||(g*=-1);g=f+g;if(0>g||g>=e.nPages)break;if(this.pageHasMoreContent_(g,a,c))return!0}return!1};
fyre.conv.manager.StreamContentManager.prototype.pageHasMoreContent_=function(a,b,c){var d=this.states_[a],e=this.appContext.collectionService.collection();e.get(e.ATTRIBUTES.ARCHIVE_INFO);var f=b.get(b.ATTRIBUTES.CREATED);return!this.pendingOrComplete_[a]||!d?!0:goog.object.some(d,function(a){return c?a.content.createdAt>f&&!a.content.parentId:f>a.content.createdAt})};fyre.conv.manager.StreamContentManager.prototype.isContentInHead=function(a){return this.pageIndex_[a]==this.HEAD};
fyre.conv.manager.StreamContentManager.prototype.disposeInternal=function(){var a=fyre.conv.events;this.appContext.bus.unsubscribe(a.STREAM_DATA_RECEIVED,this.handleStreamData,this);this.appContext.bus.unsubscribe(a.QUILL_MESSAGE_RECEIVED,this.handleQuillData,this);this.appContext.bus.unsubscribe(a.QUILL_LIKE_RECEIVED,this.handleQuillData,this);this.appContext.bus.unsubscribe(a.QUILL_UNLIKE_RECEIVED,this.handleQuillData,this);fyre.conv.manager.StreamContentManager.superClass_.disposeInternal.call(this)};fyre.conv.service.ContentService=function(a,b){fyre.v1.service.ServiceBase.call(this,a,b);this.streamManager=new fyre.conv.manager.StreamContentManager(a)};goog.inherits(fyre.conv.service.ContentService,fyre.v1.service.ServiceBase);fyre.conv.service.ContentService.prototype.initPermalinkManager=function(){this.permalinkManager=new fyre.conv.manager.PermalinkContentManager(this.context)};
fyre.conv.service.ContentService.prototype.initTopContentManager=function(a){this.topContentManager=new fyre.conv.manager.TopContentContentManager(this.context,a)};fyre.conv.service.ContentService.prototype.getInitialContent=function(a){return this.getCommentData(a==fyre.v1.enums.content.direction.NEW?this.streamManager.HEAD:0)};fyre.conv.service.ContentService.prototype.getCommentData=function(a){var b=new fyre.conv.model.BootstrapResponseModel;this.streamManager.getCommentData(a,b);return b};
fyre.conv.service.ContentService.prototype.getMoreContent=function(a,b,c){var b=b==fyre.v1.enums.content.direction.OLD,d=this.streamManager.getArchivePageIndex(a,b),e=new fyre.conv.model.BootstrapResponseModel;this.streamManager.getMoreContent({refComment:a,oldestFirst:b,minResults:0.25*c,targetResults:c,maxRequests:4,promise:e,nFetched:0,nRequests:1},d);return e};
fyre.conv.service.ContentService.prototype.fetchAuthorData=function(a,b,c,d){fyre.conv.client.BootstrapClient.getInstance().getAuthorData(a,b,c,d)};fyre.conv.service.ContentService.prototype.getContentThread=function(a,b){this.permalinkManager||this.initPermalinkManager();var c=new fyre.conv.model.BootstrapResponseModel;this.permalinkManager.getContentThread(a,c,b);return c};
fyre.conv.service.ContentService.prototype.getAggregateContent=function(a){this.disposeTopContentManager();this.initTopContentManager();var b=new fyre.conv.model.BootstrapResponseModel;this.topContentManager.getAggregateContent(a,b);return b};fyre.conv.service.ContentService.prototype.getHotThreads=function(){this.disposeTopContentManager();this.initTopContentManager();var a=new fyre.conv.model.BootstrapResponseModel;this.topContentManager.getHotThreads(a);return a};
fyre.conv.service.ContentService.prototype.getThread=function(a,b){this.disposeTopContentManager();this.initTopContentManager(!0);var c=new fyre.conv.model.BootstrapResponseModel;this.topContentManager.getThread(a,b,c);return c};fyre.conv.service.ContentService.prototype.disposeTopContentManager=function(){this.topContentManager&&this.topContentManager.dispose();this.topContentManager=null};
fyre.conv.service.ContentService.prototype.hasMoreContent=function(a,b){return this.streamManager.hasMoreContent(a,b)};fyre.conv.service.ContentService.prototype.getRepliesFor=function(a){var b=this.streamManager.getArchivePageIndex(a),c=new fyre.conv.model.BootstrapResponseModel;c.filterContent=function(b){return goog.object.filter(b,function(b){return b.content.ancestorId==a.id})};this.streamManager.getCommentData(b,c);return c};fyre.conv.service.ContentService.prototype.isContentInHead=function(a){return this.streamManager.isContentInHead(a)};fyre.v1.controller={};fyre.v1.controller.Controller=function(a,b){fyre.v1.object.AppContextObject.call(this,a,b)};goog.inherits(fyre.v1.controller.Controller,fyre.v1.object.AppContextObject);fyre.v1.controller.Controller.prototype.isSuccess=function(a){return"code"in a&&(2==(a.code+"").substring(0,1)||304===a.code)?!0:!1};fyre.conv.client.LivecountClient=function(a){a=a||{};fyre.v1.client.BaseClient.call(this,a);this.uid=a.uid||null;this.collectionId=a.collectionId||null;this.success=a.success||goog.nullFunction;this.failure=a.failure||goog.nullFunction;this.stopped=!1;this.configureLogging("fyre.conv.client.LivecountClient")};goog.inherits(fyre.conv.client.LivecountClient,fyre.v1.client.BaseClient);
fyre.conv.client.LivecountClient.prototype._getXHR=function(){var a={url:[this.routed?this.routed:fyre.conv.config.servers.livecount,"livecountping",this.collectionId,this.uid].join("/"),timeout:1E4,success:goog.bind(this.handleLivecountSuccess,this),failure:goog.bind(this.handleLivecountFailure,this)};a[fyre.v1.io.WITH_CREDENTIALS]=!1;return new fyre.v1.io.XDR(a)};fyre.conv.client.LivecountClient.prototype.isRunning=function(){return this.xhr&&this.xhr.running};
fyre.conv.client.LivecountClient.prototype.restart=function(){this.xhr.abort();this.start()};fyre.conv.client.LivecountClient.prototype.stop=function(){this.stopped=!0;this.xhr.abort()};fyre.conv.client.LivecountClient.prototype.start=function(){goog.asserts.assert(this.collectionId);this.xhr=this._getXHR();var a={__:goog.string.getRandomString()};this.routed?a.routed="1":this.timeout&&(a.timeout="1");this.xhr.send(a)};
fyre.conv.client.LivecountClient.prototype.handleLivecountSuccess=function(a){if(!this.stopped){var b=a.data;this.timeout=!1;switch(a.code){case 302:this.routed=b;this.start();break;case 500:this.routed=!1;this.start();break;default:this.success(b)}}};fyre.conv.client.LivecountClient.prototype.handleLivecountFailure=function(a){this.stopped||(this.timeout=!0,this.routed=!1,this.failure(a.data))};fyre.conv.model.Livecount=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.Livecount,fyre.v1.model.Model);fyre.conv.model.Livecount.ATTRIBUTES=fyre.conv.model.Livecount.prototype.ATTRIBUTES={LISTENERS:"listeners",FOLLOWERS:"followers"};fyre.conv.model.Livecount.prototype.defaults=function(){var a={},b=fyre.conv.model.Livecount.ATTRIBUTES;a[b.LISTENERS]=0;a[b.FOLLOWERS]=0;return a}();fyre.conv.service.LivecountHandler=function(a,b){fyre.v1.handler.HandlerBase.call(this,a,b)};goog.inherits(fyre.conv.service.LivecountHandler,fyre.v1.handler.HandlerBase);fyre.conv.service.LivecountHandler.prototype.initialize=function(a,b){this.opts=a;this.service=b;fyre.conv.service.LivecountHandler.superClass_.initialize.call(this,a,b)};fyre.conv.service.LivecountHandler.prototype.handleConvInit=function(a){this.service.handleConvInit(a)};
fyre.v1.util.handler([fyre.conv.events.COLLECTION_INITIALIZED],fyre.conv.service.LivecountHandler.prototype.handleConvInit);fyre.conv.service.LivecountService=function(a,b){fyre.v1.controller.Controller.call(this,a,b);this.model=new fyre.conv.model.Livecount};goog.inherits(fyre.conv.service.LivecountService,fyre.v1.controller.Controller);fyre.conv.service.LivecountService.PAUSE=6E4;fyre.conv.service.LivecountService.prototype.initialize=function(a){this.livecountClient=null;this.handler=new (a.handler||fyre.conv.service.LivecountHandler)(a,this);this.livecountErrorCount=0;this.ERROR_THESHOLD=3};
fyre.conv.service.LivecountService.prototype.handleConvInit=function(){this.start()};fyre.conv.service.LivecountService.prototype.start=function(){this.runLivecount()};fyre.conv.service.LivecountService.prototype.stop=function(){this.stopped=!0;this.livecountTimeout_&&clearTimeout(this.livecountTimeout_);this.livecountClient&&this.livecountClient.stop()};
fyre.conv.service.LivecountService.prototype.runLivecount=function(){this.livecountClient||(this.livecountClient=new fyre.conv.client.LivecountClient({uid:this.getLivecountUuid(),collectionId:this.context.collectionService.collection().id,success:goog.bind(this.handleLivecountSuccess,this),failure:goog.bind(this.handleLivecountFailure,this)}));this.livecountTimeout_&&clearTimeout(this.livecountTimeout_);!this.livecountClient.isRunning()&&!this.stopped&&this.livecountClient.start()};
fyre.conv.service.LivecountService.prototype.getLivecountUuid=function(){var a=goog.net.cookies.get(fyre.conv.config.LIVECOUNT_COOKIE);goog.isDefAndNotNull(a)||(a=Math.floor(Math.random()*Math.pow(10,12)),goog.net.cookies.set(fyre.conv.config.LIVECOUNT_COOKIE,a));return a};
fyre.conv.service.LivecountService.prototype.handleLivecountSuccess=function(a){var b=fyre.conv.model.Livecount.ATTRIBUTES,c=this.model.get(b.LISTENERS)||0;0<c&&a<c/2&&(a=Math.ceil(0.9*c));this.model.set(b.LISTENERS,a);this.livecountErrorCount=0;this.livecountTimeout_=setTimeout(goog.bind(this.runLivecount,this),fyre.conv.service.LivecountService.PAUSE)};
fyre.conv.service.LivecountService.prototype.handleLivecountFailure=function(){this.livecountErrorCount++;if(this.livecountErrorCount<=this.ERROR_THESHOLD){var a=fyre.conv.service.LivecountService.PAUSE*this.livecountErrorCount;this.livecountTimeout_=setTimeout(goog.bind(this.runLivecount,this),a)}};fyre.v1.io.Poll=function(a){fyre.v1.io.XDR.call(this,a);this.loop=goog.isBoolean(a.loop)?a.loop:!0;this.delay=a.delay||0;this.data=a.data||null;this.aborted=this.running=!1};goog.inherits(fyre.v1.io.Poll,fyre.v1.io.XDR);fyre.v1.io.Poll.prototype.send=function(a){this.running||(this.aborted=!1,this.running=!0,this.data=a||this.data,fyre.v1.io.Poll.superClass_.send.call(this,this.data))};fyre.v1.io.Poll.prototype.abort=function(){clearTimeout(this.request_timeout);this.aborted=!0;fyre.v1.io.Poll.superClass_.abort.call(this)};
fyre.v1.io.Poll.prototype.isRunning=function(){return this.running};fyre.v1.io.Poll.prototype.success=function(a){fyre.v1.io.Poll.superClass_.success.call(this,a);this.running=!1;this.loop&&!this.aborted&&(this.request_timeout=setTimeout(goog.bind(function(){this.send(this.data)},this),this.delay))};
fyre.v1.io.Poll.prototype.failure=function(a){fyre.v1.io.Poll.superClass_.failure.call(this,a);this.running=!1;this.loop&&!this.aborted&&(this.request_timeout=setTimeout(goog.bind(function(){this.send(this.data)},this),this.delay))};fyre.v1.client.StreamClient=function(a){var b={url:fyre.v1.config.servers.stream,data:{},success:goog.bind(this.success,this),failure:goog.bind(this.failure,this),loop:!0,timeout:65,delay:500};fyre.v1.client.BaseClient.call(this,a);this.xhr=new fyre.v1.io.Poll(b);this.success_cb=function(){};this.failure_cb=function(){};this.stopped=!1;this.errors=0;this.configureLogging("fyre.v1.client.StreamClient");this.streamBackend=null};goog.inherits(fyre.v1.client.StreamClient,fyre.v1.client.BaseClient);
goog.exportSymbol("fyre.v1.client.StreamClient",fyre.v1.client.StreamClient);fyre.v1.client.StreamClient.prototype.CONSTANTS={STATES:"states",COMMENTS:"comments",AUTHORS:"authors",FOLLOWERS:"followers",EVENTID:"maxEventId"};fyre.v1.client.StreamClient.prototype.setBackend=function(a){this.streamBackend=a};fyre.v1.client.StreamClient.prototype._degrade=function(a){this.xhr.delay=Math.round(1E3*(Math.random()+0.5)*a)};
fyre.v1.client.StreamClient.prototype.prepareUrl_=function(){var a=this.streamBackend.getServer().split(":");this.xhr.url.setDomain(a[0]);this.xhr.url.setPort(a[1]);this.xhr.url.setPath("/v3.0/collection/"+this.collectionId+"/"+this.eventId+"/");this.logger.info("sending event ID: ",this.eventId)};
fyre.v1.client.StreamClient.prototype.start=function(a,b,c){goog.asserts.assert(this.streamBackend);this.eventId=a.eventId||this.eventId||0;this.logger.info("starting poll at event ID:",this.eventId);delete a.eventId;this.collectionId=a.collectionId;delete a.collectionId;this.prepareUrl_();a=a||{};this.success_cb=b;this.failure_cb=c;this.xhr.send(a);this.stopped=!1};goog.exportProperty(fyre.v1.client.StreamClient.prototype,"start",fyre.v1.client.StreamClient.prototype.start);
fyre.v1.client.StreamClient.prototype.stop=function(){this.stopped||(this.logger.info("stopping poll"),this.stopped=!0,this.xhr.abort())};goog.exportProperty(fyre.v1.client.StreamClient.prototype,"stop",fyre.v1.client.StreamClient.prototype.stop);fyre.v1.client.StreamClient.CLIENT_DELAY="client_delay";
fyre.v1.client.StreamClient.prototype.success=function(a){this.errors=0;this.xhr.delay=500;if(this.stopped)this.xhr.abort();else if(a){if(!("timeout"in a)){var b=a.data;this.eventId=b.maxEventId;this.logger.info("streamClient setting event ID: ",this.eventId);0<a[fyre.v1.client.StreamClient.CLIENT_DELAY]&&(this.xhr.delay=1E3*a[fyre.v1.client.StreamClient.CLIENT_DELAY]);this.prepareUrl_();this.success_cb(b)}}else this.logger.shout("Bad response object")};
fyre.v1.client.StreamClient.prototype.adaptResponse=function(a){var b={},a=a.data;b[this.CONSTANTS.AUTHORS]=goog.object.map(a[this.CONSTANTS.AUTHORS],this.adaptAuthor,this);b[this.CONSTANTS.STATES]=a[this.CONSTANTS.STATES]||[];return b};fyre.v1.client.StreamClient.prototype.adaptAuthor=function(a,b){var c=fyre.v1.model.User.ATTRIBUTES;a[c.ID]=b;0<!a[c.RATE]&&(a[c.RATE]=0);return a};
fyre.v1.client.StreamClient.prototype.failure=function(a,b){this.stopped||(this.streamBackend.onBackendFailure(),this.errors++,this.xhr.delay*=2,this.prepareUrl_(),this.failure_cb({version:this.version,data:a.data,event:b}))};fyre.v1.client.StreamClient.fetchStreamServers=function(a,b,c,d){a=goog.Uri.parse("http://"+a+"/servers/").toString();(new fyre.v1.io.XDR({url:a,success:c,failure:d})).send(b)};fyre.v1.lib.ConsistentHashing=function(a,b){this.replicas=160;this.ring={};this.keys=[];this.nodes=[];b=b||{};b.replicas&&(this.replicas=b.replicas);for(var c=0;c<a.length;c++)this.addNode(a[c])};fyre.v1.lib.ConsistentHashing.prototype.addNode=function(a){this.nodes.push(a);for(var b=0;b<this.replicas;b++){var c=this.crypto(a)+":"+b;this.keys.push(c);this.ring[c]=a}this.keys.sort()};
fyre.v1.lib.ConsistentHashing.prototype.removeNode=function(a){for(var b=0;b<this.nodes.length;b++)this.nodes[b]==a&&(this.nodes.splice(b,1),b--);for(b=0;b<this.replicas;b++){var c=this.crypto(a)+":"+b;delete this.ring[c];for(var d=0;d<this.keys.length;d++)this.keys[d]==c&&(this.keys.splice(d,1),d--)}};fyre.v1.lib.ConsistentHashing.prototype.getNode=function(a){return 0==this.getRingLength()?0:this.ring[this.keys[this.getNodePosition(this.crypto(a))]]};
fyre.v1.lib.ConsistentHashing.prototype.getNodePosition=function(a){var b=this.getRingLength()-1,c=0,d=0,e=0;if(0==b)return 0;for(;c<=b;){d=Math.floor((c+b)/2);e=this.compare(this.keys[d],a);if(0==e)return d;0<e?b=d-1:c=d+1}0>b&&(b=this.getRingLength()-1);return b};fyre.v1.lib.ConsistentHashing.prototype.getRingLength=function(){return goog.object.getKeys(this.ring).length};fyre.v1.lib.ConsistentHashing.prototype.compare=function(a,b){return a>b?1:a<b?-1:0};
fyre.v1.lib.ConsistentHashing.prototype.crypto=function(a){var b=new goog.crypt.Md5;b.update(a);return b.digest()};fyre.conv.stream={};fyre.conv.stream.StreamBackend={};fyre.conv.stream.StreamBackend.BackendInterface=function(){};fyre.conv.stream.StreamBackend.ELBBackend_=function(){};fyre.conv.stream.StreamBackend.ELBBackend_.prototype.getServer=function(){return fyre.conv.config.servers.stream.replace("http://","")};fyre.conv.stream.StreamBackend.ELBBackend_.prototype.onBackendFailure=goog.nullFunction;fyre.conv.stream.StreamBackend.ELBBackend=new fyre.conv.stream.StreamBackend.ELBBackend_;
fyre.conv.stream.StreamBackend.HashingBackend=function(a,b){this.hash=a;this.collectionId=b};fyre.conv.stream.StreamBackend.HashingBackend.prototype.getServer=function(){return 0==this.hash.nodes.length?fyre.conv.stream.StreamBackend.ELBBackend.getServer():this.hash.getNode(this.collectionId)};fyre.conv.stream.StreamBackend.HashingBackend.prototype.onBackendFailure=function(){this.hash.removeNode(this.hash.getNode(this.collectionId))};
fyre.conv.stream.StreamBackend.getStreamBackend=function(a,b){var c=fyre.conv.model.Collection.ATTRIBUTES,d=a.get(c.MODIFIED),c=a.get(c.STREAM_HASH_THRESHOLD),e=goog.now()/1E3;c>e-d?b(fyre.conv.stream.StreamBackend.ELBBackend):fyre.conv.stream.StreamBackend.fetchStreamServers(a.id,b)};
fyre.conv.stream.StreamBackend.fetchStreamServers=function(a,b){var c={domain:fyre.conv.config.servers.domain,collectionId:a},d=fyre.conv.stream.StreamBackend.ELBBackend.getServer();fyre.v1.client.StreamClient.fetchStreamServers(d,c,function(c){c=c.servers;!c||goog.array.isEmpty(c)?b(fyre.conv.stream.StreamBackend.ELBBackend):(c=new fyre.v1.lib.ConsistentHashing(c),b(new fyre.conv.stream.StreamBackend.HashingBackend(c,a)))},function(){b(fyre.conv.stream.StreamBackend.ELBBackend)})};fyre.conv.service.StreamService=function(a){var b=a.appOpts;this.logger=fyre.v1.logging.getLogger("StreamService");this.client=new fyre.v1.client.StreamClient;fyre.v1.controller.Controller.call(this,a,b);this.fetchBackendComplete_=!1;a.bus.subscribe(fyre.conv.events.COLLECTION_INITIALIZED,this.start,this)};goog.inherits(fyre.conv.service.StreamService,fyre.v1.controller.Controller);fyre.conv.service.StreamService.prototype.isRunning=function(){return!!this.client.running};
fyre.conv.service.StreamService.prototype.stop=function(){this.client.stop()};fyre.conv.service.StreamService.prototype.start=function(){this.startStream()};fyre.conv.service.StreamService.prototype.fetchBackendComplete=function(a,b,c){goog.asserts.assert(c.getServer);this.fetchBackendComplete_=!0;this.client.setBackend(c);this.startStream(a,b)};
fyre.conv.service.StreamService.prototype.startStream=function(a,b){var c=this.context.collectionService.collection();if(this.fetchBackendComplete_){var d=c.id,c=c.get(fyre.conv.model.Collection.ATTRIBUTES.EVENT);goog.asserts.assert(d);goog.asserts.assert(goog.isDefAndNotNull(c));if(this.isRunning())b?b():goog.asserts.assert(!1);else{a=goog.functions.compose(a||goog.nullFunction,goog.bind(this.handleStreamData,this));if(goog.DEBUG){var e=fyre.conv.test.fixtureLoader.loadFixture("stream");if(e){a(e);
return}}this.client.start({collectionId:d,eventId:c},a,b||goog.nullFunction)}}else fyre.conv.stream.StreamBackend.getStreamBackend(c,goog.bind(this.fetchBackendComplete,this,a,b))};
fyre.conv.service.StreamService.prototype.handleStreamData=function(a){this.trigger(fyre.conv.events.STREAM_DATA_RECEIVED_RAW,a);var b={content:{},erefs:{},settings:[],followers:[]};a.authors&&goog.object.forEach(a.authors,goog.bind(this.context.trigger,this.context,fyre.conv.events.STREAM_AUTHOR_RECEIVED));a.states&&goog.object.forEach(a.states,goog.bind(this.handleStreamContent,this,b));a.settings&&goog.array.forEach(a.settings,goog.bind(this.handleStreamSettings,this,b));a.followers&&goog.array.forEach(a.followers,
goog.bind(this.handleStreamFollowers,this,b));this.trigger(fyre.conv.events.STREAM_DATA_RECEIVED,b);return b};
fyre.conv.service.StreamService.prototype.handleStreamContent=function(a,b,c){this.logger.fine("Stream content: "+goog.json.serialize(b));b.fromStream=!0;var d=fyre.conv.model.ContentState.ATTRIBUTES;if(b[d.EREFS])b[d.CONTENT]={id:c},a.erefs[c]=b;else{var e;switch(b[fyre.conv.model.ContentState.ATTRIBUTES.TYPE]){case fyre.conv.model.ContentState.ENUM_TYPE.MESSAGE:e=fyre.conv.events.STREAM_MESSAGE_RECEIVED;break;case fyre.conv.model.ContentState.ENUM_TYPE.OPINE:e=fyre.conv.events.STREAM_OPINE_RECEIVED;
break;case fyre.conv.model.ContentState.ENUM_TYPE.OEMBED:e=fyre.conv.events.STREAM_MEDIA_RECEIVED;break;default:goog.asserts.fail("Unknown content type received from stream, type=%s, id=%s",b.type,c)}a.content[c]=b;this.trigger(e,b)}};fyre.conv.service.StreamService.prototype.handleStreamSettings=function(a,b){a.settings.push(b);this.trigger(fyre.conv.events.STREAM_SETTING_RECEIVED,b)};
fyre.conv.service.StreamService.prototype.handleStreamFollowers=function(a,b){a.followers.push(b);this.trigger(fyre.conv.events.STREAM_FOLLOWER_RECEIVED,b)};fyre.v1.client.FilepickerClient=function(){this.logger_=fyre.v1.logging.getLogger("fyre.v1.client.FilepickerClient")};goog.addSingletonGetter(fyre.v1.client.FilepickerClient);fyre.v1.client.FilepickerClient.FILEPICKER_SOURCE_URL="//api.filepicker.io/v1/filepicker.js";fyre.v1.client.FilepickerClient.FILEPICKER_API_KEY="AYNlO8P2PT6qnCfo9eCw2z";fyre.v1.client.FilepickerClient.MEDIA_CACHE_URL="http://media.fyre.co/";
fyre.v1.client.FilepickerClient.FILEPICKER_OPTIONS={PICK:{container:"modal",maxSize:4194304,mimetypes:["image/*"],multiple:!0,services:"COMPUTER,WEBCAM,IMAGE_SEARCH,FACEBOOK,INSTAGRAM,FLICKR,PICASA,BOX,DROPBOX,GOOGLE_DRIVE".split(",")},STORAGE:{location:"S3",access:"public"}};
fyre.v1.client.FilepickerClient.prototype.init=function(){this.filepicker_||(goog.global.filepicker?this.logger_.severe("Global filepicker object already defined..."):fyre.v1.util.ScriptLoader.loadScript(fyre.v1.client.FilepickerClient.FILEPICKER_SOURCE_URL,null,null,goog.bind(this.init_,this)))};fyre.v1.client.FilepickerClient.prototype.init_=function(){this.filepicker_=goog.global.filepicker;this.filepicker_.setKey(fyre.v1.client.FilepickerClient.FILEPICKER_API_KEY)};
fyre.v1.client.FilepickerClient.prototype.pickAndStore=function(a){var b=fyre.v1.client.FilepickerClient.FILEPICKER_OPTIONS;this.filepicker_.pickAndStore(b.PICK,b.STORAGE,a)};fyre.conv.service.MediaService=function(a){fyre.v1.service.ServiceBase.call(this,a)};goog.inherits(fyre.conv.service.MediaService,fyre.v1.service.ServiceBase);fyre.conv.service.MediaService.prototype.pickAndStore=function(a){goog.asserts.assertFunction(a);fyre.v1.client.FilepickerClient.getInstance().pickAndStore(goog.bind(function(b){b=this.adaptFilepickerContent_(b);a(b)},this))};
fyre.conv.service.MediaService.prototype.adaptFilepickerContent_=function(a){return goog.array.map(a,function(a){var c=fyre.v1.client.FilepickerClient.MEDIA_CACHE_URL+a.key,a=this.resolveMimeType_(a.mimetype);return{source_url:c,type:a}},this)};fyre.conv.service.MediaService.prototype.resolveMimeType_=function(a){return a.match(/^video\//i)?"video":"image"};fyre.conv.app.AppContext=function(a,b,c){this.appOpts=c||{};this.bus=fyre.conv.bus.createChannel(a);this.getBusExceptionHandler_();this.appName=a;goog.array.forEach(b,goog.bind(this.setService,this))};goog.inherits(fyre.conv.app.AppContext,goog.Disposable);fyre.conv.app.AppContext.prototype.bus=null;
fyre.conv.app.AppContext.prototype.disposeInternal=function(){fyre.conv.app.AppContext.superClass_.disposeInternal.call(this);this.disposeBusExceptionHandler_();this.bus.dispose();delete this.bus;this.collectionService&&this.collectionService.dispose()};fyre.conv.app.AppContext.prototype.getBusExceptionHandler_=function(){var a=this.busExceptionHandler_;if(a)return a;a=fyre.v1.error.ExceptionHandler.getInstance();a.wrapBus(this.bus);return this.busExceptionHandler_=a};
fyre.conv.app.AppContext.prototype.disposeBusExceptionHandler_=function(){this.busExceptionHandler_&&(this.busExceptionHandler_.unwrapBus(this.bus),delete this.busExceptionHandler_)};
fyre.conv.app.AppContext.prototype.setService=function(a){var b=this.appOpts;switch(a){case fyre.conv.service.ActionQueueService:this.actionQueueService=new fyre.conv.service.ActionQueueService(this,b);break;case fyre.conv.service.AuthenticationService:this.authenticationService=fyre.conv.service.AuthenticationService.getInstance(this);break;case fyre.conv.service.LocalStorageService:this.localStorageService=fyre.conv.service.LocalStorageService.getInstance();break;case fyre.conv.service.CollectionService:this.collectionService=
new fyre.conv.service.CollectionService(this,b);break;case fyre.conv.service.CommentService:this.commentService=new fyre.conv.service.CommentService(this,b);break;case fyre.conv.service.ContentService:this.contentService=new fyre.conv.service.ContentService(this,b);break;case fyre.conv.service.StreamService:this.streamService=new fyre.conv.service.StreamService(this);break;case fyre.conv.service.LivecountService:this.livecountService=new fyre.conv.service.LivecountService(this,b);break;case fyre.conv.service.MediaService:this.mediaService=
new fyre.conv.service.MediaService(this,b);break;case fyre.conv.share.ShareService:this.shareService=new fyre.conv.share.ShareService(this,b);break;default:goog.asserts.fail("Unrecognized service type.")}};fyre.conv.app.AppContext.deprecatedWarning=function(){goog.DEBUG&&goog.global.console&&goog.global.console.log&&goog.global.console.log("deprecated... use appContext.bus directly.")};
fyre.conv.app.AppContext.prototype.subscribe=function(){fyre.conv.app.AppContext.deprecatedWarning();this.bus.subscribe.apply(this.bus,arguments)};fyre.conv.app.AppContext.prototype.subscribeOnce=function(){fyre.conv.app.AppContext.deprecatedWarning();this.bus.subscribeOnce.apply(this.bus,arguments)};fyre.conv.app.AppContext.prototype.trigger=function(){fyre.conv.app.AppContext.deprecatedWarning();this.isDisposed()||this.bus.trigger.apply(this.bus,arguments)};
fyre.conv.app.AppContext.prototype.triggerAll=function(){fyre.conv.app.AppContext.deprecatedWarning();this.isDisposed()||this.bus.triggerAll.apply(this.bus,arguments)};fyre.conv.app.ExternalBus=function(){this.externalBus_=new fyre.v1.messenger.PubSub("conv.app.ExternalBus")};goog.inherits(fyre.conv.app.ExternalBus,goog.Disposable);fyre.conv.app.ExternalBus.prototype.internalBus_=null;fyre.conv.app.ExternalBus.prototype.disposeInternal=function(){fyre.conv.app.ExternalBus.superClass_.disposeInternal.call(this);this.unsetAppContext_()};fyre.conv.app.ExternalBus.prototype.on=function(a,b,c){this.externalBus_.subscribe(a,b||goog.nullFunction,c)};
fyre.conv.app.ExternalBus.prototype.unsetAppContext_=function(){};fyre.conv.app.ExternalBus.prototype.setAppContext=function(a){this.unsetAppContext_();a=a.bus;a!=this.internalBus_&&(this.internalBus_=a,this.register_())};
fyre.conv.app.ExternalBus.prototype.register_=function(){goog.asserts.assertInstanceof(this.internalBus_,fyre.v1.messenger.PubSub);var a=fyre.conv.events,b=this.internalBus_;b.subscribe(a.QUILL_MESSAGE_RECEIVED,this.onCommentPosted_,this);b.subscribe(a.QUILL_FLAG_RECEIVED,this.onCommentFlagged_,this);b.subscribe(a.QUILL_LIKE_RECEIVED,this.onCommentLiked_,this);b.subscribe(a.QUILL_COMMENT_SHARED,this.onCommentShared_,this);b.subscribeOnce(a.STREAM_VIEW_RESET,this.onStreamViewReset_,this);b.subscribe(a.COMMENT_COUNT_UPDATED,
this.onCommentCountUpdated_,this);b.subscribe(a.MENTIONS_SHARED,this.onSocialMention_,this);fyre.conv.bus.subscribe(a.USER_LOGGED_IN,this.onUserLoggedIn_,this);fyre.conv.bus.subscribe(a.USER_LOGGED_OUT,this.onUserLoggedOut_,this)};
fyre.conv.app.ExternalBus.EXTERNAL_EVENTS={COMMENT_COUNT_UPDATED:"commentCountUpdated",COMMENT_FLAGGED:"commentFlagged",COMMENT_LIKED:"commentLiked",COMMENT_POSTED:"commentPosted",COMMENT_SHARED:"commentShared",INITIAL_RENDER_COMPLETE:"initialRenderComplete",USER_LOGGED_IN:"userLoggedIn",USER_LOGGED_OUT:"userLoggedOut",SOCIAL_MENTION:"socialMention"};fyre.conv.app.ExternalBus.prototype.onStreamViewReset_=function(){this.externalBus_.trigger(fyre.conv.app.ExternalBus.EXTERNAL_EVENTS.INITIAL_RENDER_COMPLETE)};
fyre.conv.app.ExternalBus.prototype.onCommentCountUpdated_=function(a){this.externalBus_.trigger(fyre.conv.app.ExternalBus.EXTERNAL_EVENTS.COMMENT_COUNT_UPDATED,a)};
fyre.conv.app.ExternalBus.prototype.onCommentPosted_=function(a){var b=fyre.conv.model.Comment.ATTRIBUTES,a=a.content,c=a[b.SHARE_TYPES],d=fyre.conv.model.Comment.SHARE_TYPES;a[b.REPLACES]||this.externalBus_.trigger(fyre.conv.app.ExternalBus.EXTERNAL_EVENTS.COMMENT_POSTED,{authorId:a[b.AUTHOR_ID],parent:a[b.PARENT_ID],bodyHtml:a[b.BODY_HTML],sharedToFacebook:0<(c&d.FACEBOOK),sharedToTwitter:0<(c&d.TWITTER)})};
fyre.conv.app.ExternalBus.prototype.onCommentFlagged_=function(a){var b=fyre.conv.app.ExternalBus.EXTERNAL_EVENTS,c=fyre.conv.model.ContentFlag.ATTRIBUTES,d=a.get(c.NOTES),a={targetId:a.get(c.TARGET_ID),type:a.get(c.FLAG_TYPE),notes:goog.isArray(d)?d[0]:d};this.externalBus_.trigger(b.COMMENT_FLAGGED,a)};
fyre.conv.app.ExternalBus.prototype.onCommentLiked_=function(a){var b=fyre.conv.app.ExternalBus.EXTERNAL_EVENTS,c=fyre.conv.model.Opine.ATTRIBUTES,a=a.content,c={targetId:a[c.TARGET_ID],targetAuthorId:a[c.TARGET].get(fyre.conv.model.Comment.ATTRIBUTES.AUTHOR_ID)};this.externalBus_.trigger(b.COMMENT_LIKED,c)};
fyre.conv.app.ExternalBus.prototype.onCommentShared_=function(a){var b=fyre.conv.app.ExternalBus.EXTERNAL_EVENTS,c=a.get(fyre.conv.model.Comment.ATTRIBUTES.SHARE_TYPES),d=a.SHARE_TYPES;this.externalBus_.trigger(b.COMMENT_SHARED,{targetId:a.id,sharedToFacebook:0<(c&d.FACEBOOK),sharedToTwitter:0<(c&d.TWITTER)})};
fyre.conv.app.ExternalBus.prototype.onUserLoggedIn_=function(){var a=fyre.conv.app.ExternalBus.EXTERNAL_EVENTS,b=fyre.conv.user.ATTRIBUTES,c=fyre.conv.user,b={avatar:c.get(b.AVATAR),displayName:c.get(b.DISPLAY_NAME),id:c.id,isModerator:c.isModerator()};this.externalBus_.trigger(a.USER_LOGGED_IN,b)};fyre.conv.app.ExternalBus.prototype.onUserLoggedOut_=function(){this.externalBus_.trigger(fyre.conv.app.ExternalBus.EXTERNAL_EVENTS.USER_LOGGED_OUT)};
fyre.conv.app.ExternalBus.prototype.onSocialMention_=function(a){var b=fyre.conv.app.ExternalBus.EXTERNAL_EVENTS,a=goog.array.map(a,function(a){return{displayName:a.display_name,id:a.uid,message:a.message,provider:a.provider}});this.externalBus_.trigger(b.SOCIAL_MENTION,a)};fyre.conv.app.MainAdapter={};
fyre.conv.app.MainAdapter.ingestOptions=function(a){var b={},c=fyre.conv.modules.main.OPTION_KEYS,d=a[c.ARTICLE_ID];goog.asserts.assert(d);b.articleId=d;if(d=a[c.AUTH_DELEGATE])b.authDelegate=d;if(d=a[c.AUTH_PAGE_RELOAD]||fyre.conv.app.MainAdapter.forceAuthPageReload())b.authPageReload=d;if(d=a[c.BETA_BANNER])b.betaBanner=d;d=a[c.XX_USE_SEAMLESS_EDITOR];b.XX_UseSeamlessEditor=d?d:!1;if(d=a[c.CALLBACK])goog.asserts.assertFunction(d),b.callback=d;if(d=a[c.CHECKSUM])goog.asserts.assertString(d),b.checksum=
d;if(d=a[c.COLLECTION_META])goog.asserts.assert(goog.isString(d)||goog.isObject(d)),b.collectionMeta=d;b.datetimeFormat=fyre.conv.app.MainAdapter.ingestDatetimeFormat(a[c.DATETIME_FORMAT]);if(d=a[c.ELEMENT_ID])goog.asserts.assertString(d),b.el=d;if(d=a[c.POST_TO_BUTTONS])b.postToButtons=d;if(d=a[c.SHARE_DELEGATE])b.shareDelegate=d;d=a[c.SIGNED];goog.isDefAndNotNull(d)&&(b.signed=d);if(d=a[c.DISABLE_AVATARS]||!1)b.disableAvatars=d;if(d=a[c.USER_RATING_IN_HOVERCARD])b.userRatingInHovercard=d;if(d=a[c.ATTACHMENT_DELEGATE])b.attachmentDelegate=
d;if(d=a[c.EDITOR_CSS])b.editorCss=d;a=a[c.SITE_ID];goog.asserts.assert(a);b.siteId=a;return b};fyre.conv.app.MainAdapter.DATETIME_OPTION_KEYS={ABSOLUTE_DATETIME_FORMAT:"absoluteFormat",MINUTES_UNTIL_ABSOLUTE_TIME:"minutesUntilAbsoluteTime"};
fyre.conv.app.MainAdapter.ingestDatetimeFormat=function(a){var b={};if(goog.isString(a))return b.absoluteFormat=a,b;goog.isFunction(a)&&(b.override=a);if(goog.isObject(a)){var c=fyre.conv.app.MainAdapter.DATETIME_OPTION_KEYS,d=a[c.ABSOLUTE_DATETIME_FORMAT];d&&(goog.asserts.assertString(d),b.absoluteFormat=d);if(a=a[c.MINUTES_UNTIL_ABSOLUTE_TIME])goog.asserts.assertNumber(a),b.minutesUntilAbsoluteTime=a}return b};
fyre.conv.app.MainAdapter.forceAuthPageReload=function(){return fyre.v1.util.browser.isMobile()&&goog.isDef(fyre.sp)};fyre.conv.model.Share=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.Share,fyre.v1.model.Model);fyre.conv.model.Share.prototype.ATTRIBUTES=fyre.conv.model.Share.ATTRIBUTES={AUTHOR_ID:"authorId",COLLECTION:"collection",COMMENT:"comment",CONTENT:"content",DISPLAY_NAME:"displayName",SERVICES:"services",URL:"url"};
fyre.conv.model.Share.prototype.defaults=function(){var a={},b=fyre.conv.model.Share.ATTRIBUTES;a[b.AUTHOR_ID]=null;a[b.COLLECTION]=null;a[b.COMMENT]=null;a[b.CONTENT]=null;a[b.DISPLAY_NAME]="";a[b.URL]="";a[b.SERVICES]=new goog.structs.Set;return a};fyre.conv.model.Share.prototype.toSoyData=function(){var a={};a.authorId=this.get(this.ATTRIBUTES.AUTHOR_ID);a.displayName=this.get(this.ATTRIBUTES.DISPLAY_NAME);a.url=this.get(this.ATTRIBUTES.URL);return a};fyre.conv.share={};fyre.conv.share.ShareAdapter={};fyre.conv.share.ShareAdapter.KEYS={CONTENT:"content",PROVIDER_TOKENS:"provider_tokens",COMMENT_ID:"message_id",COLLECTION_ID:"collection_id"};fyre.conv.share.ShareAdapter.exportTokens=function(a,b){var c=a.get(fyre.conv.model.User.ATTRIBUTES.OAUTH_TOKENS),d=b.getValues(),e=[];goog.array.forEach(d,function(a){var b=c[a];b&&e.push(a+":"+b)});return e};
fyre.conv.share.ShareAdapter.modelToShare=function(a,b){var c=fyre.conv.model.Share.ATTRIBUTES,d=a.get(c.CONTENT),e=a.get(c.SERVICES),e=fyre.conv.share.ShareAdapter.exportTokens(b,e),f=a.get(c.COMMENT),c=a.get(c.COLLECTION),g={},h=fyre.conv.share.ShareAdapter.KEYS;g[h.PROVIDER_TOKENS]=e;g[h.CONTENT]=d;g[h.COMMENT_ID]=f.id;g[h.COLLECTION_ID]=c.id;return g};fyre.conv.share.SimpleShareDelegate=function(a){var b=a.appOpts||{};this.appContext_=a;this.shareFn_=b.shareDelegate;goog.asserts.assertFunction(this.shareFn_);this.pendingModels_=new goog.structs.Set};goog.inherits(fyre.conv.share.SimpleShareDelegate,goog.Disposable);fyre.conv.share.SimpleShareDelegate.prototype.disposeInternal=function(){goog.array.forEach(this.pendingModels_.values(),function(a){a.off(null,null,this)});this.pendingModels_=null;delete this.shareFn_;this.appContext_=null};
fyre.conv.share.SimpleShareDelegate.prototype.share=function(){goog.asserts.fail("SimpleShareDelegate.share() unimplemented.")};fyre.conv.share.SimpleShareDelegate.prototype.show=function(a){var b=this.appContext_.shareService;a.onChange(fyre.conv.model.Share.ATTRIBUTES.URL,function(b){goog.asserts.assert(b==a);this.shareFn_(fyre.conv.share.SimpleShareDelegate.shareModelToData(a));a.off(null,null,this);this.pendingModels_.remove(a)},this);this.pendingModels_.add(a);b.getShortUrl(a,goog.nullFunction)};
fyre.conv.share.SimpleShareDelegate.shareModelToData=function(a){var a=a.get(fyre.conv.model.Share.ATTRIBUTES.URL),b={};b[fyre.conv.share.SimpleShareDelegate.DATA_KEYS.URL]=a;return b};fyre.conv.share.SimpleShareDelegate.DATA_KEYS={URL:"url"};fyre.conv.share.DialogContents=function(a,b){this.shareModel=a;goog.ui.Component.call(this,b);this.twitterButton_=new fyre.conv.share.TwitterButton(this.shareModel,b);this.addChild(this.twitterButton_);this.facebookButton_=new fyre.conv.share.FacebookButton(this.shareModel,b);this.addChild(this.facebookButton_)};goog.inherits(fyre.conv.share.DialogContents,goog.ui.Component);fyre.conv.share.DialogContents.EVENTS={ACTION:"sdc_action",ADD_AUTH:"sdc_add_auth"};
fyre.conv.share.DialogContents.prototype.CLASSES=fyre.conv.share.DialogContents.CLASSES={CONTENT:"fyre-modal-content",FACEBOOK_BUTTON:"fyre-modal-facebook-icon",FACEBOOK_BUTTON_ACTIVE:"fyre-modal-facebook-icon-active",PERMALINK:"fyre-modal-permalink",PERMALINK_CONTAINER:"fyre-modal-shares-permalink",SHARE_BUTTON:"fyre-modal-button-share",TWITTER_BUTTON:"fyre-modal-twitter-icon",TWITTER_BUTTON_ACTIVE:"fyre-modal-twitter-icon-active"};
fyre.conv.share.DialogContents.prototype.toSoyData=function(){var a=fyre.conv.i18n.textEnumeration,b=this.shareModel.toSoyData();b.url||(b.url=goog.getMsg("Loading short url..."));b.strings={button:a.get(a.KEYS.SHARE_BUTTON_TEXT),defaultText:goog.string.subs(a.get(a.KEYS.SHARE_DEFAULT_TEXT),b.displayName),label:a.get(a.KEYS.SHARE_LABEL),permalink:a.get(a.KEYS.SHARE_PERMALINK)};return b};
fyre.conv.share.DialogContents.prototype.createDom=function(){this.decorateInternal(goog.soy.renderAsElement(fyre.templates.conv.misc.share,this.toSoyData()))};
fyre.conv.share.DialogContents.prototype.decorateInternal=function(a){fyre.conv.share.DialogContents.superClass_.decorateInternal.call(this,a);a=fyre.conv.share.DialogContents.CLASSES;this.shareButtonEl_=this.getElementByClass(a.SHARE_BUTTON);this.contentEl_=this.getElementByClass(a.CONTENT);this.permalinkEl_=this.getElementByClass(a.PERMALINK);this.permalinkContainerEl_=this.getElementByClass(a.PERMALINK_CONTAINER);this.twitterButtonEl_=this.getElementByClass(a.TWITTER_BUTTON);this.twitterButton_.decorate(this.twitterButtonEl_);
this.facebookButtonEl_=this.getElementByClass(a.FACEBOOK_BUTTON);this.facebookButton_.decorate(this.facebookButtonEl_)};fyre.conv.share.DialogContents.prototype.enterDocument=function(){fyre.conv.share.DialogContents.superClass_.enterDocument.call(this);this.getHandler().listen(this.shareButtonEl_,goog.events.EventType.CLICK,this.handleShareBtnClick);this.shareModel.onChange(fyre.conv.model.Share.ATTRIBUTES.URL,this.onPermalink_,this)};
fyre.conv.share.DialogContents.prototype.disposeInternal=function(){this.shareModel.off(null,null,this);this.facebookButtonEl_=this.twitterButtonEl_=this.permalinkContainerEl_=this.permalinkEl_=this.contentEl_=this.shareButtonEl_=this.shareModel=null;fyre.conv.share.DialogContents.superClass_.disposeInternal.call(this)};fyre.conv.share.DialogContents.prototype.getServices=function(){return this.shareModel.get(fyre.conv.model.Share.ATTRIBUTES.SERVICES)};
fyre.conv.share.DialogContents.prototype.handleShareBtnClick=function(a){a.preventDefault();this.getServices().isEmpty()?(this.twitterButton_.ping(),this.facebookButton_.ping()):(this.shareModel.set(fyre.conv.model.Share.ATTRIBUTES.CONTENT,this.contentEl_.value),this.dispatchEvent(fyre.conv.share.DialogContents.EVENTS.ACTION))};
fyre.conv.share.DialogContents.prototype.onPermalink_=function(a){goog.asserts.assert(a==this.shareModel);this.permalinkEl_.value=a.get(fyre.conv.model.Share.ATTRIBUTES.URL);this.permalinkEl_.disabled=!1};fyre.conv.share.DialogContents.prototype.permalinkFailure=function(){this.isDisposed()||goog.style.showElement(this.permalinkContainerEl_,!1)};
fyre.conv.share.DialogServiceButton=function(a,b,c,d){this.shareModel=a;this.services=a.get(fyre.conv.model.Share.ATTRIBUTES.SERVICES);this.serviceType=b;this.activeClass=c;goog.ui.Component.call(this,d)};goog.inherits(fyre.conv.share.DialogServiceButton,goog.ui.Component);fyre.conv.share.DialogServiceButton.prototype.createDom=function(){goog.asserts.fail("Unimplemented")};fyre.conv.share.DialogServiceButton.prototype.disposeInternal=function(){this.services=this.shareModel=null;fyre.conv.share.DialogServiceButton.superClass_.disposeInternal.call(this)};
fyre.conv.share.DialogServiceButton.prototype.enterDocument=function(){var a=this.getElement();this.getHandler().listen(a,goog.events.EventType.CLICK,this.onClick_);this.shareModel.onChange(fyre.conv.model.Share.ATTRIBUTES.SERVICES,this.getActivation_,this);this.getActivation_();fyre.conv.share.DialogServiceButton.superClass_.enterDocument.call(this)};fyre.conv.share.DialogServiceButton.prototype.exitDocument=function(){this.shareModel.off(null,null,this);fyre.conv.share.DialogServiceButton.superClass_.exitDocument.call(this)};
fyre.conv.share.DialogServiceButton.prototype.domOn_=function(){goog.dom.classes.add(this.getElement(),this.activeClass)};fyre.conv.share.DialogServiceButton.prototype.domOff_=function(){goog.dom.classes.remove(this.getElement(),this.activeClass)};fyre.conv.share.DialogServiceButton.prototype.getActivation_=function(){this.services.contains(this.serviceType)?this.domOn_():this.domOff_()};
fyre.conv.share.DialogServiceButton.prototype.onClick_=function(a){a.preventDefault();this.services.contains(this.serviceType)?(this.services.remove(this.serviceType),this.getActivation_()):this.dispatchEvent({type:fyre.conv.share.DialogContents.EVENTS.ADD_AUTH,serviceType:this.serviceType})};
fyre.conv.share.DialogServiceButton.prototype.ping=function(){this.domOn_();setTimeout(goog.bind(this.domOff_,this),200);setTimeout(goog.bind(this.domOn_,this),400);setTimeout(goog.bind(this.domOff_,this),600);setTimeout(goog.bind(this.getActivation_,this),1E3)};fyre.conv.share.TwitterButton=function(a,b){fyre.conv.share.DialogServiceButton.call(this,a,fyre.v1.enums.social.services.TWITTER,fyre.conv.share.DialogContents.CLASSES.TWITTER_BUTTON_ACTIVE,b)};
goog.inherits(fyre.conv.share.TwitterButton,fyre.conv.share.DialogServiceButton);fyre.conv.share.FacebookButton=function(a,b){fyre.conv.share.DialogServiceButton.call(this,a,fyre.v1.enums.social.services.FACEBOOK,fyre.conv.share.DialogContents.CLASSES.FACEBOOK_BUTTON_ACTIVE,b)};goog.inherits(fyre.conv.share.FacebookButton,fyre.conv.share.DialogServiceButton);fyre.conv.share.LivefyreShareDelegate=function(a){this.appContext=a;this.shareDelegateHandlers_={}};goog.inherits(fyre.conv.share.LivefyreShareDelegate,goog.Disposable);fyre.conv.share.LivefyreShareDelegate.prototype.getHandler=function(a){var a=goog.getUid(a),b=this.shareDelegateHandlers_[a];if(b)return b;b=new goog.events.EventHandler(this);return this.shareDelegateHandlers_[a]=b};
fyre.conv.share.LivefyreShareDelegate.prototype.disposeHandler=function(a){var a=goog.getUid(a),b=this.shareDelegateHandlers_[a];return b?(b.dispose(),delete this.shareDelegateHandlers_[a]):!1};fyre.conv.share.LivefyreShareDelegate.prototype.share=function(a){this.appContext.shareService.share(a)};
fyre.conv.share.LivefyreShareDelegate.prototype.show=function(a){var b=fyre.conv.i18n.textEnumeration,c=new fyre.conv.share.DialogContents(a),d=this.getHandler(a),e=this.appContext.dialog,f=this.appContext.shareService,g=fyre.conv.share.DialogContents.EVENTS;d.listen(c,g.ACTION,function(){this.share(a);e.close();c.dispose();this.disposeHandler(a)});d.listen(c,g.ADD_AUTH,function(b){f.addService(b.serviceType,a)});d.listen(e,goog.ui.Dialog.EventType.SELECT,function(){this.disposeHandler(a);c.dispose()});
e.addChild(c,!0);e.setTitle(goog.getMsg(b.get(b.KEYS.SHARE_TITLE)));e.open();e.setHiddenCancelButtonSet();b=goog.bind(c.permalinkFailure,c);f.getShortUrl(a,b)};fyre.conv.share.LivefyreShareDelegate.prototype.disposeInternal=function(){goog.object.forEach(this.shareDelegateHandlers_,function(a,b){a.dispose();delete this.shareDelegateHandlers_[b]},this);this.appContext=null};fyre.conv.share.ShareService=function(a,b){fyre.v1.service.ServiceBase.call(this,a,b||{})};goog.inherits(fyre.conv.share.ShareService,fyre.v1.service.ServiceBase);fyre.conv.share.ShareService.prototype.getBaseDelegate=function(){return this.baseDelegate||(this.baseDelegate=new fyre.conv.share.LivefyreShareDelegate(this.context))};fyre.conv.share.ShareService.prototype.getSimpleDelegate=function(){return this.simpleDelegate||(this.simpleDelegate=new fyre.conv.share.SimpleShareDelegate(this.context))};
fyre.conv.share.ShareService.prototype.getDelegate=function(){var a=fyre.conv.share.ShareService.ERRORS,b=(this.context.appOpts||{}).shareDelegate;if(b){if(goog.isFunction(b))return this.getSimpleDelegate();goog.typeOf(b);goog.asserts.fail(a.UNRECOGNIZED_DELEGATE)}else return this.getBaseDelegate()};fyre.conv.share.ShareService.ERRORS={INVALID:"Invalid share delegate given: ",UNRECOGNIZED_DELEGATE:"Unrecognized share delegate given..."};
fyre.conv.share.ShareService.prototype.share=function(a){a=fyre.conv.share.ShareAdapter.modelToShare(a,fyre.conv.user);a[fyre.conv.share.ShareAdapter.KEYS.PROVIDER_TOKENS].length&&this.shareMessage(a,fyre.conv.user,goog.nullFunction,goog.nullFunction)};fyre.conv.share.ShareService.prototype.shareMessage=function(a,b,c,d){var e=goog.bind(function(b){this.handleShareSuccess(a);c&&c(b)},this);fyre.v1.client.WriteClient.getInstance().shareMessage(a,b.getTokenInfo(),e,d||goog.nullFunction)};
fyre.conv.share.ShareService.prototype.handleShareSuccess=function(a){var b=new fyre.conv.model.Comment;b.set(b.ATTRIBUTES.ID,a.message_id);goog.array.forEach(a.provider_tokens||[],function(a){var d=0;switch(a.substr(0,1)){case ""+fyre.v1.enums.social.services.TWITTER:d=b.SHARE_TYPES.TWITTER;break;case ""+fyre.v1.enums.social.services.FACEBOOK:d=b.SHARE_TYPES.FACEBOOK}b.increment(b.ATTRIBUTES.SHARE_TYPES,d)});this.context.trigger(fyre.conv.events.QUILL_COMMENT_SHARED,b)};
fyre.conv.share.ShareService.prototype.getShortUrl=function(a,b){var c=fyre.conv.model.Share.ATTRIBUTES,d=fyre.conv.model.Comment.ATTRIBUTES,e=d.SHARE_LINK,f=a.get(c.COMMENT),g=f.get(e),h=function(b){f.set(e,b,{force:!0});a.set(c.URL,b,{force:!0})};g?h(g):this.context.commentService.getShortenedLink(f.get(d.ID),function(a){h(a.data.url)},b||goog.nullFunction)};
fyre.conv.share.ShareService.prototype.addService=function(a,b){this.context.authenticationService.getOAuthToken(fyre.conv.user,a,function(){var c=fyre.conv.model.Share.ATTRIBUTES.SERVICES,d=b.get(c);d.add(a);b.set(c,d,{force:!0})},goog.nullFunction)};fyre.conv.app.MainAppContext=function(a,b){fyre.conv.app.AppContext.call(this,b,fyre.conv.app.MainAppContext.SERVICES,a)};goog.inherits(fyre.conv.app.MainAppContext,fyre.conv.app.AppContext);
fyre.conv.app.MainAppContext.SERVICES=[fyre.conv.service.StreamService,fyre.conv.service.ActionQueueService,fyre.conv.service.AuthenticationService,fyre.conv.service.CommentService,fyre.conv.service.LivecountService,fyre.conv.service.CollectionService,fyre.conv.service.ContentService,fyre.conv.service.LocalStorageService,fyre.conv.share.ShareService,fyre.conv.service.MediaService];fyre.conv.widget={};fyre.conv.widget.ui={};fyre.conv.widget.ui.DomWatcher=function(a,b){goog.events.EventTarget.call(this);this.logger=fyre.v1.logging.getLogger("fyre.conv.widget.ui.DomWatcher");this.dom_=b||new goog.dom.DomHelper;this.startTime_=this.pollTimeout_=null;this.elementId=a};goog.inherits(fyre.conv.widget.ui.DomWatcher,goog.events.EventTarget);
fyre.conv.widget.ui.DomWatcher.prototype.disposeInternal=function(){this.cancel();fyre.conv.widget.ui.DomWatcher.superClass_.disposeInternal.call(this);delete this.dom_};fyre.conv.widget.ui.DomWatcher.prototype.start=function(){this.cancel();this.startTime_=+new Date;this.poll_()};fyre.conv.widget.ui.DomWatcher.prototype.cancel=function(){this.pollTimeout_&&(clearTimeout(this.pollTimeout_),this.pollTimeout_=null);this.startTime_=null};
fyre.conv.widget.ui.DomWatcher.prototype.poll_=function(){var a=this.dom_.getElement(this.elementId);if(a)this.dispatchEvent({type:fyre.conv.widget.ui.DomWatcher.EVENT.FOUND,el:a}),this.pollTimeout_=null;else{var a=fyre.conv.widget.ui.DomWatcher.MAX_SEEK_TIME,b=this.startTime_+a<+new Date;goog.isDefAndNotNull(a)&&b?this.logger.shout("Failed to find livefyre stream widget element, after looking for "+a+"ms!"):this.pollTimeout_=setTimeout(goog.bind(this.poll_,this),fyre.conv.widget.ui.DomWatcher.INTERVAL)}};
fyre.conv.widget.ui.DomWatcher.INTERVAL=25;fyre.conv.widget.ui.DomWatcher.MAX_SEEK_TIME=6E4;fyre.conv.widget.ui.DomWatcher.EVENT={CANCELED:"ef_canceled",FOUND:"ef_found",NOT_FOUND:"ef_not_found"};fyre.templates.conv.app={};
fyre.templates.conv.app.main=function(a){return'<div class="fyre '+(a.isLiveBlog?"fyre-liveblog":"")+(a.isLiveChat?"fyre-livechat":"")+'"><div class="fyre-widget '+(a.disableAvatars?"fyre-avatar-disabled":"")+'">'+fyre.templates.conv.app.tracking(a)+'<div class="fyre-permalink-stream"></div><div class="fyre-stream-stats"><div class="fyre-comment-count"></div><div class="fyre-help"></div></div><div class="fyre-auth"><div class="fyre-login-bar"></div><div class="fyre-live-container"><div class="fyre-livecount"></div>'+(!a.disableAvatars?
'<div class="fyre-listener-avatars"></div>':"")+'</div></div><div class="fyre-editor"></div><div class="fyre-input-box-collapsed"></div><div class="fyre-stream-header"></div><div class="fyre-comment-stream"></div><div class="fyre-top-content-stream"></div><div class="fyre-thread-breakout-stream"></div><div class="fyre-stream-menu-container"></div></div></div>'};fyre.templates.conv.app.spinner=function(){return'<div class="fyre-widget-loading-spinner"></div>'};
fyre.templates.conv.app.helper=function(a){return'<div class="fyre-box-wrapper"><a href="http://livefyre.com" target="_blank"><img class="fyre-logo-drop" src="'+soy.$$escapeHtml(a.down_arrow)+'" /><img class="fyre-logo-help" src="'+soy.$$escapeHtml(a.logo)+'" alt="Livefyre" /></a><ul class="fyre-box-list"><li><a href="http://livefyre.com" target="_blank" title="Get Livefyre">Get Livefyre</a></li><li><a href="http://support.livefyre.com" target="_blank" title="FAQ">FAQ</a></li></ul></div>'};
fyre.templates.conv.app.tracking=function(a){return'<iframe src="'+soy.$$escapeHtml(a.trackingHost)+"/v3/tracking/"+soy.$$escapeHtml(a.trackingUrl)+'" frameborder="0" style="position: absolute; height: 1px; width: 1px; z-index: 99999; background-color: transparent;"></iframe>'};fyre.conv.widget.ui.WidgetSpinner=function(a){goog.ui.Component.call(this,a)};goog.inherits(fyre.conv.widget.ui.WidgetSpinner,goog.ui.Component);fyre.conv.widget.ui.WidgetSpinner.prototype.createDom=function(){this.decorateInternal(goog.soy.renderAsElement(fyre.templates.conv.app.spinner))};fyre.conv.view.CommentCountView=function(a,b){this.model_=a;goog.ui.Component.call(this,b)};goog.inherits(fyre.conv.view.CommentCountView,goog.ui.Component);
fyre.conv.view.CommentCountView.prototype.getSoyData=function(){var a=this.model_.get(fyre.conv.model.Collection.ATTRIBUTES.NUM_VISIBLE),b=fyre.conv.i18n.textEnumeration,b=this.model_.isLiveBlog()?{commentsLabel:b.get(b.KEYS.LIVEBLOG_POSTS),commentLabel:b.get(b.KEYS.LIVEBLOG_POST)}:{commentsLabel:b.get(b.KEYS.COMMENTS),commentLabel:b.get(b.KEYS.COMMENT)};return{numVisible:a,strings:b}};
fyre.conv.view.CommentCountView.prototype.updateNumVisibleUi=function(){var a=fyre.templates.conv.misc.commentCount;this.element_.innerHTML=a(this.getSoyData())};fyre.conv.view.CommentCountView.prototype.enterDocument=function(){this.model_.onChange(fyre.conv.model.Collection.ATTRIBUTES.NUM_VISIBLE,this.updateNumVisibleUi,this);fyre.conv.view.CommentCountView.superClass_.enterDocument.call(this)};fyre.conv.view.CommentCountView.prototype.exitDocument=function(){this.model_.off(null,null,this);fyre.conv.view.CommentCountView.superClass_.exitDocument.call(this)};
fyre.conv.view.CommentCountView.prototype.decorateInternal=function(a){fyre.conv.view.CommentCountView.superClass_.decorateInternal.call(this,a);this.updateNumVisibleUi()};fyre.conv.stream.EVENTS={ANIMATION_INIT:"animationInit",PAST_PERMALINK_INSERTED:"pastPermalinkInserted",POST_COMMENT:"postComment",REPLIES_EXPANDED:"repliesExpanded",SHOW_MORE:"showMore",SHOW_NEXT_CLICKED:"showNextClicked",SORT_HOT_THREADS:"sortHotThreads",SORT_ORDER_CHANGED:"sortOrderChanged",SORT_TOP_COMMENTS:"sortTopComments",STREAM_REFRESH_CLICKED:"streamRefreshClicked",STREAM_RENDERED:"streamRendered",THREAD_BREAKOUT:"threadBreakout"};fyre.v1.editor={};
fyre.v1.editor.CONFIG_KEYS={CLASS:"class",RTE_TOOLBAR:"ret_toolbar",RTE_SHORTCUTS:"rte_shortcuts",MINIMAL:"minimal",MINIMAL_TEXT:"minimal_text",ALLOW_MEDIA:"allow_media",FOLLOW_TOOLBAR:"follow_toolbar",MENTIONS_TOOLBAR:"mentions_toolbar",CANCEL_TOOLBAR:"cancel_toolbar",POST_TO_FACEBOOK:"post_to_facebook",POST_TO_TWITTER:"post_to_twitter",POST_TO_LINKEDIN:"post_to_linkedin",POST_HOTKEY:"post_hotkey",FOLLOW_BUTTON_TEXT:"follow_button_text",UNFOLLOW_BUTTON_TEXT:"unfollow_button_text",POST_BUTTON_TEXT_ANON:"post_button_text_anon",
POST_BUTTON_TEXT_AUTH:"post_button_text_auth",POST_BUTTON_TEXT_EDIT:"post_button_text_edit",POST_BUTTON_TEXT_EDIT_CANCEL:"post_button_text_edit_cancel",ERROR_AUTH_ERROR:"error_auth_error",ERROR_COMMENTS_NOT_ALLOWED:"error_comments_not_allowed",ERROR_DUPLICATE:"error_duplicate",ERROR_EDIT_DUPLICATE:"error_edit_duplicate",ERROR_EDIT_NOT_ALLOWED:"error_edit_not_allowed",ERROR_EMPTY:"error_empty",ERROR_INVALID_CHAR:"error_invalid_char",ERROR_MALFORMED:"error_malformed",ERROR_MAX_CHARS:"error_max_chars",
ERROR_EXPIRED:"error_expired",ERROR_EDIT_TIME_EXCEEDED:"error_edit_time_exceeded",MAX_CHARS:"max_chars",MAX_HEIGHT:"max_height",EDITOR_CSS:"editorCss",DEFAULT_ERROR:"default_error",XX_USE_SEAMLESS_EDITOR:"XX_UseSeamlessEditor"};fyre.v1.editor.PROVIDERS={FACEBOOK:"fb",TWITTER:"tw",LINKEDIN:"li",GOOGLE_PLUS:"gp"};
fyre.v1.editor.ERROR_TYPE_MAP={AuthorizationError:fyre.v1.editor.CONFIG_KEYS.ERROR_AUTH_ERROR,CommentsNotAllowedError:fyre.v1.editor.CONFIG_KEYS.ERROR_COMMENTS_NOT_ALLOWED,DuplicateCommentError:fyre.v1.editor.CONFIG_KEYS.ERROR_DUPLICATE,EditCommentDuplicate:fyre.v1.editor.CONFIG_KEYS.ERROR_EDIT_DUPLICATE,EditCommentsNotAllowedError:fyre.v1.editor.CONFIG_KEYS.ERROR_EDIT_NOT_ALLOWED,EmptyCommentError:fyre.v1.editor.CONFIG_KEYS.ERROR_EMPTY,InvalidCharacterError:fyre.v1.editor.CONFIG_KEYS.ERROR_INVALID_CHAR,
MalformedCommentError:fyre.v1.editor.CONFIG_KEYS.ERROR_MALFORMED,EditCommentTimeExceeded:fyre.v1.editor.CONFIG_KEYS.ERROR_EDIT_TIME_EXCEEDED};fyre.v1.editor.config={};
fyre.v1.editor.config.DefaultConfig=function(){var a=fyre.v1.editor.CONFIG_KEYS,b={};b[a.RTE_TOOLBAR]=!1;b[a.ALLOW_MEDIA]=!1;b[a.RTE_SHORTCUTS]=!0;b[a.MINIMAL_TEXT]="Leave a comment, tag your friends, link or attach media files...";b[a.POST_TO_TWITTER]=!1;b[a.POST_TO_FACEBOOK]=!1;b[a.POST_TO_LINKEDIN]=!1;b[a.POST_TO_GOOGLE_PLUS]=!1;b[a.POST_BUTTON_TEXT_ANON]="Post comment as...";b[a.POST_BUTTON_TEXT_AUTH]="Post comment";b[a.POST_BUTTON_TEXT_EDIT]="Edit comment";b[a.POST_BUTTON_TEXT_EDIT_CANCEL]="Cancel";
b[a.ERROR_AUTH_ERROR]="You're not authorized to post a comment on this conversation";b[a.ERROR_COMMENTS_NOT_ALLOWED]="Comments are not allowed on this conversation";b[a.ERROR_DUPLICATE]="As much as you liked your comment, you're not allowed to post it twice.";b[a.ERROR_EDIT_DUPLICATE]="You must change the body of the comment when you edit it.";b[a.ERROR_EDIT_NOT_ALLOWED]="You're not allowed to edit comments on this conversation.";b[a.ERROR_EMPTY]="It seems you're attempting to post an empty comment.";
b[a.ERROR_INVALID_CHAR]="It seems you're attempting to post an invalid character.";b[a.ERROR_MALFORMED]="It seems you're attempting to post malformed content.";b[a.ERROR_MAX_CHARS]="Sorry, your comment is too long. Please edit and try again.";b[a.ERROR_EXPIRED]="Your session has expired. Please reload the page.";b[a.ERROR_EDIT_TIME_EXCEEDED]="Sorry, your comment editing period has expired.";b[a.MAX_CHARS]=8E3;b[a.MAX_HEIGHT]=500;b[a.DEFAULT_ERROR]="An error has occurred. Please try again.";b[a.XX_USE_SEAMLESS_EDITOR]=
!1;b.KEYS=a;b.ERRORS=fyre.v1.editor.ERROR_TYPE_MAP;b.PROVIDERS=fyre.v1.editor.PROVIDERS;return goog.object.clone(b)};fyre.conv.view.EditorConfig=function(a){var b=fyre.v1.editor.config.DefaultConfig(),c=b.KEYS,d=b.PROVIDERS,e=fyre.conv.i18n.textEnumeration,a=a||{};b[c.RTE_TOOLBAR]=!0;b[c.FOLLOW_TOOLBAR]=!0;b[c.MENTIONS_TOOLBAR]=!(goog.userAgent.IE&&goog.array.contains(["7.0","8.0"],goog.userAgent.product.VERSION));b[c.POST_TO_FACEBOOK]=!1;b[c.POST_TO_TWITTER]=!1;b[c.POST_TO_LINKEDIN]=!1;a.XX_UseSeamlessEditor&&goog.userAgent.IE&&(b[c.XX_USE_SEAMLESS_EDITOR]=a.XX_UseSeamlessEditor);goog.asserts.assert(goog.isArray(a.postToButtons)||
!goog.isDef(a.postToButtons),"postToButtons must be an array or undefined");goog.isArray(a.postToButtons)?goog.array.forEach(a.postToButtons,function(a){switch(a.toLowerCase()){case d.FACEBOOK:b[c.POST_TO_FACEBOOK]=!0;break;case d.TWITTER:b[c.POST_TO_TWITTER]=!0;break;case d.LINKEDIN:b[c.POST_TO_LINKEDIN]=!0}}):(b[c.POST_TO_FACEBOOK]=!0,b[c.POST_TO_TWITTER]=!0,b[c.POST_TO_LINKEDIN]=!fyre.conv.config.customNetwork);b[c.FOLLOW_BUTTON_TEXT]=e.get(e.KEYS.FOLLOW);b[c.UNFOLLOW_BUTTON_TEXT]=e.get(e.KEYS.UNFOLLOW);
b[c.POST_BUTTON_TEXT_ANON]=e.get(e.KEYS.POST_AS);b[c.POST_BUTTON_TEXT_AUTH]=e.get(e.KEYS.POST);b[c.POST_BUTTON_TEXT_EDIT]=e.get(e.KEYS.POST_EDIT);b[c.POST_BUTTON_TEXT_EDIT_CANCEL]=e.get(e.KEYS.POST_EDIT_CANCEL);b[c.ERROR_AUTH_ERROR]=e.get(e.KEYS.ERROR_AUTH_ERROR);b[c.ERROR_COMMENTS_NOT_ALLOWED]=e.get(e.KEYS.ERROR_COMMENTS_NOT_ALLOWED);b[c.ERROR_DUPLICATE]=e.get(e.KEYS.ERROR_DUPLICATE);b[c.ERROR_EDIT_DUPLICATE]=e.get(e.KEYS.ERROR_EDIT_DUPLICATE);b[c.ERROR_EDIT_NOT_ALLOWED]=e.get(e.KEYS.ERROR_EDIT_NOT_ALLOWED);
b[c.ERROR_EMPTY]=e.get(e.KEYS.ERROR_EMPTY);b[c.ERROR_INVALID_CHAR]=e.get(e.KEYS.ERROR_INVALID_CHAR);b[c.ERROR_MALFORMED]=e.get(e.KEYS.ERROR_MALFORMED);b[c.ERROR_MAX_CHARS]=e.get(e.KEYS.ERROR_MAX_CHARS);b[c.ERROR_EXPIRED]=e.get(e.KEYS.ERROR_EXPIRED);b[c.ERROR_EDIT_TIME_EXCEEDED]=e.get(e.KEYS.ERROR_EDIT_TIME_EXCEEDED);b[c.DEFAULT_ERROR]=e.get(e.KEYS.DEFAULT_ERROR);b[c.EDITOR_CSS]=a[c.EDITOR_CSS];return b};fyre.v1.client.SocialClient=function(a){fyre.v1.client.BaseClient.call(this,a);this.configureLogging("fyre.v1.client.SocialClient")};goog.inherits(fyre.v1.client.SocialClient,fyre.v1.client.BaseClient);goog.addSingletonGetter(fyre.v1.client.SocialClient);
fyre.v1.client.SocialClient.prototype.getXhr=function(a,b,c,d,e){var f=new goog.Uri(fyre.v1.config.servers.bootstrap+b),b={success:c,failure:d,method:"GET"};f.setParameterValue(a.isGuest()?"lfgtoken":"lftoken",a.get(a.ATTRIBUTES.TOKEN));goog.object.forEach(e||{},function(a,b){f.setParameterValue(b,a)});b.url=f.toString();return new fyre.v1.io.XDR(b)};
fyre.v1.client.SocialClient.prototype.getSocialFriends=function(a,b,c,d){this.getXhr(a,fyre.v1.config.API1+"public/social/friends/",c,d).send({force:goog.isBoolean(b)?b:!1})};fyre.v1.client.SocialClient.prototype.getShortenedLink=function(a,b,c,d){this.getXhr(b,fyre.v1.config.API2+"message/"+a.messageId+"/permalink/",c,d).send({collection_id:a.collectionId})};fyre.v1.model.Media=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.v1.model.Media,fyre.v1.model.Model);
fyre.v1.model.Media.ATTRIBUTES=fyre.v1.model.Media.prototype.ATTRIBUTES={SOURCE_URL:"source_url",DESCRIPTION:"description",WIDTH:"width",HEIGHT:"height",THUMBNAIL_WIDTH:"thumbnail_width",THUMBNAIL_HEIGHT:"thumbnail_height",HTML:"html",THUMBNAIL:"thumbnail_url",TITLE:"title",TYPE:"type",URL:"url",PROVIDER_URL:"provider_url",AUTHOR_NAME:"author_name",VERSION:"version",PROVIDER_NAME:"provider_name",AUTHOR_URL:"author_url"};fyre.v1.model.Media.prototype.defaults={height:0,width:0};fyre.v1.model.MediaCollection=function(a,b){b=b||{};b.model=fyre.v1.model.Media;fyre.v1.model.Collection.call(this,a,b)};goog.inherits(fyre.v1.model.MediaCollection,fyre.v1.model.Collection);fyre.v1.model.MediaCollection.prototype.hasKey=function(a){return this.get(a)?!0:goog.array.some(this.models,function(b){return goog.string.caseInsensitiveStartsWith(a,b.get("url"))})};fyre.v1.editor.EditorModel=function(a){this.ATTRIBUTES=fyre.v1.editor.EditorModel.prototype.ATTRIBUTES;fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.v1.editor.EditorModel,fyre.v1.model.Model);fyre.v1.editor.EditorModel.prototype.STATE=fyre.v1.editor.EditorModel.BUTTON_STATE={CANCELED:"canceled",POST_IN_PROGRESS:"posting",POST_COMPLETE:"posted",POST_FAILED:"postFailed"};fyre.v1.editor.EditorModel.prototype.POST_TYPE=fyre.v1.editor.EditorModel.POST_TYPE={EDIT:"edit",REPLY:"reply",NEW:"new"};
fyre.v1.editor.EditorModel.prototype.ATTRIBUTES=fyre.v1.editor.EditorModel.ATTRIBUTES={STATE:"state",BODY:"body",OPEN:"open",FOLLOWERS:"followers",SOCIAL_FRIENDS:"socFriends",CONV_AUTHORS:"authors",FOLLOWING:"following",MENTION_SEARCH_RESULTS:"mentionSearchResults",USERAUTH:"userAuth",CONFIG:"config",MEDIA:"media",SHARE_TYPES:"shareTypes",USER:"user",POST_TYPE:"postType",RAW_HTML:"rawHtml"};
fyre.v1.editor.EditorModel.prototype.defaults=function(){var a=fyre.v1.editor.EditorModel.ATTRIBUTES,b={};b[a.CONFIG]=fyre.v1.editor.config.DefaultConfig();b[a.MEDIA]=new fyre.v1.model.MediaCollection;b[a.POST_TYPE]=fyre.v1.editor.EditorModel.POST_TYPE.NEW;b[a.SHARE_TYPES]=[];return b};fyre.conv.view.EditorViewHandler=function(a,b){fyre.v1.handler.HandlerBase.call(this,a,b)};goog.inherits(fyre.conv.view.EditorViewHandler,fyre.v1.handler.HandlerBase);
fyre.conv.view.EditorViewHandler.prototype.initialize=function(a,b){this.view=b;fyre.conv.view.EditorViewHandler.superClass_.initialize.call(this,a,b);var c=this.context.collectionService.followers();c.on(c.EVENTS.ADD,goog.partial(this.handleFollow,!0),this);c.on(c.EVENTS.REMOVE,goog.partial(this.handleFollow,!1),this);fyre.conv.user.on(fyre.conv.user.EVENTS.CHANGE,this.handleUserChange,this)};
fyre.conv.view.EditorViewHandler.prototype.disposeInternal=function(){var a=this.context.collectionService.followers(),b=fyre.conv.user;a.off(null,null,this);b.off(null,null,this);fyre.conv.view.EditorViewHandler.superClass_.disposeInternal.call(this)};fyre.conv.view.EditorViewHandler.prototype.handleNavigation=function(){this.view.saveState()};fyre.v1.util.handler([fyre.conv.events.WINDOW_NAVIGATION],fyre.conv.view.EditorViewHandler.prototype.handleNavigation,fyre.conv.bus);
fyre.conv.view.EditorViewHandler.prototype.handleUserChange=function(a){a=this.context.collectionService.isFollowing(a.id);this.view.viewModel.set(fyre.v1.editor.EditorModel.ATTRIBUTES.FOLLOWING,a)};fyre.conv.view.EditorViewHandler.prototype.handleFollow=function(a,b){b.id===fyre.conv.user.id&&this.view.viewModel.set(fyre.v1.editor.EditorModel.ATTRIBUTES.FOLLOWING,a)};fyre.conv.view.EditorViewHandler.prototype.commentPostSuccess=function(){this.view.clear()};
fyre.conv.view.EditorViewHandler.prototype.commentPostFailure=function(a){this.view.setErrorState(a.error_type)};fyre.conv.view.EditorViewHandler.prototype.refetchSocialFriends=function(){this.view.retrieveSocialFriends()};fyre.v1.util.handler([fyre.conv.events.USER_LOGGED_IN],fyre.conv.view.EditorViewHandler.prototype.refetchSocialFriends,fyre.conv.bus);fyre.conv.view.RawHtmlComponent=function(a){goog.ui.Component.call(this,a)};goog.inherits(fyre.conv.view.RawHtmlComponent,goog.ui.Component);
fyre.conv.view.RawHtmlComponent.prototype.setContent=function(a){this.element_&&(this.dom_.removeChildren(this.element_),a&&(a=fyre.v1.util.htmlExtractNodes(a),this.dom_.appendChild(this.element_,this.dom_.htmlToDocumentFragment(a.html)),goog.array.forEach(a.script,function(a){a.src?this.dom_.appendChild(this.element_,this.dom_.createDom(goog.dom.TagName.SCRIPT,{src:a.src})):this.dom_.getWindow().eval(a.innerHTML)},this)))};fyre.templates.conv.comment={};
fyre.templates.conv.comment.actions=function(a){return fyre.templates.conv.comment.tweetActions(a)+(a.banable?'<a class="fyre-ban-link" title="'+soy.$$escapeHtml(a.strings.banTooltip)+'"><span></span>'+a.strings.ban+"</a>":"")+'<a class="fyre-share-link" title="'+soy.$$escapeHtml(a.strings.shareTooltip)+'"><span></span>'+a.strings.share+"</a>"+(a.flaggable?'<a class="fyre-flag-link" title="'+soy.$$escapeHtml(a.strings.flagTooltip)+'"><span></span>'+a.strings.flag+"</a>":"")+(a.banable?'<a class="fyre-bozo-link" title="'+
soy.$$escapeHtml(a.strings.bozoTooltip)+'"><span></span>'+a.strings.bozo+"</a>":"")+(a.deletable?'<a class="fyre-delete-link" title="'+soy.$$escapeHtml(a.strings.deleteTooltip)+'"><span></span>'+a.strings.del+"</a>":"")};
fyre.templates.conv.comment.flagMobileMenu=function(a){return'<div class="fyre-mobile-menu"><div class="fyre-flag-menu-item"><a class="fyre-flag-spam-link" title="'+soy.$$escapeHtml(a.strings.flagSpamTooltip)+'"><span class="fyre-flag-spam-sprite"></span>'+a.strings.flagSpam+'</a></div><div class="fyre-flag-menu-item"><a class="fyre-flag-offensive-link" title="'+soy.$$escapeHtml(a.strings.flagOffensiveTooltip)+'"><span class="fyre-flag-offensive-sprite"></span>'+a.strings.flagOffensive+'</a></div><div class="fyre-flag-menu-item"><a class="fyre-flag-disagree-link" title="'+
soy.$$escapeHtml(a.strings.flagDisagreeTooltip)+'"><span class="fyre-flag-disagree-sprite"></span>'+a.strings.flagDisagree+'</a></div><div class="fyre-flag-menu-item"><a class="fyre-flag-offtopic-link" title="'+soy.$$escapeHtml(a.strings.flagOfftopicTooltip)+'"><span class="fyre-flag-off-topic-sprite"></span>'+a.strings.flagOfftopic+"</a></div></div>"};
fyre.templates.conv.comment.flagConfirmationDialogMobile=function(a){return'<div class="fyre-mobile-flag-confirmation"><span class="fyre-flag-'+soy.$$escapeHtml(a.flagType)+'-confirmation-sprite"></span><div>'+soy.$$escapeHtml(a.message)+"</div></div>"};fyre.templates.conv.comment.flagMobileButton=function(){return'<a class="fyre-comment-flag-mobile-btn fyre-comment-action-button"></a>'};
fyre.templates.conv.comment.tweetActions=function(a){return a.tweetId?'<a class="fyre-tw-reply-link" href="'+soy.$$escapeHtml(a.baseUrl)+"tweet?in_reply_to="+soy.$$escapeHtml(a.tweetId)+'" title="Reply on Twitter"><span></span>Reply on Twitter</a><a class="fyre-tw-retweet-link" href="'+soy.$$escapeHtml(a.baseUrl)+"retweet?tweet_id="+soy.$$escapeHtml(a.tweetId)+'" title="Retweet"><span></span>Retweet</a><a class="fyre-tw-fav-link" href="'+soy.$$escapeHtml(a.baseUrl)+"favorite?tweet_id="+soy.$$escapeHtml(a.tweetId)+
'" title="Favorite"><span></span>Favorite</a>':""};fyre.templates.conv.comment.approvable=function(a){return'<div class="fyre-mod-actions"><a class="fyre-mod-deny" href="#" title="Deny"><span></span></a><a class="fyre-mod-approve" href="#" title="Approve"><span></span></a></div><div class="fyre-pending">'+soy.$$escapeHtml(a.strings.pending)+"</div>"};
fyre.templates.conv.comment.threadContainer=function(a){return'<div class="fyre-comment-wrapper"></div><div class="fyre-comment-divider"><a title="Toggle Collapse" class="fyre-comment-collapse" style="display: none;"></a><div class="fyre-comment-divider"></div></div><div class="fyre-outer-comment-container"><div class="fyre-comment-container '+(a.isLiveblogPost?"fyre-liveblog-replies":"fyre-comment-replies")+'"></div></div>'};
fyre.templates.conv.comment.comment=function(a){return(!0!=a.bodyOnly?(!a.disableAvatars?'<div class="fyre-comment-user" data-from="'+soy.$$escapeHtml(a.author.displayName)+'" data-author-id="'+soy.$$escapeHtml(a.author.id)+'">'+fyre.templates.conv.comment.user(a)+"</div>":"")+'<header class="fyre-comment-head">'+fyre.templates.conv.comment.header(a)+"</header>":"")+'<section class="fyre-comment-body">'+fyre.templates.conv.comment.body(a)+"</section>"+(!0!=a.bodyOnly?'<footer class="fyre-comment-footer">'+
fyre.templates.conv.comment.footer(a)+"</footer>":"")};fyre.templates.conv.comment.body=function(a){return'<div class="fyre-comment"></div><div class="fyre-comment-raw-html"></div>'+(a.linkback?'<div class="fyre-comment-linkback"><p><span class="fyre-label">Latest blog post: <a rel="nofollow" target="_blank" href="'+soy.$$escapeHtml(a.linkback.href)+'">'+soy.$$escapeHtml(a.linkback.title)+"</a></span></p></div>":"")+'<div class="fyre-comment-media fyre-comment-media-expanded"></div><div class="fyre-comment-media fyre-comment-media-thumbnails"></div>'};
fyre.templates.conv.comment.header=function(a){for(var b=(a.author.isGuest&&!a.author.profileUrl?'<span class="fyre-comment-username"><strong>'+soy.$$escapeHtml(a.author.displayName)+"</strong></span>":'<a class="fyre-comment-username"'+(a.author.profileUrl?'href="'+soy.$$escapeHtml(a.author.profileUrl)+'" target="_blank"':"")+">"+soy.$$escapeHtml(a.author.displayName)+"</a> "+(a.author.doShowFeedSource?'<span class="fyre-comment-from-text fyre-comment-username">from '+soy.$$escapeHtml(a.author.source)+
"</span>":""))+(a.moderator?'<span class="fyre-user-level fyre-comment-author-tag fyre-moderator">'+soy.$$escapeHtml(a.strings.moderator)+"</span>":""),c=a.author.tags,d=c.length,e=0;e<d;e++)var f=c[e],b=b+('<span class="fyre-comment-author-tag" data-fyre-author-tag="'+soy.$$escapeHtml(f)+'">'+soy.$$escapeHtml(f)+"</span>");b+=(a.author.isTwitter?'<a href="'+soy.$$escapeHtml(a.author.profileUrl)+'" class="fyre-twitter-handle" target="_blank"><span class="fyre-user-level fyre-user-twitter">@'+soy.$$escapeHtml(a.author.twitterHandle)+
'</span><a href="'+soy.$$escapeHtml(a.author.profileUrl)+'" class="fyre-twitter-handle" target="_blank"><span class="fyre-comment-from-text">from Twitter</span></a></a>':"")+(a.author.isFacebook?'<a href="'+soy.$$escapeHtml(a.author.profileUrl)+'" class="fyre-facebook-handle" target="_blank"><span class="fyre-comment-from-text">from Facebook</span></a>':"")+'<span class="fyre-comment-user-rating">';switch(a.author.rating){case 1:b+=soy.$$escapeHtml(a.author.rating)+"pt";break;default:b+=soy.$$escapeHtml(a.author.rating)+
"pts"}return b+='</span><div class="fyre-comment-premod"></div>'+(a.author.isTwitter?'<a href="https://twitter.com/'+soy.$$escapeHtml(a.author.twitterHandle)+"/status/"+soy.$$escapeHtml(a.socialMsgId)+'" target="_blank"><time class="fyre-comment-date">'+soy.$$escapeHtml(a.createdAt)+"</time></a>":'<time class="fyre-comment-date">'+soy.$$escapeHtml(a.createdAt)+"</time>")+(a.title?'<a class="fyre-comment-title" '+(a.link?'href="'+soy.$$escapeHtml(a.link)+'" target="_blank"':"")+">"+soy.$$escapeHtml(a.title)+
"</a>":"")+(a.link?'<span class="fyre-comment-link">'+soy.$$escapeHtml(a.link)+"</span>":"")+'<div class="fyre-flag-list"></div>'};
fyre.templates.conv.comment.user=function(a){return(a.author.isGuest&&!a.author.profileUrl?'<img src="'+a.author.avatar+'" class="fyre-user-avatar fyre-comment-author" alt="'+soy.$$escapeHtml(a.author.displayName)+'" onerror="javascript:this.src=\''+soy.$$escapeHtml(a.author.defaultAvatar)+"';\" />":'<a href="'+a.author.profileUrl+'" class="fyre-comment-author"><img src="'+a.author.avatar+'" class="fyre-user-avatar" alt="'+soy.$$escapeHtml(a.author.displayName)+'" onerror="javascript:this.src=\''+
soy.$$escapeHtml(a.author.defaultAvatar)+"';\" /></a>")+'<div class="fyre-comment-socialsync fyre-comment-from-'+soy.$$escapeHtml(a.type)+'"></div>'};fyre.templates.conv.comment.seeMore=function(){return'<span class="fyre-comment-see-more">See more</span>'};fyre.templates.conv.comment.footer=function(a){return'<div class="fyre-comment-actions"> '+fyre.templates.conv.comment.flagMobileButton(a)+'</div><span class="fyre-comment-like"></span>'};
fyre.templates.conv.comment.replyButton=function(a){return'<a class="fyre-comment-reply fyre-comment-action-button">'+fyre.templates.conv.comment.replyButtonContents(a)+"</a>"};fyre.templates.conv.comment.editorContainer=function(){return'<div class="fyre-editor" style="display: none;"></div>'};fyre.templates.conv.comment.replyButtonContents=function(a){return a.descendentCount?1==a.descendentCount?"1 "+a.strings.repliesSingular:soy.$$escapeHtml(a.descendentCount)+" "+a.strings.repliesPlural:a.strings.reply};
fyre.templates.conv.comment.divider=function(){return'<a title="Toggle Collapse" class="fyre-comment-collapse" style="display: none;"></a><div class="fyre-comment-divider"></div>'};fyre.templates.conv.comment.dividerCounter=function(a){return'<span class="fyre-comment-reply-wrapper '+(a.highVelocityMode?"fyre-comment-reply-highlight":"")+'"><span class="fyre-comment-reply-count"></span><span class="fyre-comment-reply-text"></span></span>'};fyre.templates.conv.comment.deleted=function(){return'<section class="fyre-comment-deleted"><p>This comment has been deleted</p></section>'};
fyre.templates.conv.comment.updated=function(a){return'<span class="fyre-comment-updated">Last edited '+soy.$$escapeHtml(a.updated)+"</span>"};fyre.templates.conv.comment.edit=function(a){return'<a class="fyre-comment-edit"><span>'+soy.$$escapeHtml(a.strings.edit)+(!a.moderator?' (<span class="fyre-comment-edit-interval">'+soy.$$escapeHtml(a.interval)+"</span> minutes)":"")+"</span></a>"};
fyre.templates.conv.comment.flagModal=function(a){for(var b='<div class="fyre-modal-container"><form class="fyre-modal-flag-form"><label class="fyre-modal-subtitle" for="flagType">'+soy.$$escapeHtml(a.strings.subtitle)+'</label><span class="fyre-modal-select-error">*Please select a flag type</span><select class="fyre-modal-textarea fyre-modal-flagas" name="flagType"><option value="none" selected="selected">Select</option>',c=a.flagTypes,d=c.length,e=0;e<d;e++)var f=c[e],b=b+('<option value="'+soy.$$escapeHtml(f.val)+
'">'+soy.$$escapeHtml(f.label)+"</option>");return b+="</select>"+(a.authorId?'<input type="hidden" name="authorId" value="'+soy.$$escapeHtml(a.authorId)+'" />':'<label class="fyre-modal-subtitle" for="email">'+soy.$$escapeHtml(a.strings.email)+'</label><input class="fyre-modal-textfield fyre-modal-email" name="email" type="text" placeholder="'+soy.$$escapeHtml(a.strings.emailPlaceholder)+'">')+'<label class="fyre-modal-subtitle" for="notes">'+soy.$$escapeHtml(a.strings.notes)+'</label><textarea name="notes" class="fyre-modal-textfield fyre-modal-notes" placeholder="'+
soy.$$escapeHtml(a.strings.notesPlaceholder)+'"></textarea></form></div>'};
fyre.templates.conv.comment.mediaExpanded=function(a){var b="";switch(a.type){case "photo":b+='<a href="'+a.url+'" target="_blank"><img src="'+a.url+'" /></a>';break;case "video":b+='<a href="'+a.url+'" class="fyre-comment-media-link">'+(a.expandable?'<span class="fyre-comment-media-title">'+soy.$$escapeHtml(a.title)+'</span><img src="'+a.thumbnailUrl+'" alt="'+soy.$$escapeHtml(a.title)+'" class="fyre-comment-media-img" /><span class="fyre-comment-media-play"></span>':'<img src="'+a.thumbnailUrl+
'" alt="'+soy.$$escapeHtml(a.title)+'" class="fyre-comment-media-img" /><div class="fyre-video-play"></div>')+"</a>";break;case "rich":b+='<div class="fyre-rich-media-content"></div>';break;default:b+='<div class="fyre-rich-media-content">'+(a.thumbnailUrl?'<a href="'+a.url+'" target="_blank"><img src="'+a.thumbnailUrl+'" /></a>':"")+"</div>"}return b};
fyre.templates.conv.comment.mediaThumbnail=function(a){var b="";switch(a.type){case "photo":b+='<img src="'+a.thumbnailUrl+'" class="fyre-img-thumb" />';break;case "video":b+='<img src="'+a.thumbnailUrl+'" class="fyre-video-thumbnail" /><div class="fyre-video-play"></div>';break;default:b+='<img src="'+a.thumbnailUrl+'" />'}return b};fyre.templates.conv.comment.replyCount=function(a){var b="";switch(a.replies){case 1:b+="1 reply";break;default:b+=soy.$$escapeHtml(a.replies)+" replies"}return b};
fyre.templates.conv.comment.likeAvatar=function(a){return'<a href="'+a.profileUrl+'" title="'+soy.$$escapeHtml(a.displayName)+'" rel="nofollow" target="_blank" data-opineid="'+soy.$$escapeHtml(a.opineId)+'" class="fyre-avatar"><img src="'+a.avatar+'" alt="'+soy.$$escapeHtml(a.displayName)+'" onerror="javascript:this.src=\''+soy.$$escapeHtml(a.defaultAvatar)+"';\" /></a>"};
fyre.templates.conv.comment.preview=function(a){return'<div class="fyre-comment-preview"><h5>Custom HTML Preview<span class="fyre-icon-remove"></span></h5><div class="fyre-roundedpanel-content fyre-comment-preview-content"><article class="fyre-comment-article">'+fyre.templates.conv.comment.comment(a)+"</article></div></div>"};
fyre.templates.conv.comment.likeContainer=function(a){for(var b='<span class="fyre-comment-like-count">'+(a.count?soy.$$escapeHtml(a.count):"")+'</span><span class="fyre-comment-like-imgs"></span><a class="fyre-comment-like-btn fyre-comment-action-button">'+soy.$$escapeHtml(a.strings.like)+'</a><span class="fyre-comment-like-imgs">',a=a.likes,c=a.length,d=0;d<c;d++)b+=fyre.templates.conv.comment.likeAvatar(a[d]);return b+"</span>"};
fyre.templates.conv.comment.threadBreakout=function(a){return'<div class="fyre-thread-breakout"><span>'+soy.$$escapeHtml(a.threadBreakoutButton)+"</span></div>"};fyre.templates.conv.comment.liveblogTopDivider=function(){return'<div class="fyre-liveblog-top-divider outer"><div class="fyre-liveblog-top-divider inner"></div></div>'};fyre.templates.conv.comment.liveblogReplyArrow=function(){return'<div class="fyre-liveblog-reply-top"><div class="fyre-liveblog-reply-top-inner"><div class="fyre-liveblog-reply-top-bg"></div><div class="fyre-liveblog-reply-top-arrow"></div></div></div>'};fyre.conv.view.editor={};fyre.conv.view.editor.PreviewComponent=function(a,b){this.commentModel_=a;this.rawHtmlComponent_=new fyre.conv.view.RawHtmlComponent(b);this.addChild(this.rawHtmlComponent_);goog.ui.Component.call(this,b)};goog.inherits(fyre.conv.view.editor.PreviewComponent,goog.ui.Component);fyre.conv.view.editor.PreviewComponent.events={CANCELED:"canceled"};fyre.conv.view.editor.PreviewComponent.prototype.createDom=function(){this.decorateInternal(this.dom_.htmlToDocumentFragment(fyre.templates.conv.comment.preview({bodyOnly:!0})))};
fyre.conv.view.editor.PreviewComponent.prototype.decorateInternal=function(a){this.element_=a;this.rawHtmlComponent_.decorate(this.dom_.getElementByClass("fyre-comment-raw-html",this.element_));this.closeButtonEl_=this.dom_.getElementByClass("fyre-icon-remove",this.element_);this.updateDom()};
fyre.conv.view.editor.PreviewComponent.prototype.enterDocument=function(){fyre.conv.view.editor.PreviewComponent.superClass_.enterDocument.call(this);this.commentModel_.onChange(this.commentModel_.ATTRIBUTES.RAW_HTML,this.updateDom,this);this.getHandler().listen(this.closeButtonEl_,goog.events.EventType.CLICK,function(){this.dispatchEvent(fyre.conv.view.editor.PreviewComponent.events.CANCELED)})};
fyre.conv.view.editor.PreviewComponent.prototype.exitDocument=function(){fyre.conv.view.editor.PreviewComponent.superClass_.exitDocument.call(this);this.commentModel_.off(null,null,this)};fyre.conv.view.editor.PreviewComponent.prototype.updateDom=function(){var a=this.commentModel_.get(this.commentModel_.ATTRIBUTES.RAW_HTML);a?(this.rawHtmlComponent_.setContent(a.body),goog.style.showElement(this.element_,!0)):goog.style.showElement(this.element_,!1)};goog.editor={};
goog.editor.Command={UNDO:"+undo",REDO:"+redo",LINK:"+link",FORMAT_BLOCK:"+formatBlock",INDENT:"+indent",OUTDENT:"+outdent",REMOVE_FORMAT:"+removeFormat",STRIKE_THROUGH:"+strikeThrough",HORIZONTAL_RULE:"+insertHorizontalRule",SUBSCRIPT:"+subscript",SUPERSCRIPT:"+superscript",UNDERLINE:"+underline",BOLD:"+bold",ITALIC:"+italic",FONT_SIZE:"+fontSize",FONT_FACE:"+fontName",FONT_COLOR:"+foreColor",EMOTICON:"+emoticon",EQUATION:"+equation",BACKGROUND_COLOR:"+backColor",ORDERED_LIST:"+insertOrderedList",UNORDERED_LIST:"+insertUnorderedList",
TABLE:"+table",JUSTIFY_CENTER:"+justifyCenter",JUSTIFY_FULL:"+justifyFull",JUSTIFY_RIGHT:"+justifyRight",JUSTIFY_LEFT:"+justifyLeft",BLOCKQUOTE:"+BLOCKQUOTE",DIR_LTR:"ltr",DIR_RTL:"rtl",IMAGE:"image",EDIT_HTML:"editHtml",UPDATE_LINK_BUBBLE:"updateLinkBubble",DEFAULT_TAG:"+defaultTag",CLEAR_LOREM:"clearlorem",UPDATE_LOREM:"updatelorem",USING_LOREM:"usinglorem",MODAL_LINK_EDITOR:"link"};goog.async.Delay=function(a,b,c){goog.Disposable.call(this);this.listener_=a;this.interval_=b||0;this.handler_=c;this.callback_=goog.bind(this.doAction_,this)};goog.inherits(goog.async.Delay,goog.Disposable);goog.Delay=goog.async.Delay;goog.async.Delay.prototype.id_=0;goog.async.Delay.prototype.disposeInternal=function(){goog.async.Delay.superClass_.disposeInternal.call(this);this.stop();delete this.listener_;delete this.handler_};
goog.async.Delay.prototype.start=function(a){this.stop();this.id_=goog.Timer.callOnce(this.callback_,goog.isDef(a)?a:this.interval_)};goog.async.Delay.prototype.stop=function(){this.isActive()&&goog.Timer.clear(this.id_);this.id_=0};goog.async.Delay.prototype.fire=function(){this.stop();this.doAction_()};goog.async.Delay.prototype.fireIfActive=function(){this.isActive()&&this.fire()};goog.async.Delay.prototype.isActive=function(){return 0!=this.id_};
goog.async.Delay.prototype.doAction_=function(){this.id_=0;this.listener_&&this.listener_.call(this.handler_)};goog.dom.SavedRange=function(){goog.Disposable.call(this)};goog.inherits(goog.dom.SavedRange,goog.Disposable);goog.dom.SavedRange.logger_=goog.debug.Logger.getLogger("goog.dom.SavedRange");goog.dom.SavedRange.prototype.restore=function(a){this.isDisposed()&&goog.dom.SavedRange.logger_.severe("Disposed SavedRange objects cannot be restored.");var b=this.restoreInternal();a||this.dispose();return b};goog.dom.SavedCaretRange=function(a){goog.dom.SavedRange.call(this);this.startCaretId_=goog.string.createUniqueString();this.endCaretId_=goog.string.createUniqueString();this.dom_=goog.dom.getDomHelper(a.getDocument());a.surroundWithNodes(this.createCaret_(!0),this.createCaret_(!1))};goog.inherits(goog.dom.SavedCaretRange,goog.dom.SavedRange);
goog.dom.SavedCaretRange.prototype.toAbstractRange=function(){var a=null,b=this.getCaret(!0),c=this.getCaret(!1);b&&c&&(a=goog.dom.Range.createFromNodes(b,0,c,0));return a};goog.dom.SavedCaretRange.prototype.getCaret=function(a){return this.dom_.getElement(a?this.startCaretId_:this.endCaretId_)};goog.dom.SavedCaretRange.prototype.removeCarets=function(a){goog.dom.removeNode(this.getCaret(!0));goog.dom.removeNode(this.getCaret(!1));return a};
goog.dom.SavedCaretRange.prototype.setRestorationDocument=function(a){this.dom_.setDocument(a)};goog.dom.SavedCaretRange.prototype.restoreInternal=function(){var a=null,b=this.getCaret(!0),c=this.getCaret(!1);if(b&&c){var a=b.parentNode,b=goog.array.indexOf(a.childNodes,b),d=c.parentNode,c=goog.array.indexOf(d.childNodes,c);d==a&&(c-=1);a=goog.dom.Range.createFromNodes(a,b,d,c);a=this.removeCarets(a);a.select()}else this.removeCarets();return a};
goog.dom.SavedCaretRange.prototype.disposeInternal=function(){this.removeCarets();this.dom_=null};goog.dom.SavedCaretRange.prototype.createCaret_=function(a){return this.dom_.createDom(goog.dom.TagName.SPAN,{id:a?this.startCaretId_:this.endCaretId_})};goog.dom.SavedCaretRange.CARET_REGEX=/<span\s+id="?goog_\d+"?><\/span>/ig;goog.dom.SavedCaretRange.htmlEqual=function(a,b){return a==b||a.replace(goog.dom.SavedCaretRange.CARET_REGEX,"")==b.replace(goog.dom.SavedCaretRange.CARET_REGEX,"")};goog.dom.TagWalkType={START_TAG:1,OTHER:0,END_TAG:-1};goog.dom.TagIterator=function(a,b,c,d,e){this.reversed=!!b;a&&this.setPosition(a,d);this.depth=void 0!=e?e:this.tagType||0;this.reversed&&(this.depth*=-1);this.constrained=!c};goog.inherits(goog.dom.TagIterator,goog.iter.Iterator);goog.dom.TagIterator.prototype.node=null;goog.dom.TagIterator.prototype.tagType=goog.dom.TagWalkType.OTHER;goog.dom.TagIterator.prototype.started_=!1;
goog.dom.TagIterator.prototype.setPosition=function(a,b,c){if(this.node=a)this.tagType=goog.isNumber(b)?b:this.node.nodeType!=goog.dom.NodeType.ELEMENT?goog.dom.TagWalkType.OTHER:this.reversed?goog.dom.TagWalkType.END_TAG:goog.dom.TagWalkType.START_TAG;goog.isNumber(c)&&(this.depth=c)};goog.dom.TagIterator.prototype.copyFrom=function(a){this.node=a.node;this.tagType=a.tagType;this.depth=a.depth;this.reversed=a.reversed;this.constrained=a.constrained};
goog.dom.TagIterator.prototype.clone=function(){return new goog.dom.TagIterator(this.node,this.reversed,!this.constrained,this.tagType,this.depth)};goog.dom.TagIterator.prototype.skipTag=function(){var a=this.reversed?goog.dom.TagWalkType.END_TAG:goog.dom.TagWalkType.START_TAG;this.tagType==a&&(this.tagType=-1*a,this.depth+=this.tagType*(this.reversed?-1:1))};
goog.dom.TagIterator.prototype.restartTag=function(){var a=this.reversed?goog.dom.TagWalkType.START_TAG:goog.dom.TagWalkType.END_TAG;this.tagType==a&&(this.tagType=-1*a,this.depth+=this.tagType*(this.reversed?-1:1))};
goog.dom.TagIterator.prototype.next=function(){var a;if(this.started_){if(!this.node||this.constrained&&0==this.depth)throw goog.iter.StopIteration;a=this.node;var b=this.reversed?goog.dom.TagWalkType.END_TAG:goog.dom.TagWalkType.START_TAG;if(this.tagType==b){var c=this.reversed?a.lastChild:a.firstChild;c?this.setPosition(c):this.setPosition(a,-1*b)}else(c=this.reversed?a.previousSibling:a.nextSibling)?this.setPosition(c):this.setPosition(a.parentNode,-1*b);this.depth+=this.tagType*(this.reversed?
-1:1)}else this.started_=!0;a=this.node;if(!this.node)throw goog.iter.StopIteration;return a};goog.dom.TagIterator.prototype.isStarted=function(){return this.started_};goog.dom.TagIterator.prototype.isStartTag=function(){return this.tagType==goog.dom.TagWalkType.START_TAG};goog.dom.TagIterator.prototype.isEndTag=function(){return this.tagType==goog.dom.TagWalkType.END_TAG};goog.dom.TagIterator.prototype.isNonElement=function(){return this.tagType==goog.dom.TagWalkType.OTHER};
goog.dom.TagIterator.prototype.equals=function(a){return a.node==this.node&&(!this.node||a.tagType==this.tagType)};goog.dom.TagIterator.prototype.splice=function(a){var b=this.node;this.restartTag();this.reversed=!this.reversed;goog.dom.TagIterator.prototype.next.call(this);this.reversed=!this.reversed;for(var c=goog.isArrayLike(arguments[0])?arguments[0]:arguments,d=c.length-1;0<=d;d--)goog.dom.insertSiblingAfter(c[d],b);goog.dom.removeNode(b)};goog.dom.RangeType={TEXT:"text",CONTROL:"control",MULTI:"mutli"};goog.dom.AbstractRange=function(){};goog.dom.AbstractRange.getBrowserSelectionForWindow=function(a){if(a.getSelection)return a.getSelection();var a=a.document,b=a.selection;if(b){try{var c=b.createRange();if(c.parentElement){if(c.parentElement().document!=a)return null}else if(!c.length||c.item(0).document!=a)return null}catch(d){return null}return b}return null};goog.dom.AbstractRange.isNativeControlRange=function(a){return!!a&&!!a.addElement};
goog.dom.AbstractRange.prototype.setBrowserRangeObject=function(){return!1};goog.dom.AbstractRange.prototype.getTextRanges=function(){for(var a=[],b=0,c=this.getTextRangeCount();b<c;b++)a.push(this.getTextRange(b));return a};goog.dom.AbstractRange.prototype.getContainerElement=function(){var a=this.getContainer();return a.nodeType==goog.dom.NodeType.ELEMENT?a:a.parentNode};goog.dom.AbstractRange.prototype.getAnchorNode=function(){return this.isReversed()?this.getEndNode():this.getStartNode()};
goog.dom.AbstractRange.prototype.getAnchorOffset=function(){return this.isReversed()?this.getEndOffset():this.getStartOffset()};goog.dom.AbstractRange.prototype.getFocusNode=function(){return this.isReversed()?this.getStartNode():this.getEndNode()};goog.dom.AbstractRange.prototype.getFocusOffset=function(){return this.isReversed()?this.getStartOffset():this.getEndOffset()};goog.dom.AbstractRange.prototype.isReversed=function(){return!1};
goog.dom.AbstractRange.prototype.getDocument=function(){return goog.dom.getOwnerDocument(goog.userAgent.IE?this.getContainer():this.getStartNode())};goog.dom.AbstractRange.prototype.getWindow=function(){return goog.dom.getWindow(this.getDocument())};goog.dom.AbstractRange.prototype.containsNode=function(a,b){return this.containsRange(goog.dom.Range.createFromNodeContents(a),b)};
goog.dom.AbstractRange.prototype.replaceContentsWithNode=function(a){this.isCollapsed()||this.removeContents();return this.insertNode(a,!0)};goog.dom.AbstractRange.prototype.saveUsingCarets=function(){return this.getStartNode()&&this.getEndNode()?new goog.dom.SavedCaretRange(this):null};goog.dom.RangeIterator=function(a,b){goog.dom.TagIterator.call(this,a,b,!0)};goog.inherits(goog.dom.RangeIterator,goog.dom.TagIterator);goog.dom.AbstractMultiRange=function(){};goog.inherits(goog.dom.AbstractMultiRange,goog.dom.AbstractRange);goog.dom.AbstractMultiRange.prototype.containsRange=function(a,b){var c=this.getTextRanges(),d=a.getTextRanges();return(b?goog.array.some:goog.array.every)(d,function(a){return goog.array.some(c,function(c){return c.containsRange(a,b)})})};
goog.dom.AbstractMultiRange.prototype.insertNode=function(a,b){b?goog.dom.insertSiblingBefore(a,this.getStartNode()):goog.dom.insertSiblingAfter(a,this.getEndNode());return a};goog.dom.AbstractMultiRange.prototype.surroundWithNodes=function(a,b){this.insertNode(a,!0);this.insertNode(b,!1)};goog.dom.TextRangeIterator=function(a,b,c,d,e){var f;a&&(this.startNode_=a,this.startOffset_=b,this.endNode_=c,this.endOffset_=d,a.nodeType==goog.dom.NodeType.ELEMENT&&a.tagName!=goog.dom.TagName.BR&&(a=a.childNodes,(b=a[b])?(this.startNode_=b,this.startOffset_=0):(a.length&&(this.startNode_=goog.array.peek(a)),f=!0)),c.nodeType==goog.dom.NodeType.ELEMENT&&((this.endNode_=c.childNodes[d])?this.endOffset_=0:this.endNode_=c));goog.dom.RangeIterator.call(this,e?this.endNode_:this.startNode_,e);if(f)try{this.next()}catch(g){if(g!=
goog.iter.StopIteration)throw g;}};goog.inherits(goog.dom.TextRangeIterator,goog.dom.RangeIterator);goog.dom.TextRangeIterator.prototype.startNode_=null;goog.dom.TextRangeIterator.prototype.endNode_=null;goog.dom.TextRangeIterator.prototype.startOffset_=0;goog.dom.TextRangeIterator.prototype.endOffset_=0;goog.dom.TextRangeIterator.prototype.getStartTextOffset=function(){return this.node.nodeType!=goog.dom.NodeType.TEXT?-1:this.node==this.startNode_?this.startOffset_:0};
goog.dom.TextRangeIterator.prototype.getEndTextOffset=function(){return this.node.nodeType!=goog.dom.NodeType.TEXT?-1:this.node==this.endNode_?this.endOffset_:this.node.nodeValue.length};goog.dom.TextRangeIterator.prototype.getStartNode=function(){return this.startNode_};goog.dom.TextRangeIterator.prototype.setStartNode=function(a){this.isStarted()||this.setPosition(a);this.startNode_=a;this.startOffset_=0};goog.dom.TextRangeIterator.prototype.getEndNode=function(){return this.endNode_};
goog.dom.TextRangeIterator.prototype.setEndNode=function(a){this.endNode_=a;this.endOffset_=0};goog.dom.TextRangeIterator.prototype.isLast=function(){return this.isStarted()&&this.node==this.endNode_&&(!this.endOffset_||!this.isStartTag())};goog.dom.TextRangeIterator.prototype.next=function(){if(this.isLast())throw goog.iter.StopIteration;return goog.dom.TextRangeIterator.superClass_.next.call(this)};
goog.dom.TextRangeIterator.prototype.skipTag=function(){goog.dom.TextRangeIterator.superClass_.skipTag.apply(this);if(goog.dom.contains(this.node,this.endNode_))throw goog.iter.StopIteration;};goog.dom.TextRangeIterator.prototype.copyFrom=function(a){this.startNode_=a.startNode_;this.endNode_=a.endNode_;this.startOffset_=a.startOffset_;this.endOffset_=a.endOffset_;this.isReversed_=a.isReversed_;goog.dom.TextRangeIterator.superClass_.copyFrom.call(this,a)};
goog.dom.TextRangeIterator.prototype.clone=function(){var a=new goog.dom.TextRangeIterator(this.startNode_,this.startOffset_,this.endNode_,this.endOffset_,this.isReversed_);a.copyFrom(this);return a};goog.dom.RangeEndpoint={START:1,END:0};goog.dom.browserrange={};goog.dom.browserrange.AbstractRange=function(){};goog.dom.browserrange.AbstractRange.prototype.containsRange=function(a,b){var c=b&&!a.isCollapsed(),d=a.getBrowserRange(),e=goog.dom.RangeEndpoint.START,f=goog.dom.RangeEndpoint.END;try{return c?0<=this.compareBrowserRangeEndpoints(d,f,e)&&0>=this.compareBrowserRangeEndpoints(d,e,f):0<=this.compareBrowserRangeEndpoints(d,f,f)&&0>=this.compareBrowserRangeEndpoints(d,e,e)}catch(g){if(!goog.userAgent.IE)throw g;return!1}};
goog.dom.browserrange.AbstractRange.prototype.containsNode=function(a,b){return this.containsRange(goog.dom.browserrange.createRangeFromNodeContents(a),b)};
goog.dom.browserrange.AbstractRange.prototype.getHtmlFragment=function(){var a=new goog.string.StringBuffer;goog.iter.forEach(this,function(b,c,d){b.nodeType==goog.dom.NodeType.TEXT?a.append(goog.string.htmlEscape(b.nodeValue.substring(d.getStartTextOffset(),d.getEndTextOffset()))):b.nodeType==goog.dom.NodeType.ELEMENT&&(d.isEndTag()?goog.dom.canHaveChildren(b)&&a.append("</"+b.tagName+">"):(c=b.cloneNode(!1),c=goog.dom.getOuterHtml(c),goog.userAgent.IE&&b.tagName==goog.dom.TagName.LI?a.append(c):
(b=c.lastIndexOf("<"),a.append(b?c.substr(0,b):c))))},this);return a.toString()};goog.dom.browserrange.AbstractRange.prototype.__iterator__=function(){return new goog.dom.TextRangeIterator(this.getStartNode(),this.getStartOffset(),this.getEndNode(),this.getEndOffset())};goog.dom.browserrange.W3cRange=function(a){this.range_=a};goog.inherits(goog.dom.browserrange.W3cRange,goog.dom.browserrange.AbstractRange);
goog.dom.browserrange.W3cRange.getBrowserRangeForNode=function(a){var b=goog.dom.getOwnerDocument(a).createRange();if(a.nodeType==goog.dom.NodeType.TEXT)b.setStart(a,0),b.setEnd(a,a.length);else if(goog.dom.browserrange.canContainRangeEndpoint(a)){for(var c,d=a;(c=d.firstChild)&&goog.dom.browserrange.canContainRangeEndpoint(c);)d=c;b.setStart(d,0);for(d=a;(c=d.lastChild)&&goog.dom.browserrange.canContainRangeEndpoint(c);)d=c;b.setEnd(d,d.nodeType==goog.dom.NodeType.ELEMENT?d.childNodes.length:d.length)}else c=
a.parentNode,a=goog.array.indexOf(c.childNodes,a),b.setStart(c,a),b.setEnd(c,a+1);return b};goog.dom.browserrange.W3cRange.getBrowserRangeForNodes=function(a,b,c,d){var e=goog.dom.getOwnerDocument(a).createRange();e.setStart(a,b);e.setEnd(c,d);return e};goog.dom.browserrange.W3cRange.createFromNodeContents=function(a){return new goog.dom.browserrange.W3cRange(goog.dom.browserrange.W3cRange.getBrowserRangeForNode(a))};
goog.dom.browserrange.W3cRange.createFromNodes=function(a,b,c,d){return new goog.dom.browserrange.W3cRange(goog.dom.browserrange.W3cRange.getBrowserRangeForNodes(a,b,c,d))};goog.dom.browserrange.W3cRange.prototype.clone=function(){return new this.constructor(this.range_.cloneRange())};goog.dom.browserrange.W3cRange.prototype.getBrowserRange=function(){return this.range_};goog.dom.browserrange.W3cRange.prototype.getContainer=function(){return this.range_.commonAncestorContainer};
goog.dom.browserrange.W3cRange.prototype.getStartNode=function(){return this.range_.startContainer};goog.dom.browserrange.W3cRange.prototype.getStartOffset=function(){return this.range_.startOffset};goog.dom.browserrange.W3cRange.prototype.getEndNode=function(){return this.range_.endContainer};goog.dom.browserrange.W3cRange.prototype.getEndOffset=function(){return this.range_.endOffset};
goog.dom.browserrange.W3cRange.prototype.compareBrowserRangeEndpoints=function(a,b,c){return this.range_.compareBoundaryPoints(c==goog.dom.RangeEndpoint.START?b==goog.dom.RangeEndpoint.START?goog.global.Range.START_TO_START:goog.global.Range.START_TO_END:b==goog.dom.RangeEndpoint.START?goog.global.Range.END_TO_START:goog.global.Range.END_TO_END,a)};goog.dom.browserrange.W3cRange.prototype.isCollapsed=function(){return this.range_.collapsed};goog.dom.browserrange.W3cRange.prototype.getText=function(){return this.range_.toString()};
goog.dom.browserrange.W3cRange.prototype.getValidHtml=function(){var a=goog.dom.getDomHelper(this.range_.startContainer).createDom("div");a.appendChild(this.range_.cloneContents());a=a.innerHTML;if(goog.string.startsWith(a,"<")||!this.isCollapsed()&&!goog.string.contains(a,"<"))return a;var b=this.getContainer(),b=b.nodeType==goog.dom.NodeType.ELEMENT?b:b.parentNode;return goog.dom.getOuterHtml(b.cloneNode(!1)).replace(">",">"+a)};
goog.dom.browserrange.W3cRange.prototype.select=function(a){this.selectInternal(goog.dom.getWindow(goog.dom.getOwnerDocument(this.getStartNode())).getSelection(),a)};goog.dom.browserrange.W3cRange.prototype.selectInternal=function(a){a.removeAllRanges();a.addRange(this.range_)};
goog.dom.browserrange.W3cRange.prototype.removeContents=function(){var a=this.range_;a.extractContents();if(a.startContainer.hasChildNodes()&&(a=a.startContainer.childNodes[a.startOffset])){var b=a.previousSibling;""==goog.dom.getRawTextContent(a)&&goog.dom.removeNode(a);b&&""==goog.dom.getRawTextContent(b)&&goog.dom.removeNode(b)}};goog.dom.browserrange.W3cRange.prototype.surroundContents=function(a){this.range_.surroundContents(a);return a};
goog.dom.browserrange.W3cRange.prototype.insertNode=function(a,b){var c=this.range_.cloneRange();c.collapse(b);c.insertNode(a);c.detach();return a};
goog.dom.browserrange.W3cRange.prototype.surroundWithNodes=function(a,b){var c=goog.dom.getWindow(goog.dom.getOwnerDocument(this.getStartNode()));if(c=goog.dom.Range.createFromWindow(c))var d=c.getStartNode(),e=c.getEndNode(),f=c.getStartOffset(),g=c.getEndOffset();var h=this.range_.cloneRange(),i=this.range_.cloneRange();h.collapse(!1);i.collapse(!0);h.insertNode(b);i.insertNode(a);h.detach();i.detach();if(c){if(d.nodeType==goog.dom.NodeType.TEXT)for(;f>d.length;){f-=d.length;do d=d.nextSibling;
while(d==a||d==b)}if(e.nodeType==goog.dom.NodeType.TEXT)for(;g>e.length;){g-=e.length;do e=e.nextSibling;while(e==a||e==b)}goog.dom.Range.createFromNodes(d,f,e,g).select()}};goog.dom.browserrange.W3cRange.prototype.collapse=function(a){this.range_.collapse(a)};goog.dom.browserrange.GeckoRange=function(a){goog.dom.browserrange.W3cRange.call(this,a)};goog.inherits(goog.dom.browserrange.GeckoRange,goog.dom.browserrange.W3cRange);goog.dom.browserrange.GeckoRange.createFromNodeContents=function(a){return new goog.dom.browserrange.GeckoRange(goog.dom.browserrange.W3cRange.getBrowserRangeForNode(a))};
goog.dom.browserrange.GeckoRange.createFromNodes=function(a,b,c,d){return new goog.dom.browserrange.GeckoRange(goog.dom.browserrange.W3cRange.getBrowserRangeForNodes(a,b,c,d))};goog.dom.browserrange.GeckoRange.prototype.selectInternal=function(a,b){var c=b?this.getEndNode():this.getStartNode(),d=b?this.getEndOffset():this.getStartOffset(),e=b?this.getStartNode():this.getEndNode(),f=b?this.getStartOffset():this.getEndOffset();a.collapse(c,d);(c!=e||d!=f)&&a.extend(e,f)};goog.dom.NodeIterator=function(a,b,c,d){goog.dom.TagIterator.call(this,a,b,c,null,d)};goog.inherits(goog.dom.NodeIterator,goog.dom.TagIterator);goog.dom.NodeIterator.prototype.next=function(){do goog.dom.NodeIterator.superClass_.next.call(this);while(this.isEndTag());return this.node};goog.dom.browserrange.IeRange=function(a,b){this.range_=a;this.doc_=b};goog.inherits(goog.dom.browserrange.IeRange,goog.dom.browserrange.AbstractRange);goog.dom.browserrange.IeRange.logger_=goog.debug.Logger.getLogger("goog.dom.browserrange.IeRange");
goog.dom.browserrange.IeRange.getBrowserRangeForNode_=function(a){var b=goog.dom.getOwnerDocument(a).body.createTextRange();if(a.nodeType==goog.dom.NodeType.ELEMENT)b.moveToElementText(a),goog.dom.browserrange.canContainRangeEndpoint(a)&&!a.childNodes.length&&b.collapse(!1);else{for(var c=0,d=a;d=d.previousSibling;){var e=d.nodeType;if(e==goog.dom.NodeType.TEXT)c+=d.length;else if(e==goog.dom.NodeType.ELEMENT){b.moveToElementText(d);break}}d||b.moveToElementText(a.parentNode);b.collapse(!d);c&&b.move("character",
c);b.moveEnd("character",a.length)}return b};
goog.dom.browserrange.IeRange.getBrowserRangeForNodes_=function(a,b,c,d){var e=!1;a.nodeType==goog.dom.NodeType.ELEMENT&&(b>a.childNodes.length&&goog.dom.browserrange.IeRange.logger_.severe("Cannot have startOffset > startNode child count"),b=a.childNodes[b],e=!b,a=b||a.lastChild||a,b=0);var f=goog.dom.browserrange.IeRange.getBrowserRangeForNode_(a);b&&f.move("character",b);if(a==c&&b==d)return f.collapse(!0),f;e&&f.collapse(!1);e=!1;c.nodeType==goog.dom.NodeType.ELEMENT&&(d>c.childNodes.length&&
goog.dom.browserrange.IeRange.logger_.severe("Cannot have endOffset > endNode child count"),c=(b=c.childNodes[d])||c.lastChild||c,d=0,e=!b);a=goog.dom.browserrange.IeRange.getBrowserRangeForNode_(c);a.collapse(!e);d&&a.moveEnd("character",d);f.setEndPoint("EndToEnd",a);return f};
goog.dom.browserrange.IeRange.createFromNodeContents=function(a){var b=new goog.dom.browserrange.IeRange(goog.dom.browserrange.IeRange.getBrowserRangeForNode_(a),goog.dom.getOwnerDocument(a));if(goog.dom.browserrange.canContainRangeEndpoint(a)){for(var c,d=a;(c=d.firstChild)&&goog.dom.browserrange.canContainRangeEndpoint(c);)d=c;b.startNode_=d;b.startOffset_=0;for(d=a;(c=d.lastChild)&&goog.dom.browserrange.canContainRangeEndpoint(c);)d=c;b.endNode_=d;b.endOffset_=d.nodeType==goog.dom.NodeType.ELEMENT?
d.childNodes.length:d.length;b.parentNode_=a}else b.startNode_=b.endNode_=b.parentNode_=a.parentNode,b.startOffset_=goog.array.indexOf(b.parentNode_.childNodes,a),b.endOffset_=b.startOffset_+1;return b};goog.dom.browserrange.IeRange.createFromNodes=function(a,b,c,d){var e=new goog.dom.browserrange.IeRange(goog.dom.browserrange.IeRange.getBrowserRangeForNodes_(a,b,c,d),goog.dom.getOwnerDocument(a));e.startNode_=a;e.startOffset_=b;e.endNode_=c;e.endOffset_=d;return e};
goog.dom.browserrange.IeRange.prototype.parentNode_=null;goog.dom.browserrange.IeRange.prototype.startNode_=null;goog.dom.browserrange.IeRange.prototype.endNode_=null;goog.dom.browserrange.IeRange.prototype.startOffset_=-1;goog.dom.browserrange.IeRange.prototype.endOffset_=-1;goog.dom.browserrange.IeRange.prototype.clone=function(){var a=new goog.dom.browserrange.IeRange(this.range_.duplicate(),this.doc_);a.parentNode_=this.parentNode_;a.startNode_=this.startNode_;a.endNode_=this.endNode_;return a};
goog.dom.browserrange.IeRange.prototype.getBrowserRange=function(){return this.range_};goog.dom.browserrange.IeRange.prototype.clearCachedValues_=function(){this.parentNode_=this.startNode_=this.endNode_=null;this.startOffset_=this.endOffset_=-1};
goog.dom.browserrange.IeRange.prototype.getContainer=function(){if(!this.parentNode_){var a=this.range_.text,b=this.range_.duplicate(),c=a.replace(/ +$/,"");(c=a.length-c.length)&&b.moveEnd("character",-c);c=b.parentElement();b=goog.string.stripNewlines(b.htmlText).length;if(this.isCollapsed()&&0<b)return this.parentNode_=c;for(;b>goog.string.stripNewlines(c.outerHTML).length;)c=c.parentNode;for(;1==c.childNodes.length&&c.innerText==goog.dom.browserrange.IeRange.getNodeText_(c.firstChild)&&goog.dom.browserrange.canContainRangeEndpoint(c.firstChild);)c=
c.firstChild;0==a.length&&(c=this.findDeepestContainer_(c));this.parentNode_=c}return this.parentNode_};
goog.dom.browserrange.IeRange.prototype.findDeepestContainer_=function(a){for(var b=a.childNodes,c=0,d=b.length;c<d;c++){var e=b[c];if(goog.dom.browserrange.canContainRangeEndpoint(e)){var f=goog.dom.browserrange.IeRange.getBrowserRangeForNode_(e),g=goog.dom.RangeEndpoint.START,h=goog.dom.RangeEndpoint.END,i=f.htmlText!=e.outerHTML;if(this.isCollapsed()&&i?0<=this.compareBrowserRangeEndpoints(f,g,g)&&0>=this.compareBrowserRangeEndpoints(f,g,h):this.range_.inRange(f))return this.findDeepestContainer_(e)}}return a};
goog.dom.browserrange.IeRange.prototype.getStartNode=function(){this.startNode_||(this.startNode_=this.getEndpointNode_(goog.dom.RangeEndpoint.START),this.isCollapsed()&&(this.endNode_=this.startNode_));return this.startNode_};goog.dom.browserrange.IeRange.prototype.getStartOffset=function(){0>this.startOffset_&&(this.startOffset_=this.getOffset_(goog.dom.RangeEndpoint.START),this.isCollapsed()&&(this.endOffset_=this.startOffset_));return this.startOffset_};
goog.dom.browserrange.IeRange.prototype.getEndNode=function(){if(this.isCollapsed())return this.getStartNode();this.endNode_||(this.endNode_=this.getEndpointNode_(goog.dom.RangeEndpoint.END));return this.endNode_};goog.dom.browserrange.IeRange.prototype.getEndOffset=function(){if(this.isCollapsed())return this.getStartOffset();0>this.endOffset_&&(this.endOffset_=this.getOffset_(goog.dom.RangeEndpoint.END),this.isCollapsed()&&(this.startOffset_=this.endOffset_));return this.endOffset_};
goog.dom.browserrange.IeRange.prototype.compareBrowserRangeEndpoints=function(a,b,c){return this.range_.compareEndPoints((b==goog.dom.RangeEndpoint.START?"Start":"End")+"To"+(c==goog.dom.RangeEndpoint.START?"Start":"End"),a)};
goog.dom.browserrange.IeRange.prototype.getEndpointNode_=function(a,b){var c=b||this.getContainer();if(!c||!c.firstChild)return c;for(var d=goog.dom.RangeEndpoint.START,e=goog.dom.RangeEndpoint.END,f=a==d,g=0,h=c.childNodes.length;g<h;g++){var i=f?g:h-g-1,j=c.childNodes[i],k;try{k=goog.dom.browserrange.createRangeFromNodeContents(j)}catch(l){continue}var m=k.getBrowserRange();if(this.isCollapsed())if(goog.dom.browserrange.canContainRangeEndpoint(j)){if(k.containsRange(this))return this.getEndpointNode_(a,
j)}else{if(0==this.compareBrowserRangeEndpoints(m,d,d)){this.startOffset_=this.endOffset_=i;break}}else{if(this.containsRange(k)){if(!goog.dom.browserrange.canContainRangeEndpoint(j)){f?this.startOffset_=i:this.endOffset_=i+1;break}return this.getEndpointNode_(a,j)}if(0>this.compareBrowserRangeEndpoints(m,d,e)&&0<this.compareBrowserRangeEndpoints(m,e,d))return this.getEndpointNode_(a,j)}}return c};
goog.dom.browserrange.IeRange.prototype.compareNodeEndpoints_=function(a,b,c){return this.range_.compareEndPoints((b==goog.dom.RangeEndpoint.START?"Start":"End")+"To"+(c==goog.dom.RangeEndpoint.START?"Start":"End"),goog.dom.browserrange.createRangeFromNodeContents(a).getBrowserRange())};
goog.dom.browserrange.IeRange.prototype.getOffset_=function(a,b){var c=a==goog.dom.RangeEndpoint.START,d=b||(c?this.getStartNode():this.getEndNode());if(d.nodeType==goog.dom.NodeType.ELEMENT){for(var d=d.childNodes,e=d.length,f=c?1:-1,g=c?0:e-1;0<=g&&g<e;g+=f){var h=d[g];if(!goog.dom.browserrange.canContainRangeEndpoint(h)&&0==this.compareNodeEndpoints_(h,a,a))return c?g:g+1}return-1==g?0:g}e=this.range_.duplicate();f=goog.dom.browserrange.IeRange.getBrowserRangeForNode_(d);e.setEndPoint(c?"EndToEnd":
"StartToStart",f);e=e.text.length;return c?d.length-e:e};goog.dom.browserrange.IeRange.getNodeText_=function(a){return a.nodeType==goog.dom.NodeType.TEXT?a.nodeValue:a.innerText};goog.dom.browserrange.IeRange.prototype.isRangeInDocument=function(){var a=this.doc_.body.createTextRange();a.moveToElementText(this.doc_.body);return this.containsRange(new goog.dom.browserrange.IeRange(a,this.doc_),!0)};
goog.dom.browserrange.IeRange.prototype.isCollapsed=function(){return 0==this.range_.compareEndPoints("StartToEnd",this.range_)};goog.dom.browserrange.IeRange.prototype.getText=function(){return this.range_.text};goog.dom.browserrange.IeRange.prototype.getValidHtml=function(){return this.range_.htmlText};goog.dom.browserrange.IeRange.prototype.select=function(){this.range_.select()};
goog.dom.browserrange.IeRange.prototype.removeContents=function(){if(!this.isCollapsed()&&this.range_.htmlText){var a=this.getStartNode(),b=this.getEndNode(),c=this.range_.text,d=this.range_.duplicate();d.moveStart("character",1);d.moveStart("character",-1);d.text==c&&(this.range_=d);this.range_.text="";this.clearCachedValues_();c=this.getStartNode();d=this.getStartOffset();try{var e=a.nextSibling;a==b&&a.parentNode&&a.nodeType==goog.dom.NodeType.TEXT&&e&&e.nodeType==goog.dom.NodeType.TEXT&&(a.nodeValue+=
e.nodeValue,goog.dom.removeNode(e),this.range_=goog.dom.browserrange.IeRange.getBrowserRangeForNode_(c),this.range_.move("character",d),this.clearCachedValues_())}catch(f){}}};goog.dom.browserrange.IeRange.getDomHelper_=function(a){return goog.dom.getDomHelper(a.parentElement())};
goog.dom.browserrange.IeRange.pasteElement_=function(a,b,c){var c=c||goog.dom.browserrange.IeRange.getDomHelper_(a),d,e=d=b.id;d||(d=b.id=goog.string.createUniqueString());a.pasteHTML(b.outerHTML);(b=c.getElement(d))&&(e||b.removeAttribute("id"));return b};
goog.dom.browserrange.IeRange.prototype.surroundContents=function(a){goog.dom.removeNode(a);a.innerHTML=this.range_.htmlText;(a=goog.dom.browserrange.IeRange.pasteElement_(this.range_,a))&&this.range_.moveToElementText(a);this.clearCachedValues_();return a};
goog.dom.browserrange.IeRange.insertNode_=function(a,b,c,d){var d=d||goog.dom.browserrange.IeRange.getDomHelper_(a),e;b.nodeType!=goog.dom.NodeType.ELEMENT&&(e=!0,b=d.createDom(goog.dom.TagName.DIV,null,b));a.collapse(c);b=goog.dom.browserrange.IeRange.pasteElement_(a,b,d);e&&(a=b.firstChild,d.flattenElement(b),b=a);return b};goog.dom.browserrange.IeRange.prototype.insertNode=function(a,b){var c=goog.dom.browserrange.IeRange.insertNode_(this.range_.duplicate(),a,b);this.clearCachedValues_();return c};
goog.dom.browserrange.IeRange.prototype.surroundWithNodes=function(a,b){var c=this.range_.duplicate(),d=this.range_.duplicate();goog.dom.browserrange.IeRange.insertNode_(c,a,!0);goog.dom.browserrange.IeRange.insertNode_(d,b,!1);this.clearCachedValues_()};goog.dom.browserrange.IeRange.prototype.collapse=function(a){this.range_.collapse(a);a?(this.endNode_=this.startNode_,this.endOffset_=this.startOffset_):(this.startNode_=this.endNode_,this.startOffset_=this.endOffset_)};goog.dom.browserrange.OperaRange=function(a){goog.dom.browserrange.W3cRange.call(this,a)};goog.inherits(goog.dom.browserrange.OperaRange,goog.dom.browserrange.W3cRange);goog.dom.browserrange.OperaRange.createFromNodeContents=function(a){return new goog.dom.browserrange.OperaRange(goog.dom.browserrange.W3cRange.getBrowserRangeForNode(a))};
goog.dom.browserrange.OperaRange.createFromNodes=function(a,b,c,d){return new goog.dom.browserrange.OperaRange(goog.dom.browserrange.W3cRange.getBrowserRangeForNodes(a,b,c,d))};goog.dom.browserrange.OperaRange.prototype.selectInternal=function(a){a.collapse(this.getStartNode(),this.getStartOffset());(this.getEndNode()!=this.getStartNode()||this.getEndOffset()!=this.getStartOffset())&&a.extend(this.getEndNode(),this.getEndOffset());0==a.rangeCount&&a.addRange(this.range_)};goog.dom.browserrange.WebKitRange=function(a){goog.dom.browserrange.W3cRange.call(this,a)};goog.inherits(goog.dom.browserrange.WebKitRange,goog.dom.browserrange.W3cRange);goog.dom.browserrange.WebKitRange.createFromNodeContents=function(a){return new goog.dom.browserrange.WebKitRange(goog.dom.browserrange.W3cRange.getBrowserRangeForNode(a))};
goog.dom.browserrange.WebKitRange.createFromNodes=function(a,b,c,d){return new goog.dom.browserrange.WebKitRange(goog.dom.browserrange.W3cRange.getBrowserRangeForNodes(a,b,c,d))};
goog.dom.browserrange.WebKitRange.prototype.compareBrowserRangeEndpoints=function(a,b,c){return goog.userAgent.isVersion("528")?goog.dom.browserrange.WebKitRange.superClass_.compareBrowserRangeEndpoints.call(this,a,b,c):this.range_.compareBoundaryPoints(c==goog.dom.RangeEndpoint.START?b==goog.dom.RangeEndpoint.START?goog.global.Range.START_TO_START:goog.global.Range.END_TO_START:b==goog.dom.RangeEndpoint.START?goog.global.Range.START_TO_END:goog.global.Range.END_TO_END,a)};
goog.dom.browserrange.WebKitRange.prototype.selectInternal=function(a,b){a.removeAllRanges();b?a.setBaseAndExtent(this.getEndNode(),this.getEndOffset(),this.getStartNode(),this.getStartOffset()):a.setBaseAndExtent(this.getStartNode(),this.getStartOffset(),this.getEndNode(),this.getEndOffset())};goog.dom.browserrange.Error={NOT_IMPLEMENTED:"Not Implemented"};goog.dom.browserrange.createRange=function(a){return goog.userAgent.IE&&!goog.userAgent.isDocumentMode(9)?new goog.dom.browserrange.IeRange(a,goog.dom.getOwnerDocument(a.parentElement())):goog.userAgent.WEBKIT?new goog.dom.browserrange.WebKitRange(a):goog.userAgent.GECKO?new goog.dom.browserrange.GeckoRange(a):goog.userAgent.OPERA?new goog.dom.browserrange.OperaRange(a):new goog.dom.browserrange.W3cRange(a)};
goog.dom.browserrange.createRangeFromNodeContents=function(a){return goog.userAgent.IE&&!goog.userAgent.isDocumentMode(9)?goog.dom.browserrange.IeRange.createFromNodeContents(a):goog.userAgent.WEBKIT?goog.dom.browserrange.WebKitRange.createFromNodeContents(a):goog.userAgent.GECKO?goog.dom.browserrange.GeckoRange.createFromNodeContents(a):goog.userAgent.OPERA?goog.dom.browserrange.OperaRange.createFromNodeContents(a):goog.dom.browserrange.W3cRange.createFromNodeContents(a)};
goog.dom.browserrange.createRangeFromNodes=function(a,b,c,d){return goog.userAgent.IE&&!goog.userAgent.isDocumentMode(9)?goog.dom.browserrange.IeRange.createFromNodes(a,b,c,d):goog.userAgent.WEBKIT?goog.dom.browserrange.WebKitRange.createFromNodes(a,b,c,d):goog.userAgent.GECKO?goog.dom.browserrange.GeckoRange.createFromNodes(a,b,c,d):goog.userAgent.OPERA?goog.dom.browserrange.OperaRange.createFromNodes(a,b,c,d):goog.dom.browserrange.W3cRange.createFromNodes(a,b,c,d)};
goog.dom.browserrange.canContainRangeEndpoint=function(a){return goog.dom.canHaveChildren(a)||a.nodeType==goog.dom.NodeType.TEXT};goog.dom.TextRange=function(){};goog.inherits(goog.dom.TextRange,goog.dom.AbstractRange);goog.dom.TextRange.createFromBrowserRange=function(a,b){return goog.dom.TextRange.createFromBrowserRangeWrapper_(goog.dom.browserrange.createRange(a),b)};goog.dom.TextRange.createFromBrowserRangeWrapper_=function(a,b){var c=new goog.dom.TextRange;c.browserRangeWrapper_=a;c.isReversed_=!!b;return c};
goog.dom.TextRange.createFromNodeContents=function(a,b){return goog.dom.TextRange.createFromBrowserRangeWrapper_(goog.dom.browserrange.createRangeFromNodeContents(a),b)};
goog.dom.TextRange.createFromNodes=function(a,b,c,d){var e=new goog.dom.TextRange;e.isReversed_=goog.dom.Range.isReversed(a,b,c,d);if("BR"==a.tagName)var f=a.parentNode,b=goog.array.indexOf(f.childNodes,a),a=f;"BR"==c.tagName&&(f=c.parentNode,d=goog.array.indexOf(f.childNodes,c),c=f);e.isReversed_?(e.startNode_=c,e.startOffset_=d,e.endNode_=a,e.endOffset_=b):(e.startNode_=a,e.startOffset_=b,e.endNode_=c,e.endOffset_=d);return e};goog.dom.TextRange.prototype.browserRangeWrapper_=null;
goog.dom.TextRange.prototype.startNode_=null;goog.dom.TextRange.prototype.startOffset_=null;goog.dom.TextRange.prototype.endNode_=null;goog.dom.TextRange.prototype.endOffset_=null;goog.dom.TextRange.prototype.isReversed_=!1;goog.dom.TextRange.prototype.clone=function(){var a=new goog.dom.TextRange;a.browserRangeWrapper_=this.browserRangeWrapper_;a.startNode_=this.startNode_;a.startOffset_=this.startOffset_;a.endNode_=this.endNode_;a.endOffset_=this.endOffset_;a.isReversed_=this.isReversed_;return a};
goog.dom.TextRange.prototype.getType=function(){return goog.dom.RangeType.TEXT};goog.dom.TextRange.prototype.getBrowserRangeObject=function(){return this.getBrowserRangeWrapper_().getBrowserRange()};goog.dom.TextRange.prototype.setBrowserRangeObject=function(a){if(goog.dom.AbstractRange.isNativeControlRange(a))return!1;this.browserRangeWrapper_=goog.dom.browserrange.createRange(a);this.clearCachedValues_();return!0};
goog.dom.TextRange.prototype.clearCachedValues_=function(){this.startNode_=this.startOffset_=this.endNode_=this.endOffset_=null};goog.dom.TextRange.prototype.getTextRangeCount=function(){return 1};goog.dom.TextRange.prototype.getTextRange=function(){return this};goog.dom.TextRange.prototype.getBrowserRangeWrapper_=function(){return this.browserRangeWrapper_||(this.browserRangeWrapper_=goog.dom.browserrange.createRangeFromNodes(this.getStartNode(),this.getStartOffset(),this.getEndNode(),this.getEndOffset()))};
goog.dom.TextRange.prototype.getContainer=function(){return this.getBrowserRangeWrapper_().getContainer()};goog.dom.TextRange.prototype.getStartNode=function(){return this.startNode_||(this.startNode_=this.getBrowserRangeWrapper_().getStartNode())};goog.dom.TextRange.prototype.getStartOffset=function(){return null!=this.startOffset_?this.startOffset_:this.startOffset_=this.getBrowserRangeWrapper_().getStartOffset()};
goog.dom.TextRange.prototype.getEndNode=function(){return this.endNode_||(this.endNode_=this.getBrowserRangeWrapper_().getEndNode())};goog.dom.TextRange.prototype.getEndOffset=function(){return null!=this.endOffset_?this.endOffset_:this.endOffset_=this.getBrowserRangeWrapper_().getEndOffset()};goog.dom.TextRange.prototype.moveToNodes=function(a,b,c,d,e){this.startNode_=a;this.startOffset_=b;this.endNode_=c;this.endOffset_=d;this.isReversed_=e;this.browserRangeWrapper_=null};
goog.dom.TextRange.prototype.isReversed=function(){return this.isReversed_};goog.dom.TextRange.prototype.containsRange=function(a,b){var c=a.getType();if(c==goog.dom.RangeType.TEXT)return this.getBrowserRangeWrapper_().containsRange(a.getBrowserRangeWrapper_(),b);return c==goog.dom.RangeType.CONTROL?(c=a.getElements(),(b?goog.array.some:goog.array.every)(c,function(a){return this.containsNode(a,b)},this)):!1};
goog.dom.TextRange.isAttachedNode=function(a){if(goog.userAgent.IE&&!goog.userAgent.isDocumentMode(9)){var b=!1;try{b=a.parentNode}catch(c){}return!!b}return goog.dom.contains(a.ownerDocument.body,a)};goog.dom.TextRange.prototype.isRangeInDocument=function(){return(!this.startNode_||goog.dom.TextRange.isAttachedNode(this.startNode_))&&(!this.endNode_||goog.dom.TextRange.isAttachedNode(this.endNode_))&&(!(goog.userAgent.IE&&!goog.userAgent.isDocumentMode(9))||this.getBrowserRangeWrapper_().isRangeInDocument())};
goog.dom.TextRange.prototype.isCollapsed=function(){return this.getBrowserRangeWrapper_().isCollapsed()};goog.dom.TextRange.prototype.getText=function(){return this.getBrowserRangeWrapper_().getText()};goog.dom.TextRange.prototype.getHtmlFragment=function(){return this.getBrowserRangeWrapper_().getHtmlFragment()};goog.dom.TextRange.prototype.getValidHtml=function(){return this.getBrowserRangeWrapper_().getValidHtml()};
goog.dom.TextRange.prototype.getPastableHtml=function(){var a=this.getValidHtml();if(a.match(/^\s*<td\b/i))a="<table><tbody><tr>"+a+"</tr></tbody></table>";else if(a.match(/^\s*<tr\b/i))a="<table><tbody>"+a+"</tbody></table>";else if(a.match(/^\s*<tbody\b/i))a="<table>"+a+"</table>";else if(a.match(/^\s*<li\b/i)){for(var b=this.getContainer(),c=goog.dom.TagName.UL;b;){if(b.tagName==goog.dom.TagName.OL){c=goog.dom.TagName.OL;break}else if(b.tagName==goog.dom.TagName.UL)break;b=b.parentNode}a=goog.string.buildString("<",
c,">",a,"</",c,">")}return a};goog.dom.TextRange.prototype.__iterator__=function(){return new goog.dom.TextRangeIterator(this.getStartNode(),this.getStartOffset(),this.getEndNode(),this.getEndOffset())};goog.dom.TextRange.prototype.select=function(){this.getBrowserRangeWrapper_().select(this.isReversed_)};goog.dom.TextRange.prototype.removeContents=function(){this.getBrowserRangeWrapper_().removeContents();this.clearCachedValues_()};
goog.dom.TextRange.prototype.surroundContents=function(a){a=this.getBrowserRangeWrapper_().surroundContents(a);this.clearCachedValues_();return a};goog.dom.TextRange.prototype.insertNode=function(a,b){var c=this.getBrowserRangeWrapper_().insertNode(a,b);this.clearCachedValues_();return c};goog.dom.TextRange.prototype.surroundWithNodes=function(a,b){this.getBrowserRangeWrapper_().surroundWithNodes(a,b);this.clearCachedValues_()};goog.dom.TextRange.prototype.saveUsingDom=function(){return new goog.dom.DomSavedTextRange_(this)};
goog.dom.TextRange.prototype.collapse=function(a){a=this.isReversed()?!a:a;this.browserRangeWrapper_&&this.browserRangeWrapper_.collapse(a);a?(this.endNode_=this.startNode_,this.endOffset_=this.startOffset_):(this.startNode_=this.endNode_,this.startOffset_=this.endOffset_);this.isReversed_=!1};goog.dom.DomSavedTextRange_=function(a){this.anchorNode_=a.getAnchorNode();this.anchorOffset_=a.getAnchorOffset();this.focusNode_=a.getFocusNode();this.focusOffset_=a.getFocusOffset()};
goog.inherits(goog.dom.DomSavedTextRange_,goog.dom.SavedRange);goog.dom.DomSavedTextRange_.prototype.restoreInternal=function(){return goog.dom.Range.createFromNodes(this.anchorNode_,this.anchorOffset_,this.focusNode_,this.focusOffset_)};goog.dom.DomSavedTextRange_.prototype.disposeInternal=function(){goog.dom.DomSavedTextRange_.superClass_.disposeInternal.call(this);this.focusNode_=this.anchorNode_=null};goog.dom.ControlRange=function(){};goog.inherits(goog.dom.ControlRange,goog.dom.AbstractMultiRange);goog.dom.ControlRange.createFromBrowserRange=function(a){var b=new goog.dom.ControlRange;b.range_=a;return b};goog.dom.ControlRange.createFromElements=function(a){for(var b=goog.dom.getOwnerDocument(arguments[0]).body.createControlRange(),c=0,d=arguments.length;c<d;c++)b.addElement(arguments[c]);return goog.dom.ControlRange.createFromBrowserRange(b)};goog.dom.ControlRange.prototype.range_=null;
goog.dom.ControlRange.prototype.elements_=null;goog.dom.ControlRange.prototype.sortedElements_=null;goog.dom.ControlRange.prototype.clearCachedValues_=function(){this.sortedElements_=this.elements_=null};goog.dom.ControlRange.prototype.clone=function(){return goog.dom.ControlRange.createFromElements.apply(this,this.getElements())};goog.dom.ControlRange.prototype.getType=function(){return goog.dom.RangeType.CONTROL};
goog.dom.ControlRange.prototype.getBrowserRangeObject=function(){return this.range_||document.body.createControlRange()};goog.dom.ControlRange.prototype.setBrowserRangeObject=function(a){if(!goog.dom.AbstractRange.isNativeControlRange(a))return!1;this.range_=a;return!0};goog.dom.ControlRange.prototype.getTextRangeCount=function(){return this.range_?this.range_.length:0};goog.dom.ControlRange.prototype.getTextRange=function(a){return goog.dom.TextRange.createFromNodeContents(this.range_.item(a))};
goog.dom.ControlRange.prototype.getContainer=function(){return goog.dom.findCommonAncestor.apply(null,this.getElements())};goog.dom.ControlRange.prototype.getStartNode=function(){return this.getSortedElements()[0]};goog.dom.ControlRange.prototype.getStartOffset=function(){return 0};goog.dom.ControlRange.prototype.getEndNode=function(){var a=this.getSortedElements(),b=goog.array.peek(a);return goog.array.find(a,function(a){return goog.dom.contains(a,b)})};
goog.dom.ControlRange.prototype.getEndOffset=function(){return this.getEndNode().childNodes.length};goog.dom.ControlRange.prototype.getElements=function(){if(!this.elements_&&(this.elements_=[],this.range_))for(var a=0;a<this.range_.length;a++)this.elements_.push(this.range_.item(a));return this.elements_};
goog.dom.ControlRange.prototype.getSortedElements=function(){this.sortedElements_||(this.sortedElements_=this.getElements().concat(),this.sortedElements_.sort(function(a,b){return a.sourceIndex-b.sourceIndex}));return this.sortedElements_};goog.dom.ControlRange.prototype.isRangeInDocument=function(){var a=!1;try{a=goog.array.every(this.getElements(),function(a){return goog.userAgent.IE?a.parentNode:goog.dom.contains(a.ownerDocument.body,a)})}catch(b){}return a};
goog.dom.ControlRange.prototype.isCollapsed=function(){return!this.range_||!this.range_.length};goog.dom.ControlRange.prototype.getText=function(){return""};goog.dom.ControlRange.prototype.getHtmlFragment=function(){return goog.array.map(this.getSortedElements(),goog.dom.getOuterHtml).join("")};goog.dom.ControlRange.prototype.getValidHtml=function(){return this.getHtmlFragment()};goog.dom.ControlRange.prototype.getPastableHtml=goog.dom.ControlRange.prototype.getValidHtml;
goog.dom.ControlRange.prototype.__iterator__=function(){return new goog.dom.ControlRangeIterator(this)};goog.dom.ControlRange.prototype.select=function(){this.range_&&this.range_.select()};goog.dom.ControlRange.prototype.removeContents=function(){if(this.range_){for(var a=[],b=0,c=this.range_.length;b<c;b++)a.push(this.range_.item(b));goog.array.forEach(a,goog.dom.removeNode);this.collapse(!1)}};
goog.dom.ControlRange.prototype.replaceContentsWithNode=function(a){a=this.insertNode(a,!0);this.isCollapsed()||this.removeContents();return a};goog.dom.ControlRange.prototype.saveUsingDom=function(){return new goog.dom.DomSavedControlRange_(this)};goog.dom.ControlRange.prototype.collapse=function(){this.range_=null;this.clearCachedValues_()};goog.dom.DomSavedControlRange_=function(a){this.elements_=a.getElements()};goog.inherits(goog.dom.DomSavedControlRange_,goog.dom.SavedRange);
goog.dom.DomSavedControlRange_.prototype.restoreInternal=function(){for(var a=(this.elements_.length?goog.dom.getOwnerDocument(this.elements_[0]):document).body.createControlRange(),b=0,c=this.elements_.length;b<c;b++)a.addElement(this.elements_[b]);return goog.dom.ControlRange.createFromBrowserRange(a)};goog.dom.DomSavedControlRange_.prototype.disposeInternal=function(){goog.dom.DomSavedControlRange_.superClass_.disposeInternal.call(this);delete this.elements_};
goog.dom.ControlRangeIterator=function(a){a&&(this.elements_=a.getSortedElements(),this.startNode_=this.elements_.shift(),this.endNode_=goog.array.peek(this.elements_)||this.startNode_);goog.dom.RangeIterator.call(this,this.startNode_,!1)};goog.inherits(goog.dom.ControlRangeIterator,goog.dom.RangeIterator);goog.dom.ControlRangeIterator.prototype.startNode_=null;goog.dom.ControlRangeIterator.prototype.endNode_=null;goog.dom.ControlRangeIterator.prototype.elements_=null;
goog.dom.ControlRangeIterator.prototype.getStartTextOffset=function(){return 0};goog.dom.ControlRangeIterator.prototype.getEndTextOffset=function(){return 0};goog.dom.ControlRangeIterator.prototype.getStartNode=function(){return this.startNode_};goog.dom.ControlRangeIterator.prototype.getEndNode=function(){return this.endNode_};goog.dom.ControlRangeIterator.prototype.isLast=function(){return!this.depth&&!this.elements_.length};
goog.dom.ControlRangeIterator.prototype.next=function(){if(this.isLast())throw goog.iter.StopIteration;if(!this.depth){var a=this.elements_.shift();this.setPosition(a,goog.dom.TagWalkType.START_TAG,goog.dom.TagWalkType.START_TAG);return a}return goog.dom.ControlRangeIterator.superClass_.next.call(this)};
goog.dom.ControlRangeIterator.prototype.copyFrom=function(a){this.elements_=a.elements_;this.startNode_=a.startNode_;this.endNode_=a.endNode_;goog.dom.ControlRangeIterator.superClass_.copyFrom.call(this,a)};goog.dom.ControlRangeIterator.prototype.clone=function(){var a=new goog.dom.ControlRangeIterator(null);a.copyFrom(this);return a};goog.dom.MultiRange=function(){this.browserRanges_=[];this.ranges_=[];this.container_=this.sortedRanges_=null};goog.inherits(goog.dom.MultiRange,goog.dom.AbstractMultiRange);goog.dom.MultiRange.createFromBrowserSelection=function(a){for(var b=new goog.dom.MultiRange,c=0,d=a.rangeCount;c<d;c++)b.browserRanges_.push(a.getRangeAt(c));return b};goog.dom.MultiRange.createFromBrowserRanges=function(a){var b=new goog.dom.MultiRange;b.browserRanges_=goog.array.clone(a);return b};
goog.dom.MultiRange.createFromTextRanges=function(a){var b=new goog.dom.MultiRange;b.ranges_=a;b.browserRanges_=goog.array.map(a,function(a){return a.getBrowserRangeObject()});return b};goog.dom.MultiRange.prototype.logger_=goog.debug.Logger.getLogger("goog.dom.MultiRange");goog.dom.MultiRange.prototype.clearCachedValues_=function(){this.ranges_=[];this.container_=this.sortedRanges_=null};goog.dom.MultiRange.prototype.clone=function(){return goog.dom.MultiRange.createFromBrowserRanges(this.browserRanges_)};
goog.dom.MultiRange.prototype.getType=function(){return goog.dom.RangeType.MULTI};goog.dom.MultiRange.prototype.getBrowserRangeObject=function(){1<this.browserRanges_.length&&this.logger_.warning("getBrowserRangeObject called on MultiRange with more than 1 range");return this.browserRanges_[0]};goog.dom.MultiRange.prototype.setBrowserRangeObject=function(){return!1};goog.dom.MultiRange.prototype.getTextRangeCount=function(){return this.browserRanges_.length};
goog.dom.MultiRange.prototype.getTextRange=function(a){this.ranges_[a]||(this.ranges_[a]=goog.dom.TextRange.createFromBrowserRange(this.browserRanges_[a]));return this.ranges_[a]};goog.dom.MultiRange.prototype.getContainer=function(){if(!this.container_){for(var a=[],b=0,c=this.getTextRangeCount();b<c;b++)a.push(this.getTextRange(b).getContainer());this.container_=goog.dom.findCommonAncestor.apply(null,a)}return this.container_};
goog.dom.MultiRange.prototype.getSortedRanges=function(){this.sortedRanges_||(this.sortedRanges_=this.getTextRanges(),this.sortedRanges_.sort(function(a,b){var c=a.getStartNode(),d=a.getStartOffset(),e=b.getStartNode(),f=b.getStartOffset();return c==e&&d==f?0:goog.dom.Range.isReversed(c,d,e,f)?1:-1}));return this.sortedRanges_};goog.dom.MultiRange.prototype.getStartNode=function(){return this.getSortedRanges()[0].getStartNode()};goog.dom.MultiRange.prototype.getStartOffset=function(){return this.getSortedRanges()[0].getStartOffset()};
goog.dom.MultiRange.prototype.getEndNode=function(){return goog.array.peek(this.getSortedRanges()).getEndNode()};goog.dom.MultiRange.prototype.getEndOffset=function(){return goog.array.peek(this.getSortedRanges()).getEndOffset()};goog.dom.MultiRange.prototype.isRangeInDocument=function(){return goog.array.every(this.getTextRanges(),function(a){return a.isRangeInDocument()})};goog.dom.MultiRange.prototype.isCollapsed=function(){return 0==this.browserRanges_.length||1==this.browserRanges_.length&&this.getTextRange(0).isCollapsed()};
goog.dom.MultiRange.prototype.getText=function(){return goog.array.map(this.getTextRanges(),function(a){return a.getText()}).join("")};goog.dom.MultiRange.prototype.getHtmlFragment=function(){return this.getValidHtml()};goog.dom.MultiRange.prototype.getValidHtml=function(){return goog.array.map(this.getTextRanges(),function(a){return a.getValidHtml()}).join("")};goog.dom.MultiRange.prototype.getPastableHtml=function(){return this.getValidHtml()};goog.dom.MultiRange.prototype.__iterator__=function(){return new goog.dom.MultiRangeIterator(this)};
goog.dom.MultiRange.prototype.select=function(){var a=goog.dom.AbstractRange.getBrowserSelectionForWindow(this.getWindow());a.removeAllRanges();for(var b=0,c=this.getTextRangeCount();b<c;b++)a.addRange(this.getTextRange(b).getBrowserRangeObject())};goog.dom.MultiRange.prototype.removeContents=function(){goog.array.forEach(this.getTextRanges(),function(a){a.removeContents()})};goog.dom.MultiRange.prototype.saveUsingDom=function(){return new goog.dom.DomSavedMultiRange_(this)};
goog.dom.MultiRange.prototype.collapse=function(a){if(!this.isCollapsed()){var b=a?this.getTextRange(0):this.getTextRange(this.getTextRangeCount()-1);this.clearCachedValues_();b.collapse(a);this.ranges_=[b];this.sortedRanges_=[b];this.browserRanges_=[b.getBrowserRangeObject()]}};goog.dom.DomSavedMultiRange_=function(a){this.savedRanges_=goog.array.map(a.getTextRanges(),function(a){return a.saveUsingDom()})};goog.inherits(goog.dom.DomSavedMultiRange_,goog.dom.SavedRange);
goog.dom.DomSavedMultiRange_.prototype.restoreInternal=function(){var a=goog.array.map(this.savedRanges_,function(a){return a.restore()});return goog.dom.MultiRange.createFromTextRanges(a)};goog.dom.DomSavedMultiRange_.prototype.disposeInternal=function(){goog.dom.DomSavedMultiRange_.superClass_.disposeInternal.call(this);goog.array.forEach(this.savedRanges_,function(a){a.dispose()});delete this.savedRanges_};
goog.dom.MultiRangeIterator=function(a){a&&(this.iterators_=goog.array.map(a.getSortedRanges(),function(a){return goog.iter.toIterator(a)}));goog.dom.RangeIterator.call(this,a?this.getStartNode():null,!1)};goog.inherits(goog.dom.MultiRangeIterator,goog.dom.RangeIterator);goog.dom.MultiRangeIterator.prototype.iterators_=null;goog.dom.MultiRangeIterator.prototype.currentIdx_=0;goog.dom.MultiRangeIterator.prototype.getStartTextOffset=function(){return this.iterators_[this.currentIdx_].getStartTextOffset()};
goog.dom.MultiRangeIterator.prototype.getEndTextOffset=function(){return this.iterators_[this.currentIdx_].getEndTextOffset()};goog.dom.MultiRangeIterator.prototype.getStartNode=function(){return this.iterators_[0].getStartNode()};goog.dom.MultiRangeIterator.prototype.getEndNode=function(){return goog.array.peek(this.iterators_).getEndNode()};goog.dom.MultiRangeIterator.prototype.isLast=function(){return this.iterators_[this.currentIdx_].isLast()};
goog.dom.MultiRangeIterator.prototype.next=function(){try{var a=this.iterators_[this.currentIdx_],b=a.next();this.setPosition(a.node,a.tagType,a.depth);return b}catch(c){if(c!==goog.iter.StopIteration||this.iterators_.length-1==this.currentIdx_)throw c;this.currentIdx_++;return this.next()}};goog.dom.MultiRangeIterator.prototype.copyFrom=function(a){this.iterators_=goog.array.clone(a.iterators_);goog.dom.MultiRangeIterator.superClass_.copyFrom.call(this,a)};
goog.dom.MultiRangeIterator.prototype.clone=function(){var a=new goog.dom.MultiRangeIterator(null);a.copyFrom(this);return a};goog.dom.Range={};goog.dom.Range.createFromWindow=function(a){return(a=goog.dom.AbstractRange.getBrowserSelectionForWindow(a||window))&&goog.dom.Range.createFromBrowserSelection(a)};
goog.dom.Range.createFromBrowserSelection=function(a){var b,c=!1;if(a.createRange)try{b=a.createRange()}catch(d){return null}else if(a.rangeCount){if(1<a.rangeCount)return goog.dom.MultiRange.createFromBrowserSelection(a);b=a.getRangeAt(0);c=goog.dom.Range.isReversed(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)}else return null;return goog.dom.Range.createFromBrowserRange(b,c)};
goog.dom.Range.createFromBrowserRange=function(a,b){return goog.dom.AbstractRange.isNativeControlRange(a)?goog.dom.ControlRange.createFromBrowserRange(a):goog.dom.TextRange.createFromBrowserRange(a,b)};goog.dom.Range.createFromNodeContents=function(a,b){return goog.dom.TextRange.createFromNodeContents(a,b)};goog.dom.Range.createCaret=function(a,b){return goog.dom.TextRange.createFromNodes(a,b,a,b)};goog.dom.Range.createFromNodes=function(a,b,c,d){return goog.dom.TextRange.createFromNodes(a,b,c,d)};
goog.dom.Range.clearSelection=function(a){if(a=goog.dom.AbstractRange.getBrowserSelectionForWindow(a||window))if(a.empty)try{a.empty()}catch(b){}else try{a.removeAllRanges()}catch(c){}};goog.dom.Range.hasSelection=function(a){a=goog.dom.AbstractRange.getBrowserSelectionForWindow(a||window);return!!a&&(goog.userAgent.IE?"None"!=a.type:!!a.rangeCount)};
goog.dom.Range.isReversed=function(a,b,c,d){if(a==c)return d<b;var e;if(a.nodeType==goog.dom.NodeType.ELEMENT&&b)if(e=a.childNodes[b])a=e,b=0;else if(goog.dom.contains(a,c))return!0;if(c.nodeType==goog.dom.NodeType.ELEMENT&&d)if(e=c.childNodes[d])c=e,d=0;else if(goog.dom.contains(c,a))return!1;return 0<(goog.dom.compareNodeOrder(a,c)||b-d)};goog.editor.defines={};goog.editor.defines.USE_CONTENTEDITABLE_IN_FIREFOX_3=!1;goog.userAgent.product.determineVersion_=function(){var a="",b,c;if(goog.userAgent.product.FIREFOX)b=/Firefox\/([0-9.]+)/;else{if(goog.userAgent.product.IE||goog.userAgent.product.OPERA)return goog.userAgent.VERSION;goog.userAgent.product.CHROME?b=/Chrome\/([0-9.]+)/:goog.userAgent.product.SAFARI?b=/Version\/([0-9.]+)/:goog.userAgent.product.IPHONE||goog.userAgent.product.IPAD?(b=/Version\/(\S+).*Mobile\/(\S+)/,c=!0):goog.userAgent.product.ANDROID?b=/Android\s+([0-9.]+)(?:.*Version\/([0-9.]+))?/:
goog.userAgent.product.CAMINO&&(b=/Camino\/([0-9.]+)/)}b&&(a=(a=b.exec(goog.userAgent.getUserAgentString()))?c?a[1]+"."+a[2]:a[2]||a[1]:"");return a};goog.userAgent.product.VERSION=goog.userAgent.product.determineVersion_();goog.userAgent.product.isVersion=function(a){return 0<=goog.string.compareVersions(goog.userAgent.product.VERSION,a)};goog.editor.BrowserFeature={HAS_IE_RANGES:goog.userAgent.IE&&!goog.userAgent.isDocumentMode(9),HAS_W3C_RANGES:goog.userAgent.GECKO||goog.userAgent.WEBKIT||goog.userAgent.OPERA||goog.userAgent.IE&&goog.userAgent.isDocumentMode(9),HAS_CONTENT_EDITABLE:goog.userAgent.IE||goog.userAgent.WEBKIT||goog.userAgent.OPERA||goog.editor.defines.USE_CONTENTEDITABLE_IN_FIREFOX_3&&goog.userAgent.GECKO&&goog.userAgent.isVersion("1.9"),USE_MUTATION_EVENTS:goog.userAgent.GECKO,HAS_DOM_SUBTREE_MODIFIED_EVENT:goog.userAgent.WEBKIT||
goog.editor.defines.USE_CONTENTEDITABLE_IN_FIREFOX_3&&goog.userAgent.GECKO&&goog.userAgent.isVersion("1.9"),HAS_DOCUMENT_INDEPENDENT_NODES:goog.userAgent.GECKO,PUTS_CURSOR_BEFORE_FIRST_BLOCK_ELEMENT_ON_FOCUS:goog.userAgent.GECKO,CLEARS_SELECTION_WHEN_FOCUS_LEAVES:goog.userAgent.IE||goog.userAgent.WEBKIT||goog.userAgent.OPERA,HAS_UNSELECTABLE_STYLE:goog.userAgent.GECKO||goog.userAgent.WEBKIT,FORMAT_BLOCK_WORKS_FOR_BLOCKQUOTES:goog.userAgent.GECKO||goog.userAgent.WEBKIT||goog.userAgent.OPERA,CREATES_MULTIPLE_BLOCKQUOTES:goog.userAgent.WEBKIT&&
!goog.userAgent.isVersion("534.16")||goog.userAgent.OPERA,WRAPS_BLOCKQUOTE_IN_DIVS:goog.userAgent.OPERA,PREFERS_READY_STATE_CHANGE_EVENT:goog.userAgent.IE,TAB_FIRES_KEYPRESS:!goog.userAgent.IE,NEEDS_99_WIDTH_IN_STANDARDS_MODE:goog.userAgent.IE,USE_DOCUMENT_FOR_KEY_EVENTS:goog.userAgent.GECKO&&!goog.editor.defines.USE_CONTENTEDITABLE_IN_FIREFOX_3,SHOWS_CUSTOM_ATTRS_IN_INNER_HTML:goog.userAgent.IE,COLLAPSES_EMPTY_NODES:goog.userAgent.GECKO||goog.userAgent.WEBKIT||goog.userAgent.OPERA,CONVERT_TO_B_AND_I_TAGS:goog.userAgent.GECKO||
goog.userAgent.OPERA,TABS_THROUGH_IMAGES:goog.userAgent.IE,UNESCAPES_URLS_WITHOUT_ASKING:goog.userAgent.IE&&!goog.userAgent.isVersion("7.0"),HAS_STYLE_WITH_CSS:goog.userAgent.GECKO&&goog.userAgent.isVersion("1.8")||goog.userAgent.WEBKIT||goog.userAgent.OPERA,FOLLOWS_EDITABLE_LINKS:goog.userAgent.WEBKIT,HAS_ACTIVE_ELEMENT:goog.userAgent.IE||goog.userAgent.OPERA||goog.userAgent.GECKO&&goog.userAgent.isVersion("1.9"),HAS_SET_CAPTURE:goog.userAgent.IE,EATS_EMPTY_BACKGROUND_COLOR:goog.userAgent.GECKO||
goog.userAgent.WEBKIT&&!goog.userAgent.isVersion("527"),SUPPORTS_FOCUSIN:goog.userAgent.IE||goog.userAgent.OPERA,SELECTS_IMAGES_ON_CLICK:goog.userAgent.IE||goog.userAgent.OPERA,MOVES_STYLE_TO_HEAD:goog.userAgent.WEBKIT,COLLAPSES_SELECTION_ONMOUSEDOWN:!1,CARET_INSIDE_SELECTION:goog.userAgent.OPERA,FOCUSES_EDITABLE_BODY_ON_HTML_CLICK:!0,USES_KEYDOWN:goog.userAgent.IE||goog.userAgent.WEBKIT&&goog.userAgent.isVersion("525"),ADDS_NBSPS_IN_REMOVE_FORMAT:goog.userAgent.WEBKIT&&!goog.userAgent.isVersion("531"),
GETS_STUCK_IN_LINKS:goog.userAgent.WEBKIT&&!goog.userAgent.isVersion("528"),NORMALIZE_CORRUPTS_EMPTY_TEXT_NODES:goog.userAgent.GECKO&&goog.userAgent.isVersion("1.9")||goog.userAgent.IE||goog.userAgent.OPERA||goog.userAgent.WEBKIT&&goog.userAgent.isVersion("531"),NORMALIZE_CORRUPTS_ALL_TEXT_NODES:goog.userAgent.IE,NESTS_SUBSCRIPT_SUPERSCRIPT:goog.userAgent.IE||goog.userAgent.GECKO||goog.userAgent.OPERA,CAN_SELECT_EMPTY_ELEMENT:!goog.userAgent.IE&&!goog.userAgent.WEBKIT,FORGETS_FORMATTING_WHEN_LISTIFYING:goog.userAgent.GECKO||
goog.userAgent.WEBKIT&&!goog.userAgent.isVersion("526"),LEAVES_P_WHEN_REMOVING_LISTS:goog.userAgent.IE||goog.userAgent.OPERA,CAN_LISTIFY_BR:!goog.userAgent.IE&&!goog.userAgent.OPERA,DOESNT_OVERRIDE_FONT_SIZE_IN_STYLE_ATTR:!goog.userAgent.WEBKIT,SUPPORTS_HTML5_FILE_DRAGGING:goog.userAgent.product.CHROME&&goog.userAgent.product.isVersion("4")||goog.userAgent.product.SAFARI&&goog.userAgent.isVersion("533")||goog.userAgent.GECKO&&goog.userAgent.isVersion("2.0"),SUPPORTS_OPERA_DEFAULTBLOCK_COMMAND:goog.userAgent.OPERA&&
goog.userAgent.isVersion("11.10"),SUPPORTS_FILE_PASTING:goog.userAgent.product.CHROME&&goog.userAgent.product.isVersion("12")};goog.editor.Plugin=function(){goog.events.EventTarget.call(this);this.enabled_=this.activeOnUneditableFields()};goog.inherits(goog.editor.Plugin,goog.events.EventTarget);goog.editor.Plugin.prototype.fieldObject=null;goog.editor.Plugin.prototype.getFieldDomHelper=function(){return this.fieldObject&&this.fieldObject.getEditableDomHelper()};goog.editor.Plugin.prototype.autoDispose_=!0;goog.editor.Plugin.prototype.logger=goog.debug.Logger.getLogger("goog.editor.Plugin");
goog.editor.Plugin.prototype.registerFieldObject=function(a){this.fieldObject=a};goog.editor.Plugin.prototype.unregisterFieldObject=function(){this.fieldObject&&(this.disable(this.fieldObject),this.fieldObject=null)};goog.editor.Plugin.prototype.enable=function(a){this.fieldObject==a?this.enabled_=!0:this.logger.severe("Trying to enable an unregistered field with this plugin.")};goog.editor.Plugin.prototype.disable=function(a){this.fieldObject==a?this.enabled_=!1:this.logger.severe("Trying to disable an unregistered field with this plugin.")};
goog.editor.Plugin.prototype.isEnabled=function(a){return this.fieldObject==a?this.enabled_:!1};goog.editor.Plugin.prototype.setAutoDispose=function(a){this.autoDispose_=a};goog.editor.Plugin.prototype.isAutoDispose=function(){return this.autoDispose_};goog.editor.Plugin.prototype.activeOnUneditableFields=goog.functions.FALSE;goog.editor.Plugin.prototype.isSilentCommand=goog.functions.FALSE;
goog.editor.Plugin.prototype.disposeInternal=function(){this.fieldObject&&this.unregisterFieldObject(this.fieldObject);goog.editor.Plugin.superClass_.disposeInternal.call(this)};goog.editor.Plugin.Op={KEYDOWN:1,KEYPRESS:2,KEYUP:3,SELECTION:4,SHORTCUT:5,EXEC_COMMAND:6,QUERY_COMMAND:7,PREPARE_CONTENTS_HTML:8,CLEAN_CONTENTS_HTML:10,CLEAN_CONTENTS_DOM:11};
goog.editor.Plugin.OPCODE=goog.object.transpose(goog.reflect.object(goog.editor.Plugin,{handleKeyDown:goog.editor.Plugin.Op.KEYDOWN,handleKeyPress:goog.editor.Plugin.Op.KEYPRESS,handleKeyUp:goog.editor.Plugin.Op.KEYUP,handleSelectionChange:goog.editor.Plugin.Op.SELECTION,handleKeyboardShortcut:goog.editor.Plugin.Op.SHORTCUT,execCommand:goog.editor.Plugin.Op.EXEC_COMMAND,queryCommandValue:goog.editor.Plugin.Op.QUERY_COMMAND,prepareContentsHtml:goog.editor.Plugin.Op.PREPARE_CONTENTS_HTML,cleanContentsHtml:goog.editor.Plugin.Op.CLEAN_CONTENTS_HTML,
cleanContentsDom:goog.editor.Plugin.Op.CLEAN_CONTENTS_DOM}));goog.editor.Plugin.IRREPRESSIBLE_OPS=goog.object.createSet(goog.editor.Plugin.Op.PREPARE_CONTENTS_HTML,goog.editor.Plugin.Op.CLEAN_CONTENTS_HTML,goog.editor.Plugin.Op.CLEAN_CONTENTS_DOM);
goog.editor.Plugin.prototype.execCommand=function(a,b){var c=this.isSilentCommand(a);c||(goog.userAgent.GECKO&&this.fieldObject.stopChangeEvents(!0,!0),this.fieldObject.dispatchBeforeChange());try{var d=this.execCommandInternal.apply(this,arguments)}finally{c||(this.fieldObject.dispatchChange(),this.fieldObject.dispatchSelectionChangeEvent())}return d};goog.editor.Plugin.prototype.isSupportedCommand=function(){return!1};goog.editor.icontent={};goog.editor.icontent.FieldFormatInfo=function(a,b,c,d,e){this.fieldId_=a;this.standards_=b;this.blended_=c;this.fixedHeight_=d;this.extraStyles_=e||{}};goog.editor.icontent.FieldStyleInfo=function(a,b){this.wrapper_=a;this.css_=b};goog.editor.icontent.useStandardsModeIframes_=!1;goog.editor.icontent.forceStandardsModeIframes=function(){goog.editor.icontent.useStandardsModeIframes_=!0};
goog.editor.icontent.getInitialIframeContent_=function(a,b,c){var d=[];(a.blended_&&a.standards_||goog.editor.icontent.useStandardsModeIframes_)&&d.push("<!DOCTYPE HTML>");d.push('<html style="background:none transparent;min-width:0;');a.blended_&&d.push("height:",a.fixedHeight_?"100%":"auto");d.push('">');d.push("<head><style>");c&&c.css_&&d.push(c.css_);goog.userAgent.GECKO&&a.standards_&&d.push(" img {-moz-force-broken-image-icon: 1;}");d.push("</style></head>");d.push('<body g_editable="true" hidefocus="true" ');
goog.editor.BrowserFeature.HAS_CONTENT_EDITABLE&&d.push("contentEditable ");d.push('class="editable ');d.push('" id="',a.fieldId_,'" style="min-width:0;');goog.userAgent.GECKO&&a.blended_&&(d.push(";width:100%;border:0;margin:0;background:none transparent;",";height:",a.standards_?"100%":"auto"),a.fixedHeight_?d.push(";overflow:auto"):d.push(";overflow-y:hidden;overflow-x:auto"));goog.userAgent.OPERA&&d.push(";outline:hidden");for(var e in a.extraStyles_)d.push(";"+e+":"+a.extraStyles_[e]);d.push('">',
b,"</body></html>");return d.join("")};goog.editor.icontent.writeNormalInitialBlendedIframe=function(a,b,c,d){if(a.blended_){var e=goog.style.getPaddingBox(c.wrapper_);(e.top||e.left||e.right||e.bottom)&&goog.style.setStyle(d,"margin",-e.top+"px "+-e.right+"px "+-e.bottom+"px "+-e.left+"px")}goog.editor.icontent.writeNormalInitialIframe(a,b,c,d)};
goog.editor.icontent.writeNormalInitialIframe=function(a,b,c,d){a=goog.editor.icontent.getInitialIframeContent_(a,b,c);d=goog.dom.getFrameContentDocument(d);d.open();d.write(a);d.close()};goog.editor.icontent.writeHttpsInitialIframe=function(a,b,c){b=b.body;goog.editor.BrowserFeature.HAS_CONTENT_EDITABLE&&(b.contentEditable=!0);b.className="editable";b.setAttribute("g_editable",!0);b.hideFocus=!0;b.id=a.fieldId_;goog.style.setStyle(b,a.extraStyles_);b.innerHTML=c};goog.dom.iter={};goog.dom.iter.SiblingIterator=function(a,b,c){this.node_=a;this.reverse_=!!c;a&&!b&&this.next()};goog.inherits(goog.dom.iter.SiblingIterator,goog.iter.Iterator);goog.dom.iter.SiblingIterator.prototype.next=function(){var a=this.node_;if(!a)throw goog.iter.StopIteration;this.node_=this.reverse_?a.previousSibling:a.nextSibling;return a};
goog.dom.iter.ChildIterator=function(a,b,c){goog.isDef(c)||(c=b&&a.childNodes.length?a.childNodes.length-1:0);goog.dom.iter.SiblingIterator.call(this,a.childNodes[c],!0,b)};goog.inherits(goog.dom.iter.ChildIterator,goog.dom.iter.SiblingIterator);goog.dom.iter.AncestorIterator=function(a,b){(this.node_=a)&&!b&&this.next()};goog.inherits(goog.dom.iter.AncestorIterator,goog.iter.Iterator);
goog.dom.iter.AncestorIterator.prototype.next=function(){var a=this.node_;if(!a)throw goog.iter.StopIteration;this.node_=a.parentNode;return a};goog.editor.node={};goog.editor.node.BLOCK_TAG_NAMES_=goog.object.createSet("ADDRESS","BLOCKQUOTE","BODY","CAPTION","CENTER","COL","COLGROUP","DIR","DIV","DL","DD","DT","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","HR","ISINDEX","OL","LI","MAP","MENU","OPTGROUP","OPTION","P","PRE","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","TL","UL");goog.editor.node.NON_EMPTY_TAGS_=goog.object.createSet(goog.dom.TagName.IMG,goog.dom.TagName.IFRAME,"EMBED");goog.editor.node.isStandardsMode=function(a){return goog.dom.getDomHelper(a).isCss1CompatMode()};
goog.editor.node.getRightMostLeaf=function(a){for(var b;b=goog.editor.node.getLastChild(a);)a=b;return a};goog.editor.node.getLeftMostLeaf=function(a){for(var b;b=goog.editor.node.getFirstChild(a);)a=b;return a};goog.editor.node.getFirstChild=function(a){return goog.editor.node.getChildHelper_(a,!1)};goog.editor.node.getLastChild=function(a){return goog.editor.node.getChildHelper_(a,!0)};
goog.editor.node.getPreviousSibling=function(a){return goog.editor.node.getFirstValue_(goog.iter.filter(new goog.dom.iter.SiblingIterator(a,!1,!0),goog.editor.node.isImportant))};goog.editor.node.getNextSibling=function(a){return goog.editor.node.getFirstValue_(goog.iter.filter(new goog.dom.iter.SiblingIterator(a),goog.editor.node.isImportant))};
goog.editor.node.getChildHelper_=function(a,b){return!a||a.nodeType!=goog.dom.NodeType.ELEMENT?null:goog.editor.node.getFirstValue_(goog.iter.filter(new goog.dom.iter.ChildIterator(a,b),goog.editor.node.isImportant))};goog.editor.node.getFirstValue_=function(a){try{return a.next()}catch(b){return null}};goog.editor.node.isImportant=function(a){return a.nodeType==goog.dom.NodeType.ELEMENT||a.nodeType==goog.dom.NodeType.TEXT&&!goog.editor.node.isAllNonNbspWhiteSpace(a)};
goog.editor.node.isAllNonNbspWhiteSpace=function(a){return goog.string.isBreakingWhitespace(a.nodeValue)};goog.editor.node.isEmpty=function(a,b){var c=goog.dom.getRawTextContent(a);if(a.getElementsByTagName)for(var d in goog.editor.node.NON_EMPTY_TAGS_)if(a.tagName==d||0<a.getElementsByTagName(d).length)return!1;return!b&&c==goog.string.Unicode.NBSP||goog.string.isBreakingWhitespace(c)};goog.editor.node.getLength=function(a){return a.length||a.childNodes.length};
goog.editor.node.findInChildren=function(a,b){for(var c=0,d=a.childNodes.length;c<d;c++)if(b(a.childNodes[c]))return c;return null};goog.editor.node.findHighestMatchingAncestor=function(a,b){for(var c=a.parentNode,d=null;c&&b(c);)d=c,c=c.parentNode;return d};goog.editor.node.isBlockTag=function(a){return!!goog.editor.node.BLOCK_TAG_NAMES_[a.tagName]};goog.editor.node.skipEmptyTextNodes=function(a){for(;a&&a.nodeType==goog.dom.NodeType.TEXT&&!a.nodeValue;)a=a.nextSibling;return a};
goog.editor.node.isEditableContainer=function(a){return a.getAttribute&&"true"==a.getAttribute("g_editable")};goog.editor.node.isEditable=function(a){return!!goog.dom.getAncestor(a,goog.editor.node.isEditableContainer)};goog.editor.node.findTopMostEditableAncestor=function(a,b){for(var c=null;a&&!goog.editor.node.isEditableContainer(a);)b(a)&&(c=a),a=a.parentNode;return c};
goog.editor.node.splitDomTreeAt=function(a,b,c){for(var d;a!=c&&(d=a.parentNode);)b=goog.editor.node.getSecondHalfOfNode_(d,a,b),a=d;return b};goog.editor.node.getSecondHalfOfNode_=function(a,b,c){for(a=a.cloneNode(!1);b.nextSibling;)goog.dom.appendChild(a,b.nextSibling);c&&a.insertBefore(c,a.firstChild);return a};goog.editor.node.transferChildren=function(a,b){goog.dom.append(a,b.childNodes)};goog.editor.style={};goog.editor.style.getComputedOrCascadedStyle_=function(a,b){return a.nodeType!=goog.dom.NodeType.ELEMENT?null:goog.userAgent.IE?goog.style.getCascadedStyle(a,b):goog.style.getComputedStyle(a,b)};goog.editor.style.isDisplayBlock=function(a){return"block"==goog.editor.style.getComputedOrCascadedStyle_(a,"display")};goog.editor.style.isContainer=function(a){var b=a&&a.nodeName.toLowerCase();return!(!a||!goog.editor.style.isDisplayBlock(a)&&!("td"==b||"table"==b||"li"==b))};
goog.editor.style.getContainer=function(a){return goog.dom.getAncestor(a,goog.editor.style.isContainer,!0)};goog.editor.style.SELECTABLE_INPUT_TYPES_=goog.object.createSet("text","file","url");goog.editor.style.cancelMouseDownHelper_=function(a){var b=a.target.tagName;b!=goog.dom.TagName.TEXTAREA&&b!=goog.dom.TagName.INPUT&&a.preventDefault()};
goog.editor.style.makeUnselectable=function(a,b){goog.editor.BrowserFeature.HAS_UNSELECTABLE_STYLE&&b.listen(a,goog.events.EventType.MOUSEDOWN,goog.editor.style.cancelMouseDownHelper_,!0);goog.style.setUnselectable(a,!0);for(var c=a.getElementsByTagName(goog.dom.TagName.INPUT),d=0,e=c.length;d<e;d++){var f=c[d];f.type in goog.editor.style.SELECTABLE_INPUT_TYPES_&&goog.editor.style.makeSelectable(f)}goog.array.forEach(a.getElementsByTagName(goog.dom.TagName.TEXTAREA),goog.editor.style.makeSelectable)};
goog.editor.style.makeSelectable=function(a){goog.style.setUnselectable(a,!1);if(goog.editor.BrowserFeature.HAS_UNSELECTABLE_STYLE)for(var b=a,a=a.parentNode;a&&a.tagName!=goog.dom.TagName.HTML;){if(goog.style.isUnselectable(a)){goog.style.setUnselectable(a,!1,!0);for(var c=0,d=a.childNodes.length;c<d;c++){var e=a.childNodes[c];e!=b&&e.nodeType==goog.dom.NodeType.ELEMENT&&goog.style.setUnselectable(a.childNodes[c],!0)}}b=a;a=a.parentNode}};goog.editor.range={};goog.editor.range.narrow=function(a,b){var c=a.getStartNode(),d=a.getEndNode();if(c&&d){var e=function(a){return a==b},c=goog.dom.getAncestor(c,e,!0),d=goog.dom.getAncestor(d,e,!0);if(c&&d)return a.clone();if(c)return d=goog.editor.node.getRightMostLeaf(b),goog.dom.Range.createFromNodes(a.getStartNode(),a.getStartOffset(),d,goog.editor.node.getLength(d));if(d)return goog.dom.Range.createFromNodes(goog.editor.node.getLeftMostLeaf(b),0,a.getEndNode(),a.getEndOffset())}return null};
goog.editor.range.expand=function(a,b){var c=goog.editor.range.expandEndPointToContainer_(a,goog.dom.RangeEndpoint.START,b),c=goog.editor.range.expandEndPointToContainer_(c,goog.dom.RangeEndpoint.END,b),d=c.getStartNode(),e=c.getEndNode(),f=c.getStartOffset(),c=c.getEndOffset();if(d==e){for(;e!=b&&0==f&&c==goog.editor.node.getLength(e);)d=e.parentNode,f=goog.array.indexOf(d.childNodes,e),c=f+1,e=d;d=e}return goog.dom.Range.createFromNodes(d,f,e,c)};
goog.editor.range.expandEndPointToContainer_=function(a,b,c){for(var d=(b=b==goog.dom.RangeEndpoint.START)?a.getStartNode():a.getEndNode(),e=b?a.getStartOffset():a.getEndOffset(),f=a.getContainerElement();d!=f&&d!=c&&!(b&&0!=e||!b&&e!=goog.editor.node.getLength(d));)var g=d.parentNode,d=goog.array.indexOf(g.childNodes,d),e=b?d:d+1,d=g;return goog.dom.Range.createFromNodes(b?d:a.getStartNode(),b?e:a.getStartOffset(),b?a.getEndNode():d,b?a.getEndOffset():e)};
goog.editor.range.selectNodeStart=function(a){goog.dom.Range.createCaret(goog.editor.node.getLeftMostLeaf(a),0).select()};goog.editor.range.placeCursorNextTo=function(a,b){var c=a.parentNode,d=goog.array.indexOf(c.childNodes,a)+(b?0:1),c=goog.editor.range.Point.createDeepestPoint(c,d,b),c=goog.dom.Range.createCaret(c.node,c.offset);c.select();return c};
goog.editor.range.selectionPreservingNormalize=function(a){var b=goog.dom.getOwnerDocument(a),b=goog.dom.Range.createFromWindow(goog.dom.getWindow(b));(a=goog.editor.range.rangePreservingNormalize(a,b))&&a.select()};goog.editor.range.normalizeNodeIe_=function(a){for(var b=null,c=a.firstChild;c;){var d=c.nextSibling;c.nodeType==goog.dom.NodeType.TEXT?""==c.nodeValue?a.removeChild(c):b?(b.nodeValue+=c.nodeValue,a.removeChild(c)):b=c:(goog.editor.range.normalizeNodeIe_(c),b=null);c=d}};
goog.editor.range.normalizeNode=function(a){goog.userAgent.IE?goog.editor.range.normalizeNodeIe_(a):a.normalize()};goog.editor.range.rangePreservingNormalize=function(a,b){if(b)var c=goog.editor.range.normalize(b),d=goog.editor.style.getContainer(b.getContainerElement());d?goog.editor.range.normalizeNode(goog.dom.findCommonAncestor(d,a)):a&&goog.editor.range.normalizeNode(a);return c?c():null};
goog.editor.range.getDeepEndPoint=function(a,b){return b?goog.editor.range.Point.createDeepestPoint(a.getStartNode(),a.getStartOffset()):goog.editor.range.Point.createDeepestPoint(a.getEndNode(),a.getEndOffset())};
goog.editor.range.normalize=function(a){var b=goog.editor.range.normalizePoint_(goog.editor.range.getDeepEndPoint(a,!0)),c=b.getParentPoint(),d=b.node.previousSibling;b.node.nodeType==goog.dom.NodeType.TEXT&&(b.node=null);var e=goog.editor.range.normalizePoint_(goog.editor.range.getDeepEndPoint(a,!1)),f=e.getParentPoint(),g=e.node.previousSibling;e.node.nodeType==goog.dom.NodeType.TEXT&&(e.node=null);return function(){!b.node&&d&&(b.node=d.nextSibling,b.node||(b=goog.editor.range.Point.getPointAtEndOfNode(d)));
!e.node&&g&&(e.node=g.nextSibling,e.node||(e=goog.editor.range.Point.getPointAtEndOfNode(g)));return goog.dom.Range.createFromNodes(b.node||c.node.firstChild||c.node,b.offset,e.node||f.node.firstChild||f.node,e.offset)}};
goog.editor.range.normalizePoint_=function(a){var b;if(a.node.nodeType==goog.dom.NodeType.TEXT)for(b=a.node.previousSibling;b&&b.nodeType==goog.dom.NodeType.TEXT;b=b.previousSibling)a.offset+=goog.editor.node.getLength(b);else b=a.node.previousSibling;var c=a.node.parentNode;a.node=b?b.nextSibling:c.firstChild;return a};goog.editor.range.isEditable=function(a){var b=a.getContainerElement();return a.getStartNode()!=b.parentElement&&goog.editor.node.isEditableContainer(b)||goog.editor.node.isEditable(b)};
goog.editor.range.intersectsTag=function(a,b){return goog.dom.getAncestorByTagNameAndClass(a.getContainerElement(),b)?!0:goog.iter.some(a,function(a){return a.tagName==b})};goog.editor.range.Point=function(a,b){this.node=a;this.offset=b};goog.editor.range.Point.prototype.getParentPoint=function(){var a=this.node.parentNode;return new goog.editor.range.Point(a,goog.array.indexOf(a.childNodes,this.node))};
goog.editor.range.Point.createDeepestPoint=function(a,b,c){for(;a.nodeType==goog.dom.NodeType.ELEMENT;){var d=a.childNodes[b];if(!d&&!a.lastChild)break;d?(a=d.previousSibling,c&&a?b=goog.editor.node.getLength(a):(a=d,b=0)):(a=a.lastChild,b=goog.editor.node.getLength(a))}return new goog.editor.range.Point(a,b)};goog.editor.range.Point.getPointAtEndOfNode=function(a){return new goog.editor.range.Point(a,goog.editor.node.getLength(a))};goog.editor.range.saveUsingNormalizedCarets=function(a){return new goog.editor.range.NormalizedCaretRange_(a)};
goog.editor.range.NormalizedCaretRange_=function(a){goog.dom.SavedCaretRange.call(this,a)};goog.inherits(goog.editor.range.NormalizedCaretRange_,goog.dom.SavedCaretRange);goog.editor.range.NormalizedCaretRange_.prototype.removeCarets=function(a){var b=this.getCaret(!0),c=this.getCaret(!1),b=b&&c?goog.dom.findCommonAncestor(b,c):b||c;goog.editor.range.NormalizedCaretRange_.superClass_.removeCarets.call(this);if(a)return goog.editor.range.rangePreservingNormalize(b,a);b&&goog.editor.range.selectionPreservingNormalize(b)};goog.editor.Field=function(a,b){goog.events.EventTarget.call(this);this.hashCode_=this.id=a;this.editableDomHelper=null;this.plugins_={};this.indexedPlugins_={};for(var c in goog.editor.Plugin.OPCODE)this.indexedPlugins_[c]=[];this.cssStyles="";goog.userAgent.WEBKIT&&goog.userAgent.isVersion("525.13")&&0>=goog.string.compareVersions(goog.userAgent.VERSION,"525.18")&&(this.workaroundClassName_="tr-webkit-workaround",this.cssStyles="."+this.workaroundClassName_+">*{padding-right:1}");this.stoppedEvents_=
{};this.stopEvent(goog.editor.Field.EventType.CHANGE);this.stopEvent(goog.editor.Field.EventType.DELAYEDCHANGE);this.isEverModified_=this.isModified_=!1;this.delayedChangeTimer_=new goog.async.Delay(this.dispatchDelayedChange_,goog.editor.Field.DELAYED_CHANGE_FREQUENCY,this);this.debouncedEvents_={};for(var d in goog.editor.Field.EventType)this.debouncedEvents_[goog.editor.Field.EventType[d]]=0;goog.editor.BrowserFeature.USE_MUTATION_EVENTS&&(this.changeTimerGecko_=new goog.async.Delay(this.handleChange,
goog.editor.Field.CHANGE_FREQUENCY,this));this.eventRegister=new goog.events.EventHandler(this);this.wrappers_=[];this.loadState_=goog.editor.Field.LoadState_.UNEDITABLE;this.originalDomHelper=goog.dom.getDomHelper(b||document);this.originalElement=this.originalDomHelper.getElement(this.id);this.appWindow_=this.originalDomHelper.getWindow()};goog.inherits(goog.editor.Field,goog.events.EventTarget);goog.editor.Field.prototype.field=null;goog.editor.Field.prototype.originalElement=null;
goog.editor.Field.prototype.logger=goog.debug.Logger.getLogger("goog.editor.Field");goog.editor.Field.EventType={COMMAND_VALUE_CHANGE:"cvc",LOAD:"load",UNLOAD:"unload",BEFORECHANGE:"beforechange",CHANGE:"change",DELAYEDCHANGE:"delayedchange",BEFOREFOCUS:"beforefocus",FOCUS:"focus",BLUR:"blur",BEFORETAB:"beforetab",SELECTIONCHANGE:"selectionchange"};goog.editor.Field.LoadState_={UNEDITABLE:0,LOADING:1,EDITABLE:2};goog.editor.Field.DEBOUNCE_TIME_MS_=500;goog.editor.Field.activeFieldId_=null;
goog.editor.Field.prototype.inModalMode_=!1;goog.editor.Field.setActiveFieldId=function(a){goog.editor.Field.activeFieldId_=a};goog.editor.Field.getActiveFieldId=function(){return goog.editor.Field.activeFieldId_};goog.editor.Field.prototype.inModalMode=function(){return this.inModalMode_};goog.editor.Field.prototype.setModalMode=function(a){this.inModalMode_=a};goog.editor.Field.prototype.getHashCode=function(){return this.hashCode_};goog.editor.Field.prototype.getElement=function(){return this.field};
goog.editor.Field.prototype.getOriginalElement=function(){return this.originalElement};goog.editor.Field.prototype.addListener=function(a,b,c,d){var e=this.getElement();e&&goog.editor.BrowserFeature.USE_DOCUMENT_FOR_KEY_EVENTS&&(e=e.ownerDocument);this.eventRegister.listen(e,a,b,c,d)};goog.editor.Field.prototype.getPluginByClassId=function(a){return this.plugins_[a]};
goog.editor.Field.prototype.registerPlugin=function(a){var b=a.getTrogClassId();this.plugins_[b]&&this.logger.severe("Cannot register the same class of plugin twice.");this.plugins_[b]=a;for(var c in goog.editor.Plugin.OPCODE)a[goog.editor.Plugin.OPCODE[c]]&&this.indexedPlugins_[c].push(a);a.registerFieldObject(this);this.isLoaded()&&a.enable(this)};
goog.editor.Field.prototype.unregisterPlugin=function(a){var b=a.getTrogClassId();this.plugins_[b]||this.logger.severe("Cannot unregister a plugin that isn't registered.");delete this.plugins_[b];for(var c in goog.editor.Plugin.OPCODE)a[goog.editor.Plugin.OPCODE[c]]&&goog.array.remove(this.indexedPlugins_[c],a);a.unregisterFieldObject(this)};goog.editor.Field.prototype.setInitialStyle=function(a){this.cssText=a};
goog.editor.Field.prototype.resetOriginalElemProperties=function(){var a=this.getOriginalElement();a.removeAttribute("contentEditable");a.removeAttribute("g_editable");this.id?a.id=this.id:a.removeAttribute("id");a.className=this.savedClassName_||"";var b=this.cssText;b?goog.dom.setProperties(a,{style:b}):a.removeAttribute("style");goog.isString(this.originalFieldLineHeight_)&&(goog.style.setStyle(a,"lineHeight",this.originalFieldLineHeight_),this.originalFieldLineHeight_=null)};
goog.editor.Field.prototype.isModified=function(a){return a?this.isEverModified_:this.isModified_};goog.editor.Field.CHANGE_FREQUENCY=15;goog.editor.Field.DELAYED_CHANGE_FREQUENCY=250;goog.editor.Field.prototype.usesIframe=goog.functions.TRUE;goog.editor.Field.prototype.isFixedHeight=goog.functions.TRUE;goog.editor.Field.KEYS_CAUSING_CHANGES_={46:!0,8:!0};goog.userAgent.IE||(goog.editor.Field.KEYS_CAUSING_CHANGES_[9]=!0);goog.editor.Field.CTRL_KEYS_CAUSING_CHANGES_={86:!0,88:!0};
goog.userAgent.IE&&(goog.editor.Field.KEYS_CAUSING_CHANGES_[229]=!0);goog.editor.Field.isGeneratingKey_=function(a,b){return goog.editor.Field.isSpecialGeneratingKey_(a)?!0:!(!b||a.ctrlKey||a.metaKey||goog.userAgent.GECKO&&!a.charCode)};goog.editor.Field.isSpecialGeneratingKey_=function(a){var b=!(a.ctrlKey||a.metaKey)&&a.keyCode in goog.editor.Field.KEYS_CAUSING_CHANGES_;return(a.ctrlKey||a.metaKey)&&a.keyCode in goog.editor.Field.CTRL_KEYS_CAUSING_CHANGES_||b};
goog.editor.Field.prototype.setAppWindow=function(a){this.appWindow_=a};goog.editor.Field.prototype.getAppWindow=function(){return this.appWindow_};goog.editor.Field.prototype.setBaseZindex=function(a){this.baseZindex_=a};goog.editor.Field.prototype.getBaseZindex=function(){return this.baseZindex_||0};
goog.editor.Field.prototype.setupFieldObject=function(a){this.loadState_=goog.editor.Field.LoadState_.EDITABLE;this.field=a;this.editableDomHelper=goog.dom.getDomHelper(a);this.isEverModified_=this.isModified_=!1;a.setAttribute("g_editable","true")};goog.editor.Field.prototype.tearDownFieldObject_=function(){this.loadState_=goog.editor.Field.LoadState_.UNEDITABLE;for(var a in this.plugins_){var b=this.plugins_[a];b.activeOnUneditableFields()||b.disable(this)}this.editableDomHelper=this.field=null};
goog.editor.Field.prototype.setupChangeListeners_=function(){if(goog.userAgent.OPERA&&this.usesIframe()){this.boundFocusListenerOpera_=goog.bind(this.dispatchFocusAndBeforeFocus_,this);this.boundBlurListenerOpera_=goog.bind(this.dispatchBlur,this);var a=this.getEditableDomHelper().getWindow();a.addEventListener(goog.events.EventType.FOCUS,this.boundFocusListenerOpera_,!1);a.addEventListener(goog.events.EventType.BLUR,this.boundBlurListenerOpera_,!1)}else goog.editor.BrowserFeature.SUPPORTS_FOCUSIN?
(this.addListener(goog.events.EventType.FOCUS,this.dispatchFocus_),this.addListener(goog.events.EventType.FOCUSIN,this.dispatchBeforeFocus_)):this.addListener(goog.events.EventType.FOCUS,this.dispatchFocusAndBeforeFocus_),this.addListener(goog.events.EventType.BLUR,this.dispatchBlur,goog.editor.BrowserFeature.USE_MUTATION_EVENTS);goog.editor.BrowserFeature.USE_MUTATION_EVENTS?this.setupMutationEventHandlersGecko():(this.addListener(["beforecut","beforepaste","drop","dragend"],this.dispatchBeforeChange),
this.addListener(["cut","paste"],goog.functions.lock(this.dispatchChange)),this.addListener("drop",this.handleDrop_));this.addListener(goog.userAgent.WEBKIT?"dragend":"dragdrop",this.handleDrop_);this.addListener(goog.events.EventType.KEYDOWN,this.handleKeyDown_);this.addListener(goog.events.EventType.KEYPRESS,this.handleKeyPress_);this.addListener(goog.events.EventType.KEYUP,this.handleKeyUp_);this.selectionChangeTimer_=new goog.async.Delay(this.handleSelectionChangeTimer_,goog.editor.Field.SELECTION_CHANGE_FREQUENCY_,
this);goog.editor.BrowserFeature.FOLLOWS_EDITABLE_LINKS&&this.addListener(goog.events.EventType.CLICK,goog.editor.Field.cancelLinkClick_);this.addListener(goog.events.EventType.MOUSEDOWN,this.handleMouseDown_);this.addListener(goog.events.EventType.MOUSEUP,this.handleMouseUp_)};goog.editor.Field.SELECTION_CHANGE_FREQUENCY_=250;
goog.editor.Field.prototype.clearListeners_=function(){this.eventRegister&&this.eventRegister.removeAll();if(goog.userAgent.OPERA&&this.usesIframe()){try{var a=this.getEditableDomHelper().getWindow();a.removeEventListener(goog.events.EventType.FOCUS,this.boundFocusListenerOpera_,!1);a.removeEventListener(goog.events.EventType.BLUR,this.boundBlurListenerOpera_,!1)}catch(b){}delete this.boundFocusListenerOpera_;delete this.boundBlurListenerOpera_}this.changeTimerGecko_&&this.changeTimerGecko_.stop();
this.delayedChangeTimer_.stop()};
goog.editor.Field.prototype.disposeInternal=function(){(this.isLoading()||this.isLoaded())&&this.logger.warning("Disposing a field that is in use.");this.getOriginalElement()&&this.execCommand(goog.editor.Command.CLEAR_LOREM);this.tearDownFieldObject_();this.clearListeners_();this.originalDomHelper=null;this.eventRegister&&(this.eventRegister.dispose(),this.eventRegister=null);this.removeAllWrappers();goog.editor.Field.getActiveFieldId()==this.id&&goog.editor.Field.setActiveFieldId(null);for(var a in this.plugins_){var b=
this.plugins_[a];b.isAutoDispose()&&b.dispose()}delete this.plugins_;goog.editor.Field.superClass_.disposeInternal.call(this)};goog.editor.Field.prototype.attachWrapper=function(a){this.wrappers_.push(a)};goog.editor.Field.prototype.removeAllWrappers=function(){for(var a;a=this.wrappers_.pop();)a.dispose()};goog.editor.Field.MUTATION_EVENTS_GECKO=["DOMNodeInserted","DOMNodeRemoved","DOMNodeRemovedFromDocument","DOMNodeInsertedIntoDocument","DOMCharacterDataModified"];
goog.editor.Field.prototype.setupMutationEventHandlersGecko=function(){if(goog.editor.BrowserFeature.HAS_DOM_SUBTREE_MODIFIED_EVENT)this.eventRegister.listen(this.getElement(),"DOMSubtreeModified",this.handleMutationEventGecko_);else{var a=this.getEditableDomHelper().getDocument();this.eventRegister.listen(a,goog.editor.Field.MUTATION_EVENTS_GECKO,this.handleMutationEventGecko_,!0);this.eventRegister.listen(a,"DOMAttrModified",goog.bind(this.handleDomAttrChange,this,this.handleMutationEventGecko_),
!0)}};goog.editor.Field.prototype.handleBeforeChangeKeyEvent_=function(a){if(a.keyCode==goog.events.KeyCodes.TAB&&!this.dispatchBeforeTab_(a)||goog.userAgent.GECKO&&a.metaKey&&(a.keyCode==goog.events.KeyCodes.LEFT||a.keyCode==goog.events.KeyCodes.RIGHT))return a.preventDefault(),!1;(this.gotGeneratingKey_=a.charCode||goog.editor.Field.isGeneratingKey_(a,goog.userAgent.GECKO))&&this.dispatchBeforeChange();return!0};
goog.editor.Field.SELECTION_CHANGE_KEYCODES_={8:1,9:1,13:1,33:1,34:1,35:1,36:1,37:1,38:1,39:1,40:1,46:1};goog.editor.Field.CTRL_KEYS_CAUSING_SELECTION_CHANGES_={65:!0,86:!0,88:!0};goog.editor.Field.POTENTIAL_SHORTCUT_KEYCODES_={8:1,9:1,13:1,27:1,33:1,34:1,37:1,38:1,39:1,40:1};
goog.editor.Field.prototype.invokeShortCircuitingOp_=function(a,b){for(var c=this.indexedPlugins_[a],d=goog.array.slice(arguments,1),e=0;e<c.length;++e){var f=c[e];if((f.isEnabled(this)||goog.editor.Plugin.IRREPRESSIBLE_OPS[a])&&f[goog.editor.Plugin.OPCODE[a]].apply(f,d))return!0}return!1};
goog.editor.Field.prototype.invokeOp_=function(a,b){for(var c=this.indexedPlugins_[a],d=goog.array.slice(arguments,1),e=0;e<c.length;++e){var f=c[e];(f.isEnabled(this)||goog.editor.Plugin.IRREPRESSIBLE_OPS[a])&&f[goog.editor.Plugin.OPCODE[a]].apply(f,d)}};
goog.editor.Field.prototype.reduceOp_=function(a,b,c){for(var d=this.indexedPlugins_[a],e=goog.array.slice(arguments,1),f=0;f<d.length;++f){var g=d[f];if(g.isEnabled(this)||goog.editor.Plugin.IRREPRESSIBLE_OPS[a])e[0]=g[goog.editor.Plugin.OPCODE[a]].apply(g,e)}return e[0]};goog.editor.Field.prototype.injectContents=function(a,b){var c={},d=this.getInjectableContents(a,c);goog.style.setStyle(b,c);b.innerHTML=d};
goog.editor.Field.prototype.getInjectableContents=function(a,b){return this.reduceOp_(goog.editor.Plugin.Op.PREPARE_CONTENTS_HTML,a||"",b)};goog.editor.Field.prototype.handleKeyDown_=function(a){(goog.editor.BrowserFeature.USE_MUTATION_EVENTS||this.handleBeforeChangeKeyEvent_(a))&&!this.invokeShortCircuitingOp_(goog.editor.Plugin.Op.KEYDOWN,a)&&goog.editor.BrowserFeature.USES_KEYDOWN&&this.handleKeyboardShortcut_(a)};
goog.editor.Field.prototype.handleKeyPress_=function(a){if(goog.editor.BrowserFeature.USE_MUTATION_EVENTS){if(!this.handleBeforeChangeKeyEvent_(a))return}else this.gotGeneratingKey_=!0,this.dispatchBeforeChange();!this.invokeShortCircuitingOp_(goog.editor.Plugin.Op.KEYPRESS,a)&&!goog.editor.BrowserFeature.USES_KEYDOWN&&this.handleKeyboardShortcut_(a)};
goog.editor.Field.prototype.handleKeyUp_=function(a){!goog.editor.BrowserFeature.USE_MUTATION_EVENTS&&(this.gotGeneratingKey_||goog.editor.Field.isSpecialGeneratingKey_(a))&&this.handleChange();this.invokeShortCircuitingOp_(goog.editor.Plugin.Op.KEYUP,a);this.isEventStopped(goog.editor.Field.EventType.SELECTIONCHANGE)||(goog.editor.Field.SELECTION_CHANGE_KEYCODES_[a.keyCode]||(a.ctrlKey||a.metaKey)&&goog.editor.Field.CTRL_KEYS_CAUSING_SELECTION_CHANGES_[a.keyCode])&&this.selectionChangeTimer_.start()};
goog.editor.Field.prototype.handleKeyboardShortcut_=function(a){if(!a.altKey){var b=goog.userAgent.MAC?a.metaKey:a.ctrlKey;if(b||goog.editor.Field.POTENTIAL_SHORTCUT_KEYCODES_[a.keyCode]){var c=a.charCode||a.keyCode;17!=c&&(c=String.fromCharCode(c).toLowerCase(),this.invokeShortCircuitingOp_(goog.editor.Plugin.Op.SHORTCUT,a,c,b)&&a.preventDefault())}}};
goog.editor.Field.prototype.execCommand=function(a,b){for(var c=arguments,d,e=this.indexedPlugins_[goog.editor.Plugin.Op.EXEC_COMMAND],f=0;f<e.length;++f){var g=e[f];if(g.isEnabled(this)&&g.isSupportedCommand(a)){d=g.execCommand.apply(g,c);break}}return d};
goog.editor.Field.prototype.queryCommandValue=function(a){var b=this.isLoaded()&&this.isSelectionEditable();if(goog.isString(a))return this.queryCommandValueInternal_(a,b);for(var c={},d=0;d<a.length;d++)c[a[d]]=this.queryCommandValueInternal_(a[d],b);return c};
goog.editor.Field.prototype.queryCommandValueInternal_=function(a,b){for(var c=this.indexedPlugins_[goog.editor.Plugin.Op.QUERY_COMMAND],d=0;d<c.length;++d){var e=c[d];if(e.isEnabled(this)&&e.isSupportedCommand(a)&&(b||e.activeOnUneditableFields()))return e.queryCommandValue(a)}return b?null:!1};
goog.editor.Field.prototype.handleDomAttrChange=function(a,b){if(!this.isEventStopped(goog.editor.Field.EventType.CHANGE)){var c=b.getBrowserEvent();try{if(c.originalTarget.prefix||"scrollbar"==c.originalTarget.nodeName)return}catch(d){return}c.prevValue!=c.newValue&&a.call(this,c)}};
goog.editor.Field.prototype.handleMutationEventGecko_=function(a){this.isEventStopped(goog.editor.Field.EventType.CHANGE)||(a=a.getBrowserEvent?a.getBrowserEvent():a,a.target.firebugIgnore||(this.isEverModified_=this.isModified_=!0,this.changeTimerGecko_.start()))};goog.editor.Field.prototype.handleDrop_=function(){goog.userAgent.IE&&this.execCommand(goog.editor.Command.CLEAR_LOREM,!0);goog.editor.BrowserFeature.USE_MUTATION_EVENTS&&this.dispatchFocusAndBeforeFocus_();this.dispatchChange()};
goog.editor.Field.prototype.getEditableIframe=function(){var a;return this.usesIframe()&&(a=this.getEditableDomHelper())?(a=a.getWindow())&&a.frameElement:null};goog.editor.Field.prototype.getEditableDomHelper=function(){return this.editableDomHelper};goog.editor.Field.prototype.getRange=function(){var a=this.editableDomHelper&&this.editableDomHelper.getWindow();return a&&goog.dom.Range.createFromWindow(a)};
goog.editor.Field.prototype.dispatchSelectionChangeEvent=function(a,b){if(!this.isEventStopped(goog.editor.Field.EventType.SELECTIONCHANGE)){var c=this.getRange(),c=c&&c.getContainerElement();this.isSelectionEditable_=!!c&&goog.dom.contains(this.getElement(),c);this.dispatchCommandValueChange();this.dispatchEvent({type:goog.editor.Field.EventType.SELECTIONCHANGE,originalType:a&&a.type});this.invokeShortCircuitingOp_(goog.editor.Plugin.Op.SELECTION,a,b)}};
goog.editor.Field.prototype.handleSelectionChangeTimer_=function(){var a=this.selectionChangeTarget_;this.selectionChangeTarget_=null;this.dispatchSelectionChangeEvent(void 0,a)};goog.editor.Field.prototype.dispatchBeforeChange=function(){this.isEventStopped(goog.editor.Field.EventType.BEFORECHANGE)||this.dispatchEvent(goog.editor.Field.EventType.BEFORECHANGE)};
goog.editor.Field.prototype.dispatchBeforeTab_=function(a){return this.dispatchEvent({type:goog.editor.Field.EventType.BEFORETAB,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.ctrlKey})};goog.editor.Field.prototype.stopChangeEvents=function(a,b){a&&(this.changeTimerGecko_&&this.changeTimerGecko_.fireIfActive(),this.stopEvent(goog.editor.Field.EventType.CHANGE));b&&(this.clearDelayedChange(),this.stopEvent(goog.editor.Field.EventType.DELAYEDCHANGE))};
goog.editor.Field.prototype.startChangeEvents=function(a,b){!a&&this.changeTimerGecko_&&this.changeTimerGecko_.fireIfActive();this.startEvent(goog.editor.Field.EventType.CHANGE);this.startEvent(goog.editor.Field.EventType.DELAYEDCHANGE);a&&this.handleChange();b&&this.dispatchDelayedChange_()};goog.editor.Field.prototype.stopEvent=function(a){this.stoppedEvents_[a]=1};goog.editor.Field.prototype.startEvent=function(a){this.stoppedEvents_[a]=0};
goog.editor.Field.prototype.debounceEvent=function(a){this.debouncedEvents_[a]=goog.now()};goog.editor.Field.prototype.isEventStopped=function(a){return!!this.stoppedEvents_[a]||this.debouncedEvents_[a]&&goog.now()-this.debouncedEvents_[a]<=goog.editor.Field.DEBOUNCE_TIME_MS_};
goog.editor.Field.prototype.manipulateDom=function(a,b,c){this.stopChangeEvents(!0,!0);try{a.call(c)}finally{this.isLoaded()&&(b?(this.startEvent(goog.editor.Field.EventType.CHANGE),this.handleChange(),this.startEvent(goog.editor.Field.EventType.DELAYEDCHANGE)):this.dispatchChange())}};goog.editor.Field.prototype.dispatchCommandValueChange=function(a){a?this.dispatchEvent({type:goog.editor.Field.EventType.COMMAND_VALUE_CHANGE,commands:a}):this.dispatchEvent(goog.editor.Field.EventType.COMMAND_VALUE_CHANGE)};
goog.editor.Field.prototype.dispatchChange=function(a){this.startChangeEvents(!0,a)};goog.editor.Field.prototype.handleChange=function(){this.isEventStopped(goog.editor.Field.EventType.CHANGE)||(this.changeTimerGecko_&&this.changeTimerGecko_.stop(),this.isEverModified_=this.isModified_=!0,this.isEventStopped(goog.editor.Field.EventType.DELAYEDCHANGE)||this.delayedChangeTimer_.start())};
goog.editor.Field.prototype.dispatchDelayedChange_=function(){this.isEventStopped(goog.editor.Field.EventType.DELAYEDCHANGE)||(this.delayedChangeTimer_.stop(),this.isModified_=!1,this.dispatchEvent(goog.editor.Field.EventType.DELAYEDCHANGE))};goog.editor.Field.prototype.clearDelayedChange=function(){this.changeTimerGecko_&&this.changeTimerGecko_.fireIfActive();this.delayedChangeTimer_.fireIfActive()};goog.editor.Field.prototype.dispatchFocusAndBeforeFocus_=function(){this.dispatchBeforeFocus_();this.dispatchFocus_()};
goog.editor.Field.prototype.dispatchBeforeFocus_=function(){this.isEventStopped(goog.editor.Field.EventType.BEFOREFOCUS)||(this.execCommand(goog.editor.Command.CLEAR_LOREM,!0),this.dispatchEvent(goog.editor.Field.EventType.BEFOREFOCUS))};
goog.editor.Field.prototype.dispatchFocus_=function(){if(!this.isEventStopped(goog.editor.Field.EventType.FOCUS)){goog.editor.Field.setActiveFieldId(this.id);this.isSelectionEditable_=!0;this.dispatchEvent(goog.editor.Field.EventType.FOCUS);if(goog.editor.BrowserFeature.PUTS_CURSOR_BEFORE_FIRST_BLOCK_ELEMENT_ON_FOCUS){var a=this.getElement(),b=this.getRange();if(b){var c=b.getFocusNode();0==b.getFocusOffset()&&(!c||c==a||c.tagName==goog.dom.TagName.BODY)&&goog.editor.range.selectNodeStart(a)}}!goog.editor.BrowserFeature.CLEARS_SELECTION_WHEN_FOCUS_LEAVES&&
this.usesIframe()&&this.getEditableDomHelper().getWindow().parent.getSelection().removeAllRanges()}};goog.editor.Field.prototype.dispatchBlur=function(){this.isEventStopped(goog.editor.Field.EventType.BLUR)||(goog.editor.Field.getActiveFieldId()==this.id&&goog.editor.Field.setActiveFieldId(null),this.isSelectionEditable_=!1,this.dispatchEvent(goog.editor.Field.EventType.BLUR))};goog.editor.Field.prototype.isSelectionEditable=function(){return this.isSelectionEditable_};
goog.editor.Field.cancelLinkClick_=function(a){goog.dom.getAncestorByTagNameAndClass(a.target,goog.dom.TagName.A)&&a.preventDefault()};goog.editor.Field.prototype.handleMouseDown_=function(a){goog.editor.Field.getActiveFieldId()||goog.editor.Field.setActiveFieldId(this.id);if(goog.userAgent.IE){var b=a.target;b&&b.tagName==goog.dom.TagName.A&&a.ctrlKey&&this.originalDomHelper.getWindow().open(b.href)}};
goog.editor.Field.prototype.handleMouseUp_=function(a){this.dispatchSelectionChangeEvent(a);goog.userAgent.IE&&(this.selectionChangeTarget_=a.target,this.selectionChangeTimer_.start())};
goog.editor.Field.prototype.getCleanContents=function(){if(this.queryCommandValue(goog.editor.Command.USING_LOREM))return goog.string.Unicode.NBSP;if(!this.isLoaded()){var a=this.getOriginalElement();a||this.logger.shout("Couldn't get the field element to read the contents");return a.innerHTML}a=this.getFieldCopy();this.invokeOp_(goog.editor.Plugin.Op.CLEAN_CONTENTS_DOM,a);return this.reduceOp_(goog.editor.Plugin.Op.CLEAN_CONTENTS_HTML,a.innerHTML)};
goog.editor.Field.prototype.getFieldCopy=function(){var a=this.getElement(),b=a.cloneNode(!1),a=a.innerHTML;goog.userAgent.IE&&a.match(/^\s*<script/i)&&(a=goog.string.Unicode.NBSP+a);b.innerHTML=a;return b};
goog.editor.Field.prototype.setHtml=function(a,b,c,d){this.isLoading()?this.logger.severe("Can't set html while loading Trogedit"):(d&&this.execCommand(goog.editor.Command.CLEAR_LOREM),b&&a&&(b="<p>"+b+"</p>"),c&&this.stopChangeEvents(!1,!0),this.setInnerHtml_(b),d&&this.execCommand(goog.editor.Command.UPDATE_LOREM),this.isLoaded()&&(c?(goog.editor.BrowserFeature.USE_MUTATION_EVENTS&&this.changeTimerGecko_.fireIfActive(),this.startChangeEvents()):this.dispatchChange()))};
goog.editor.Field.prototype.setInnerHtml_=function(a){var b=this.getElement();if(b){if(this.usesIframe()&&goog.editor.BrowserFeature.MOVES_STYLE_TO_HEAD)for(var c=b.ownerDocument.getElementsByTagName("HEAD"),d=c.length-1;1<=d;--d)c[d].parentNode.removeChild(c[d])}else b=this.getOriginalElement();b&&this.injectContents(a,b)};
goog.editor.Field.prototype.turnOnDesignModeGecko=function(){var a=this.getEditableDomHelper().getDocument();a.designMode="on";goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&a.execCommand("styleWithCSS",!1,!1)};goog.editor.Field.prototype.installStyles=function(){this.cssStyles&&this.shouldLoadAsynchronously()&&goog.style.installStyles(this.cssStyles,this.getElement())};
goog.editor.Field.prototype.dispatchLoadEvent_=function(){var a=this.getElement();this.workaroundClassName_&&goog.dom.classes.add(a,this.workaroundClassName_);this.installStyles();this.startChangeEvents();this.logger.info("Dispatching load "+this.id);this.dispatchEvent(goog.editor.Field.EventType.LOAD)};goog.editor.Field.prototype.isUneditable=function(){return this.loadState_==goog.editor.Field.LoadState_.UNEDITABLE};goog.editor.Field.prototype.isLoaded=function(){return this.loadState_==goog.editor.Field.LoadState_.EDITABLE};
goog.editor.Field.prototype.isLoading=function(){return this.loadState_==goog.editor.Field.LoadState_.LOADING};goog.editor.Field.prototype.focus=function(){if(!goog.editor.BrowserFeature.HAS_CONTENT_EDITABLE||goog.userAgent.WEBKIT)this.getEditableDomHelper().getWindow().focus();else{if(goog.userAgent.OPERA)var a=this.appWindow_.pageXOffset,b=this.appWindow_.pageYOffset;this.getElement().focus();goog.userAgent.OPERA&&this.appWindow_.scrollTo(a,b)}};
goog.editor.Field.prototype.focusAndPlaceCursorAtStart=function(){(goog.editor.BrowserFeature.HAS_IE_RANGES||goog.userAgent.WEBKIT)&&this.placeCursorAtStart();this.focus()};goog.editor.Field.prototype.placeCursorAtStart=function(){var a=this.getElement();if(a){var b=goog.editor.node.getLeftMostLeaf(a);a==b?goog.dom.Range.createCaret(a,0).select():goog.editor.range.placeCursorNextTo(b,!0);this.dispatchSelectionChangeEvent()}};
goog.editor.Field.prototype.makeEditable=function(a){this.loadState_=goog.editor.Field.LoadState_.LOADING;var b=this.getOriginalElement();this.nodeName=b.nodeName;this.savedClassName_=b.className;this.setInitialStyle(b.style.cssText);b.className+=" editable";this.makeEditableInternal(a)};goog.editor.Field.prototype.makeEditableInternal=function(a){this.makeIframeField_(a)};
goog.editor.Field.prototype.handleFieldLoad=function(){goog.userAgent.IE&&goog.dom.Range.clearSelection(this.editableDomHelper.getWindow());goog.editor.Field.getActiveFieldId()!=this.id&&this.execCommand(goog.editor.Command.UPDATE_LOREM);this.setupChangeListeners_();this.dispatchLoadEvent_();for(var a in this.plugins_)this.plugins_[a].enable(this)};
goog.editor.Field.prototype.makeUneditable=function(a){if(this.isUneditable())throw Error("makeUneditable: Field is already uneditable");this.clearDelayedChange();this.selectionChangeTimer_.fireIfActive();this.execCommand(goog.editor.Command.CLEAR_LOREM);var b=null;!a&&this.getElement()&&(b=this.getCleanContents());this.clearFieldLoadListener_();a=this.getOriginalElement();goog.editor.Field.getActiveFieldId()==a.id&&goog.editor.Field.setActiveFieldId(null);this.clearListeners_();goog.isString(b)&&
(a.innerHTML=b,this.resetOriginalElemProperties());this.restoreDom();this.tearDownFieldObject_();goog.userAgent.WEBKIT&&a.blur();this.execCommand(goog.editor.Command.UPDATE_LOREM);this.dispatchEvent(goog.editor.Field.EventType.UNLOAD)};goog.editor.Field.prototype.restoreDom=function(){var a=this.getOriginalElement();if(a){var b=this.getEditableIframe();b&&goog.dom.replaceNode(a,b)}};
goog.editor.Field.prototype.shouldLoadAsynchronously=function(){if(!goog.isDef(this.isHttps_)&&(this.isHttps_=!1,goog.userAgent.IE&&this.usesIframe())){for(var a=this.originalDomHelper.getWindow();a!=a.parent;)try{a=a.parent}catch(b){break}a=a.location;this.isHttps_="https:"==a.protocol&&-1==a.search.indexOf("nocheckhttps")}return this.isHttps_};
goog.editor.Field.prototype.makeIframeField_=function(a){var b=this.getOriginalElement();if(b){var b=b.innerHTML,c={},b=this.reduceOp_(goog.editor.Plugin.Op.PREPARE_CONTENTS_HTML,b,c),d=this.originalDomHelper.createDom(goog.dom.TagName.IFRAME,this.getIframeAttributes());if(this.shouldLoadAsynchronously()){var e=goog.bind(this.iframeFieldLoadHandler,this,d,b,c);this.fieldLoadListenerKey_=goog.events.listen(d,goog.events.EventType.LOAD,e,!0);a&&(d.src=a)}this.attachIframe(d);this.shouldLoadAsynchronously()||
this.iframeFieldLoadHandler(d,b,c)}};goog.editor.Field.prototype.attachIframe=function(a){var b=this.getOriginalElement();a.className=b.className;a.id=b.id;goog.dom.replaceNode(a,b)};goog.editor.Field.prototype.getFieldFormatInfo=function(a){var b=this.getOriginalElement(),b=goog.editor.node.isStandardsMode(b);return new goog.editor.icontent.FieldFormatInfo(this.id,b,!1,!1,a)};
goog.editor.Field.prototype.writeIframeContent=function(a,b,c){c=this.getFieldFormatInfo(c);if(this.shouldLoadAsynchronously())a=goog.dom.getFrameContentDocument(a),goog.editor.icontent.writeHttpsInitialIframe(c,a,b);else{var d=new goog.editor.icontent.FieldStyleInfo(this.getElement(),this.cssStyles);goog.editor.icontent.writeNormalInitialIframe(c,b,d,a)}};
goog.editor.Field.prototype.iframeFieldLoadHandler=function(a,b,c){this.clearFieldLoadListener_();a.allowTransparency="true";this.writeIframeContent(a,b,c);this.setupFieldObject(goog.dom.getFrameContentDocument(a).body);goog.editor.BrowserFeature.HAS_CONTENT_EDITABLE||this.turnOnDesignModeGecko();this.handleFieldLoad()};goog.editor.Field.prototype.clearFieldLoadListener_=function(){this.fieldLoadListenerKey_&&(goog.events.unlistenByKey(this.fieldLoadListenerKey_),this.fieldLoadListenerKey_=null)};
goog.editor.Field.prototype.getIframeAttributes=function(){var a="padding:0;"+this.getOriginalElement().style.cssText;goog.string.endsWith(a,";")||(a+=";");a+="background-color:white;";goog.userAgent.IE&&(a+="overflow:visible;");return{frameBorder:0,style:a}};goog.cssom={};goog.cssom.CssRuleType={STYLE:1,IMPORT:3,MEDIA:4,FONT_FACE:5,PAGE:6,NAMESPACE:7};goog.cssom.getAllCssText=function(a){return goog.cssom.getAllCss_(a||document.styleSheets,!0)};goog.cssom.getAllCssStyleRules=function(a){return goog.cssom.getAllCss_(a||document.styleSheets,!1)};goog.cssom.getCssRulesFromStyleSheet=function(a){var b=null;try{b=a.rules||a.cssRules}catch(c){if(15==c.code)throw c.styleSheet=a,c;}return b};
goog.cssom.getAllCssStyleSheets=function(a,b){var c=[],d=a||document.styleSheets,e=goog.isDef(b)?b:!1;if(d.imports&&d.imports.length)for(var f=0,g=d.imports.length;f<g;f++)goog.array.extend(c,goog.cssom.getAllCssStyleSheets(d.imports[f]));else if(d.length){f=0;for(g=d.length;f<g;f++)goog.array.extend(c,goog.cssom.getAllCssStyleSheets(d[f]))}else{var h=goog.cssom.getCssRulesFromStyleSheet(d);if(h&&h.length)for(var f=0,g=h.length,i;f<g;f++)i=h[f],i.styleSheet&&goog.array.extend(c,goog.cssom.getAllCssStyleSheets(i.styleSheet))}(d.type||
d.rules||d.cssRules)&&(!d.disabled||e)&&c.push(d);return c};goog.cssom.getCssTextFromCssRule=function(a){var b="";a.cssText?b=a.cssText:a.style&&a.style.cssText&&a.selectorText&&(b=a.style.cssText.replace(/\s*-closure-parent-stylesheet:\s*\[object\];?\s*/gi,"").replace(/\s*-closure-rule-index:\s*[\d]+;?\s*/gi,""),b=a.selectorText+" { "+b+" }");return b};
goog.cssom.getCssRuleIndexInParentStyleSheet=function(a,b){if(a.style&&a.style["-closure-rule-index"])return a.style["-closure-rule-index"];var c=b||goog.cssom.getParentStyleSheet(a);if(!c)throw Error("Cannot find a parentStyleSheet.");if((c=goog.cssom.getCssRulesFromStyleSheet(c))&&c.length)for(var d=0,e=c.length,f;d<e;d++)if(f=c[d],f==a)return d;return-1};goog.cssom.getParentStyleSheet=function(a){return a.parentStyleSheet||a.style["-closure-parent-stylesheet"]};
goog.cssom.replaceCssRule=function(a,b,c,d){if(c=c||goog.cssom.getParentStyleSheet(a))if(a=0<=d?d:goog.cssom.getCssRuleIndexInParentStyleSheet(a,c),0<=a)goog.cssom.removeCssRule(c,a),goog.cssom.addCssRule(c,b,a);else throw Error("Cannot proceed without the index of the cssRule.");else throw Error("Cannot proceed without the parentStyleSheet.");};
goog.cssom.addCssRule=function(a,b,c){if(0>c||void 0==c)c=(a.rules||a.cssRules).length;if(a.insertRule)a.insertRule(b,c);else if(b=/^([^\{]+)\{([^\{]+)\}/.exec(b),3==b.length)a.addRule(b[1],b[2],c);else throw Error("Your CSSRule appears to be ill-formatted.");};goog.cssom.removeCssRule=function(a,b){a.deleteRule?a.deleteRule(b):a.removeRule(b)};
goog.cssom.addCssText=function(a,b){var c=b?b.getDocument():goog.dom.getDocument(),d=c.createElement("style");d.type="text/css";c.getElementsByTagName("head")[0].appendChild(d);d.styleSheet?d.styleSheet.cssText=a:(c=c.createTextNode(a),d.appendChild(c));return d};goog.cssom.getFileNameFromStyleSheet=function(a){a=a.href;return!a?null:/([^\/\?]+)[^\/]*$/.exec(a)[1]};
goog.cssom.getAllCss_=function(a,b){for(var c=[],d=goog.cssom.getAllCssStyleSheets(a),e=0;a=d[e];e++){var f=goog.cssom.getCssRulesFromStyleSheet(a);if(f&&f.length){if(!b)var g=0;for(var h=0,i=f.length,j;h<i;h++)j=f[h],b&&!j.href?(j=goog.cssom.getCssTextFromCssRule(j),c.push(j)):j.href||(j.style&&(j.parentStyleSheet||(j.style["-closure-parent-stylesheet"]=a),j.style["-closure-rule-index"]=g),c.push(j)),b||g++}}return b?c.join(" "):c};goog.cssom.iframe={};goog.cssom.iframe.style={};goog.cssom.iframe.style.selectorPartAnchorRegex_=/a(:(link|visited|active|hover))?/;goog.cssom.iframe.style.SELECTOR_DELIMITER_=",";goog.cssom.iframe.style.SELECTOR_PART_DELIMITER_=" ";goog.cssom.iframe.style.DECLARATION_START_DELIMITER_="{";goog.cssom.iframe.style.DECLARATION_END_DELIMITER_="}\n";goog.cssom.iframe.style.CssRuleSet_=function(){this.declarationText="";this.selectors=[]};
goog.cssom.iframe.style.CssRuleSet_.prototype.initializeFromCssRule=function(a){var b=a.style;if(!b)return!1;var c,d;b&&(c=a.selectorText)&&(d=b.cssText)?goog.userAgent.IE&&(d+="/* */"):a.cssText&&(b=/([^\{]+)\{/,c=b.exec(a.cssText)[1],d=a.cssText.replace(b,"").replace(/\}[^\}]*$/g,""));return c?(this.setSelectorsFromString(c),this.declarationText=d,!0):!1};
goog.cssom.iframe.style.CssRuleSet_.prototype.setSelectorsFromString=function(a){this.selectors=[];for(var a=a.split(/,\s*/gm),b=0;b<a.length;b++){var c=a[b];0<c.length&&this.selectors.push(new goog.cssom.iframe.style.CssSelector_(c))}};goog.cssom.iframe.style.CssRuleSet_.prototype.clone=function(){var a=new goog.cssom.iframe.style.CssRuleSet_;a.selectors=this.selectors.concat();a.declarationText=this.declarationText;return a};
goog.cssom.iframe.style.CssRuleSet_.prototype.setDeclarationTextFromObject=function(a,b){var c=[],d;for(d in a){var e=a[d];e&&c.push(d,":",e,b?" !important":"",";")}this.declarationText=c.join("")};
goog.cssom.iframe.style.CssRuleSet_.prototype.writeToArray=function(a){for(var b=this.selectors.length,c=!1,d=0;d<b;d++){for(var e=this.selectors[d].parts,f=e.length,g=0;g<f;g++)a.push(e[g].inputString_,goog.cssom.iframe.style.SELECTOR_PART_DELIMITER_);d<b-1&&a.push(goog.cssom.iframe.style.SELECTOR_DELIMITER_);goog.userAgent.GECKO&&!goog.userAgent.isVersion("1.9a")&&(c=c||goog.cssom.iframe.style.selectorPartAnchorRegex_.test(e[f-1].inputString_))}b=this.declarationText;c&&(b=goog.cssom.iframe.style.makeColorRuleImportant_(b));
a.push(goog.cssom.iframe.style.DECLARATION_START_DELIMITER_,b,goog.cssom.iframe.style.DECLARATION_END_DELIMITER_)};goog.cssom.iframe.style.colorImportantReplaceRegex_=/(^|;|{)\s*color:([^;]+);/g;goog.cssom.iframe.style.makeColorRuleImportant_=function(a){return a.replace(goog.cssom.iframe.style.colorImportantReplaceRegex_,"$1 color: $2 ! important; ")};goog.cssom.iframe.style.CssSelector_=function(a){this.parts_=[];this.ancestryMatchCache_={};a&&this.setPartsFromString_(a)};
goog.cssom.iframe.style.CssSelector_.prototype.setPartsFromString_=function(a){for(var b=[],a=a.split(/\s+/gm),c=0;c<a.length;c++)if(a[c]){var d=new goog.cssom.iframe.style.CssSelectorPart_(a[c]);b.push(d)}this.parts=b};
goog.cssom.iframe.style.CssSelector_.prototype.matchElementAncestry=function(a){var b=a.uid;if(this.ancestryMatchCache_[b])return this.ancestryMatchCache_[b];for(var c=0,d=null,e=null,f=null,a=a.nodes,g=a.length,h=0;h<=this.parts.length;h++){for(e=this.parts[h];c<g;){var i=a[c];if(e&&e.testElement(i)){d={elementIndex:c,selectorPartIndex:h};c++;break}else f&&f.testElement(i)&&(d={elementIndex:c,selectorPartIndex:h-1});c++}f=e}return this.ancestryMatchCache_[b]=d};
goog.cssom.iframe.style.CssSelectorPart_=function(a){var b=goog.cssom.iframe.style.CssSelectorPart_.instances_[a];if(b)return b;for(var b=a.match(/[#\.]/)?a.split(/(?=[#\.])/):[a],c={},d=0;d<b.length;d++){var e=b[d];"."==e.charAt(0)?c.className=e.substring(1,e.length):"#"==e.charAt(0)?c.id=e.substring(1,e.length):c.tagName=e.toUpperCase()}this.inputString_=a;this.matchProperties_=c;this.testedElements_={};goog.cssom.iframe.style.CssSelectorPart_.instances_[a]=this};
goog.cssom.iframe.style.CssSelectorPart_.instances_={};goog.cssom.iframe.style.CssSelectorPart_.prototype.testElement=function(a){var b=a.uid,c=this.testedElements_[b];if("undefined"!=typeof c)return c;var d=this.matchProperties_,c=d.tagName,e=d.className,d=d.id,f=!0;c&&"*"!=c&&c!=a.nodeName?f=!1:d&&d!=a.id?f=!1:e&&!a.classNames[e]&&(f=!1);return this.testedElements_[b]=f};
goog.cssom.iframe.style.NodeAncestry_=function(a){var b=goog.getUid(a),c=goog.cssom.iframe.style.NodeAncestry_.instances_[b];if(c)return c;c=[];do{var d={id:a.id,nodeName:a.nodeName};d.uid=goog.getUid(d);var e={};if(a.className)for(var f=goog.dom.classes.get(a),g=0;g<f.length;g++)e[f[g]]=1;d.classNames=e;c.unshift(d)}while(a=a.parentNode);this.nodes=c;this.uid=goog.getUid(this);goog.cssom.iframe.style.NodeAncestry_.instances_[b]=this};goog.cssom.iframe.style.NodeAncestry_.instances_={};
goog.cssom.iframe.style.resetDomCache=function(){goog.cssom.iframe.style.NodeAncestry_.instances_={}};goog.cssom.iframe.style.getRuleSetsFromDocument_=function(a){for(var b=[],a=goog.cssom.getAllCssStyleSheets(a.styleSheets),c=0,d;d=a[c];c++)if((d=goog.cssom.getCssRulesFromStyleSheet(d))&&d.length)for(var e=0,f=d.length;e<f;e++){var g=new goog.cssom.iframe.style.CssRuleSet_;g.initializeFromCssRule(d[e])&&b.push(g)}return b};goog.cssom.iframe.style.ruleSetCache_={};
goog.cssom.iframe.style.ruleSetCache_.ruleSetCache_={};goog.cssom.iframe.style.ruleSetCache_.loadRuleSetsForDocument=function(a){var b=goog.getUid(a);goog.cssom.iframe.style.ruleSetCache_.ruleSetCache_[b]=goog.cssom.iframe.style.getRuleSetsFromDocument_(a)};
goog.cssom.iframe.style.ruleSetCache_.getRuleSetsForDocument=function(a){var b=goog.getUid(a),c=goog.cssom.iframe.style.ruleSetCache_.ruleSetCache_;c[b]||goog.cssom.iframe.style.ruleSetCache_.loadRuleSetsForDocument(a);a=c[b];b=[];for(c=0;c<a.length;c++)b.push(a[c].clone());return b};goog.cssom.iframe.style.inheritedProperties_="color,visibility,quotes,list-style-type,list-style-image,list-style-position,list-style,page-break-inside,orphans,widows,font-family,font-style,font-variant,font-weight,text-indent,text-align,text-transform,white-space,caption-side,border-collapse,border-spacing,empty-cells,cursor".split(",");
goog.cssom.iframe.style.textProperties_="font-family,font-size,font-weight,font-variant,font-style,color,text-align,text-decoration,text-indent,text-transform,letter-spacing,white-space,word-spacing".split(",");
goog.cssom.iframe.style.getElementContext=function(a,b,c){var d=a.ownerDocument;b&&goog.cssom.iframe.style.ruleSetCache_.loadRuleSetsForDocument(d);for(var b=goog.cssom.iframe.style.ruleSetCache_.getRuleSetsForDocument(d),e=new goog.cssom.iframe.style.NodeAncestry_(a),f=new goog.cssom.iframe.style.CssSelectorPart_("body"),d=0;d<b.length;d++)for(var g=b[d].selectors,h=g.length,i=0;i<h;i++){var j=g[i],k=j.matchElementAncestry(e);if(k){var l=k.selectorPartIndex,j=j.parts,m=j.length-1;k.elementIndex==
e.nodes.length-1||l<m?(k=j.concat(),k.splice(0,l+1,f),l=new goog.cssom.iframe.style.CssSelector_,l.parts=k,g.push(l)):0<l&&l==m&&(l=new goog.cssom.iframe.style.CssSelector_,l.parts=[f,j[m]],g.push(l))}}f=new goog.cssom.iframe.style.CssRuleSet_;h=goog.cssom.iframe.style.getComputedStyleObject_(a);d=new goog.cssom.iframe.style.CssSelector_;d.parts=[new goog.cssom.iframe.style.CssSelectorPart_("html")];f.selectors=[d];g={};for(d=0;e=goog.cssom.iframe.style.inheritedProperties_[d];d++)g[e]=h[goog.string.toCamelCase(e)];
f.setDeclarationTextFromObject(g);b.push(f);f=new goog.cssom.iframe.style.CssRuleSet_;g=new goog.cssom.iframe.style.CssSelector_;g.parts=[new goog.cssom.iframe.style.CssSelectorPart_("body")];i={position:"relative",top:"0",left:"0",right:"auto",display:"block",visibility:"visible"};for(d=0;e=goog.cssom.iframe.style.textProperties_[d];d++)i[e]=h[goog.string.toCamelCase(e)];if(c&&goog.cssom.iframe.style.isTransparentValue_(h.backgroundColor)&&(a=goog.cssom.iframe.style.getBackgroundContext(a),i["background-color"]=
a.backgroundColor,c=h.backgroundImage,!c||"none"==c))i["background-image"]=a.backgroundImage,i["background-repeat"]=a.backgroundRepeat,i["background-position"]=a.backgroundPosition;f.setDeclarationTextFromObject(i,!0);f.selectors=[g];b.push(f);a=[];h=b.length;for(d=0;d<h;d++)b[d].writeToArray(a);return a.join("")};goog.cssom.iframe.style.isTransparentValue_=function(a){return"transparent"==a||"rgba(0, 0, 0, 0)"==a};
goog.cssom.iframe.style.getComputedStyleObject_=function(a){return a.currentStyle||goog.dom.getOwnerDocument(a).defaultView.getComputedStyle(a,"")||{}};goog.cssom.iframe.style.valueWithUnitsRegEx_=/^(-?)([0-9]+)([a-z]*|%)/;goog.cssom.iframe.style.getBackgroundXYValues_=function(a){return a.backgroundPositionY?[a.backgroundPositionX,a.backgroundPositionY]:(a.backgroundPosition||"0 0").split(" ")};
goog.cssom.iframe.style.getBackgroundContext=function(a){for(var b={backgroundImage:"none"},c=a,d;(c=c.parentNode)&&c.nodeType==goog.dom.NodeType.ELEMENT;){var e=goog.cssom.iframe.style.getComputedStyleObject_(c),f=e.backgroundColor;goog.cssom.iframe.style.isTransparentValue_(f)||(b.backgroundColor=f);if(e.backgroundImage&&"none"!=e.backgroundImage){b.backgroundImage=e.backgroundImage;b.backgroundRepeat=e.backgroundRepeat;if(d){var f=goog.style.getFramedPageOffset(a,d),g=d.frameElement,h=goog.style.getRelativePosition(g,
c),g=goog.style.getBorderBox(g);f.x+=h.x+g.left;f.y+=h.y+g.top}else f=goog.style.getRelativePosition(a,c);e=goog.cssom.iframe.style.getBackgroundXYValues_(e);for(h=0;2>h;h++){var i=e[h],g=0==h?"X":"Y",j="backgroundPosition"+g,k=goog.cssom.iframe.style.valueWithUnitsRegEx_.exec(i);if(k){i=parseInt(k[1]+k[2],10);k=k[3];if(0==i||"px"==k)i-="X"==g?f.x:f.y;i+=k}b[j]=i}b.backgroundPosition=b.backgroundPositionX+" "+b.backgroundPositionY}if(b.backgroundColor)break;if(c.tagName==goog.dom.TagName.HTML)try{if(d=
goog.dom.getWindow(c.parentNode),c=d.frameElement,!c)break}catch(l){break}}return b};goog.editor.SeamlessField=function(a,b){goog.editor.Field.call(this,a,b)};goog.inherits(goog.editor.SeamlessField,goog.editor.Field);goog.editor.SeamlessField.prototype.logger=goog.debug.Logger.getLogger("goog.editor.SeamlessField");goog.editor.SeamlessField.prototype.setMinHeight=function(a){a!=this.minHeight_&&(this.minHeight_=a,this.usesIframe()&&this.doFieldSizingGecko())};goog.editor.SeamlessField.prototype.isFixedHeight_=!1;goog.editor.SeamlessField.prototype.isFixedHeightOverridden_=!1;
goog.editor.SeamlessField.prototype.isFixedHeight=function(){return this.isFixedHeight_};goog.editor.SeamlessField.prototype.overrideFixedHeight=function(a){this.isFixedHeight_=a;this.isFixedHeightOverridden_=!0};goog.editor.SeamlessField.prototype.autoDetectFixedHeight_=function(){if(!this.isFixedHeightOverridden_){var a=this.getOriginalElement();a&&(this.isFixedHeight_="auto"==goog.style.getComputedOverflowY(a))}};
goog.editor.SeamlessField.prototype.handleOuterDocChange_=function(){this.isEventStopped(goog.editor.Field.EventType.CHANGE)||this.sizeIframeToWrapperGecko_()};goog.editor.SeamlessField.prototype.sizeIframeToBodyHeightGecko_=function(){if(this.acquireSizeIframeLockGecko_()){var a=this.getEditableIframe(),b=this.getIframeBodyHeightGecko_();this.minHeight_&&(b=Math.max(b,this.minHeight_));parseInt(goog.style.getStyle(a,"height"),10)!=b&&(a.style.height=b+"px");this.releaseSizeIframeLockGecko_()}};
goog.editor.SeamlessField.prototype.getIframeBodyHeightGecko_=function(){var a=this.getEditableIframe(),b=a.contentDocument.body,c=b.parentNode;0===parseInt(goog.style.getStyle(a,"height"),10)&&goog.style.setStyle(a,"height","1px");goog.editor.node.isStandardsMode(b)?a=c.offsetHeight:(a=c.scrollHeight,c.clientHeight!=c.offsetHeight&&(a+=goog.editor.SeamlessField.getScrollbarWidth_()));return a};
goog.editor.SeamlessField.getScrollbarWidth_=function(){return goog.editor.SeamlessField.scrollbarWidth_||(goog.editor.SeamlessField.scrollbarWidth_=goog.style.getScrollbarWidth())};
goog.editor.SeamlessField.prototype.sizeIframeToWrapperGecko_=function(){if(this.acquireSizeIframeLockGecko_()){var a=this.getEditableIframe(),b=this.getElement();if(b){var c=goog.style.getPaddingBox(b),d=a.parentNode,e=d.offsetWidth;parseInt(goog.style.getStyle(a,"width"),10)!=e&&(a.style.width=e+"px",b.style.width=e-c.left-c.right+"px");d=d.offsetHeight;this.isFixedHeight()&&parseInt(goog.style.getStyle(a,"height"),10)!=d&&(a.style.height=d+"px",b.style.height=d-c.top-c.bottom+"px");this.releaseSizeIframeLockGecko_()}}};
goog.editor.SeamlessField.prototype.doFieldSizingGecko=function(){this.getElement()&&(this.sizeIframeToWrapperGecko_(),this.isFixedHeight()||this.sizeIframeToBodyHeightGecko_())};goog.editor.SeamlessField.prototype.acquireSizeIframeLockGecko_=function(){return this.sizeIframeLock_?!1:this.sizeIframeLock_=!0};goog.editor.SeamlessField.prototype.releaseSizeIframeLockGecko_=function(){this.sizeIframeLock_=!1};goog.editor.SeamlessField.prototype.iframeableCss_="";
goog.editor.SeamlessField.prototype.getIframeableCss=function(a){if(!this.iframeableCss_||a){var b=this.getOriginalElement();b&&(this.iframeableCss_=goog.cssom.iframe.style.getElementContext(b,a))}return this.iframeableCss_};goog.editor.SeamlessField.prototype.setIframeableCss=function(a){this.iframeableCss_=a};goog.editor.SeamlessField.haveInstalledCss_=!1;
goog.editor.SeamlessField.prototype.inheritBlendedCSS=function(){if(this.usesIframe()){var a=this.getElement(),b=goog.dom.getDomHelper(a).getElementsByTagNameAndClass("head")[0];b&&goog.dom.removeChildren(b);b=this.getIframeableCss(!0);goog.style.installStyles(b,a)}};goog.editor.SeamlessField.prototype.usesIframe=function(){return!goog.editor.BrowserFeature.HAS_CONTENT_EDITABLE};
goog.editor.SeamlessField.prototype.setupMutationEventHandlersGecko=function(){goog.editor.SeamlessField.superClass_.setupMutationEventHandlersGecko.call(this);if(this.usesIframe()){var a=this.getEditableIframe().ownerDocument;this.eventRegister.listen(a,goog.editor.Field.MUTATION_EVENTS_GECKO,this.handleOuterDocChange_,!0);this.eventRegister.listen(this.getEditableDomHelper().getWindow(),goog.events.EventType.LOAD,this.sizeIframeToBodyHeightGecko_,!0);this.eventRegister.listen(a,"DOMAttrModified",
goog.bind(this.handleDomAttrChange,this,this.handleOuterDocChange_),!0)}};goog.editor.SeamlessField.prototype.handleChange=function(){this.isEventStopped(goog.editor.Field.EventType.CHANGE)||(goog.editor.SeamlessField.superClass_.handleChange.call(this),this.usesIframe()&&this.sizeIframeToBodyHeightGecko_())};
goog.editor.SeamlessField.prototype.dispatchBlur=function(){if(!this.isEventStopped(goog.editor.Field.EventType.BLUR)&&(goog.editor.SeamlessField.superClass_.dispatchBlur.call(this),!goog.editor.BrowserFeature.HAS_CONTENT_EDITABLE&&!goog.editor.BrowserFeature.CLEARS_SELECTION_WHEN_FOCUS_LEAVES)){var a=this.getEditableDomHelper().getWindow(),b=!1;goog.events.unlistenByKey(this.listenForDragOverEventKey_);this.listenForDragOverEventKey_=goog.events.listenOnce(a.document.body,"dragover",function(){b=
!0});goog.global.setTimeout(goog.bind(function(){if(!b&&this.editableDomHelper){var a=this.getRange(),d=this.editableDomHelper.getWindow();goog.dom.Range.clearSelection(d);a&&(a.collapse(!0),a.select())}},this),0)}};goog.editor.SeamlessField.prototype.turnOnDesignModeGecko=function(){goog.editor.SeamlessField.superClass_.turnOnDesignModeGecko.call(this);var a=this.getEditableDomHelper().getDocument();a.execCommand("enableInlineTableEditing",!1,"false");a.execCommand("enableObjectResizing",!1,"false")};
goog.editor.SeamlessField.prototype.installStyles=function(){!this.usesIframe()&&!goog.editor.SeamlessField.haveInstalledCss_&&(this.cssStyles&&goog.style.installStyles(this.cssStyles,this.getElement()),goog.editor.SeamlessField.haveInstalledCss_=!0)};
goog.editor.SeamlessField.prototype.makeEditableInternal=function(a){if(this.usesIframe())goog.editor.SeamlessField.superClass_.makeEditableInternal.call(this,a);else if(a=this.getOriginalElement())this.setupFieldObject(a),a.contentEditable=!0,this.injectContents(a.innerHTML,a),this.handleFieldLoad()};goog.editor.SeamlessField.prototype.handleFieldLoad=function(){if(this.usesIframe()){var a=this;goog.global.setTimeout(function(){a.doFieldSizingGecko()},0)}goog.editor.SeamlessField.superClass_.handleFieldLoad.call(this)};
goog.editor.SeamlessField.prototype.getIframeAttributes=function(){return{frameBorder:0,style:"padding:0;"}};
goog.editor.SeamlessField.prototype.attachIframe=function(a){this.autoDetectFixedHeight_();var b=this.getOriginalElement(),c=goog.dom.getDomHelper(b),d=b.style.width,e=b.style.height;goog.style.setStyle(b,"visibility","hidden");var c=c.createDom(goog.dom.TagName.DIV,{style:"height:0;clear:both",innerHTML:"&nbsp;"}),f=c.cloneNode(!0);b.insertBefore(c,b.firstChild);goog.dom.appendChild(b,f);var f=goog.style.getContentBoxSize(b),c=f.width,f=f.height,g="";this.isFixedHeight()&&(g="&nbsp;",goog.style.setStyle(b,
"position","relative"),goog.style.setStyle(b,"overflow","visible"),goog.style.setStyle(a,"position","absolute"),goog.style.setStyle(a,"top","0"),goog.style.setStyle(a,"left","0"));goog.style.setSize(b,c,f);goog.editor.node.isStandardsMode(b)&&(this.originalFieldLineHeight_=b.style.lineHeight,goog.style.setStyle(b,"lineHeight","0"));b.innerHTML=g;goog.style.setSize(a,c,f);goog.style.setSize(b,d,e);goog.style.setStyle(b,"visibility","");goog.dom.appendChild(b,a);this.shouldLoadAsynchronously()||(b=
a.contentWindow.document,goog.editor.node.isStandardsMode(a.ownerDocument)&&(b.open(),b.write("<!DOCTYPE HTML><html></html>"),b.close()))};goog.editor.SeamlessField.prototype.getFieldFormatInfo=function(a){var b=this.getOriginalElement();if(b)return new goog.editor.icontent.FieldFormatInfo(this.id,goog.editor.node.isStandardsMode(b),!0,this.isFixedHeight(),a);throw Error("no field");};
goog.editor.SeamlessField.prototype.writeIframeContent=function(a,b,c){goog.style.setStyle(a,"visibility","hidden");var c=this.getFieldFormatInfo(c),d=new goog.editor.icontent.FieldStyleInfo(this.getOriginalElement(),this.cssStyles+this.getIframeableCss());goog.editor.icontent.writeNormalInitialBlendedIframe(c,b,d,a);this.doFieldSizingGecko();goog.style.setStyle(a,"visibility","visible")};goog.editor.SeamlessField.prototype.restoreDom=function(){this.usesIframe()&&goog.dom.removeNode(this.getEditableIframe())};
goog.editor.SeamlessField.prototype.disposeInternal=function(){goog.events.unlistenByKey(this.listenForDragOverEventKey_);goog.editor.SeamlessField.superClass_.disposeInternal.call(this)};fyre.templates.core.editor={};fyre.templates.core.editor.main=function(){return'<div class="fyre-editor-container"><div class="fyre-editor-editable"><div class="fyre-roundedpanel-content"></div></div><div class="fyre-editor-toolbar"></div><div class="fyre-editor-preview"></div></div>'};fyre.templates.core.editor.mentionsMenu=function(){return'<div class="fyre-provider-connections"><strong>To see and mention your friends</strong></div>'};
fyre.templates.core.editor.mentionMenuItem=function(a){return'<img src="'+a.avatar+'" class="fyre-mention-item-avatar" /><h4 class="fyre-mention-item-display-name">'+soy.$$escapeHtml(a.displayName)+'</h4><span class="fyre-mention-item-'+soy.$$escapeHtml(a.provider)+'"></span>'};fyre.templates.core.editor.error=function(a){return'<span class="fyre-editor-error"><a class="fyre-editor-error-close"></a><span>'+soy.$$escapeHtml(a.msg)+"</span></span>"};fyre.templates.core.editor.mediaDrawer=function(){return'<div class="fyre-editor-media-drawer"></div>'};
fyre.templates.core.editor.mediaContainer=function(){return'<div class="fyre-editor-thumbnails-container"><div class="fyre-editor-thumbnails"></div></div>'};
fyre.templates.core.editor.mediaThumbnail=function(a){var b=!a.isMobile?'<a href="'+soy.$$escapeHtml(a.sourceUrl)+'" target="_blank">':"";switch(a.type){case "photo":b+='<img src="'+a.sourceUrl+'" class="fyre-img-thumb" />';break;case "video":b+='<img src="'+a.sourceUrl+'" class="fyre-video-thumbnail" /><div class="fyre-video-play"></div>';break;default:b+='<img src="'+a.sourceUrl+'" />'}return b+=!a.isMobile?"</a>":""};fyre.templates.core.editor.mediaTooltip=function(){return'<div class="fyre-editor-media-tooltip" style="display: none;"><div class="fyre-editor-media-tooltip-body"><button class="fyre-editor-media-tooltip-remove">Remove</button></div><div class="fyre-editor-media-tooltip-arrow"></div></div>'};
fyre.templates.core.editor.imageUpload=function(){return'Link Media from URL:<input type="text" name="url" class="fyre-url-upload" placeholder="http://" /><div class="fyre-invalid-url-message">Unsupported URL. Please enter directly into the editor.</div><div class="goog-inline-block fyre-button fyre-button-enabled fyre-button-right fyre-attach-media" title="" role="button">Attach</div>'};
fyre.templates.core.editor.media=function(a){return'<a href="'+a.url+'" class="fyre-editor-media-thumb" target="_blank"><div class="fyre-editor-media-shadow"></div><img src="'+a.thumbnail_url+'" /></a><div class="fyre-editor-media-preview-left"><p class="fyre-editor-media-title">'+soy.$$escapeHtml(a.title)+'</p><p class="fyre-editor-media-description">'+soy.$$escapeHtml(a.description)+'</p></div><div class="fyre-editor-media-preview-right"><a class="fyre-editor-media-delete"></a><p class="fyre-editor-media-source">Source: '+
soy.$$escapeHtml(a.provider_name)+"</p></div>"};fyre.templates.core.editor.rawHtmlEditor=function(a){return'<textarea cols="100" rows="10">'+soy.$$escapeHtml(a.rawHtml)+"</textarea>"};fyre.templates.core.editor.spinner=function(){return'<span class="fyre-editor-spinner"></span>'};fyre.templates.core.editor.mobileMain=function(){return'<div class="fyre-editor-container"><div class="fyre-editor-editable"><textarea class="fyre-editor-field-mobile fyre-roundedpanel-content"></textarea></div><div class="fyre-editor-toolbar" role="toolbar"></div></div>'};
fyre.templates.core.editor.disabled=function(){return'<div class="fyre-editor-disabled"><span class="fyre-editor-locked"></span> This conversation is currently closed to new comments.</div>'};goog.ui.ButtonSide={NONE:0,START:1,END:2,BOTH:3};goog.ui.ButtonRenderer=function(){goog.ui.ControlRenderer.call(this)};goog.inherits(goog.ui.ButtonRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.ButtonRenderer);goog.ui.ButtonRenderer.CSS_CLASS="goog-button";goog.ui.ButtonRenderer.prototype.getAriaRole=function(){return goog.dom.a11y.Role.BUTTON};
goog.ui.ButtonRenderer.prototype.updateAriaState=function(a,b,c){b==goog.ui.Component.State.CHECKED?goog.dom.a11y.setState(a,goog.dom.a11y.State.PRESSED,c):goog.ui.ButtonRenderer.superClass_.updateAriaState.call(this,a,b,c)};
goog.ui.ButtonRenderer.prototype.createDom=function(a){var b=goog.ui.ButtonRenderer.superClass_.createDom.call(this,a),c=a.getTooltip();c&&this.setTooltip(b,c);(c=a.getValue())&&this.setValue(b,c);a.isSupportedState(goog.ui.Component.State.CHECKED)&&this.updateAriaState(b,goog.ui.Component.State.CHECKED,a.isChecked());return b};
goog.ui.ButtonRenderer.prototype.decorate=function(a,b){b=goog.ui.ButtonRenderer.superClass_.decorate.call(this,a,b);a.setValueInternal(this.getValue(b));a.setTooltipInternal(this.getTooltip(b));a.isSupportedState(goog.ui.Component.State.CHECKED)&&this.updateAriaState(b,goog.ui.Component.State.CHECKED,a.isChecked());return b};goog.ui.ButtonRenderer.prototype.getValue=goog.nullFunction;goog.ui.ButtonRenderer.prototype.setValue=goog.nullFunction;goog.ui.ButtonRenderer.prototype.getTooltip=function(a){return a.title};
goog.ui.ButtonRenderer.prototype.setTooltip=function(a,b){a&&(a.title=b||"")};goog.ui.ButtonRenderer.prototype.setCollapsed=function(a,b){var c=a.isRightToLeft(),d=this.getStructuralCssClass()+"-collapse-left",e=this.getStructuralCssClass()+"-collapse-right";a.enableClassName(c?e:d,!!(b&goog.ui.ButtonSide.START));a.enableClassName(c?d:e,!!(b&goog.ui.ButtonSide.END))};goog.ui.ButtonRenderer.prototype.getCssClass=function(){return goog.ui.ButtonRenderer.CSS_CLASS};goog.ui.INLINE_BLOCK_CLASSNAME="goog-inline-block";goog.ui.CustomButtonRenderer=function(){goog.ui.ButtonRenderer.call(this)};goog.inherits(goog.ui.CustomButtonRenderer,goog.ui.ButtonRenderer);goog.addSingletonGetter(goog.ui.CustomButtonRenderer);goog.ui.CustomButtonRenderer.CSS_CLASS="goog-custom-button";
goog.ui.CustomButtonRenderer.prototype.createDom=function(a){var b=this.getClassNames(a),b={"class":goog.ui.INLINE_BLOCK_CLASSNAME+" "+b.join(" "),title:a.getTooltip()||""},b=a.getDomHelper().createDom("div",b,this.createButton(a.getContent(),a.getDomHelper()));this.setAriaStates(a,b);return b};goog.ui.CustomButtonRenderer.prototype.getAriaRole=function(){return goog.dom.a11y.Role.BUTTON};
goog.ui.CustomButtonRenderer.prototype.setAriaStates=function(a,b){goog.asserts.assert(a);goog.asserts.assert(b);a.isEnabled()||this.updateAriaState(b,goog.ui.Component.State.DISABLED,!0);a.isSelected()&&this.updateAriaState(b,goog.ui.Component.State.SELECTED,!0);a.isSupportedState(goog.ui.Component.State.CHECKED)&&this.updateAriaState(b,goog.ui.Component.State.CHECKED,!0);a.isOpen()&&this.updateAriaState(b,goog.ui.Component.State.OPENED,!0)};
goog.ui.CustomButtonRenderer.prototype.getContentElement=function(a){return a&&a.firstChild.firstChild};goog.ui.CustomButtonRenderer.prototype.createButton=function(a,b){return b.createDom("div",goog.ui.INLINE_BLOCK_CLASSNAME+" "+(this.getCssClass()+"-outer-box"),b.createDom("div",goog.ui.INLINE_BLOCK_CLASSNAME+" "+(this.getCssClass()+"-inner-box"),a))};goog.ui.CustomButtonRenderer.prototype.canDecorate=function(a){return"DIV"==a.tagName};
goog.ui.CustomButtonRenderer.prototype.hasBoxStructure=function(a,b){var c=a.getDomHelper().getFirstElementChild(b);return c&&-1!=c.className.indexOf(this.getCssClass()+"-outer-box")&&(c=a.getDomHelper().getFirstElementChild(c))&&-1!=c.className.indexOf(this.getCssClass()+"-inner-box")?!0:!1};
goog.ui.CustomButtonRenderer.prototype.decorate=function(a,b){goog.ui.CustomButtonRenderer.trimTextNodes_(b,!0);goog.ui.CustomButtonRenderer.trimTextNodes_(b,!1);this.hasBoxStructure(a,b)||b.appendChild(this.createButton(b.childNodes,a.getDomHelper()));goog.dom.classes.add(b,goog.ui.INLINE_BLOCK_CLASSNAME,this.getCssClass());return goog.ui.CustomButtonRenderer.superClass_.decorate.call(this,a,b)};goog.ui.CustomButtonRenderer.prototype.getCssClass=function(){return goog.ui.CustomButtonRenderer.CSS_CLASS};
goog.ui.CustomButtonRenderer.trimTextNodes_=function(a,b){if(a)for(var c=b?a.firstChild:a.lastChild,d;c&&c.parentNode==a;){d=b?c.nextSibling:c.previousSibling;if(c.nodeType==goog.dom.NodeType.TEXT){var e=c.nodeValue;if(""==goog.string.trim(e))a.removeChild(c);else{c.nodeValue=b?goog.string.trimLeft(e):goog.string.trimRight(e);break}}else break;c=d}};fyre.v1.editor.LeftButtonRenderer=function(){goog.ui.CustomButtonRenderer.call(this)};goog.inherits(fyre.v1.editor.LeftButtonRenderer,goog.ui.CustomButtonRenderer);fyre.v1.editor.LeftButtonRenderer.prototype.getCssClass=function(){return"fyre-button-left"};goog.addSingletonGetter(fyre.v1.editor.LeftButtonRenderer);fyre.v1.editor.RightButtonRenderer=function(){goog.ui.CustomButtonRenderer.call(this)};goog.inherits(fyre.v1.editor.RightButtonRenderer,goog.ui.CustomButtonRenderer);
fyre.v1.editor.RightButtonRenderer.prototype.getCssClass=function(){return"fyre-button-right"};goog.addSingletonGetter(fyre.v1.editor.RightButtonRenderer);fyre.v1.editor.MentionMenuRenderer=function(){goog.ui.MenuRenderer.call(this)};goog.inherits(fyre.v1.editor.MentionMenuRenderer,goog.ui.MenuRenderer);goog.addSingletonGetter(fyre.v1.editor.MentionMenuRenderer);fyre.v1.editor.MentionMenuRenderer.prototype.getCssClass=function(){return"fyre-mention-menu"};fyre.v1.ui.FyreControl=fyre.v1.ui.FyreComponentFactory(goog.ui.Control);fyre.v1.editor.MentionMenuItem=function(a){this.model_=a;this.model_.bind("change",this.render,this);this.model_.bind("visible",this.setVisible,this);fyre.v1.ui.FyreControl.call(this);this.setRenderer(goog.ui.ControlRenderer.getCustomRenderer(goog.ui.ControlRenderer,"fyre-mention-item"))};goog.inherits(fyre.v1.editor.MentionMenuItem,fyre.v1.ui.FyreControl);fyre.v1.editor.MentionMenuItem.EVENTS=fyre.v1.editor.MentionMenuItem.prototype.EVENTS={CLICKED:"clicked"};
fyre.v1.editor.MentionMenuItem.prototype.createDomInternal=function(){fyre.v1.editor.MentionMenuItem.superClass_.createDomInternal.call(this);this.render()};fyre.v1.editor.MentionMenuItem.prototype.getCaption=function(){return this.model_.get(this.model_.ATTRIBUTES.DISPLAY_NAME)};fyre.v1.editor.MentionMenuItem.prototype.setContent=function(){return this.model_.get(this.model_.ATTRIBUTES.DISPLAY_NAME)};
fyre.v1.editor.MentionMenuItem.prototype.enterDocument=function(){fyre.v1.editor.MentionMenuItem.superClass_.enterDocument.call(this);this.getHandler().listen(this,goog.ui.Component.EventType.ACTION,goog.bind(this.trigger,this,this.EVENTS.CLICKED,this.model_))};fyre.v1.editor.MentionMenuItem.prototype.exitDocument=function(){this.model_.off(null,null,this);fyre.v1.editor.MentionMenuItem.superClass_.exitDocument.call(this)};
fyre.v1.editor.MentionMenuItem.prototype.getSoyData=function(){var a=fyre.v1.model.Mention.ATTRIBUTES;return{avatar:this.model_.get(a.AVATAR),displayName:this.model_.get(a.DISPLAY_NAME),provider:this.model_.get(a.PROVIDER)}};fyre.v1.editor.MentionMenuItem.prototype.render=function(){this.model_&&this.$dom_.html(fyre.templates.core.editor.mentionMenuItem(this.getSoyData()))};
fyre.v1.editor.MentionMenuItem.prototype.setVisible=function(a,b){this.renderer_&&fyre.v1.editor.MentionMenuItem.superClass_.setVisible.call(this,a,b)};fyre.v1.util.WindowPoller=function(a,b,c){this.callbackFn=b;this.duration=c;this.timeout=this.durationTimeout=null;this.win=a};fyre.v1.util.WindowPoller.DEFAULT_FREQUENCY=50;fyre.v1.util.WindowPoller.prototype.processTick=function(){this.win.closed?(this.stop(),this.callbackFn()):this.timeout=setTimeout(goog.bind(this.processTick,this),fyre.v1.util.WindowPoller.DEFAULT_FREQUENCY)};
fyre.v1.util.WindowPoller.prototype.start=function(){this.timeout=setTimeout(goog.bind(this.processTick,this),fyre.v1.util.WindowPoller.DEFAULT_FREQUENCY);goog.isNumber(this.duration)&&(this.durationTimeout=setTimeout(goog.bind(function(){this.stop();this.callbackFn()},this),this.duration))};fyre.v1.util.WindowPoller.prototype.stop=function(){clearTimeout(this.durationTimeout);clearTimeout(this.timeout)};fyre.v1.editor.MentionsMenu=function(a){fyre.v1.ui.FyreFilteredMenu.call(this,fyre.v1.editor.MentionMenuRenderer.getInstance(),null);this.model_=a;this.user=this.model_.get(a.ATTRIBUTES.USER);this.rendered_={};this.deferred_={};this.sectIndex_={};this.sectHeader_={};this.connectLinks_=[];this.poller=null;goog.array.forEach(this.SECTION_ORDER,this.initSection_,this);this.bindCollection_(this.SECTIONS.CONV,a.get(a.ATTRIBUTES.FOLLOWERS));this.bindCollection_(this.SECTIONS.CONV,a.get(a.ATTRIBUTES.CONV_AUTHORS));
this.bindCollection_(this.SECTIONS.SOC,a.get(a.ATTRIBUTES.SOCIAL_FRIENDS));this.model_.on(this.model_.attributeChangeEvent(this.model_.ATTRIBUTES.USERAUTH),this.handleUserAuthChange,this)};goog.inherits(fyre.v1.editor.MentionsMenu,fyre.v1.ui.FyreFilteredMenu);fyre.v1.editor.MentionsMenu.CLASSES={PROVIDER_CONN:"fyre-provider-connections"};fyre.v1.editor.MentionsMenu.prototype.SECTIONS={CONV:"conv",CUSTOM:"custom",SOC:"soc"};
fyre.v1.editor.MentionsMenu.prototype.SECTION_SIZE=function(){var a={},b=fyre.v1.editor.MentionsMenu.prototype.SECTIONS;a[b.CONV]=10;a[b.CUSTOM]=2;a[b.SOC]=10;return a}();fyre.v1.editor.MentionsMenu.prototype.SECTION_ORDER=function(){var a=fyre.v1.editor.MentionsMenu.prototype.SECTIONS;return[a.CONV,a.SOC,a.CUSTOM]}();fyre.v1.editor.MentionsMenu.prototype.SECTION_HEADERS=function(){var a=fyre.v1.editor.MentionsMenu.prototype.SECTIONS,b={};b[a.CONV]="";b[a.CUSTOM]="";b[a.SOC]="";return b}();
fyre.v1.editor.MentionsMenu.EVENTS=fyre.v1.editor.MentionsMenu.prototype.EVENTS={FETCH_FRIENDS:"fetchFriends",FETCH_FRIENDS_COMPLETE:"fetchFriendsComplete"};goog.object.extend(fyre.v1.editor.MentionsMenu.EVENTS,fyre.v1.editor.MentionMenuItem.EVENTS);fyre.v1.editor.MentionsMenu.prototype.bindCollection_=function(a,b){b.on(b.EVENTS.ADD,goog.bind(this.addAuthor,this,a));b.forEach(goog.bind(this.addAuthor,this,a))};
fyre.v1.editor.MentionsMenu.prototype.createCustomMentions_=function(){var a=fyre.v1.model.Mention.ATTRIBUTES,b=fyre.v1.model.Mention.PROVIDERS;this.livefyreMention=new fyre.v1.model.Mention(goog.object.create(a.PROVIDER,b.LIVEFYRE,a.JID,"custom@livefyre.com",a.CUSTOM,!0));this.twitterMention=new fyre.v1.model.Mention(goog.object.create(a.PROVIDER,b.TWITTER,a.JID,"custom@twitter.com",a.CUSTOM,!0));this.addFollower(this.SECTIONS.CUSTOM,this.twitterMention);this.addFollower(this.SECTIONS.CUSTOM,this.livefyreMention)};
fyre.v1.editor.MentionsMenu.prototype.initSection_=function(a){var b=new goog.ui.Control(this.SECTION_HEADERS[a]);b.setEnabled(!1);this.rendered_[a]=[];this.deferred_[a]={};this.sectHeader_[a]=b;this.setPersistentVisibility(b,!0)};fyre.v1.editor.MentionsMenu.prototype.addAuthor=function(a,b){var c=b.get(b.ATTRIBUTES.DISPLAY_NAME);goog.string.isEmpty(c)||b instanceof fyre.conv.model.Author&&b.isFeed()||this.addFollower(a,b.toMention())};
fyre.v1.editor.MentionsMenu.prototype.createDomInternal=function(){fyre.v1.editor.MentionsMenu.superClass_.createDomInternal.call(this);goog.object.isEmpty(this.user.get(this.user.ATTRIBUTES.CONNECTIONS))||(this.$dom_.prepend(fyre.v1.dom.create(fyre.templates.core.editor.mentionsMenu())),this.$dom_.addClass("fyre-mention-connections"),this.handleConnectionChange(),this.user.on(this.user.attributeChangeEvent(this.user.ATTRIBUTES.CONNECTIONS),this.handleConnectionChange,this));goog.array.forEach(this.SECTION_ORDER,
function(a){this.addChild(this.sectHeader_[a],!0)},this);this.createCustomMentions_();this.filterItems_()};fyre.v1.editor.MentionsMenu.prototype.connectAccount=function(a){a.preventDefault();a.stopPropagation();var b=goog.window.open(a.target.href,{height:400,width:770});this.poller=new fyre.v1.util.WindowPoller(b,goog.bind(this.handleConnectAccountWindowClose,this,a.target.name),16E4);this.poller.start()};
fyre.v1.editor.MentionsMenu.prototype.handleConnectAccountWindowClose=function(a){this.trigger(this.EVENTS.FETCH_FRIENDS);this.showFetchingFriends(a)};fyre.v1.editor.MentionsMenu.prototype.showFetchingFriends=function(a){this.$dom_.getByClass("fyre-provider-"+a).addClass("fyre-provider-fetching")};fyre.v1.editor.MentionsMenu.prototype.hideFetchingFriends=function(){this.$dom_.getNByClass("fyre-provider-connect").removeClass("fyre-provider-fetching")};
fyre.v1.editor.MentionsMenu.prototype.handleUserAuthChange=function(){if((this.user=this.model_.get(this.model_.ATTRIBUTES.USER))&&this.user.id)this.user.on(this.user.attributeChangeEvent(this.user.ATTRIBUTES.CONNECTIONS),this.handleConnectionChange,this)};
fyre.v1.editor.MentionsMenu.prototype.handleConnectionChange=function(){if(this.$dom_){var a=this.$dom_.getByClass(fyre.v1.editor.MentionsMenu.CLASSES.PROVIDER_CONN),b=this.user.get(fyre.conv.model.User.ATTRIBUTES.CONNECTIONS);goog.object.isEmpty(b)?(a&&a.remove(),this.$dom_.removeClass("fyre-mention-connections")):(this.$dom_.addClass("fyre-mention-connections"),a||(a=fyre.v1.dom.create(fyre.templates.core.editor.mentionsMenu()),this.$dom_.prepend(a)),a.findElementsByTagName("a").remove(),goog.object.forEach(b,
function(b,d){var e=fyre.v1.dom.create("a",{"class":"fyre-provider-connect fyre-provider-"+d,href:b,name:d});a.append(e);this.getHandler().listen(e.element,goog.events.EventType.CLICK,goog.bind(this.connectAccount,this))},this))}};
fyre.v1.editor.MentionsMenu.prototype.addFollower=function(a,b){var c=b.get(b.ATTRIBUTES.JID);this.sectIndex_[c]=a;!this.isInDocument()||this.getVisibleBySection()[a].length>=this.SECTION_SIZE[a]||!this.mentionMatchesFilter_(b)?this.deferred_[a][c]=b:goog.array.binaryInsert(this.rendered_[a],c)&&(c=new fyre.v1.editor.MentionMenuItem(b),b.get(b.ATTRIBUTES.CUSTOM)&&c.setVisible(!1),c.on(c.EVENTS.CLICKED,goog.bind(this.trigger,this,this.EVENTS.CLICKED)),this.addChildAt(c,this.getSectAppendIndex(a),!0),
this.visibleBySection_&&this.visibleBySection_[a].push(c))};fyre.v1.editor.MentionsMenu.prototype.getSectAppendIndex=function(a){a=this.SECTION_ORDER[goog.array.indexOf(this.SECTION_ORDER,a)+1];return!a?this.children_.length:goog.array.indexOf(this.children_,this.sectHeader_[a])};
fyre.v1.editor.MentionsMenu.prototype.filterItems_=function(a){this.visibleBySection_=null;this.filterCustom_(a);fyre.v1.editor.MentionsMenu.superClass_.filterItems_.call(this,a);goog.object.forEach(this.getVisibleBySection(),this.filterSect_,this)};
fyre.v1.editor.MentionsMenu.prototype.filterCustom_=function(a){var b=fyre.v1.model.Mention.ATTRIBUTES,c=goog.isString(a)?a.split(" ")[0]:"";this.twitterMention.set(goog.object.create(b.DISPLAY_NAME,c,b.HANDLE,c));this.livefyreMention.set(goog.object.create(b.DISPLAY_NAME,c));""===a&&(this.twitterMention.trigger("visible",!1),this.livefyreMention.trigger("visible",!1))};
fyre.v1.editor.MentionsMenu.prototype.filterSect_=function(a,b){for(var c=a.length,d,e,f;c>this.SECTION_SIZE[b];)d=this.removeChild(a.pop()),e=d.getModel(),f=e.get(e.ATTRIBUTES.JID),goog.array.binaryRemove(this.rendered_[b],f),this.deferred_[b][f]=e,d.dispose(),c--;c<this.SECTION_SIZE[b]&&goog.object.some(this.deferred_[b],function(a,d){this.mentionMatchesFilter_(a)&&(this.addFollower(b,a),setTimeout(goog.bind(function(){delete this.deferred_[b][d]},this),50),c++);return c>=this.SECTION_SIZE[b]},
this)};fyre.v1.editor.MentionsMenu.prototype.mentionMatchesFilter_=function(a){return!this.filterStr_||goog.string.caseInsensitiveStartsWith(a.get(a.ATTRIBUTES.DISPLAY_NAME),this.filterStr_)};
fyre.v1.editor.MentionsMenu.prototype.getVisibleBySection=function(){var a={},b;if(this.visibleBySection_)return this.visibleBySection_;goog.object.forEach(this.SECTIONS,function(b){a[b]=[]});this.forEachChild(function(c){c.isVisible()&&!this.hasPersistentVisibility(c)&&(b=c.getModel(),a[this.sectIndex_[b.get(b.ATTRIBUTES.JID)]].push(c))},this);return this.visibleBySection_=a};fyre.v2={};fyre.v2.editor={};fyre.v2.editor.EVENTS={MEDIA_UPLOAD_CLICKED:"mediaUploadClicked"};fyre.conv.editor={};fyre.conv.editor.EVENTS={};goog.object.extend(fyre.conv.editor.EVENTS,fyre.v2.editor.EVENTS);goog.positioning={};goog.positioning.Corner={TOP_LEFT:0,TOP_RIGHT:2,BOTTOM_LEFT:1,BOTTOM_RIGHT:3,TOP_START:4,TOP_END:6,BOTTOM_START:5,BOTTOM_END:7};goog.positioning.CornerBit={BOTTOM:1,RIGHT:2,FLIP_RTL:4};goog.positioning.Overflow={IGNORE:0,ADJUST_X:1,FAIL_X:2,ADJUST_Y:4,FAIL_Y:8,RESIZE_WIDTH:16,RESIZE_HEIGHT:32,ADJUST_X_EXCEPT_OFFSCREEN:65,ADJUST_Y_EXCEPT_OFFSCREEN:132};
goog.positioning.OverflowStatus={NONE:0,ADJUSTED_X:1,ADJUSTED_Y:2,WIDTH_ADJUSTED:4,HEIGHT_ADJUSTED:8,FAILED_LEFT:16,FAILED_RIGHT:32,FAILED_TOP:64,FAILED_BOTTOM:128,FAILED_OUTSIDE_VIEWPORT:256};goog.positioning.OverflowStatus.FAILED=goog.positioning.OverflowStatus.FAILED_LEFT|goog.positioning.OverflowStatus.FAILED_RIGHT|goog.positioning.OverflowStatus.FAILED_TOP|goog.positioning.OverflowStatus.FAILED_BOTTOM|goog.positioning.OverflowStatus.FAILED_OUTSIDE_VIEWPORT;
goog.positioning.OverflowStatus.FAILED_HORIZONTAL=goog.positioning.OverflowStatus.FAILED_LEFT|goog.positioning.OverflowStatus.FAILED_RIGHT;goog.positioning.OverflowStatus.FAILED_VERTICAL=goog.positioning.OverflowStatus.FAILED_TOP|goog.positioning.OverflowStatus.FAILED_BOTTOM;
goog.positioning.positionAtAnchor=function(a,b,c,d,e,f,g,h){var i,j=c.offsetParent;if(j){var k=j.tagName==goog.dom.TagName.HTML||j.tagName==goog.dom.TagName.BODY;if(!k||"static"!=goog.style.getComputedPosition(j))i=goog.style.getPageOffset(j),k||(i=goog.math.Coordinate.difference(i,new goog.math.Coordinate(j.scrollLeft,j.scrollTop)))}j=goog.positioning.getVisiblePart_(a);goog.style.translateRectForAnotherFrame(j,goog.dom.getDomHelper(a),goog.dom.getDomHelper(c));a=goog.positioning.getEffectiveCorner(a,
b);b=new goog.math.Coordinate(a&goog.positioning.CornerBit.RIGHT?j.left+j.width:j.left,a&goog.positioning.CornerBit.BOTTOM?j.top+j.height:j.top);i&&(b=goog.math.Coordinate.difference(b,i));e&&(b.x+=(a&goog.positioning.CornerBit.RIGHT?-1:1)*e.x,b.y+=(a&goog.positioning.CornerBit.BOTTOM?-1:1)*e.y);var l;if(g&&(l=goog.style.getVisibleRectForElement(c))&&i)l.top-=i.y,l.right-=i.x,l.bottom-=i.y,l.left-=i.x;return goog.positioning.positionAtCoordinate(b,c,d,f,l,g,h)};
goog.positioning.getVisiblePart_=function(a){var b=goog.style.getBounds(a);(a=goog.style.getVisibleRectForElement(a))&&b.intersection(goog.math.Rect.createFromBox(a));return b};
goog.positioning.positionAtCoordinate=function(a,b,c,d,e,f,g){var a=a.clone(),h=goog.positioning.OverflowStatus.NONE,c=goog.positioning.getEffectiveCorner(b,c),i=goog.style.getSize(b),g=g?g.clone():i.clone();if(d||c!=goog.positioning.Corner.TOP_LEFT)c&goog.positioning.CornerBit.RIGHT?a.x-=g.width+(d?d.right:0):d&&(a.x+=d.left),c&goog.positioning.CornerBit.BOTTOM?a.y-=g.height+(d?d.bottom:0):d&&(a.y+=d.top);if(f&&(h=e?goog.positioning.adjustForViewport_(a,g,e,f):goog.positioning.OverflowStatus.FAILED_OUTSIDE_VIEWPORT,
h&goog.positioning.OverflowStatus.FAILED))return h;goog.style.setPosition(b,a);goog.math.Size.equals(i,g)||goog.style.setBorderBoxSize(b,g);return h};
goog.positioning.adjustForViewport_=function(a,b,c,d){var e=goog.positioning.OverflowStatus.NONE,f=goog.positioning.Overflow.ADJUST_X_EXCEPT_OFFSCREEN,g=goog.positioning.Overflow.ADJUST_Y_EXCEPT_OFFSCREEN;if((d&f)==f&&(a.x<c.left||a.x>=c.right))d&=~goog.positioning.Overflow.ADJUST_X;if((d&g)==g&&(a.y<c.top||a.y>=c.bottom))d&=~goog.positioning.Overflow.ADJUST_Y;a.x<c.left&&d&goog.positioning.Overflow.ADJUST_X&&(a.x=c.left,e|=goog.positioning.OverflowStatus.ADJUSTED_X);a.x<c.left&&a.x+b.width>c.right&&
d&goog.positioning.Overflow.RESIZE_WIDTH&&(b.width=Math.max(b.width-(a.x+b.width-c.right),0),e|=goog.positioning.OverflowStatus.WIDTH_ADJUSTED);a.x+b.width>c.right&&d&goog.positioning.Overflow.ADJUST_X&&(a.x=Math.max(c.right-b.width,c.left),e|=goog.positioning.OverflowStatus.ADJUSTED_X);d&goog.positioning.Overflow.FAIL_X&&(e|=(a.x<c.left?goog.positioning.OverflowStatus.FAILED_LEFT:0)|(a.x+b.width>c.right?goog.positioning.OverflowStatus.FAILED_RIGHT:0));a.y<c.top&&d&goog.positioning.Overflow.ADJUST_Y&&
(a.y=c.top,e|=goog.positioning.OverflowStatus.ADJUSTED_Y);a.y>=c.top&&a.y+b.height>c.bottom&&d&goog.positioning.Overflow.RESIZE_HEIGHT&&(b.height=Math.max(b.height-(a.y+b.height-c.bottom),0),e|=goog.positioning.OverflowStatus.HEIGHT_ADJUSTED);a.y+b.height>c.bottom&&d&goog.positioning.Overflow.ADJUST_Y&&(a.y=Math.max(c.bottom-b.height,c.top),e|=goog.positioning.OverflowStatus.ADJUSTED_Y);d&goog.positioning.Overflow.FAIL_Y&&(e|=(a.y<c.top?goog.positioning.OverflowStatus.FAILED_TOP:0)|(a.y+b.height>
c.bottom?goog.positioning.OverflowStatus.FAILED_BOTTOM:0));return e};goog.positioning.getEffectiveCorner=function(a,b){return(b&goog.positioning.CornerBit.FLIP_RTL&&goog.style.isRightToLeft(a)?b^goog.positioning.CornerBit.RIGHT:b)&~goog.positioning.CornerBit.FLIP_RTL};goog.positioning.flipCornerHorizontal=function(a){return a^goog.positioning.CornerBit.RIGHT};goog.positioning.flipCornerVertical=function(a){return a^goog.positioning.CornerBit.BOTTOM};
goog.positioning.flipCorner=function(a){return a^goog.positioning.CornerBit.BOTTOM^goog.positioning.CornerBit.RIGHT};goog.ui.NativeButtonRenderer=function(){goog.ui.ButtonRenderer.call(this)};goog.inherits(goog.ui.NativeButtonRenderer,goog.ui.ButtonRenderer);goog.addSingletonGetter(goog.ui.NativeButtonRenderer);goog.ui.NativeButtonRenderer.prototype.getAriaRole=function(){};
goog.ui.NativeButtonRenderer.prototype.createDom=function(a){this.setUpNativeButton_(a);return a.getDomHelper().createDom("button",{"class":this.getClassNames(a).join(" "),disabled:!a.isEnabled(),title:a.getTooltip()||"",value:a.getValue()||""},a.getCaption()||"")};goog.ui.NativeButtonRenderer.prototype.canDecorate=function(a){return"BUTTON"==a.tagName||"INPUT"==a.tagName&&("button"==a.type||"submit"==a.type||"reset"==a.type)};
goog.ui.NativeButtonRenderer.prototype.decorate=function(a,b){this.setUpNativeButton_(a);b.disabled&&goog.dom.classes.add(b,this.getClassForState(goog.ui.Component.State.DISABLED));return goog.ui.NativeButtonRenderer.superClass_.decorate.call(this,a,b)};goog.ui.NativeButtonRenderer.prototype.initializeDom=function(a){a.getHandler().listen(a.getElement(),goog.events.EventType.CLICK,a.performActionInternal)};goog.ui.NativeButtonRenderer.prototype.setAllowTextSelection=goog.nullFunction;
goog.ui.NativeButtonRenderer.prototype.setRightToLeft=goog.nullFunction;goog.ui.NativeButtonRenderer.prototype.isFocusable=function(a){return a.isEnabled()};goog.ui.NativeButtonRenderer.prototype.setFocusable=goog.nullFunction;goog.ui.NativeButtonRenderer.prototype.setState=function(a,b,c){goog.ui.NativeButtonRenderer.superClass_.setState.call(this,a,b,c);if((a=a.getElement())&&b==goog.ui.Component.State.DISABLED)a.disabled=c};goog.ui.NativeButtonRenderer.prototype.getValue=function(a){return a.value};
goog.ui.NativeButtonRenderer.prototype.setValue=function(a,b){a&&(a.value=b)};goog.ui.NativeButtonRenderer.prototype.updateAriaState=goog.nullFunction;goog.ui.NativeButtonRenderer.prototype.setUpNativeButton_=function(a){a.setHandleMouseEvents(!1);a.setAutoStates(goog.ui.Component.State.ALL,!1);a.setSupportedState(goog.ui.Component.State.FOCUSED,!1)};goog.ui.Button=function(a,b,c){goog.ui.Control.call(this,a,b||goog.ui.NativeButtonRenderer.getInstance(),c)};goog.inherits(goog.ui.Button,goog.ui.Control);goog.ui.Button.Side=goog.ui.ButtonSide;goog.ui.Button.prototype.getValue=function(){return this.value_};goog.ui.Button.prototype.setValue=function(a){this.value_=a;this.getRenderer().setValue(this.getElement(),a)};goog.ui.Button.prototype.setValueInternal=function(a){this.value_=a};goog.ui.Button.prototype.getTooltip=function(){return this.tooltip_};
goog.ui.Button.prototype.setTooltip=function(a){this.tooltip_=a;this.getRenderer().setTooltip(this.getElement(),a)};goog.ui.Button.prototype.setTooltipInternal=function(a){this.tooltip_=a};goog.ui.Button.prototype.setCollapsed=function(a){this.getRenderer().setCollapsed(this,a)};goog.ui.Button.prototype.disposeInternal=function(){goog.ui.Button.superClass_.disposeInternal.call(this);delete this.value_;delete this.tooltip_};
goog.ui.Button.prototype.enterDocument=function(){goog.ui.Button.superClass_.enterDocument.call(this);if(this.isSupportedState(goog.ui.Component.State.FOCUSED)){var a=this.getKeyEventTarget();a&&this.getHandler().listen(a,goog.events.EventType.KEYUP,this.handleKeyEventInternal)}};
goog.ui.Button.prototype.handleKeyEventInternal=function(a){return a.keyCode==goog.events.KeyCodes.ENTER&&a.type==goog.events.KeyHandler.EventType.KEY||a.keyCode==goog.events.KeyCodes.SPACE&&a.type==goog.events.EventType.KEYUP?this.performActionInternal(a):a.keyCode==goog.events.KeyCodes.SPACE};goog.ui.registry.setDecoratorByClassName(goog.ui.ButtonRenderer.CSS_CLASS,function(){return new goog.ui.Button(null)});goog.positioning.AbstractPosition=function(){};goog.positioning.AbstractPosition.prototype.reposition=function(){};goog.positioning.AnchoredPosition=function(a,b,c){this.element=a;this.corner=b;this.overflow_=c};goog.inherits(goog.positioning.AnchoredPosition,goog.positioning.AbstractPosition);goog.positioning.AnchoredPosition.prototype.reposition=function(a,b,c){goog.positioning.positionAtAnchor(this.element,this.corner,a,b,void 0,c,this.overflow_)};goog.positioning.ViewportPosition=function(a,b){this.coordinate=a instanceof goog.math.Coordinate?a:new goog.math.Coordinate(a,b)};goog.inherits(goog.positioning.ViewportPosition,goog.positioning.AbstractPosition);goog.positioning.ViewportPosition.prototype.reposition=function(a,b,c,d){goog.positioning.positionAtAnchor(goog.style.getClientViewportElement(a),goog.positioning.Corner.TOP_LEFT,a,b,this.coordinate,c,null,d)};goog.positioning.AbsolutePosition=function(a,b){this.coordinate=a instanceof goog.math.Coordinate?a:new goog.math.Coordinate(a,b)};goog.inherits(goog.positioning.AbsolutePosition,goog.positioning.AbstractPosition);goog.positioning.AbsolutePosition.prototype.reposition=function(a,b,c,d){goog.positioning.positionAtCoordinate(this.coordinate,a,b,c,null,null,d)};goog.positioning.AnchoredViewportPosition=function(a,b,c){goog.positioning.AnchoredPosition.call(this,a,b);this.lastResortOverflow_=c?goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.ADJUST_Y:goog.positioning.Overflow.IGNORE};goog.inherits(goog.positioning.AnchoredViewportPosition,goog.positioning.AnchoredPosition);goog.positioning.AnchoredViewportPosition.prototype.getLastResortOverflow=function(){return this.lastResortOverflow_};
goog.positioning.AnchoredViewportPosition.prototype.setLastResortOverflow=function(a){this.lastResortOverflow_=a};
goog.positioning.AnchoredViewportPosition.prototype.reposition=function(a,b,c,d){var e=goog.positioning.positionAtAnchor(this.element,this.corner,a,b,null,c,goog.positioning.Overflow.FAIL_X|goog.positioning.Overflow.FAIL_Y,d);if(e&goog.positioning.OverflowStatus.FAILED){var f=this.correctCorner_(e,this.corner),b=this.correctCorner_(e,b),e=goog.positioning.positionAtAnchor(this.element,f,a,b,null,c,goog.positioning.Overflow.FAIL_X|goog.positioning.Overflow.FAIL_Y,d);e&goog.positioning.OverflowStatus.FAILED&&
(f=this.correctCorner_(e,f),b=this.correctCorner_(e,b),goog.positioning.positionAtAnchor(this.element,f,a,b,null,c,this.getLastResortOverflow(),d))}};goog.positioning.AnchoredViewportPosition.prototype.correctCorner_=function(a,b){a&goog.positioning.OverflowStatus.FAILED_HORIZONTAL&&(b=goog.positioning.flipCornerHorizontal(b));a&goog.positioning.OverflowStatus.FAILED_VERTICAL&&(b=goog.positioning.flipCornerVertical(b));return b};goog.positioning.ClientPosition=function(a,b){this.coordinate=a instanceof goog.math.Coordinate?a:new goog.math.Coordinate(a,b)};goog.inherits(goog.positioning.ClientPosition,goog.positioning.AbstractPosition);goog.positioning.ClientPosition.prototype.reposition=function(a,b,c,d){var e=goog.style.getClientViewportElement(a),f=new goog.math.Coordinate(this.coordinate.x+e.scrollLeft,this.coordinate.y+e.scrollTop);goog.positioning.positionAtAnchor(e,goog.positioning.Corner.TOP_LEFT,a,b,f,c,null,d)};goog.positioning.ViewportClientPosition=function(a,b){goog.positioning.ClientPosition.call(this,a,b)};goog.inherits(goog.positioning.ViewportClientPosition,goog.positioning.ClientPosition);goog.positioning.ViewportClientPosition.prototype.lastResortOverflow_=0;goog.positioning.ViewportClientPosition.prototype.setLastResortOverflow=function(a){this.lastResortOverflow_=a};
goog.positioning.ViewportClientPosition.prototype.reposition=function(a,b,c,d){var e=goog.style.getClientViewportElement(a),e=goog.style.getVisibleRectForElement(e),f=goog.dom.getDomHelper(a).getDocumentScrollElement(),f=new goog.math.Coordinate(this.coordinate.x+f.scrollLeft,this.coordinate.y+f.scrollTop),g=goog.positioning.Overflow.FAIL_X|goog.positioning.Overflow.FAIL_Y,h=b,i=goog.positioning.positionAtCoordinate(f,a,h,c,e,g,d);if(0!=(i&goog.positioning.OverflowStatus.FAILED)){if(i&goog.positioning.OverflowStatus.FAILED_LEFT||
i&goog.positioning.OverflowStatus.FAILED_RIGHT)h=goog.positioning.flipCornerHorizontal(h);if(i&goog.positioning.OverflowStatus.FAILED_TOP||i&goog.positioning.OverflowStatus.FAILED_BOTTOM)h=goog.positioning.flipCornerVertical(h);i=goog.positioning.positionAtCoordinate(f,a,h,c,e,g,d);0!=(i&goog.positioning.OverflowStatus.FAILED)&&goog.positioning.positionAtCoordinate(f,a,b,c,e,this.lastResortOverflow_,d)}};goog.ui.Popup=function(a,b){this.popupCorner_=goog.positioning.Corner.TOP_START;this.position_=b||void 0;goog.ui.PopupBase.call(this,a)};goog.inherits(goog.ui.Popup,goog.ui.PopupBase);goog.ui.Popup.Corner=goog.positioning.Corner;goog.ui.Popup.Overflow=goog.positioning.Overflow;goog.ui.Popup.prototype.getPinnedCorner=function(){return this.popupCorner_};goog.ui.Popup.prototype.setPinnedCorner=function(a){this.popupCorner_=a;this.isVisible()&&this.reposition()};
goog.ui.Popup.prototype.getPosition=function(){return this.position_||null};goog.ui.Popup.prototype.setPosition=function(a){this.position_=a||void 0;this.isVisible()&&this.reposition()};goog.ui.Popup.prototype.getMargin=function(){return this.margin_||null};goog.ui.Popup.prototype.setMargin=function(a,b,c,d){this.margin_=null==a||a instanceof goog.math.Box?a:new goog.math.Box(a,b,c,d);this.isVisible()&&this.reposition()};
goog.ui.Popup.prototype.reposition=function(){if(this.position_){var a=!this.isVisible()&&this.getType()!=goog.ui.PopupBase.Type.MOVE_OFFSCREEN,b=this.getElement();a&&(b.style.visibility="hidden",goog.style.showElement(b,!0));this.position_.reposition(b,this.popupCorner_,this.margin_);a&&goog.style.showElement(b,!1)}};goog.ui.Popup.positionPopup=function(a,b,c,d,e,f,g){return 0==(goog.positioning.positionAtAnchor(a,b,c,d,e,f,g)&goog.positioning.OverflowStatus.FAILED)};
goog.ui.Popup.positionAtCoordinate=function(a,b,c,d){goog.positioning.positionAtCoordinate(a,b,c,d);return!0};goog.ui.Popup.AnchoredPosition=goog.positioning.AnchoredPosition;goog.ui.Popup.AnchoredViewPortPosition=goog.positioning.AnchoredViewportPosition;goog.ui.Popup.AbsolutePosition=goog.positioning.AbsolutePosition;goog.ui.Popup.ViewPortPosition=goog.positioning.ViewportPosition;goog.ui.Popup.ClientPosition=goog.positioning.ClientPosition;goog.ui.Popup.ViewPortClientPosition=goog.positioning.ViewportClientPosition;goog.ui.Tooltip=function(a,b,c){this.dom_=c||(a?goog.dom.getDomHelper(goog.dom.getElement(a)):goog.dom.getDomHelper());goog.ui.Popup.call(this,this.dom_.createDom("div",{style:"position:absolute;display:none;"}));this.cursorPosition=new goog.math.Coordinate(1,1);this.elements_=new goog.structs.Set;a&&this.attach(a);null!=b&&this.setText(b)};goog.inherits(goog.ui.Tooltip,goog.ui.Popup);goog.ui.Tooltip.activeInstances_=[];goog.ui.Tooltip.prototype.activeEl_=null;
goog.ui.Tooltip.prototype.className="goog-tooltip";goog.ui.Tooltip.prototype.showDelayMs_=500;goog.ui.Tooltip.prototype.hideDelayMs_=0;goog.ui.Tooltip.State={INACTIVE:0,WAITING_TO_SHOW:1,SHOWING:2,WAITING_TO_HIDE:3,UPDATING:4};goog.ui.Tooltip.Activation={CURSOR:0,FOCUS:1};goog.ui.Tooltip.prototype.getDomHelper=function(){return this.dom_};goog.ui.Tooltip.prototype.getChildTooltip=function(){return this.childTooltip_};
goog.ui.Tooltip.prototype.attach=function(a){a=goog.dom.getElement(a);this.elements_.add(a);goog.events.listen(a,goog.events.EventType.MOUSEOVER,this.handleMouseOver,!1,this);goog.events.listen(a,goog.events.EventType.MOUSEOUT,this.handleMouseOutAndBlur,!1,this);goog.events.listen(a,goog.events.EventType.MOUSEMOVE,this.handleMouseMove,!1,this);goog.events.listen(a,goog.events.EventType.FOCUS,this.handleFocus,!1,this);goog.events.listen(a,goog.events.EventType.BLUR,this.handleMouseOutAndBlur,!1,this)};
goog.ui.Tooltip.prototype.detach=function(a){if(a)a=goog.dom.getElement(a),this.detachElement_(a),this.elements_.remove(a);else{for(var b=this.elements_.getValues(),c=0;a=b[c];c++)this.detachElement_(a);this.elements_.clear()}};
goog.ui.Tooltip.prototype.detachElement_=function(a){goog.events.unlisten(a,goog.events.EventType.MOUSEOVER,this.handleMouseOver,!1,this);goog.events.unlisten(a,goog.events.EventType.MOUSEOUT,this.handleMouseOutAndBlur,!1,this);goog.events.unlisten(a,goog.events.EventType.MOUSEMOVE,this.handleMouseMove,!1,this);goog.events.unlisten(a,goog.events.EventType.FOCUS,this.handleFocus,!1,this);goog.events.unlisten(a,goog.events.EventType.BLUR,this.handleMouseOutAndBlur,!1,this)};
goog.ui.Tooltip.prototype.setShowDelayMs=function(a){this.showDelayMs_=a};goog.ui.Tooltip.prototype.getShowDelayMs=function(){return this.showDelayMs_};goog.ui.Tooltip.prototype.setHideDelayMs=function(a){this.hideDelayMs_=a};goog.ui.Tooltip.prototype.getHideDelayMs=function(){return this.hideDelayMs_};goog.ui.Tooltip.prototype.setText=function(a){goog.dom.setTextContent(this.getElement(),a)};goog.ui.Tooltip.prototype.setHtml=function(a){this.getElement().innerHTML=a};
goog.ui.Tooltip.prototype.setElement=function(a){var b=this.getElement();b&&goog.dom.removeNode(b);goog.ui.Tooltip.superClass_.setElement.call(this,a);a&&(b=this.dom_.getDocument().body,b.insertBefore(a,b.lastChild))};goog.ui.Tooltip.prototype.getText=function(){return goog.dom.getTextContent(this.getElement())};goog.ui.Tooltip.prototype.getHtml=function(){return this.getElement().innerHTML};
goog.ui.Tooltip.prototype.getState=function(){return this.showTimer?this.isVisible()?goog.ui.Tooltip.State.UPDATING:goog.ui.Tooltip.State.WAITING_TO_SHOW:this.hideTimer?goog.ui.Tooltip.State.WAITING_TO_HIDE:this.isVisible()?goog.ui.Tooltip.State.SHOWING:goog.ui.Tooltip.State.INACTIVE};goog.ui.Tooltip.prototype.setRequireInteraction=function(a){this.requireInteraction_=a};
goog.ui.Tooltip.prototype.isCoordinateInTooltip=function(a){if(!this.isVisible())return!1;var b=goog.style.getPageOffset(this.getElement()),c=goog.style.getSize(this.getElement());return b.x<=a.x&&a.x<=b.x+c.width&&b.y<=a.y&&a.y<=b.y+c.height};
goog.ui.Tooltip.prototype.onBeforeShow=function(){if(!goog.ui.PopupBase.prototype.onBeforeShow.call(this))return!1;if(this.anchor)for(var a,b=0;a=goog.ui.Tooltip.activeInstances_[b];b++)goog.dom.contains(a.getElement(),this.anchor)||a.setVisible(!1);goog.array.insert(goog.ui.Tooltip.activeInstances_,this);a=this.getElement();a.className=this.className;this.clearHideTimer();goog.events.listen(a,goog.events.EventType.MOUSEOVER,this.handleTooltipMouseOver,!1,this);goog.events.listen(a,goog.events.EventType.MOUSEOUT,
this.handleTooltipMouseOut,!1,this);this.clearShowTimer();return!0};
goog.ui.Tooltip.prototype.onHide_=function(){goog.array.remove(goog.ui.Tooltip.activeInstances_,this);for(var a=this.getElement(),b,c=0;b=goog.ui.Tooltip.activeInstances_[c];c++)b.anchor&&goog.dom.contains(a,b.anchor)&&b.setVisible(!1);this.parentTooltip_&&this.parentTooltip_.startHideTimer();goog.events.unlisten(a,goog.events.EventType.MOUSEOVER,this.handleTooltipMouseOver,!1,this);goog.events.unlisten(a,goog.events.EventType.MOUSEOUT,this.handleTooltipMouseOut,!1,this);this.anchor=void 0;this.getState()==
goog.ui.Tooltip.State.INACTIVE&&(this.seenInteraction_=!1);goog.ui.PopupBase.prototype.onHide_.call(this)};goog.ui.Tooltip.prototype.maybeShow=function(a,b){this.anchor==a&&this.elements_.contains(this.anchor)&&(this.seenInteraction_||!this.requireInteraction_?(this.setVisible(!1),this.isVisible()||this.positionAndShow_(a,b)):this.anchor=void 0);this.showTimer=void 0};goog.ui.Tooltip.prototype.getElements=function(){return this.elements_};goog.ui.Tooltip.prototype.getActiveElement=function(){return this.activeEl_};
goog.ui.Tooltip.prototype.setActiveElement=function(a){this.activeEl_=a};goog.ui.Tooltip.prototype.showForElement=function(a,b){this.attach(a);this.activeEl_=a;this.positionAndShow_(a,b)};goog.ui.Tooltip.prototype.positionAndShow_=function(a,b){this.anchor=a;this.setPosition(b||this.getPositioningStrategy(goog.ui.Tooltip.Activation.CURSOR));this.setVisible(!0)};
goog.ui.Tooltip.prototype.maybeHide=function(a){this.hideTimer=void 0;a==this.anchor&&(null==this.activeEl_||this.activeEl_!=this.getElement()&&!this.elements_.contains(this.activeEl_))&&!this.hasActiveChild()&&this.setVisible(!1)};goog.ui.Tooltip.prototype.hasActiveChild=function(){return!(!this.childTooltip_||!this.childTooltip_.activeEl_)};
goog.ui.Tooltip.prototype.saveCursorPosition_=function(a){var b=this.dom_.getDocumentScroll();this.cursorPosition.x=a.clientX+b.x;this.cursorPosition.y=a.clientY+b.y};goog.ui.Tooltip.prototype.handleMouseOver=function(a){var b=this.getAnchorFromElement(a.target);this.activeEl_=b;this.clearHideTimer();b!=this.anchor&&(this.anchor=b,this.startShowTimer(b),this.checkForParentTooltip_(),this.saveCursorPosition_(a))};
goog.ui.Tooltip.prototype.getAnchorFromElement=function(a){try{for(;a&&!this.elements_.contains(a);)a=a.parentNode;return a}catch(b){return null}};goog.ui.Tooltip.prototype.handleMouseMove=function(a){this.saveCursorPosition_(a);this.seenInteraction_=!0};
goog.ui.Tooltip.prototype.handleFocus=function(a){this.activeEl_=a=this.getAnchorFromElement(a.target);this.seenInteraction_=!0;if(this.anchor!=a){this.anchor=a;var b=this.getPositioningStrategy(goog.ui.Tooltip.Activation.FOCUS);this.clearHideTimer();this.startShowTimer(a,b);this.checkForParentTooltip_()}};goog.ui.Tooltip.prototype.getPositioningStrategy=function(a){return a==goog.ui.Tooltip.Activation.CURSOR?(a=this.cursorPosition.clone(),new goog.ui.Tooltip.CursorTooltipPosition(a)):new goog.ui.Tooltip.ElementTooltipPosition(this.activeEl_)};
goog.ui.Tooltip.prototype.checkForParentTooltip_=function(){if(this.anchor)for(var a,b=0;a=goog.ui.Tooltip.activeInstances_[b];b++)goog.dom.contains(a.getElement(),this.anchor)&&(a.childTooltip_=this,this.parentTooltip_=a)};
goog.ui.Tooltip.prototype.handleMouseOutAndBlur=function(a){var b=this.getAnchorFromElement(a.target),c=this.getAnchorFromElement(a.relatedTarget);b!=c&&(b==this.activeEl_&&(this.activeEl_=null),this.clearShowTimer(),this.seenInteraction_=!1,this.isVisible()&&(!a.relatedTarget||!goog.dom.contains(this.getElement(),a.relatedTarget))?this.startHideTimer():this.anchor=void 0)};
goog.ui.Tooltip.prototype.handleTooltipMouseOver=function(){var a=this.getElement();this.activeEl_!=a&&(this.clearHideTimer(),this.activeEl_=a)};goog.ui.Tooltip.prototype.handleTooltipMouseOut=function(a){var b=this.getElement();if(this.activeEl_==b&&(!a.relatedTarget||!goog.dom.contains(b,a.relatedTarget)))this.activeEl_=null,this.startHideTimer()};goog.ui.Tooltip.prototype.startShowTimer=function(a,b){this.showTimer||(this.showTimer=goog.Timer.callOnce(goog.bind(this.maybeShow,this,a,b),this.showDelayMs_))};
goog.ui.Tooltip.prototype.clearShowTimer=function(){this.showTimer&&(goog.Timer.clear(this.showTimer),this.showTimer=void 0)};goog.ui.Tooltip.prototype.startHideTimer=function(){this.getState()==goog.ui.Tooltip.State.SHOWING&&(this.hideTimer=goog.Timer.callOnce(goog.bind(this.maybeHide,this,this.anchor),this.getHideDelayMs()))};goog.ui.Tooltip.prototype.clearHideTimer=function(){this.hideTimer&&(goog.Timer.clear(this.hideTimer),this.hideTimer=void 0)};
goog.ui.Tooltip.prototype.disposeInternal=function(){this.setVisible(!1);this.clearShowTimer();this.detach();this.getElement()&&goog.dom.removeNode(this.getElement());this.activeEl_=null;delete this.dom_;goog.ui.Tooltip.superClass_.disposeInternal.call(this)};goog.ui.Tooltip.CursorTooltipPosition=function(a,b){goog.positioning.ViewportPosition.call(this,a,b)};goog.inherits(goog.ui.Tooltip.CursorTooltipPosition,goog.positioning.ViewportPosition);
goog.ui.Tooltip.CursorTooltipPosition.prototype.reposition=function(a,b,c){b=goog.style.getClientViewportElement(a);b=goog.style.getVisibleRectForElement(b);c=c?new goog.math.Box(c.top+10,c.right,c.bottom,c.left+10):new goog.math.Box(10,0,0,10);goog.positioning.positionAtCoordinate(this.coordinate,a,goog.positioning.Corner.TOP_START,c,b,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.FAIL_Y)&goog.positioning.OverflowStatus.FAILED&&goog.positioning.positionAtCoordinate(this.coordinate,
a,goog.positioning.Corner.TOP_START,c,b,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.ADJUST_Y)};goog.ui.Tooltip.ElementTooltipPosition=function(a){goog.positioning.AnchoredPosition.call(this,a,goog.positioning.Corner.BOTTOM_RIGHT)};goog.inherits(goog.ui.Tooltip.ElementTooltipPosition,goog.positioning.AnchoredPosition);
goog.ui.Tooltip.ElementTooltipPosition.prototype.reposition=function(a,b,c){var d=new goog.math.Coordinate(10,0);goog.positioning.positionAtAnchor(this.element,this.corner,a,b,d,c,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.FAIL_Y)&goog.positioning.OverflowStatus.FAILED&&goog.positioning.positionAtAnchor(this.element,goog.positioning.Corner.TOP_RIGHT,a,goog.positioning.Corner.BOTTOM_LEFT,d,c,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.ADJUST_Y)};fyre.v2.editor.MediaTooltip=function(a,b,c){this.dom_=c||(a?goog.dom.getDomHelper(goog.dom.getElement(a)):goog.dom.getDomHelper());this.domElement_=this.createDom_();goog.ui.Popup.call(this,this.domElement_);this.setUpRemoveButton_();this.cursorPosition=new goog.math.Coordinate(1,1);this.elements_=new goog.structs.Set;a&&this.attach(a);null!=b&&this.setText(b)};goog.inherits(fyre.v2.editor.MediaTooltip,goog.ui.Tooltip);goog.addSingletonGetter(fyre.v2.editor.MediaTooltip);
fyre.v2.editor.MediaTooltip.CLASSES={BASE:"fyre-editor-media-tooltip",BODY:"fyre-editor-media-tooltip-body",REMOVE:"fyre-editor-media-tooltip-remove"};fyre.v2.editor.MediaTooltip.prototype.showDelayMs_=100;fyre.v2.editor.MediaTooltip.prototype.hideDelayMs_=100;fyre.v2.editor.MediaTooltip.prototype.className=fyre.v2.editor.MediaTooltip.CLASSES.BASE;
fyre.v2.editor.MediaTooltip.prototype.createDom_=function(){var a=goog.soy.renderAsElement(fyre.templates.core.editor.mediaTooltip),b=this.dom_.getDocument().body;goog.dom.append(b,a);return a};fyre.v2.editor.MediaTooltip.prototype.setUpRemoveButton_=function(){var a=goog.dom.getElementByClass(fyre.v2.editor.MediaTooltip.CLASSES.REMOVE,this.domElement_),b=new goog.ui.Button(null);b.setHandleMouseEvents(!0);b.decorate(a);b.setParentEventTarget(this)};
fyre.v2.editor.MediaTooltip.prototype.handleRemoveButtonClick_=function(){this.dispatchEvent(fyre.conv.editor.EVENTS.MEDIA_REMOVE_CLICKED)};fyre.v2.editor.MediaTooltip.prototype.adjustPosition_=function(){var a=this.domElement_,b=0;a.clientHeight&&(b=-a.clientHeight,a=-10-(this.domElement_.clientWidth-this.anchor.clientWidth)/2,this.setMargin(b,void 0,void 0,a))};fyre.v2.editor.MediaTooltip.prototype.onShow_=function(){fyre.v2.editor.MediaTooltip.superClass_.onShow_.call(this);this.adjustPosition_()};
fyre.v2.editor.MediaTooltip.prototype.getPositioningStrategy=function(a){a=goog.ui.Tooltip.Activation.FOCUS;a=fyre.v2.editor.MediaTooltip.superClass_.getPositioningStrategy.call(this,a);a.corner=goog.positioning.Corner.TOP_LEFT;return a};
fyre.v2.editor.MediaTooltip.prototype.attach=function(a,b){b=goog.isFunction(b)?b:goog.nullFunction;a.callback=b;fyre.v1.util.browser.isMobile()?(this.elements_.add(a),goog.events.listen(a,goog.events.EventType.CLICK,this.handleClick,!1,this)):fyre.v2.editor.MediaTooltip.superClass_.attach.call(this,a)};fyre.v2.editor.MediaTooltip.prototype.detach=function(a){fyre.v2.editor.MediaTooltip.superClass_.detach.call(this,a);goog.events.unlisten(a,goog.events.EventType.CLICK,this.handleClick,!1,this)};
fyre.v2.editor.MediaTooltip.prototype.handleMouseOver=function(a){this.getAnchorFromElement(a.target).callback();fyre.v2.editor.MediaTooltip.superClass_.handleMouseOver.call(this,a)};fyre.v2.editor.MediaTooltip.prototype.handleClick=function(a){a=this.getAnchorFromElement(a.target);this.activeEl_===a&&this.isActive_?(this.setVisible(!1),this.isActive_=!1):(a.callback(),this.isActive_=!0,this.anchor=this.activeEl_=a,this.maybeShow(a))};fyre.v2.editor.Media=function(a,b){goog.ui.Component.call(this,b);this.model_=a};goog.inherits(fyre.v2.editor.Media,goog.ui.Component);fyre.v2.editor.Media.prototype.createDom=function(){var a=this.getSoyData();this.element_=goog.soy.renderAsElement(fyre.templates.core.editor.mediaThumbnail,a)};
fyre.v2.editor.Media.prototype.getSoyData=function(){var a=fyre.v1.model.Media.ATTRIBUTES,b={};b.sourceUrl=this.model_.get(a.SOURCE_URL);b.type=this.model_.get(a.TYPE);b.isMobile=fyre.v1.util.browser.isMobile();return b};fyre.v2.editor.Media.prototype.enterDocument=function(){fyre.v2.editor.Media.superClass_.enterDocument.call(this);this.tooltip_=fyre.v2.editor.MediaTooltip.getInstance();this.tooltip_.attach(this.getElement(),goog.bind(this.setTooltipParentTarget_,this))};
fyre.v2.editor.Media.prototype.setTooltipParentTarget_=function(){this.tooltip_.setParentEventTarget(this);this.getHandler().listen(this.tooltip_,goog.ui.Component.EventType.ACTION,this.handleRemoveMedia_)};fyre.v2.editor.Media.prototype.handleRemoveMedia_=function(a){goog.object.extend(a,{media:this.model_,callback:goog.bind(this.dispose,this)})};
fyre.v2.editor.Media.prototype.disposeInternal=function(){this.tooltip_.detach(this.getElement());this.tooltip_.setVisible(!1);this.getHandler().unlisten(this.tooltip_,goog.ui.Component.EventType.ACTION,this.handleRemoveMedia_);fyre.v2.editor.Media.superClass_.disposeInternal.call(this)};fyre.v2.editor.MediaContainer=function(a,b){goog.ui.Component.call(this,b);this.mediaCollection_=a};goog.inherits(fyre.v2.editor.MediaContainer,goog.ui.Component);fyre.v2.editor.MediaContainer.CLASSES={THUMBNAILS:"fyre-editor-thumbnails"};fyre.v2.editor.MediaContainer.prototype.createDom=function(){this.element_=goog.soy.renderAsElement(fyre.templates.core.editor.mediaContainer)};
fyre.v2.editor.MediaContainer.prototype.enterDocument=function(){var a=fyre.v2.editor.MediaContainer.CLASSES;fyre.v2.editor.MediaContainer.superClass_.enterDocument.call(this);this.mediaCollection_.on(this.mediaCollection_.EVENTS.ADD,this.mediaAdded_,this);this.thumbnailsEl_=this.getElementByClass(a.THUMBNAILS)};
fyre.v2.editor.MediaContainer.prototype.mediaAdded_=function(a){a=new fyre.v2.editor.Media(a);this.addChild(a);a.render(this.thumbnailsEl_);this.getHandler().listen(a,goog.ui.Component.EventType.ACTION,this.handleRemoveMedia_)};fyre.v2.editor.MediaContainer.prototype.handleRemoveMedia_=function(a){a.stopPropagation();this.mediaCollection_.remove(a.media);a.callback()};
fyre.v2.editor.MediaContainer.prototype.scrollToNewest=function(){var a=this.thumbnailsEl_.offsetWidth,a=this.getElement().offsetWidth-a;0<a||(this.getElement().scrollLeft=-a)};fyre.v2.editor.MediaContainer.prototype.disposeInternal=function(){this.mediaCollection_.off(null,null,this);fyre.v2.editor.MediaContainer.superClass_.disposeInternal.call(this)};fyre.v2.editor.MediaDrawer=function(a,b){goog.ui.Component.call(this,b);this.mediaCollection_=a};goog.inherits(fyre.v2.editor.MediaDrawer,goog.ui.Component);fyre.v2.editor.MediaDrawer.DEFAULT_ANIMATION_DURATION=500;fyre.v2.editor.MediaDrawer.prototype.createDom=function(){var a=goog.soy.renderAsElement(fyre.templates.core.editor.mediaDrawer);goog.style.showElement(a,!1);this.element_=a};
fyre.v2.editor.MediaDrawer.prototype.enterDocument=function(){fyre.v2.editor.MediaDrawer.superClass_.enterDocument.call(this);this.mediaCollection_.on(this.mediaCollection_.EVENTS.REMOVE,this.handleMediaRemoved_,this);this.mediaCollection_.on(this.mediaCollection_.EVENTS.RESET,this.handleMediaReset_,this)};
fyre.v2.editor.MediaDrawer.prototype.initMediaContainer_=function(){this.mediaContainer_||(this.mediaContainer_=new fyre.v2.editor.MediaContainer(this.mediaCollection_),this.addChild(this.mediaContainer_,!0))};fyre.v2.editor.MediaDrawer.prototype.disposeMediaContainer_=function(){this.mediaContainer_&&(this.removeChild(this.mediaContainer_),this.mediaContainer_.dispose(),this.mediaContainer_=null)};fyre.v2.editor.MediaDrawer.prototype.handleMediaRemoved_=function(){this.mediaCollection_.length||this.hide(!0)};
fyre.v2.editor.MediaDrawer.prototype.handleMediaReset_=function(){this.hide(!0)};fyre.v2.editor.MediaDrawer.prototype.addMedia=function(a){this.initMediaContainer_();this.mediaCollection_.add(a);this.show()};
fyre.v2.editor.MediaDrawer.prototype.show=function(a){a=goog.isNumber(a)||fyre.v2.editor.MediaDrawer.DEFAULT_ANIMATION_DURATION;goog.style.isElementShown(this.getElement())||(new goog.fx.dom.FadeInAndShow(this.getElement(),a)).play();goog.global.setTimeout(goog.bind(this.mediaContainer_.scrollToNewest,this.mediaContainer_),a+1E3)};fyre.v2.editor.MediaDrawer.prototype.hide=function(a){goog.style.showElement(this.getElement(),!1);a&&this.disposeMediaContainer_()};
fyre.v2.editor.MediaDrawer.prototype.disposeInternal=function(){fyre.v2.editor.MediaDrawer.superClass_.disposeInternal.call(this);this.mediaContainer_.off(null,null,this)};goog.ui.CustomButton=function(a,b,c){goog.ui.Button.call(this,a,b||goog.ui.CustomButtonRenderer.getInstance(),c)};goog.inherits(goog.ui.CustomButton,goog.ui.Button);goog.ui.registry.setDecoratorByClassName(goog.ui.CustomButtonRenderer.CSS_CLASS,function(){return new goog.ui.CustomButton(null)});goog.ui.Option=function(a,b,c){goog.ui.MenuItem.call(this,a,b,c);this.setSelectable(!0)};goog.inherits(goog.ui.Option,goog.ui.MenuItem);goog.ui.Option.prototype.performActionInternal=function(){return this.dispatchEvent(goog.ui.Component.EventType.ACTION)};goog.ui.registry.setDecoratorByClassName("goog-option",function(){return new goog.ui.Option(null)});goog.ui.ToolbarSeparatorRenderer=function(){goog.ui.MenuSeparatorRenderer.call(this)};goog.inherits(goog.ui.ToolbarSeparatorRenderer,goog.ui.MenuSeparatorRenderer);goog.addSingletonGetter(goog.ui.ToolbarSeparatorRenderer);goog.ui.ToolbarSeparatorRenderer.CSS_CLASS="goog-toolbar-separator";goog.ui.ToolbarSeparatorRenderer.prototype.createDom=function(a){return a.getDomHelper().createDom("div",this.getCssClass()+" "+goog.ui.INLINE_BLOCK_CLASSNAME,"\u00a0")};
goog.ui.ToolbarSeparatorRenderer.prototype.decorate=function(a,b){b=goog.ui.ToolbarSeparatorRenderer.superClass_.decorate.call(this,a,b);goog.dom.classes.add(b,goog.ui.INLINE_BLOCK_CLASSNAME);return b};goog.ui.ToolbarSeparatorRenderer.prototype.getCssClass=function(){return goog.ui.ToolbarSeparatorRenderer.CSS_CLASS};goog.ui.ToolbarRenderer=function(){goog.ui.ContainerRenderer.call(this)};goog.inherits(goog.ui.ToolbarRenderer,goog.ui.ContainerRenderer);goog.addSingletonGetter(goog.ui.ToolbarRenderer);goog.ui.ToolbarRenderer.CSS_CLASS="goog-toolbar";goog.ui.ToolbarRenderer.prototype.getAriaRole=function(){return goog.dom.a11y.Role.TOOLBAR};
goog.ui.ToolbarRenderer.prototype.getDecoratorForChild=function(a){return"HR"==a.tagName?new goog.ui.Separator(goog.ui.ToolbarSeparatorRenderer.getInstance()):goog.ui.ToolbarRenderer.superClass_.getDecoratorForChild.call(this,a)};goog.ui.ToolbarRenderer.prototype.getCssClass=function(){return goog.ui.ToolbarRenderer.CSS_CLASS};goog.ui.ToolbarRenderer.prototype.getDefaultOrientation=function(){return goog.ui.Container.Orientation.HORIZONTAL};goog.ui.Toolbar=function(a,b,c){goog.ui.Container.call(this,b,a||goog.ui.ToolbarRenderer.getInstance(),c)};goog.inherits(goog.ui.Toolbar,goog.ui.Container);goog.ui.ToolbarButtonRenderer=function(){goog.ui.CustomButtonRenderer.call(this)};goog.inherits(goog.ui.ToolbarButtonRenderer,goog.ui.CustomButtonRenderer);goog.addSingletonGetter(goog.ui.ToolbarButtonRenderer);goog.ui.ToolbarButtonRenderer.CSS_CLASS="goog-toolbar-button";goog.ui.ToolbarButtonRenderer.prototype.getCssClass=function(){return goog.ui.ToolbarButtonRenderer.CSS_CLASS};goog.ui.ToolbarButton=function(a,b,c){goog.ui.Button.call(this,a,b||goog.ui.ToolbarButtonRenderer.getInstance(),c)};goog.inherits(goog.ui.ToolbarButton,goog.ui.Button);goog.ui.registry.setDecoratorByClassName(goog.ui.ToolbarButtonRenderer.CSS_CLASS,function(){return new goog.ui.ToolbarButton(null)});goog.ui.MenuButtonRenderer=function(){goog.ui.CustomButtonRenderer.call(this)};goog.inherits(goog.ui.MenuButtonRenderer,goog.ui.CustomButtonRenderer);goog.addSingletonGetter(goog.ui.MenuButtonRenderer);goog.ui.MenuButtonRenderer.CSS_CLASS="goog-menu-button";goog.ui.MenuButtonRenderer.WRAPPER_PROP_="__goog_wrapper_div";
goog.userAgent.GECKO&&(goog.ui.MenuButtonRenderer.prototype.setContent=function(a,b){var c=goog.ui.MenuButtonRenderer.superClass_.getContentElement.call(this,a&&a.firstChild);c&&goog.dom.replaceNode(this.createCaption(b,goog.dom.getDomHelper(a)),c)});goog.ui.MenuButtonRenderer.prototype.getContentElement=function(a){a=goog.ui.MenuButtonRenderer.superClass_.getContentElement.call(this,a&&a.firstChild);goog.userAgent.GECKO&&a&&a[goog.ui.MenuButtonRenderer.WRAPPER_PROP_]&&(a=a.firstChild);return a};
goog.ui.MenuButtonRenderer.prototype.decorate=function(a,b){var c=goog.dom.getElementsByTagNameAndClass("*",goog.ui.MenuRenderer.CSS_CLASS,b)[0];if(c){goog.style.showElement(c,!1);goog.dom.appendChild(goog.dom.getOwnerDocument(c).body,c);var d=new goog.ui.Menu;d.decorate(c);a.setMenu(d)}return goog.ui.MenuButtonRenderer.superClass_.decorate.call(this,a,b)};
goog.ui.MenuButtonRenderer.prototype.createButton=function(a,b){return goog.ui.MenuButtonRenderer.superClass_.createButton.call(this,[this.createCaption(a,b),this.createDropdown(b)],b)};goog.ui.MenuButtonRenderer.prototype.createCaption=function(a,b){return goog.ui.MenuButtonRenderer.wrapCaption(a,this.getCssClass(),b)};goog.ui.MenuButtonRenderer.wrapCaption=function(a,b,c){return c.createDom("div",goog.ui.INLINE_BLOCK_CLASSNAME+" "+(b+"-caption"),a)};
goog.ui.MenuButtonRenderer.prototype.createDropdown=function(a){return a.createDom("div",goog.ui.INLINE_BLOCK_CLASSNAME+" "+(this.getCssClass()+"-dropdown"),"\u00a0")};goog.ui.MenuButtonRenderer.prototype.getCssClass=function(){return goog.ui.MenuButtonRenderer.CSS_CLASS};goog.ui.ColorMenuButtonRenderer=function(){goog.ui.MenuButtonRenderer.call(this)};goog.inherits(goog.ui.ColorMenuButtonRenderer,goog.ui.MenuButtonRenderer);goog.addSingletonGetter(goog.ui.ColorMenuButtonRenderer);goog.ui.ColorMenuButtonRenderer.CSS_CLASS="goog-color-menu-button";goog.ui.ColorMenuButtonRenderer.prototype.createCaption=function(a,b){return goog.ui.ColorMenuButtonRenderer.superClass_.createCaption.call(this,goog.ui.ColorMenuButtonRenderer.wrapCaption(a,b),b)};
goog.ui.ColorMenuButtonRenderer.wrapCaption=function(a,b){return b.createDom("div",goog.ui.ColorMenuButtonRenderer.CSS_CLASS+"-indicator",a)};goog.ui.ColorMenuButtonRenderer.prototype.setValue=function(a,b){a&&goog.ui.ColorMenuButtonRenderer.setCaptionValue(this.getContentElement(a),b)};goog.ui.ColorMenuButtonRenderer.setCaptionValue=function(a,b){if(a&&a.firstChild){var c;try{c=goog.color.parse(b).hex}catch(d){c=null}a.firstChild.style.borderBottomColor=c||(goog.userAgent.IE?"":"transparent")}};
goog.ui.ColorMenuButtonRenderer.prototype.initializeDom=function(a){this.setValue(a.getElement(),a.getValue());goog.dom.classes.add(a.getElement(),goog.ui.ColorMenuButtonRenderer.CSS_CLASS);goog.ui.ColorMenuButtonRenderer.superClass_.initializeDom.call(this,a)};goog.ui.PaletteRenderer=function(){goog.ui.ControlRenderer.call(this)};goog.inherits(goog.ui.PaletteRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.PaletteRenderer);goog.ui.PaletteRenderer.cellId_=0;goog.ui.PaletteRenderer.CSS_CLASS="goog-palette";goog.ui.PaletteRenderer.prototype.createDom=function(a){var b=this.getClassNames(a);return a.getDomHelper().createDom("div",b?b.join(" "):null,this.createGrid(a.getContent(),a.getSize(),a.getDomHelper()))};
goog.ui.PaletteRenderer.prototype.createGrid=function(a,b,c){for(var d=[],e=0,f=0;e<b.height;e++){for(var g=[],h=0;h<b.width;h++){var i=a&&a[f++];g.push(this.createCell(i,c))}d.push(this.createRow(g,c))}return this.createTable(d,c)};goog.ui.PaletteRenderer.prototype.createTable=function(a,b){var c=b.createDom("table",this.getCssClass()+"-table",b.createDom("tbody",this.getCssClass()+"-body",a));c.cellSpacing=0;c.cellPadding=0;goog.dom.a11y.setRole(c,"grid");return c};
goog.ui.PaletteRenderer.prototype.createRow=function(a,b){return b.createDom("tr",this.getCssClass()+"-row",a)};goog.ui.PaletteRenderer.prototype.createCell=function(a,b){var c=b.createDom("td",{"class":this.getCssClass()+"-cell",id:this.getCssClass()+"-cell-"+goog.ui.PaletteRenderer.cellId_++},a);goog.dom.a11y.setRole(c,"gridcell");return c};goog.ui.PaletteRenderer.prototype.canDecorate=function(){return!1};goog.ui.PaletteRenderer.prototype.decorate=function(){return null};
goog.ui.PaletteRenderer.prototype.setContent=function(a,b){if(a){var c=goog.dom.getElementsByTagNameAndClass("tbody",this.getCssClass()+"-body",a)[0];if(c){var d=0;goog.array.forEach(c.rows,function(a){goog.array.forEach(a.cells,function(a){goog.dom.removeChildren(a);if(b){var c=b[d++];c&&goog.dom.appendChild(a,c)}})});if(d<b.length){for(var e=[],f=goog.dom.getDomHelper(a),g=c.rows[0].cells.length;d<b.length;){var h=b[d++];e.push(this.createCell(h,f));e.length==g&&(h=this.createRow(e,f),goog.dom.appendChild(c,
h),e.length=0)}if(0<e.length){for(;e.length<g;)e.push(this.createCell("",f));h=this.createRow(e,f);goog.dom.appendChild(c,h)}}}goog.style.setUnselectable(a,!0,goog.userAgent.GECKO)}};goog.ui.PaletteRenderer.prototype.getContainingItem=function(a,b){for(var c=a.getElement();b&&b.nodeType==goog.dom.NodeType.ELEMENT&&b!=c;){if("TD"==b.tagName&&goog.dom.classes.has(b,this.getCssClass()+"-cell"))return b.firstChild;b=b.parentNode}return null};
goog.ui.PaletteRenderer.prototype.highlightCell=function(a,b,c){b&&(b=b.parentNode,goog.dom.classes.enable(b,this.getCssClass()+"-cell-hover",c),a=a.getElement().firstChild,goog.dom.a11y.setState(a,"activedescendent",b.id))};goog.ui.PaletteRenderer.prototype.selectCell=function(a,b,c){b&&goog.dom.classes.enable(b.parentNode,this.getCssClass()+"-cell-selected",c)};goog.ui.PaletteRenderer.prototype.getCssClass=function(){return goog.ui.PaletteRenderer.CSS_CLASS};goog.ui.SelectionModel=function(a){goog.events.EventTarget.call(this);this.items_=[];this.addItems(a)};goog.inherits(goog.ui.SelectionModel,goog.events.EventTarget);goog.ui.SelectionModel.prototype.selectedItem_=null;goog.ui.SelectionModel.prototype.selectionHandler_=null;goog.ui.SelectionModel.prototype.getSelectionHandler=function(){return this.selectionHandler_};goog.ui.SelectionModel.prototype.setSelectionHandler=function(a){this.selectionHandler_=a};
goog.ui.SelectionModel.prototype.getItemCount=function(){return this.items_.length};goog.ui.SelectionModel.prototype.indexOfItem=function(a){return a?goog.array.indexOf(this.items_,a):-1};goog.ui.SelectionModel.prototype.getFirst=function(){return this.items_[0]};goog.ui.SelectionModel.prototype.getLast=function(){return this.items_[this.items_.length-1]};goog.ui.SelectionModel.prototype.getItemAt=function(a){return this.items_[a]||null};
goog.ui.SelectionModel.prototype.addItems=function(a){a&&(goog.array.forEach(a,function(a){this.selectItem_(a,!1)},this),goog.array.extend(this.items_,a))};goog.ui.SelectionModel.prototype.addItem=function(a){this.addItemAt(a,this.getItemCount())};goog.ui.SelectionModel.prototype.addItemAt=function(a,b){a&&(this.selectItem_(a,!1),goog.array.insertAt(this.items_,a,b))};
goog.ui.SelectionModel.prototype.removeItem=function(a){a&&goog.array.remove(this.items_,a)&&a==this.selectedItem_&&(this.selectedItem_=null,this.dispatchEvent(goog.events.EventType.SELECT))};goog.ui.SelectionModel.prototype.removeItemAt=function(a){this.removeItem(this.getItemAt(a))};goog.ui.SelectionModel.prototype.getSelectedItem=function(){return this.selectedItem_};goog.ui.SelectionModel.prototype.getItems=function(){return goog.array.clone(this.items_)};
goog.ui.SelectionModel.prototype.setSelectedItem=function(a){a!=this.selectedItem_&&(this.selectItem_(this.selectedItem_,!1),this.selectedItem_=a,this.selectItem_(a,!0));this.dispatchEvent(goog.events.EventType.SELECT)};goog.ui.SelectionModel.prototype.getSelectedIndex=function(){return this.indexOfItem(this.selectedItem_)};goog.ui.SelectionModel.prototype.setSelectedIndex=function(a){this.setSelectedItem(this.getItemAt(a))};
goog.ui.SelectionModel.prototype.clear=function(){goog.array.clear(this.items_);this.selectedItem_=null};goog.ui.SelectionModel.prototype.disposeInternal=function(){goog.ui.SelectionModel.superClass_.disposeInternal.call(this);delete this.items_;this.selectedItem_=null};goog.ui.SelectionModel.prototype.selectItem_=function(a,b){a&&("function"==typeof this.selectionHandler_?this.selectionHandler_(a,b):"function"==typeof a.setSelected&&a.setSelected(b))};goog.ui.Palette=function(a,b,c){goog.ui.Control.call(this,a,b||goog.ui.PaletteRenderer.getInstance(),c)};goog.inherits(goog.ui.Palette,goog.ui.Control);goog.ui.Palette.prototype.size_=null;goog.ui.Palette.prototype.highlightedIndex_=-1;goog.ui.Palette.prototype.selectionModel_=null;goog.ui.Palette.prototype.disposeInternal=function(){goog.ui.Palette.superClass_.disposeInternal.call(this);this.selectionModel_&&(this.selectionModel_.dispose(),this.selectionModel_=null);this.size_=null};
goog.ui.Palette.prototype.setContentInternal=function(a){goog.ui.Palette.superClass_.setContentInternal.call(this,a);this.adjustSize_();this.selectionModel_?(this.selectionModel_.clear(),this.selectionModel_.addItems(a)):(this.selectionModel_=new goog.ui.SelectionModel(a),this.selectionModel_.setSelectionHandler(goog.bind(this.selectItem_,this)),this.getHandler().listen(this.selectionModel_,goog.events.EventType.SELECT,this.handleSelectionChange));this.highlightedIndex_=-1};
goog.ui.Palette.prototype.getCaption=function(){return null};goog.ui.Palette.prototype.setCaption=function(){};goog.ui.Palette.prototype.handleMouseOver=function(a){goog.ui.Palette.superClass_.handleMouseOver.call(this,a);var b=this.getRenderer().getContainingItem(this,a.target);(!b||!a.relatedTarget||!goog.dom.contains(b,a.relatedTarget))&&b!=this.getHighlightedItem()&&this.setHighlightedItem(b)};
goog.ui.Palette.prototype.handleMouseOut=function(a){goog.ui.Palette.superClass_.handleMouseOut.call(this,a);var b=this.getRenderer().getContainingItem(this,a.target);(!b||!a.relatedTarget||!goog.dom.contains(b,a.relatedTarget))&&b==this.getHighlightedItem()&&this.getRenderer().highlightCell(this,b,!1)};
goog.ui.Palette.prototype.handleMouseDown=function(a){goog.ui.Palette.superClass_.handleMouseDown.call(this,a);this.isActive()&&(a=this.getRenderer().getContainingItem(this,a.target),a!=this.getHighlightedItem()&&this.setHighlightedItem(a))};goog.ui.Palette.prototype.performActionInternal=function(){var a=this.getHighlightedItem();return a?(this.setSelectedItem(a),this.dispatchEvent(goog.ui.Component.EventType.ACTION)):!1};
goog.ui.Palette.prototype.handleKeyEvent=function(a){var b=this.getContent(),b=b?b.length:0,c=this.size_.width;if(0==b||!this.isEnabled())return!1;if(a.keyCode==goog.events.KeyCodes.ENTER||a.keyCode==goog.events.KeyCodes.SPACE)return this.performActionInternal(a);if(a.keyCode==goog.events.KeyCodes.HOME)return this.setHighlightedIndex(0),!0;if(a.keyCode==goog.events.KeyCodes.END)return this.setHighlightedIndex(b-1),!0;var d=0>this.highlightedIndex_?this.getSelectedIndex():this.highlightedIndex_;switch(a.keyCode){case goog.events.KeyCodes.LEFT:-1==
d&&(d=b);if(0<d)return this.setHighlightedIndex(d-1),a.preventDefault(),!0;break;case goog.events.KeyCodes.RIGHT:if(d<b-1)return this.setHighlightedIndex(d+1),a.preventDefault(),!0;break;case goog.events.KeyCodes.UP:-1==d&&(d=b+c-1);if(d>=c)return this.setHighlightedIndex(d-c),a.preventDefault(),!0;break;case goog.events.KeyCodes.DOWN:if(-1==d&&(d=-c),d<b-c)return this.setHighlightedIndex(d+c),a.preventDefault(),!0}return!1};goog.ui.Palette.prototype.handleSelectionChange=function(){};
goog.ui.Palette.prototype.getSize=function(){return this.size_};goog.ui.Palette.prototype.setSize=function(a,b){if(this.getElement())throw Error(goog.ui.Component.Error.ALREADY_RENDERED);this.size_=goog.isNumber(a)?new goog.math.Size(a,b):a;this.adjustSize_()};goog.ui.Palette.prototype.getHighlightedIndex=function(){return this.highlightedIndex_};goog.ui.Palette.prototype.getHighlightedItem=function(){var a=this.getContent();return a&&a[this.highlightedIndex_]};
goog.ui.Palette.prototype.setHighlightedIndex=function(a){a!=this.highlightedIndex_&&(this.highlightIndex_(this.highlightedIndex_,!1),this.highlightedIndex_=a,this.highlightIndex_(a,!0))};goog.ui.Palette.prototype.setHighlightedItem=function(a){var b=this.getContent();this.setHighlightedIndex(b?goog.array.indexOf(b,a):-1)};goog.ui.Palette.prototype.getSelectedIndex=function(){return this.selectionModel_?this.selectionModel_.getSelectedIndex():-1};
goog.ui.Palette.prototype.getSelectedItem=function(){return this.selectionModel_?this.selectionModel_.getSelectedItem():null};goog.ui.Palette.prototype.setSelectedIndex=function(a){this.selectionModel_&&this.selectionModel_.setSelectedIndex(a)};goog.ui.Palette.prototype.setSelectedItem=function(a){this.selectionModel_&&this.selectionModel_.setSelectedItem(a)};
goog.ui.Palette.prototype.highlightIndex_=function(a,b){if(this.getElement()){var c=this.getContent();c&&0<=a&&a<c.length&&this.getRenderer().highlightCell(this,c[a],b)}};goog.ui.Palette.prototype.selectItem_=function(a,b){this.getElement()&&this.getRenderer().selectCell(this,a,b)};
goog.ui.Palette.prototype.adjustSize_=function(){var a=this.getContent();if(a)if(this.size_&&this.size_.width){if(a=Math.ceil(a.length/this.size_.width),!goog.isNumber(this.size_.height)||this.size_.height<a)this.size_.height=a}else a=Math.ceil(Math.sqrt(a.length)),this.size_=new goog.math.Size(a,a);else this.size_=new goog.math.Size(0,0)};goog.ui.ColorPalette=function(a,b,c){this.colors_=a||[];goog.ui.Palette.call(this,null,b||goog.ui.PaletteRenderer.getInstance(),c);this.setColors(this.colors_)};goog.inherits(goog.ui.ColorPalette,goog.ui.Palette);goog.ui.ColorPalette.prototype.normalizedColors_=null;goog.ui.ColorPalette.prototype.getColors=function(){return this.colors_};goog.ui.ColorPalette.prototype.setColors=function(a){this.colors_=a;this.normalizedColors_=null;this.setContent(this.createColorNodes_())};
goog.ui.ColorPalette.prototype.getSelectedColor=function(){var a=this.getSelectedItem();return a?(a=goog.style.getStyle(a,"background-color"),goog.ui.ColorPalette.parseColor_(a)):null};goog.ui.ColorPalette.prototype.setSelectedColor=function(a){a=goog.ui.ColorPalette.parseColor_(a);this.normalizedColors_||(this.normalizedColors_=goog.array.map(this.colors_,function(a){return goog.ui.ColorPalette.parseColor_(a)}));this.setSelectedIndex(a?goog.array.indexOf(this.normalizedColors_,a):-1)};
goog.ui.ColorPalette.prototype.createColorNodes_=function(){return goog.array.map(this.colors_,function(a){var b=this.getDomHelper().createDom("div",{"class":this.getRenderer().getCssClass()+"-colorswatch",style:"background-color:"+a});b.title="#"==a.charAt(0)?"RGB ("+goog.color.hexToRgb(a).join(", ")+")":a;return b},this)};goog.ui.ColorPalette.parseColor_=function(a){if(a)try{return goog.color.parse(a).hex}catch(b){}return null};goog.positioning.MenuAnchoredPosition=function(a,b,c,d){goog.positioning.AnchoredViewportPosition.call(this,a,b,c||d);if(c||d)this.setLastResortOverflow(goog.positioning.Overflow.ADJUST_X_EXCEPT_OFFSCREEN|(d?goog.positioning.Overflow.RESIZE_HEIGHT:goog.positioning.Overflow.ADJUST_Y_EXCEPT_OFFSCREEN))};goog.inherits(goog.positioning.MenuAnchoredPosition,goog.positioning.AnchoredViewportPosition);goog.ui.MenuButton=function(a,b,c,d){goog.ui.Button.call(this,a,c||goog.ui.MenuButtonRenderer.getInstance(),d);this.setSupportedState(goog.ui.Component.State.OPENED,!0);b&&this.setMenu(b);this.menuMargin_=null;this.timer_=new goog.Timer(500);(goog.userAgent.product.IPHONE||goog.userAgent.product.IPAD)&&!goog.userAgent.isVersion("533.17.9")&&this.setFocusablePopupMenu(!0)};goog.inherits(goog.ui.MenuButton,goog.ui.Button);goog.ui.MenuButton.prototype.alignToStart_=!0;
goog.ui.MenuButton.prototype.scrollOnOverflow_=!1;goog.ui.MenuButton.prototype.isFocusablePopupMenu_=!1;goog.ui.MenuButton.prototype.renderMenuAsSibling_=!1;goog.ui.MenuButton.prototype.enterDocument=function(){goog.ui.MenuButton.superClass_.enterDocument.call(this);this.menu_&&this.attachMenuEventListeners_(this.menu_,!0);goog.dom.a11y.setState(this.getElement(),goog.dom.a11y.State.HASPOPUP,"true")};
goog.ui.MenuButton.prototype.exitDocument=function(){goog.ui.MenuButton.superClass_.exitDocument.call(this);if(this.menu_){this.setOpen(!1);this.menu_.exitDocument();this.attachMenuEventListeners_(this.menu_,!1);var a=this.menu_.getElement();a&&goog.dom.removeNode(a)}};goog.ui.MenuButton.prototype.disposeInternal=function(){goog.ui.MenuButton.superClass_.disposeInternal.call(this);this.menu_&&(this.menu_.dispose(),delete this.menu_);delete this.positionElement_;this.timer_.dispose()};
goog.ui.MenuButton.prototype.handleMouseDown=function(a){goog.ui.MenuButton.superClass_.handleMouseDown.call(this,a);this.isActive()&&(this.setOpen(!this.isOpen(),a),this.menu_&&this.menu_.setMouseButtonPressed(this.isOpen()))};goog.ui.MenuButton.prototype.handleMouseUp=function(a){goog.ui.MenuButton.superClass_.handleMouseUp.call(this,a);this.menu_&&!this.isActive()&&this.menu_.setMouseButtonPressed(!1)};goog.ui.MenuButton.prototype.performActionInternal=function(){this.setActive(!1);return!0};
goog.ui.MenuButton.prototype.handleDocumentMouseDown=function(a){this.menu_&&this.menu_.isVisible()&&!this.containsElement(a.target)&&this.setOpen(!1)};goog.ui.MenuButton.prototype.containsElement=function(a){return a&&goog.dom.contains(this.getElement(),a)||this.menu_&&this.menu_.containsElement(a)||!1};
goog.ui.MenuButton.prototype.handleKeyEventInternal=function(a){if(a.keyCode==goog.events.KeyCodes.SPACE){if(a.preventDefault(),a.type!=goog.events.EventType.KEYUP)return!1}else if(a.type!=goog.events.KeyHandler.EventType.KEY)return!1;if(this.menu_&&this.menu_.isVisible()){var b=this.menu_.handleKeyEvent(a);return a.keyCode==goog.events.KeyCodes.ESC?(this.setOpen(!1),!0):b}return a.keyCode==goog.events.KeyCodes.DOWN||a.keyCode==goog.events.KeyCodes.UP||a.keyCode==goog.events.KeyCodes.SPACE?(this.setOpen(!0),
!0):!1};goog.ui.MenuButton.prototype.handleMenuAction=function(){this.setOpen(!1)};goog.ui.MenuButton.prototype.handleMenuBlur=function(){this.isActive()||this.setOpen(!1)};goog.ui.MenuButton.prototype.handleBlur=function(a){this.isFocusablePopupMenu()||this.setOpen(!1);goog.ui.MenuButton.superClass_.handleBlur.call(this,a)};goog.ui.MenuButton.prototype.getMenu=function(){this.menu_||this.setMenu(new goog.ui.Menu(this.getDomHelper()));return this.menu_||null};
goog.ui.MenuButton.prototype.setMenu=function(a){var b=this.menu_;a!=b&&(b&&(this.setOpen(!1),this.isInDocument()&&this.attachMenuEventListeners_(b,!1),delete this.menu_),a&&(this.menu_=a,a.setParent(this),a.setVisible(!1),a.setAllowAutoFocus(this.isFocusablePopupMenu()),this.isInDocument()&&this.attachMenuEventListeners_(a,!0)));return b};goog.ui.MenuButton.prototype.setMenuPosition=function(a){this.menuPosition_=a};
goog.ui.MenuButton.prototype.setPositionElement=function(a){this.positionElement_=a;this.positionMenu()};goog.ui.MenuButton.prototype.setMenuMargin=function(a){this.menuMargin_=a};goog.ui.MenuButton.prototype.addItem=function(a){this.getMenu().addChild(a,!0)};goog.ui.MenuButton.prototype.addItemAt=function(a,b){this.getMenu().addChildAt(a,b,!0)};goog.ui.MenuButton.prototype.removeItem=function(a){(a=this.getMenu().removeChild(a,!0))&&a.dispose()};
goog.ui.MenuButton.prototype.removeItemAt=function(a){(a=this.getMenu().removeChildAt(a,!0))&&a.dispose()};goog.ui.MenuButton.prototype.getItemAt=function(a){return this.menu_?this.menu_.getChildAt(a):null};goog.ui.MenuButton.prototype.getItemCount=function(){return this.menu_?this.menu_.getChildCount():0};goog.ui.MenuButton.prototype.setVisible=function(a,b){var c=goog.ui.MenuButton.superClass_.setVisible.call(this,a,b);c&&!this.isVisible()&&this.setOpen(!1);return c};
goog.ui.MenuButton.prototype.setEnabled=function(a){goog.ui.MenuButton.superClass_.setEnabled.call(this,a);this.isEnabled()||this.setOpen(!1)};goog.ui.MenuButton.prototype.isAlignMenuToStart=function(){return this.alignToStart_};goog.ui.MenuButton.prototype.setAlignMenuToStart=function(a){this.alignToStart_=a};goog.ui.MenuButton.prototype.setScrollOnOverflow=function(a){this.scrollOnOverflow_=a};goog.ui.MenuButton.prototype.isScrollOnOverflow=function(){return this.scrollOnOverflow_};
goog.ui.MenuButton.prototype.isFocusablePopupMenu=function(){return this.isFocusablePopupMenu_};goog.ui.MenuButton.prototype.setFocusablePopupMenu=function(a){this.isFocusablePopupMenu_=a};goog.ui.MenuButton.prototype.setRenderMenuAsSibling=function(a){this.renderMenuAsSibling_=a};goog.ui.MenuButton.prototype.showMenu=function(){this.setOpen(!0)};goog.ui.MenuButton.prototype.hideMenu=function(){this.setOpen(!1)};
goog.ui.MenuButton.prototype.setOpen=function(a,b){goog.ui.MenuButton.superClass_.setOpen.call(this,a);if(this.menu_&&this.hasState(goog.ui.Component.State.OPENED)==a){if(a)this.menu_.isInDocument()||(this.renderMenuAsSibling_?this.menu_.render(this.getElement().parentNode):this.menu_.render()),this.viewportBox_=goog.style.getVisibleRectForElement(this.getElement()),this.buttonRect_=goog.style.getBounds(this.getElement()),this.positionMenu(),this.menu_.setHighlightedIndex(-1);else if(this.setActive(!1),
this.menu_.setMouseButtonPressed(!1),this.getElement()&&goog.dom.a11y.setState(this.getElement(),goog.dom.a11y.State.ACTIVEDESCENDANT,""),goog.isDefAndNotNull(this.originalSize_)){this.originalSize_=void 0;var c=this.menu_.getElement();c&&goog.style.setSize(c,"","")}this.menu_.setVisible(a,!1,b);this.isDisposed()||this.attachPopupListeners_(a)}};
goog.ui.MenuButton.prototype.positionMenu=function(){if(this.menu_.isInDocument()){var a=this.positionElement_||this.getElement(),b=this.menuPosition_;b||(b=this.isAlignMenuToStart()?goog.positioning.Corner.BOTTOM_START:goog.positioning.Corner.BOTTOM_END,b=new goog.positioning.MenuAnchoredPosition(a,b,!this.scrollOnOverflow_,this.scrollOnOverflow_));a=this.menu_.getElement();this.menu_.isVisible()||(a.style.visibility="hidden",goog.style.showElement(a,!0));!this.originalSize_&&this.scrollOnOverflow_&&
(this.originalSize_=goog.style.getSize(a));var c=goog.positioning.flipCornerVertical(b.corner);b.reposition(a,c,this.menuMargin_,this.originalSize_);this.menu_.isVisible()||(goog.style.showElement(a,!1),a.style.visibility="visible")}};
goog.ui.MenuButton.prototype.onTick_=function(){var a=goog.style.getBounds(this.getElement()),b=goog.style.getVisibleRectForElement(this.getElement());if(!goog.math.Rect.equals(this.buttonRect_,a)||!goog.math.Box.equals(this.viewportBox_,b))this.buttonRect_=a,this.viewportBox_=b,this.positionMenu()};
goog.ui.MenuButton.prototype.attachMenuEventListeners_=function(a,b){var c=this.getHandler(),d=b?c.listen:c.unlisten;d.call(c,a,goog.ui.Component.EventType.ACTION,this.handleMenuAction);d.call(c,a,goog.ui.Component.EventType.HIGHLIGHT,this.handleHighlightItem);d.call(c,a,goog.ui.Component.EventType.UNHIGHLIGHT,this.handleUnHighlightItem)};goog.ui.MenuButton.prototype.handleHighlightItem=function(a){goog.dom.a11y.setState(this.getElement(),goog.dom.a11y.State.ACTIVEDESCENDANT,a.target.getElement().id)};
goog.ui.MenuButton.prototype.handleUnHighlightItem=function(){this.menu_.getHighlighted()||goog.dom.a11y.setState(this.getElement(),goog.dom.a11y.State.ACTIVEDESCENDANT,"")};
goog.ui.MenuButton.prototype.attachPopupListeners_=function(a){var b=this.getHandler(),c=a?b.listen:b.unlisten;c.call(b,this.getDomHelper().getDocument(),goog.events.EventType.MOUSEDOWN,this.handleDocumentMouseDown,!0);this.isFocusablePopupMenu()&&c.call(b,this.menu_,goog.ui.Component.EventType.BLUR,this.handleMenuBlur);c.call(b,this.timer_,goog.Timer.TICK,this.onTick_);a?this.timer_.start():this.timer_.stop()};goog.ui.registry.setDecoratorByClassName(goog.ui.MenuButtonRenderer.CSS_CLASS,function(){return new goog.ui.MenuButton(null)});goog.ui.ColorMenuButton=function(a,b,c,d){goog.ui.MenuButton.call(this,a,b,c||goog.ui.ColorMenuButtonRenderer.getInstance(),d)};goog.inherits(goog.ui.ColorMenuButton,goog.ui.MenuButton);goog.ui.ColorMenuButton.PALETTES={GRAYSCALE:"#000,#444,#666,#999,#ccc,#eee,#f3f3f3,#fff".split(","),SOLID:"#f00,#f90,#ff0,#0f0,#0ff,#00f,#90f,#f0f".split(","),PASTEL:"#f4cccc,#fce5cd,#fff2cc,#d9ead3,#d0e0e3,#cfe2f3,#d9d2e9,#ead1dc,#ea9999,#f9cb9c,#ffe599,#b6d7a8,#a2c4c9,#9fc5e8,#b4a7d6,#d5a6bd,#e06666,#f6b26b,#ffd966,#93c47d,#76a5af,#6fa8dc,#8e7cc3,#c27ba0,#cc0000,#e69138,#f1c232,#6aa84f,#45818e,#3d85c6,#674ea7,#a64d79,#990000,#b45f06,#bf9000,#38761d,#134f5c,#0b5394,#351c75,#741b47,#660000,#783f04,#7f6000,#274e13,#0c343d,#073763,#20124d,#4c1130".split(",")};
goog.ui.ColorMenuButton.NO_COLOR="none";goog.ui.ColorMenuButton.newColorMenu=function(a,b){var c=new goog.ui.Menu(b);a&&goog.array.forEach(a,function(a){c.addChild(a,!0)});goog.object.forEach(goog.ui.ColorMenuButton.PALETTES,function(a){a=new goog.ui.ColorPalette(a,null,b);a.setSize(8);c.addChild(a,!0)});return c};goog.ui.ColorMenuButton.prototype.getSelectedColor=function(){return this.getValue()};goog.ui.ColorMenuButton.prototype.setSelectedColor=function(a){this.setValue(a)};
goog.ui.ColorMenuButton.prototype.setValue=function(a){for(var b=0,c;c=this.getItemAt(b);b++)"function"==typeof c.setSelectedColor&&c.setSelectedColor(a);goog.ui.ColorMenuButton.superClass_.setValue.call(this,a)};
goog.ui.ColorMenuButton.prototype.handleMenuAction=function(a){"function"==typeof a.target.getSelectedColor?this.setValue(a.target.getSelectedColor()):a.target.getValue()==goog.ui.ColorMenuButton.NO_COLOR&&this.setValue(null);goog.ui.ColorMenuButton.superClass_.handleMenuAction.call(this,a);a.stopPropagation();this.dispatchEvent(goog.ui.Component.EventType.ACTION)};
goog.ui.ColorMenuButton.prototype.setOpen=function(a,b){a&&0==this.getItemCount()&&(this.setMenu(goog.ui.ColorMenuButton.newColorMenu(null,this.getDomHelper())),this.setValue(this.getValue()));goog.ui.ColorMenuButton.superClass_.setOpen.call(this,a,b)};goog.ui.registry.setDecoratorByClassName(goog.ui.ColorMenuButtonRenderer.CSS_CLASS,function(){return new goog.ui.ColorMenuButton(null)});goog.ui.ToolbarMenuButtonRenderer=function(){goog.ui.MenuButtonRenderer.call(this)};goog.inherits(goog.ui.ToolbarMenuButtonRenderer,goog.ui.MenuButtonRenderer);goog.addSingletonGetter(goog.ui.ToolbarMenuButtonRenderer);goog.ui.ToolbarMenuButtonRenderer.CSS_CLASS="goog-toolbar-menu-button";goog.ui.ToolbarMenuButtonRenderer.prototype.getCssClass=function(){return goog.ui.ToolbarMenuButtonRenderer.CSS_CLASS};goog.ui.ToolbarColorMenuButtonRenderer=function(){goog.ui.ToolbarMenuButtonRenderer.call(this)};goog.inherits(goog.ui.ToolbarColorMenuButtonRenderer,goog.ui.ToolbarMenuButtonRenderer);goog.addSingletonGetter(goog.ui.ToolbarColorMenuButtonRenderer);goog.ui.ToolbarColorMenuButtonRenderer.prototype.createCaption=function(a,b){return goog.ui.MenuButtonRenderer.wrapCaption(goog.ui.ColorMenuButtonRenderer.wrapCaption(a,b),this.getCssClass(),b)};
goog.ui.ToolbarColorMenuButtonRenderer.prototype.setValue=function(a,b){a&&goog.ui.ColorMenuButtonRenderer.setCaptionValue(this.getContentElement(a),b)};goog.ui.ToolbarColorMenuButtonRenderer.prototype.initializeDom=function(a){this.setValue(a.getElement(),a.getValue());goog.dom.classes.add(a.getElement(),"goog-toolbar-color-menu-button");goog.ui.ToolbarColorMenuButtonRenderer.superClass_.initializeDom.call(this,a)};goog.ui.ToolbarColorMenuButton=function(a,b,c,d){goog.ui.ColorMenuButton.call(this,a,b,c||goog.ui.ToolbarColorMenuButtonRenderer.getInstance(),d)};goog.inherits(goog.ui.ToolbarColorMenuButton,goog.ui.ColorMenuButton);goog.ui.registry.setDecoratorByClassName("goog-toolbar-color-menu-button",function(){return new goog.ui.ToolbarColorMenuButton(null)});goog.ui.ToolbarMenuButton=function(a,b,c,d){goog.ui.MenuButton.call(this,a,b,c||goog.ui.ToolbarMenuButtonRenderer.getInstance(),d)};goog.inherits(goog.ui.ToolbarMenuButton,goog.ui.MenuButton);goog.ui.registry.setDecoratorByClassName(goog.ui.ToolbarMenuButtonRenderer.CSS_CLASS,function(){return new goog.ui.ToolbarMenuButton(null)});goog.ui.Select=function(a,b,c,d){goog.ui.MenuButton.call(this,a,b,c,d);this.setDefaultCaption(a);this.setPreferredAriaRole(goog.dom.a11y.Role.LISTBOX)};goog.inherits(goog.ui.Select,goog.ui.MenuButton);goog.ui.Select.prototype.selectionModel_=null;goog.ui.Select.prototype.defaultCaption_=null;
goog.ui.Select.prototype.enterDocument=function(){goog.ui.Select.superClass_.enterDocument.call(this);this.updateCaption();this.listenToSelectionModelEvents_();goog.dom.a11y.setState(this.getElement(),goog.dom.a11y.State.HASPOPUP,"false")};goog.ui.Select.prototype.decorateInternal=function(a){goog.ui.Select.superClass_.decorateInternal.call(this,a);(a=this.getCaption())?this.setDefaultCaption(a):this.setSelectedIndex(0)};
goog.ui.Select.prototype.disposeInternal=function(){goog.ui.Select.superClass_.disposeInternal.call(this);this.selectionModel_&&(this.selectionModel_.dispose(),this.selectionModel_=null);this.defaultCaption_=null};goog.ui.Select.prototype.handleMenuAction=function(a){this.setSelectedItem(a.target);goog.ui.Select.superClass_.handleMenuAction.call(this,a);a.stopPropagation();this.dispatchEvent(goog.ui.Component.EventType.ACTION)};
goog.ui.Select.prototype.handleSelectionChange=function(){var a=this.getSelectedItem();goog.ui.Select.superClass_.setValue.call(this,a&&a.getValue());this.updateCaption()};goog.ui.Select.prototype.setMenu=function(a){var b=goog.ui.Select.superClass_.setMenu.call(this,a);a!=b&&(this.selectionModel_&&this.selectionModel_.clear(),a&&(this.selectionModel_?a.forEachChild(function(a){this.setCorrectAriaRole_(a);this.selectionModel_.addItem(a)},this):this.createSelectionModel_(a)));return b};
goog.ui.Select.prototype.getDefaultCaption=function(){return this.defaultCaption_};goog.ui.Select.prototype.setDefaultCaption=function(a){this.defaultCaption_=a;this.updateCaption()};goog.ui.Select.prototype.addItem=function(a){this.setCorrectAriaRole_(a);goog.ui.Select.superClass_.addItem.call(this,a);this.selectionModel_?this.selectionModel_.addItem(a):this.createSelectionModel_(this.getMenu())};
goog.ui.Select.prototype.addItemAt=function(a,b){this.setCorrectAriaRole_(a);goog.ui.Select.superClass_.addItemAt.call(this,a,b);this.selectionModel_?this.selectionModel_.addItemAt(a,b):this.createSelectionModel_(this.getMenu())};goog.ui.Select.prototype.removeItem=function(a){goog.ui.Select.superClass_.removeItem.call(this,a);this.selectionModel_&&this.selectionModel_.removeItem(a)};
goog.ui.Select.prototype.removeItemAt=function(a){goog.ui.Select.superClass_.removeItemAt.call(this,a);this.selectionModel_&&this.selectionModel_.removeItemAt(a)};goog.ui.Select.prototype.setSelectedItem=function(a){if(this.selectionModel_){var b=this.getSelectedItem();this.selectionModel_.setSelectedItem(a);a!=b&&this.dispatchEvent(goog.ui.Component.EventType.CHANGE)}};goog.ui.Select.prototype.setSelectedIndex=function(a){this.selectionModel_&&this.setSelectedItem(this.selectionModel_.getItemAt(a))};
goog.ui.Select.prototype.setValue=function(a){if(goog.isDefAndNotNull(a)&&this.selectionModel_)for(var b=0,c;c=this.selectionModel_.getItemAt(b);b++)if(c&&"function"==typeof c.getValue&&c.getValue()==a){this.setSelectedItem(c);return}this.setSelectedItem(null)};goog.ui.Select.prototype.getSelectedItem=function(){return this.selectionModel_?this.selectionModel_.getSelectedItem():null};
goog.ui.Select.prototype.getSelectedIndex=function(){return this.selectionModel_?this.selectionModel_.getSelectedIndex():-1};goog.ui.Select.prototype.getSelectionModel=function(){return this.selectionModel_};goog.ui.Select.prototype.createSelectionModel_=function(a){this.selectionModel_=new goog.ui.SelectionModel;a&&a.forEachChild(function(a){this.setCorrectAriaRole_(a);this.selectionModel_.addItem(a)},this);this.listenToSelectionModelEvents_()};
goog.ui.Select.prototype.listenToSelectionModelEvents_=function(){this.selectionModel_&&this.getHandler().listen(this.selectionModel_,goog.events.EventType.SELECT,this.handleSelectionChange)};goog.ui.Select.prototype.updateCaption=function(){var a=this.getSelectedItem();this.setContent(a?a.getCaption():this.defaultCaption_)};goog.ui.Select.prototype.setCorrectAriaRole_=function(a){a.setPreferredAriaRole(a instanceof goog.ui.MenuItem?goog.dom.a11y.Role.OPTION:goog.dom.a11y.Role.SEPARATOR)};
goog.ui.Select.prototype.setOpen=function(a,b){goog.ui.Select.superClass_.setOpen.call(this,a,b);this.isOpen()&&this.getMenu().setHighlightedIndex(this.getSelectedIndex())};goog.ui.registry.setDecoratorByClassName("goog-select",function(){return new goog.ui.Select(null)});goog.ui.ToolbarSelect=function(a,b,c,d){goog.ui.Select.call(this,a,b,c||goog.ui.ToolbarMenuButtonRenderer.getInstance(),d)};goog.inherits(goog.ui.ToolbarSelect,goog.ui.Select);goog.ui.registry.setDecoratorByClassName("goog-toolbar-select",function(){return new goog.ui.ToolbarSelect(null)});goog.ui.editor={};goog.ui.editor.ToolbarFactory={};goog.ui.editor.ToolbarFactory.getPrimaryFont=function(a){var b=a.indexOf(","),a=(-1!=b?a.substring(0,b):a).toLowerCase();return goog.string.stripQuotes(a,"\"'")};goog.ui.editor.ToolbarFactory.addFonts=function(a,b){goog.array.forEach(b,function(b){goog.ui.editor.ToolbarFactory.addFont(a,b.caption,b.value)})};
goog.ui.editor.ToolbarFactory.addFont=function(a,b,c){var d=goog.ui.editor.ToolbarFactory.getPrimaryFont(c),b=new goog.ui.Option(b,c,a.getDomHelper());b.setId(d);a.addItem(b);b.getContentElement().style.fontFamily=c};goog.ui.editor.ToolbarFactory.addFontSizes=function(a,b){goog.array.forEach(b,function(b){goog.ui.editor.ToolbarFactory.addFontSize(a,b.caption,b.value)})};
goog.ui.editor.ToolbarFactory.addFontSize=function(a,b,c){b=new goog.ui.Option(b,c,a.getDomHelper());a.addItem(b);a=b.getContentElement();a.style.fontSize=goog.ui.editor.ToolbarFactory.getPxFromLegacySize(c)+"px";a.firstChild.style.height="1.1em"};goog.ui.editor.ToolbarFactory.getPxFromLegacySize=function(a){return goog.ui.editor.ToolbarFactory.LEGACY_SIZE_TO_PX_MAP_[a]||10};
goog.ui.editor.ToolbarFactory.getLegacySizeFromPx=function(a){return goog.array.lastIndexOf(goog.ui.editor.ToolbarFactory.LEGACY_SIZE_TO_PX_MAP_,a)};goog.ui.editor.ToolbarFactory.LEGACY_SIZE_TO_PX_MAP_=[10,10,13,16,18,24,32,48];goog.ui.editor.ToolbarFactory.addFormatOptions=function(a,b){goog.array.forEach(b,function(b){goog.ui.editor.ToolbarFactory.addFormatOption(a,b.caption,b.command)})};
goog.ui.editor.ToolbarFactory.addFormatOption=function(a,b,c){var d=a.getDomHelper(),b=new goog.ui.Option(d.createDom(goog.dom.TagName.DIV,null,b),c,d);b.setId(c);a.addItem(b)};
goog.ui.editor.ToolbarFactory.makeToolbar=function(a,b,c){var d=goog.dom.getDomHelper(b),d=new goog.ui.Toolbar(goog.ui.ToolbarRenderer.getInstance(),goog.ui.Container.Orientation.HORIZONTAL,d),c=c||goog.style.isRightToLeft(b);d.setRightToLeft(c);d.setFocusable(!1);for(var e=0,f;f=a[e];e++)f.setSupportedState(goog.ui.Component.State.FOCUSED,!1),f.setRightToLeft(c),d.addChild(f,!0);d.render(b);return d};
goog.ui.editor.ToolbarFactory.makeButton=function(a,b,c,d,e,f){c=new goog.ui.ToolbarButton(goog.ui.editor.ToolbarFactory.createContent_(c,d,f),e,f);c.setId(a);c.setTooltip(b);return c};goog.ui.editor.ToolbarFactory.makeToggleButton=function(a,b,c,d,e,f){a=goog.ui.editor.ToolbarFactory.makeButton(a,b,c,d,e,f);a.setSupportedState(goog.ui.Component.State.CHECKED,!0);return a};
goog.ui.editor.ToolbarFactory.makeMenuButton=function(a,b,c,d,e,f){c=new goog.ui.ToolbarMenuButton(goog.ui.editor.ToolbarFactory.createContent_(c,d,f),null,e,f);c.setId(a);c.setTooltip(b);return c};goog.ui.editor.ToolbarFactory.makeSelectButton=function(a,b,c,d,e,f){e=new goog.ui.ToolbarSelect(null,null,e,f);d&&goog.array.forEach(d.split(/\s+/),e.addClassName,e);e.addClassName("goog-toolbar-select");e.setDefaultCaption(c);e.setId(a);e.setTooltip(b);return e};
goog.ui.editor.ToolbarFactory.makeColorMenuButton=function(a,b,c,d,e,f){c=new goog.ui.ToolbarColorMenuButton(goog.ui.editor.ToolbarFactory.createContent_(c,d,f),null,e,f);c.setId(a);c.setTooltip(b);return c};goog.ui.editor.ToolbarFactory.createContent_=function(a,b,c){if((!a||""==a)&&goog.userAgent.GECKO&&!goog.userAgent.isVersion("1.9a"))a=goog.string.Unicode.NBSP;return(c||goog.dom.getDomHelper()).createDom(goog.dom.TagName.DIV,b?{"class":b}:null,a)};goog.ui.editor.messages={};goog.ui.editor.messages.MSG_LINK_CAPTION=goog.getMsg("Link");goog.ui.editor.messages.MSG_EDIT_LINK=goog.getMsg("Edit Link");goog.ui.editor.messages.MSG_TEXT_TO_DISPLAY=goog.getMsg("Text to display:");goog.ui.editor.messages.MSG_LINK_TO=goog.getMsg("Link to:");goog.ui.editor.messages.MSG_ON_THE_WEB=goog.getMsg("Web address");goog.ui.editor.messages.MSG_ON_THE_WEB_TIP=goog.getMsg("Link to a page or file somewhere else on the web");
goog.ui.editor.messages.MSG_TEST_THIS_LINK=goog.getMsg("Test this link");
goog.ui.editor.messages.MSG_TR_LINK_EXPLANATION=goog.getMsg("{$startBold}Not sure what to put in the box?{$endBold} First, find the page on the web that you want to link to. (A {$searchEngineLink}search engine{$endLink} might be useful.) Then, copy the web address from the box in your browser's address bar, and paste it into the box above.",{startBold:"<b>",endBold:"</b>",searchEngineLink:"<a href='http://www.google.com/' target='_new'>",endLink:"</a>"});goog.ui.editor.messages.MSG_WHAT_URL=goog.getMsg("To what URL should this link go?");
goog.ui.editor.messages.MSG_EMAIL_ADDRESS=goog.getMsg("Email address");goog.ui.editor.messages.MSG_EMAIL_ADDRESS_TIP=goog.getMsg("Link to an email address");goog.ui.editor.messages.MSG_INVALID_EMAIL=goog.getMsg("Invalid email address");goog.ui.editor.messages.MSG_WHAT_EMAIL=goog.getMsg("To what email address should this link?");
goog.ui.editor.messages.MSG_EMAIL_EXPLANATION=goog.getMsg("{$preb}Be careful.{$postb} Remember that any time you include an email address on a web page, nasty spammers can find it too.",{preb:"<b>",postb:"</b>"});goog.ui.editor.messages.MSG_OPEN_IN_NEW_WINDOW=goog.getMsg("Open this link in a new window");goog.ui.editor.messages.MSG_IMAGE_CAPTION=goog.getMsg("Image");goog.ui.editor.DefaultToolbar={};goog.ui.editor.DefaultToolbar.MSG_FONT_NORMAL=goog.getMsg("Normal");goog.ui.editor.DefaultToolbar.MSG_FONT_NORMAL_SERIF=goog.getMsg("Normal / serif");
goog.ui.editor.DefaultToolbar.FONTS_=[{caption:goog.ui.editor.DefaultToolbar.MSG_FONT_NORMAL,value:"arial,sans-serif"},{caption:goog.ui.editor.DefaultToolbar.MSG_FONT_NORMAL_SERIF,value:"times new roman,serif"},{caption:"Courier New",value:"courier new,monospace"},{caption:"Georgia",value:"georgia,serif"},{caption:"Trebuchet",value:"trebuchet ms,sans-serif"},{caption:"Verdana",value:"verdana,sans-serif"}];
goog.ui.editor.DefaultToolbar.I18N_FONTS_={ja:[{caption:"\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af",value:"ms pgothic,sans-serif"},{caption:"\uff2d\uff33 \uff30\u660e\u671d",value:"ms pmincho,serif"},{caption:"\uff2d\uff33 \u30b4\u30b7\u30c3\u30af",value:"ms gothic,monospace"}],ko:[{caption:"\uad74\ub9bc",value:"gulim,sans-serif"},{caption:"\ubc14\ud0d5",value:"batang,serif"},{caption:"\uad74\ub9bc\uccb4",value:"gulimche,monospace"}],"zh-tw":[{caption:"\u65b0\u7d30\u660e\u9ad4",value:"pmingliu,serif"},
{caption:"\u7d30\u660e\u9ad4",value:"mingliu,serif"}],"zh-cn":[{caption:"\u5b8b\u4f53",value:"simsun,serif"},{caption:"\u9ed1\u4f53",value:"simhei,sans-serif"},{caption:"MS Song",value:"ms song,monospace"}]};goog.ui.editor.DefaultToolbar.locale_="en-us";goog.ui.editor.DefaultToolbar.setLocale=function(a){goog.ui.editor.DefaultToolbar.locale_=a};
goog.ui.editor.DefaultToolbar.addDefaultFonts=function(a){var b=goog.ui.editor.DefaultToolbar.locale_.replace(/_/,"-").toLowerCase(),c=[];b in goog.ui.editor.DefaultToolbar.I18N_FONTS_&&(c=goog.ui.editor.DefaultToolbar.I18N_FONTS_[b]);c.length&&goog.ui.editor.ToolbarFactory.addFonts(a,c);goog.ui.editor.ToolbarFactory.addFonts(a,goog.ui.editor.DefaultToolbar.FONTS_)};goog.ui.editor.DefaultToolbar.MSG_FONT_SIZE_SMALL=goog.getMsg("Small");goog.ui.editor.DefaultToolbar.MSG_FONT_SIZE_NORMAL=goog.getMsg("Normal");
goog.ui.editor.DefaultToolbar.MSG_FONT_SIZE_LARGE=goog.getMsg("Large");goog.ui.editor.DefaultToolbar.MSG_FONT_SIZE_HUGE=goog.getMsg("Huge");goog.ui.editor.DefaultToolbar.FONT_SIZES_=[{caption:goog.ui.editor.DefaultToolbar.MSG_FONT_SIZE_SMALL,value:1},{caption:goog.ui.editor.DefaultToolbar.MSG_FONT_SIZE_NORMAL,value:2},{caption:goog.ui.editor.DefaultToolbar.MSG_FONT_SIZE_LARGE,value:4},{caption:goog.ui.editor.DefaultToolbar.MSG_FONT_SIZE_HUGE,value:6}];
goog.ui.editor.DefaultToolbar.addDefaultFontSizes=function(a){goog.ui.editor.ToolbarFactory.addFontSizes(a,goog.ui.editor.DefaultToolbar.FONT_SIZES_)};goog.ui.editor.DefaultToolbar.MSG_FORMAT_HEADING=goog.getMsg("Heading");goog.ui.editor.DefaultToolbar.MSG_FORMAT_SUBHEADING=goog.getMsg("Subheading");goog.ui.editor.DefaultToolbar.MSG_FORMAT_MINOR_HEADING=goog.getMsg("Minor heading");goog.ui.editor.DefaultToolbar.MSG_FORMAT_NORMAL=goog.getMsg("Normal");
goog.ui.editor.DefaultToolbar.FORMAT_OPTIONS_=[{caption:goog.ui.editor.DefaultToolbar.MSG_FORMAT_HEADING,command:goog.dom.TagName.H2},{caption:goog.ui.editor.DefaultToolbar.MSG_FORMAT_SUBHEADING,command:goog.dom.TagName.H3},{caption:goog.ui.editor.DefaultToolbar.MSG_FORMAT_MINOR_HEADING,command:goog.dom.TagName.H4},{caption:goog.ui.editor.DefaultToolbar.MSG_FORMAT_NORMAL,command:goog.dom.TagName.P}];
goog.ui.editor.DefaultToolbar.addDefaultFormatOptions=function(a){goog.ui.editor.ToolbarFactory.addFormatOptions(a,goog.ui.editor.DefaultToolbar.FORMAT_OPTIONS_)};goog.ui.editor.DefaultToolbar.makeDefaultToolbar=function(a,b){var c=b||goog.style.isRightToLeft(a)?goog.ui.editor.DefaultToolbar.DEFAULT_BUTTONS_RTL:goog.ui.editor.DefaultToolbar.DEFAULT_BUTTONS;return goog.ui.editor.DefaultToolbar.makeToolbar(c,a,b)};
goog.ui.editor.DefaultToolbar.makeToolbar=function(a,b,c){for(var d=goog.dom.getDomHelper(b),e=[],f=0,g;g=a[f];f++)goog.isString(g)&&(g=goog.ui.editor.DefaultToolbar.makeBuiltInToolbarButton(g,d)),g&&e.push(g);return goog.ui.editor.ToolbarFactory.makeToolbar(e,b,c)};
goog.ui.editor.DefaultToolbar.makeBuiltInToolbarButton=function(a,b){var c,d=goog.ui.editor.DefaultToolbar.buttons_[a];if(d){c=d.factory||goog.ui.editor.ToolbarFactory.makeToggleButton;var e=d.command,f=d.tooltip,g=d.caption,h=d.classes,i=b||goog.dom.getDomHelper();c=c(e,f,g,h,null,i);d.queryable&&(c.queryable=!0)}return c};
goog.ui.editor.DefaultToolbar.DEFAULT_BUTTONS=[goog.editor.Command.IMAGE,goog.editor.Command.LINK,goog.editor.Command.BOLD,goog.editor.Command.ITALIC,goog.editor.Command.UNORDERED_LIST,goog.editor.Command.FONT_COLOR,goog.editor.Command.FONT_FACE,goog.editor.Command.FONT_SIZE,goog.editor.Command.JUSTIFY_LEFT,goog.editor.Command.JUSTIFY_CENTER,goog.editor.Command.JUSTIFY_RIGHT,goog.editor.Command.EDIT_HTML];
goog.ui.editor.DefaultToolbar.DEFAULT_BUTTONS_RTL=[goog.editor.Command.IMAGE,goog.editor.Command.LINK,goog.editor.Command.BOLD,goog.editor.Command.ITALIC,goog.editor.Command.UNORDERED_LIST,goog.editor.Command.FONT_COLOR,goog.editor.Command.FONT_FACE,goog.editor.Command.FONT_SIZE,goog.editor.Command.JUSTIFY_RIGHT,goog.editor.Command.JUSTIFY_CENTER,goog.editor.Command.JUSTIFY_LEFT,goog.editor.Command.DIR_RTL,goog.editor.Command.DIR_LTR,goog.editor.Command.EDIT_HTML];
goog.ui.editor.DefaultToolbar.rtlButtonFactory_=function(a,b,c,d,e,f){var g=goog.ui.editor.ToolbarFactory.makeToggleButton(a,b,c,d,e,f);g.updateFromValue=function(a){a=!!a;goog.dom.classes.enable(g.getParent().getElement(),"tr-rtl-mode",a);g.setChecked(a)};return g};goog.ui.editor.DefaultToolbar.undoRedoButtonFactory_=function(a,b,c,d,e,f){var g=goog.ui.editor.ToolbarFactory.makeButton(a,b,c,d,e,f);g.updateFromValue=function(a){g.setEnabled(a)};return g};
goog.ui.editor.DefaultToolbar.fontFaceFactory_=function(a,b,c,d,e,f){var g=goog.ui.editor.ToolbarFactory.makeSelectButton(a,b,c,d,e,f);goog.ui.editor.DefaultToolbar.addDefaultFonts(g);g.setDefaultCaption(goog.ui.editor.DefaultToolbar.MSG_FONT_NORMAL);goog.dom.classes.add(g.getMenu().getContentElement(),"goog-menu-noaccel");g.updateFromValue=function(a){var b=null;a&&0<a.length&&(b=g.getMenu().getChild(goog.ui.editor.ToolbarFactory.getPrimaryFont(a)));a=g.getSelectedItem();b!=a&&g.setSelectedItem(b)};
return g};
goog.ui.editor.DefaultToolbar.fontSizeFactory_=function(a,b,c,d,e,f){var g=goog.ui.editor.ToolbarFactory.makeSelectButton(a,b,c,d,e,f);goog.ui.editor.DefaultToolbar.addDefaultFontSizes(g);g.setDefaultCaption(goog.ui.editor.DefaultToolbar.MSG_FONT_SIZE_NORMAL);goog.dom.classes.add(g.getMenu().getContentElement(),"goog-menu-noaccel");g.updateFromValue=function(a){goog.isString(a)&&"px"==goog.style.getLengthUnits(a)&&(a=goog.ui.editor.ToolbarFactory.getLegacySizeFromPx(parseInt(a,10)));a=0<a?a:null;
a!=g.getValue()&&g.setValue(a)};return g};goog.ui.editor.DefaultToolbar.colorUpdateFromValue_=function(a,b){var c=b;try{if(goog.userAgent.IE)var d="000000"+c.toString(16),e=d.substr(d.length-6,6),c=(new goog.string.StringBuffer("#",e.substring(4,6),e.substring(2,4),e.substring(0,2))).toString();c!=a.getValue()&&a.setValue(c)}catch(f){}};
goog.ui.editor.DefaultToolbar.fontColorFactory_=function(a,b,c,d,e,f){a=goog.ui.editor.ToolbarFactory.makeColorMenuButton(a,b,c,d,e,f);a.setSelectedColor("#000");a.updateFromValue=goog.partial(goog.ui.editor.DefaultToolbar.colorUpdateFromValue_,a);return a};
goog.ui.editor.DefaultToolbar.backgroundColorFactory_=function(a,b,c,d,e,f){a=goog.ui.editor.ToolbarFactory.makeColorMenuButton(a,b,c,d,e,f);a.setSelectedColor("#FFF");a.updateFromValue=goog.partial(goog.ui.editor.DefaultToolbar.colorUpdateFromValue_,a);return a};
goog.ui.editor.DefaultToolbar.formatBlockFactory_=function(a,b,c,d,e,f){var g=goog.ui.editor.ToolbarFactory.makeSelectButton(a,b,c,d,e,f);goog.ui.editor.DefaultToolbar.addDefaultFormatOptions(g);g.setDefaultCaption(goog.ui.editor.DefaultToolbar.MSG_FORMAT_NORMAL);goog.dom.classes.add(g.getMenu().getContentElement(),"goog-menu-noaccel");g.updateFromValue=function(a){a=a&&0<a.length?a:null;a!=g.getValue()&&g.setValue(a)};return g};goog.ui.editor.DefaultToolbar.MSG_FORMAT_BLOCK_TITLE=goog.getMsg("Format");
goog.ui.editor.DefaultToolbar.MSG_FORMAT_BLOCK_CAPTION=goog.getMsg("Format");goog.ui.editor.DefaultToolbar.MSG_UNDO_TITLE=goog.getMsg("Undo");goog.ui.editor.DefaultToolbar.MSG_REDO_TITLE=goog.getMsg("Redo");goog.ui.editor.DefaultToolbar.MSG_FONT_FACE_TITLE=goog.getMsg("Font");goog.ui.editor.DefaultToolbar.MSG_FONT_SIZE_TITLE=goog.getMsg("Font size");goog.ui.editor.DefaultToolbar.MSG_FONT_COLOR_TITLE=goog.getMsg("Text color");goog.ui.editor.DefaultToolbar.MSG_BOLD_TITLE=goog.getMsg("Bold");
goog.ui.editor.DefaultToolbar.MSG_ITALIC_TITLE=goog.getMsg("Italic");goog.ui.editor.DefaultToolbar.MSG_UNDERLINE_TITLE=goog.getMsg("Underline");goog.ui.editor.DefaultToolbar.MSG_BACKGROUND_COLOR_TITLE=goog.getMsg("Text background color");goog.ui.editor.DefaultToolbar.MSG_LINK_TITLE=goog.getMsg("Add or remove link");goog.ui.editor.DefaultToolbar.MSG_ORDERED_LIST_TITLE=goog.getMsg("Numbered list");goog.ui.editor.DefaultToolbar.MSG_UNORDERED_LIST_TITLE=goog.getMsg("Bullet list");
goog.ui.editor.DefaultToolbar.MSG_OUTDENT_TITLE=goog.getMsg("Decrease indent");goog.ui.editor.DefaultToolbar.MSG_INDENT_TITLE=goog.getMsg("Increase indent");goog.ui.editor.DefaultToolbar.MSG_ALIGN_LEFT_TITLE=goog.getMsg("Align left");goog.ui.editor.DefaultToolbar.MSG_ALIGN_CENTER_TITLE=goog.getMsg("Align center");goog.ui.editor.DefaultToolbar.MSG_ALIGN_RIGHT_TITLE=goog.getMsg("Align right");goog.ui.editor.DefaultToolbar.MSG_JUSTIFY_TITLE=goog.getMsg("Justify");
goog.ui.editor.DefaultToolbar.MSG_REMOVE_FORMAT_TITLE=goog.getMsg("Remove formatting");goog.ui.editor.DefaultToolbar.MSG_IMAGE_TITLE=goog.getMsg("Insert image");goog.ui.editor.DefaultToolbar.MSG_STRIKE_THROUGH_TITLE=goog.getMsg("Strikethrough");goog.ui.editor.DefaultToolbar.MSG_DIR_LTR_TITLE=goog.getMsg("Left-to-right");goog.ui.editor.DefaultToolbar.MSG_DIR_RTL_TITLE=goog.getMsg("Right-to-left");goog.ui.editor.DefaultToolbar.MSG_BLOCKQUOTE_TITLE=goog.getMsg("Quote");
goog.ui.editor.DefaultToolbar.MSG_EDIT_HTML_TITLE=goog.getMsg("Edit HTML source");goog.ui.editor.DefaultToolbar.MSG_SUBSCRIPT=goog.getMsg("Subscript");goog.ui.editor.DefaultToolbar.MSG_SUPERSCRIPT=goog.getMsg("Superscript");goog.ui.editor.DefaultToolbar.MSG_EDIT_HTML_CAPTION=goog.getMsg("Edit HTML");goog.ui.editor.DefaultToolbar.buttons_={};
goog.ui.editor.DefaultToolbar.BUTTONS_=[{command:goog.editor.Command.UNDO,tooltip:goog.ui.editor.DefaultToolbar.MSG_UNDO_TITLE,classes:"tr-icon tr-undo",factory:goog.ui.editor.DefaultToolbar.undoRedoButtonFactory_,queryable:!0},{command:goog.editor.Command.REDO,tooltip:goog.ui.editor.DefaultToolbar.MSG_REDO_TITLE,classes:"tr-icon tr-redo",factory:goog.ui.editor.DefaultToolbar.undoRedoButtonFactory_,queryable:!0},{command:goog.editor.Command.FONT_FACE,tooltip:goog.ui.editor.DefaultToolbar.MSG_FONT_FACE_TITLE,
classes:"tr-fontName",factory:goog.ui.editor.DefaultToolbar.fontFaceFactory_,queryable:!0},{command:goog.editor.Command.FONT_SIZE,tooltip:goog.ui.editor.DefaultToolbar.MSG_FONT_SIZE_TITLE,classes:"tr-fontSize",factory:goog.ui.editor.DefaultToolbar.fontSizeFactory_,queryable:!0},{command:goog.editor.Command.BOLD,tooltip:goog.ui.editor.DefaultToolbar.MSG_BOLD_TITLE,classes:"tr-icon tr-bold",queryable:!0},{command:goog.editor.Command.ITALIC,tooltip:goog.ui.editor.DefaultToolbar.MSG_ITALIC_TITLE,classes:"tr-icon tr-italic",
queryable:!0},{command:goog.editor.Command.UNDERLINE,tooltip:goog.ui.editor.DefaultToolbar.MSG_UNDERLINE_TITLE,classes:"tr-icon tr-underline",queryable:!0},{command:goog.editor.Command.FONT_COLOR,tooltip:goog.ui.editor.DefaultToolbar.MSG_FONT_COLOR_TITLE,classes:"tr-icon tr-foreColor",factory:goog.ui.editor.DefaultToolbar.fontColorFactory_,queryable:!0},{command:goog.editor.Command.BACKGROUND_COLOR,tooltip:goog.ui.editor.DefaultToolbar.MSG_BACKGROUND_COLOR_TITLE,classes:"tr-icon tr-backColor",factory:goog.ui.editor.DefaultToolbar.backgroundColorFactory_,
queryable:!0},{command:goog.editor.Command.LINK,tooltip:goog.ui.editor.DefaultToolbar.MSG_LINK_TITLE,caption:goog.ui.editor.messages.MSG_LINK_CAPTION,classes:"tr-link",queryable:!0},{command:goog.editor.Command.ORDERED_LIST,tooltip:goog.ui.editor.DefaultToolbar.MSG_ORDERED_LIST_TITLE,classes:"tr-icon tr-insertOrderedList",queryable:!0},{command:goog.editor.Command.UNORDERED_LIST,tooltip:goog.ui.editor.DefaultToolbar.MSG_UNORDERED_LIST_TITLE,classes:"tr-icon tr-insertUnorderedList",queryable:!0},{command:goog.editor.Command.OUTDENT,
tooltip:goog.ui.editor.DefaultToolbar.MSG_OUTDENT_TITLE,classes:"tr-icon tr-outdent",factory:goog.ui.editor.ToolbarFactory.makeButton},{command:goog.editor.Command.INDENT,tooltip:goog.ui.editor.DefaultToolbar.MSG_INDENT_TITLE,classes:"tr-icon tr-indent",factory:goog.ui.editor.ToolbarFactory.makeButton},{command:goog.editor.Command.JUSTIFY_LEFT,tooltip:goog.ui.editor.DefaultToolbar.MSG_ALIGN_LEFT_TITLE,classes:"tr-icon tr-justifyLeft",queryable:!0},{command:goog.editor.Command.JUSTIFY_CENTER,tooltip:goog.ui.editor.DefaultToolbar.MSG_ALIGN_CENTER_TITLE,
classes:"tr-icon tr-justifyCenter",queryable:!0},{command:goog.editor.Command.JUSTIFY_RIGHT,tooltip:goog.ui.editor.DefaultToolbar.MSG_ALIGN_RIGHT_TITLE,classes:"tr-icon tr-justifyRight",queryable:!0},{command:goog.editor.Command.JUSTIFY_FULL,tooltip:goog.ui.editor.DefaultToolbar.MSG_JUSTIFY_TITLE,classes:"tr-icon tr-justifyFull",queryable:!0},{command:goog.editor.Command.REMOVE_FORMAT,tooltip:goog.ui.editor.DefaultToolbar.MSG_REMOVE_FORMAT_TITLE,classes:"tr-icon tr-removeFormat",factory:goog.ui.editor.ToolbarFactory.makeButton},
{command:goog.editor.Command.IMAGE,tooltip:goog.ui.editor.DefaultToolbar.MSG_IMAGE_TITLE,classes:"tr-icon tr-image",factory:goog.ui.editor.ToolbarFactory.makeButton},{command:goog.editor.Command.STRIKE_THROUGH,tooltip:goog.ui.editor.DefaultToolbar.MSG_STRIKE_THROUGH_TITLE,classes:"tr-icon tr-strikeThrough",queryable:!0},{command:goog.editor.Command.SUBSCRIPT,tooltip:goog.ui.editor.DefaultToolbar.MSG_SUBSCRIPT,classes:"tr-icon tr-subscript",queryable:!0},{command:goog.editor.Command.SUPERSCRIPT,tooltip:goog.ui.editor.DefaultToolbar.MSG_SUPERSCRIPT,
classes:"tr-icon tr-superscript",queryable:!0},{command:goog.editor.Command.DIR_LTR,tooltip:goog.ui.editor.DefaultToolbar.MSG_DIR_LTR_TITLE,classes:"tr-icon tr-ltr",queryable:!0},{command:goog.editor.Command.DIR_RTL,tooltip:goog.ui.editor.DefaultToolbar.MSG_DIR_RTL_TITLE,classes:"tr-icon tr-rtl",factory:goog.ui.editor.DefaultToolbar.rtlButtonFactory_,queryable:!0},{command:goog.editor.Command.BLOCKQUOTE,tooltip:goog.ui.editor.DefaultToolbar.MSG_BLOCKQUOTE_TITLE,classes:"tr-icon tr-BLOCKQUOTE",queryable:!0},
{command:goog.editor.Command.FORMAT_BLOCK,tooltip:goog.ui.editor.DefaultToolbar.MSG_FORMAT_BLOCK_TITLE,caption:goog.ui.editor.DefaultToolbar.MSG_FORMAT_BLOCK_CAPTION,classes:"tr-formatBlock",factory:goog.ui.editor.DefaultToolbar.formatBlockFactory_,queryable:!0},{command:goog.editor.Command.EDIT_HTML,tooltip:goog.ui.editor.DefaultToolbar.MSG_EDIT_HTML_TITLE,caption:goog.ui.editor.DefaultToolbar.MSG_EDIT_HTML_CAPTION,classes:"tr-editHtml",factory:goog.ui.editor.ToolbarFactory.makeButton}];
(function(){for(var a=0,b;b=goog.ui.editor.DefaultToolbar.BUTTONS_[a];a++)goog.ui.editor.DefaultToolbar.buttons_[b.command]=b;delete goog.ui.editor.DefaultToolbar.BUTTONS_})();goog.ui.editor.ToolbarController=function(a,b){goog.events.EventTarget.call(this);this.handler_=new goog.events.EventHandler(this);this.field_=a;this.toolbar_=b;this.queryCommands_=[];this.toolbar_.forEachChild(function(a){a.queryable&&this.queryCommands_.push(this.getComponentId(a.getId()))},this);this.toolbar_.setFocusable(!1);this.handler_.listen(this.field_,goog.editor.Field.EventType.COMMAND_VALUE_CHANGE,this.updateToolbar).listen(this.toolbar_,goog.ui.Component.EventType.ACTION,this.handleAction)};
goog.inherits(goog.ui.editor.ToolbarController,goog.events.EventTarget);goog.ui.editor.ToolbarController.prototype.getComponentId=function(a){return a};goog.ui.editor.ToolbarController.prototype.getCommand=function(a){return a};goog.ui.editor.ToolbarController.prototype.getHandler=function(){return this.handler_};goog.ui.editor.ToolbarController.prototype.getField=function(){return this.field_};goog.ui.editor.ToolbarController.prototype.getToolbar=function(){return this.toolbar_};
goog.ui.editor.ToolbarController.prototype.isVisible=function(){return this.toolbar_.isVisible()};goog.ui.editor.ToolbarController.prototype.setVisible=function(a){this.toolbar_.setVisible(a)};goog.ui.editor.ToolbarController.prototype.isEnabled=function(){return this.toolbar_.isEnabled()};goog.ui.editor.ToolbarController.prototype.setEnabled=function(a){this.toolbar_.setEnabled(a)};goog.ui.editor.ToolbarController.prototype.blur=function(){this.toolbar_.handleBlur(null)};
goog.ui.editor.ToolbarController.prototype.disposeInternal=function(){goog.ui.editor.ToolbarController.superClass_.disposeInternal.call(this);this.handler_&&(this.handler_.dispose(),delete this.handler_);this.toolbar_&&(this.toolbar_.dispose(),delete this.toolbar_);delete this.field_;delete this.queryCommands_};
goog.ui.editor.ToolbarController.prototype.updateToolbar=function(a){if(this.toolbar_.isEnabled()&&this.dispatchEvent(goog.ui.Component.EventType.CHANGE)){var b;try{b=this.field_.queryCommandValue(a.commands||this.queryCommands_)}catch(c){b={}}this.updateToolbarFromState(b)}};goog.ui.editor.ToolbarController.prototype.updateToolbarFromState=function(a){for(var b in a){var c=this.toolbar_.getChild(this.getComponentId(b));if(c){var d=a[b];c.updateFromValue?c.updateFromValue(d):c.setChecked(!!d)}}};
goog.ui.editor.ToolbarController.prototype.handleAction=function(a){this.field_.execCommand(this.getCommand(a.target.getId()),a.target.getValue())};goog.ui.ToolbarSeparator=function(a,b){goog.ui.Separator.call(this,a||goog.ui.ToolbarSeparatorRenderer.getInstance(),b)};goog.inherits(goog.ui.ToolbarSeparator,goog.ui.Separator);goog.ui.registry.setDecoratorByClassName(goog.ui.ToolbarSeparatorRenderer.CSS_CLASS,function(){return new goog.ui.ToolbarSeparator});goog.ui.TextareaRenderer=function(){goog.ui.ControlRenderer.call(this)};goog.inherits(goog.ui.TextareaRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.TextareaRenderer);goog.ui.TextareaRenderer.CSS_CLASS="goog-textarea";goog.ui.TextareaRenderer.prototype.getAriaRole=function(){};goog.ui.TextareaRenderer.prototype.decorate=function(a,b){goog.ui.TextareaRenderer.superClass_.decorate.call(this,a,b);a.setContent(b.value);return b};
goog.ui.TextareaRenderer.prototype.createDom=function(a){this.setUpTextarea_(a);return a.getDomHelper().createDom("textarea",{"class":this.getClassNames(a).join(" "),disabled:!a.isEnabled()},a.getContent()||"")};goog.ui.TextareaRenderer.prototype.canDecorate=function(a){return a.tagName==goog.dom.TagName.TEXTAREA};goog.ui.TextareaRenderer.prototype.setRightToLeft=goog.nullFunction;goog.ui.TextareaRenderer.prototype.isFocusable=function(a){return a.isEnabled()};
goog.ui.TextareaRenderer.prototype.setFocusable=goog.nullFunction;goog.ui.TextareaRenderer.prototype.setState=function(a,b,c){goog.ui.TextareaRenderer.superClass_.setState.call(this,a,b,c);if((a=a.getElement())&&b==goog.ui.Component.State.DISABLED)a.disabled=c};goog.ui.TextareaRenderer.prototype.updateAriaState=goog.nullFunction;
goog.ui.TextareaRenderer.prototype.setUpTextarea_=function(a){a.setHandleMouseEvents(!1);a.setAutoStates(goog.ui.Component.State.ALL,!1);a.setSupportedState(goog.ui.Component.State.FOCUSED,!1)};goog.ui.TextareaRenderer.prototype.setContent=function(a,b){a&&(a.value=b)};goog.ui.TextareaRenderer.prototype.getCssClass=function(){return goog.ui.TextareaRenderer.CSS_CLASS};goog.ui.Textarea=function(a,b,c){goog.ui.Control.call(this,a,b||goog.ui.TextareaRenderer.getInstance(),c);this.setHandleMouseEvents(!1);this.setAllowTextSelection(!0);a||this.setContentInternal("")};goog.inherits(goog.ui.Textarea,goog.ui.Control);goog.ui.Textarea.NEEDS_HELP_SHRINKING_=goog.userAgent.GECKO||goog.userAgent.WEBKIT;goog.ui.Textarea.prototype.isResizing_=!1;goog.ui.Textarea.prototype.height_=0;goog.ui.Textarea.prototype.maxHeight_=0;goog.ui.Textarea.prototype.minHeight_=0;
goog.ui.Textarea.prototype.hasDiscoveredTextareaCharacteristics_=!1;goog.ui.Textarea.prototype.needsPaddingBorderFix_=!1;goog.ui.Textarea.prototype.scrollHeightIncludesPadding_=!1;goog.ui.Textarea.prototype.scrollHeightIncludesBorder_=!1;goog.ui.Textarea.prototype.getPaddingBorderBoxHeight_=function(){return this.paddingBox_.top+this.paddingBox_.bottom+this.borderBox_.top+this.borderBox_.bottom};goog.ui.Textarea.prototype.getMinHeight=function(){return this.minHeight_};
goog.ui.Textarea.prototype.getMinHeight_=function(){var a=this.minHeight_,b=this.getElement();a&&b&&this.needsPaddingBorderFix_&&(a-=this.getPaddingBorderBoxHeight_());return a};goog.ui.Textarea.prototype.setMinHeight=function(a){this.minHeight_=a;this.resize()};goog.ui.Textarea.prototype.getMaxHeight=function(){return this.maxHeight_};
goog.ui.Textarea.prototype.getMaxHeight_=function(){var a=this.maxHeight_,b=this.getElement();a&&b&&this.needsPaddingBorderFix_&&(a-=this.getPaddingBorderBoxHeight_());return a};goog.ui.Textarea.prototype.setMaxHeight=function(a){this.maxHeight_=a;this.resize()};goog.ui.Textarea.prototype.setValue=function(a){this.setContent(""+a)};goog.ui.Textarea.prototype.getValue=function(){return this.getElement().value};
goog.ui.Textarea.prototype.setContent=function(a){goog.ui.Textarea.superClass_.setContent.call(this,a);this.resize()};goog.ui.Textarea.prototype.setEnabled=function(a){goog.ui.Textarea.superClass_.setEnabled.call(this,a);this.getElement().disabled=!a};goog.ui.Textarea.prototype.resize=function(){this.getElement()&&this.grow_()};
goog.ui.Textarea.prototype.enterDocument=function(){var a=this.getElement();goog.style.setStyle(a,{overflowY:"hidden",overflowX:"auto",boxSizing:"border-box",MsBoxSizing:"border-box",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box"});this.paddingBox_=goog.style.getPaddingBox(a);this.borderBox_=goog.style.getBorderBox(a);this.getHandler().listen(a,goog.events.EventType.SCROLL,this.grow_).listen(a,goog.events.EventType.FOCUS,this.grow_).listen(a,goog.events.EventType.KEYUP,this.grow_).listen(a,
goog.events.EventType.MOUSEUP,this.mouseUpListener_);this.resize()};goog.ui.Textarea.prototype.getHeight_=function(){this.discoverTextareaCharacteristics_();var a=this.getElement(),b=this.getElement().scrollHeight+this.getHorizontalScrollBarHeight_();if(this.needsPaddingBorderFix_)b-=this.getPaddingBorderBoxHeight_();else{if(!this.scrollHeightIncludesPadding_)var c=this.paddingBox_,b=b+(c.top+c.bottom);this.scrollHeightIncludesBorder_||(a=goog.style.getBorderBox(a),b+=a.top+a.bottom)}return b};
goog.ui.Textarea.prototype.setHeight_=function(a){this.height_!=a&&(this.height_=a,this.getElement().style.height=a+"px")};goog.ui.Textarea.prototype.setHeightToEstimate_=function(){var a=this.getElement();a.style.height="auto";var b=a.value.match(/\n/g)||[];a.rows=b.length+1};
goog.ui.Textarea.prototype.getHorizontalScrollBarHeight_=function(){var a=this.getElement(),b=a.offsetHeight-a.clientHeight;if(!this.scrollHeightIncludesPadding_)var c=this.paddingBox_,b=b-(c.top+c.bottom);this.scrollHeightIncludesBorder_||(a=goog.style.getBorderBox(a),b-=a.top+a.bottom);return 0<b?b:0};
goog.ui.Textarea.prototype.discoverTextareaCharacteristics_=function(){if(!this.hasDiscoveredTextareaCharacteristics_){var a=this.getElement().cloneNode(!1);goog.style.setStyle(a,{position:"absolute",height:"auto",top:"-9999px",margin:"0",padding:"1px",border:"1px solid #000",overflow:"hidden"});goog.dom.appendChild(this.getDomHelper().getDocument().body,a);var b=a.scrollHeight;a.style.padding="10px";var c=a.scrollHeight;this.scrollHeightIncludesPadding_=c>b;a.style.borderWidth="10px";this.scrollHeightIncludesBorder_=
a.scrollHeight>c;a.style.height="100px";100!=a.offsetHeight&&(this.needsPaddingBorderFix_=!0);goog.dom.removeNode(a);this.hasDiscoveredTextareaCharacteristics_=!0}};
goog.ui.Textarea.prototype.grow_=function(){if(!this.isResizing_){var a=!1;this.isResizing_=!0;var b=this.getElement();if(b.scrollHeight){var c=!1,d=!1,e=this.getHeight_(),f=b.offsetHeight,g=this.getMinHeight_(),h=this.getMaxHeight_();g&&e<g?(this.setHeight_(g),c=!0):h&&e>h?(this.setHeight_(h),b.style.overflowY="",d=!0):f!=e?this.setHeight_(e):this.height_||(this.height_=e);!c&&!d&&goog.ui.Textarea.NEEDS_HELP_SHRINKING_&&(a=!0)}else this.setHeightToEstimate_();this.isResizing_=!1;a&&this.shrink_()}};
goog.ui.Textarea.prototype.shrink_=function(){var a=this.getElement();if(!this.isResizing_){this.isResizing_=!0;var b=!1;a.value||(a.value=" ",b=!0);var c=a.scrollHeight;if(c){var d=this.getHeight_(),e=this.getMinHeight_(),f=this.getMaxHeight_();!(e&&d<=e)&&!(f&&d>=f)&&(f=this.paddingBox_,a.style.paddingBottom=f.bottom+1+"px",this.getHeight_()==d&&(a.style.paddingBottom=f.bottom+c+"px",a.scrollTop=0,c=this.getHeight_()-c,c>=e?this.setHeight_(c):this.setHeight_(e)),a.style.paddingBottom=f.bottom+"px")}else this.setHeightToEstimate_();
b&&(a.value="");this.isResizing_=!1}};goog.ui.Textarea.prototype.mouseUpListener_=function(){var a=this.getElement(),b=a.offsetHeight;a.filters&&a.filters.length&&(a=a.filters.item("DXImageTransform.Microsoft.DropShadow"))&&(b-=a.offX);b!=this.height_&&(this.height_=this.minHeight_=b)};fyre.v1.editor.ErrorNotification=function(a,b){this.message_=a||"";fyre.v1.ui.FyreComponent.call(this,b)};goog.inherits(fyre.v1.editor.ErrorNotification,fyre.v1.ui.FyreComponent);fyre.v1.editor.ErrorNotification.prototype.createDomInternal=function(){fyre.v1.editor.ErrorNotification.superClass_.createDomInternal.call(this);this.$dom_.html(fyre.templates.core.editor.error({msg:this.message_}))};
fyre.v1.editor.ErrorNotification.prototype.enterDocument=function(){this.getHandler().listen(this.$dom_.getByClass("fyre-editor-error-close").element,goog.events.EventType.CLICK,this.hide)};fyre.v1.editor.ErrorNotification.prototype.hide=function(){this.$dom_.hide()};fyre.v1.editor.ErrorNotification.prototype.show=function(){this.$dom_.show()};fyre.v1.editor.ErrorNotification.prototype.setMessage=function(a){goog.dom.setTextContent(this.$dom_.last().element,a)};goog.dom.NodeOffset=function(a,b){goog.Disposable.call(this);this.offsetStack_=[];for(this.nameStack_=[];a&&a.nodeName!=goog.dom.TagName.BODY&&a!=b;){for(var c=0,d=a.previousSibling;d;)d=d.previousSibling,++c;this.offsetStack_.unshift(c);this.nameStack_.unshift(a.nodeName);a=a.parentNode}};goog.inherits(goog.dom.NodeOffset,goog.Disposable);goog.dom.NodeOffset.prototype.toString=function(){for(var a=[],b,c=0;b=this.nameStack_[c];c++)a.push(this.offsetStack_[c]+","+b);return a.join("\n")};
goog.dom.NodeOffset.prototype.findTargetNode=function(a){for(var b=a,c=0;a=this.nameStack_[c];++c)if(b=b.childNodes[this.offsetStack_[c]],!b||b.nodeName!=a)return null;return b};goog.dom.NodeOffset.prototype.disposeInternal=function(){delete this.offsetStack_;delete this.nameStack_};goog.editor.plugins={};goog.editor.plugins.Blockquote=function(a,b){goog.editor.Plugin.call(this);this.requiresClassNameToSplit_=a;this.className_=b||"tr_bq"};goog.inherits(goog.editor.plugins.Blockquote,goog.editor.Plugin);goog.editor.plugins.Blockquote.SPLIT_COMMAND="+splitBlockquote";goog.editor.plugins.Blockquote.CLASS_ID="Blockquote";goog.editor.plugins.Blockquote.prototype.logger=goog.debug.Logger.getLogger("goog.editor.plugins.Blockquote");
goog.editor.plugins.Blockquote.prototype.getTrogClassId=function(){return goog.editor.plugins.Blockquote.CLASS_ID};goog.editor.plugins.Blockquote.prototype.isSilentCommand=goog.functions.TRUE;goog.editor.plugins.Blockquote.isBlockquote=function(a,b,c,d){if(a.tagName!=goog.dom.TagName.BLOCKQUOTE)return!1;if(!c)return b;a=goog.dom.classes.has(a,d);return b?a:!a};
goog.editor.plugins.Blockquote.prototype.isSplittableBlockquote=function(a){return a.tagName!=goog.dom.TagName.BLOCKQUOTE?!1:!this.requiresClassNameToSplit_?!0:goog.dom.classes.has(a,this.className_)};goog.editor.plugins.Blockquote.prototype.isSetupBlockquote=function(a){return a.tagName==goog.dom.TagName.BLOCKQUOTE&&goog.dom.classes.has(a,this.className_)};goog.editor.plugins.Blockquote.prototype.isUnsetupBlockquote=function(a){return a.tagName==goog.dom.TagName.BLOCKQUOTE&&!this.isSetupBlockquote(a)};
goog.editor.plugins.Blockquote.prototype.getBlockquoteClassName=function(){return this.className_};goog.editor.plugins.Blockquote.findAndRemoveSingleChildAncestor_=function(a,b){var c=goog.editor.node.findHighestMatchingAncestor(a,function(a){return a!=b&&1==a.childNodes.length});c||(c=a);goog.dom.removeNode(c)};goog.editor.plugins.Blockquote.removeAllWhiteSpaceNodes_=function(a){for(var b=0;b<a.length;++b)goog.editor.node.isEmpty(a[b],!0)&&goog.dom.removeNode(a[b])};
goog.editor.plugins.Blockquote.prototype.isSupportedCommand=function(a){return a==goog.editor.plugins.Blockquote.SPLIT_COMMAND};goog.editor.plugins.Blockquote.prototype.execCommandInternal=function(a,b){if(a==goog.editor.plugins.Blockquote.SPLIT_COMMAND&&b&&(this.className_||!this.requiresClassNameToSplit_))return goog.editor.BrowserFeature.HAS_W3C_RANGES?this.splitQuotedBlockW3C_(b):this.splitQuotedBlockIE_(b)};
goog.editor.plugins.Blockquote.prototype.splitQuotedBlockW3C_=function(a){var b=a.node,c=goog.editor.node.findTopMostEditableAncestor(b.parentNode,goog.bind(this.isSplittableBlockquote,this)),d,e,f=!1;c?b.nodeType==goog.dom.NodeType.TEXT?a.offset==b.length?(d=b.nextSibling)&&d.tagName==goog.dom.TagName.BR?(b=d,d=d.nextSibling):d=e=b.splitText(a.offset):d=b.splitText(a.offset):b.tagName==goog.dom.TagName.BR?d=b.nextSibling:f=!0:this.isSetupBlockquote(b)&&(c=b,f=!0);f&&(b=this.insertEmptyTextNodeBeforeRange_(),
d=this.insertEmptyTextNodeBeforeRange_());if(!c)return!1;d=goog.editor.node.splitDomTreeAt(b,d,c);goog.dom.insertSiblingAfter(d,c);a=this.getFieldDomHelper();b=this.fieldObject.queryCommandValue(goog.editor.Command.DEFAULT_TAG)||goog.dom.TagName.DIV;b=a.createElement(b);b.innerHTML="&nbsp;";c.parentNode.insertBefore(b,d);a.getWindow().getSelection().collapse(b,0);e&&goog.editor.plugins.Blockquote.findAndRemoveSingleChildAncestor_(e,d);goog.editor.plugins.Blockquote.removeAllWhiteSpaceNodes_([c,d]);
return!0};goog.editor.plugins.Blockquote.prototype.insertEmptyTextNodeBeforeRange_=function(){var a=this.fieldObject.getRange(),b=this.getFieldDomHelper().createTextNode("");a.insertNode(b,!0);return b};
goog.editor.plugins.Blockquote.prototype.splitQuotedBlockIE_=function(a){var b=this.getFieldDomHelper(),c=goog.editor.node.findTopMostEditableAncestor(a.parentNode,goog.bind(this.isSplittableBlockquote,this));if(!c)return!1;var d=a.cloneNode(!1);a.nextSibling&&a.nextSibling.tagName==goog.dom.TagName.BR&&(a=a.nextSibling);var e=goog.editor.node.splitDomTreeAt(a,d,c);goog.dom.insertSiblingAfter(e,c);var f=this.fieldObject.queryCommandValue(goog.editor.Command.DEFAULT_TAG)||goog.dom.TagName.DIV,f=b.createElement(f);
c.parentNode.insertBefore(f,e);f.innerHTML="&nbsp;";b=b.getDocument().selection.createRange();b.moveToElementText(a);b.move("character",2);b.select();f.innerHTML="";b.pasteHTML("");goog.editor.plugins.Blockquote.findAndRemoveSingleChildAncestor_(d,e);goog.editor.plugins.Blockquote.removeAllWhiteSpaceNodes_([c,e]);return!0};goog.editor.plugins.EnterHandler=function(){goog.editor.Plugin.call(this)};goog.inherits(goog.editor.plugins.EnterHandler,goog.editor.Plugin);goog.editor.plugins.EnterHandler.prototype.tag=goog.dom.TagName.DIV;goog.editor.plugins.EnterHandler.prototype.getTrogClassId=function(){return"EnterHandler"};
goog.editor.plugins.EnterHandler.prototype.enable=function(a){goog.editor.plugins.EnterHandler.superClass_.enable.call(this,a);goog.editor.BrowserFeature.SUPPORTS_OPERA_DEFAULTBLOCK_COMMAND&&(this.tag==goog.dom.TagName.P||this.tag==goog.dom.TagName.DIV)&&this.getFieldDomHelper().getDocument().execCommand("opera-defaultBlock",!1,this.tag)};
goog.editor.plugins.EnterHandler.prototype.prepareContentsHtml=function(a){return!a||goog.string.isBreakingWhitespace(a)?goog.editor.BrowserFeature.COLLAPSES_EMPTY_NODES?this.getNonCollapsingBlankHtml():"":a};goog.editor.plugins.EnterHandler.prototype.getNonCollapsingBlankHtml=goog.functions.constant("<br>");
goog.editor.plugins.EnterHandler.prototype.handleBackspaceInternal=function(a,b){var c=this.fieldObject.getElement(),d=b&&b.getStartNode();c.firstChild==d&&goog.editor.node.isEmpty(d)&&(a.preventDefault(),a.stopPropagation())};
goog.editor.plugins.EnterHandler.prototype.processParagraphTagsInternal=function(a,b){if(goog.userAgent.IE||goog.userAgent.OPERA)this.ensureBlockIeOpera(goog.dom.TagName.DIV);else if(!b&&goog.userAgent.WEBKIT){var c=this.fieldObject.getRange();if(c&&goog.editor.plugins.EnterHandler.isDirectlyInBlockquote(c.getContainerElement())){var d=this.getFieldDomHelper(),e=d.createElement(goog.dom.TagName.BR);c.insertNode(e,!0);goog.editor.node.isBlockTag(e.parentNode)&&!goog.editor.node.skipEmptyTextNodes(e.nextSibling)&&
goog.dom.insertSiblingBefore(d.createElement(goog.dom.TagName.BR),e);goog.editor.range.placeCursorNextTo(e,!1);a.preventDefault()}}};goog.editor.plugins.EnterHandler.isDirectlyInBlockquote=function(a){for(;a;a=a.parentNode)if(goog.editor.node.isBlockTag(a))return a.tagName==goog.dom.TagName.BLOCKQUOTE;return!1};goog.editor.plugins.EnterHandler.prototype.handleDeleteGecko=function(a){this.deleteBrGecko(a)};
goog.editor.plugins.EnterHandler.prototype.deleteBrGecko=function(a){var b=this.fieldObject.getRange();if(b.isCollapsed()){var c=b.getEndNode();if(c.nodeType==goog.dom.NodeType.ELEMENT&&(b=c.childNodes[b.getEndOffset()])&&b.tagName==goog.dom.TagName.BR){var d=goog.editor.node.getPreviousSibling(b),e=b.nextSibling;c.removeChild(b);a.preventDefault();e&&goog.editor.node.isBlockTag(e)&&(d&&!(d.tagName==goog.dom.TagName.BR||goog.editor.node.isBlockTag(d))?goog.dom.Range.createCaret(d,goog.editor.node.getLength(d)).select():
(a=goog.editor.node.getLeftMostLeaf(e),goog.dom.Range.createCaret(a,0).select()))}}};
goog.editor.plugins.EnterHandler.prototype.handleKeyPress=function(a){if(goog.userAgent.GECKO&&this.fieldObject.inModalMode())return!1;if(a.keyCode==goog.events.KeyCodes.BACKSPACE)this.handleBackspaceInternal(a,this.fieldObject.getRange());else if(a.keyCode==goog.events.KeyCodes.ENTER)if(goog.userAgent.GECKO)a.shiftKey||this.handleEnterGecko_(a);else{this.fieldObject.dispatchBeforeChange();var b=this.deleteCursorSelection_(),c=!!this.fieldObject.execCommand(goog.editor.plugins.Blockquote.SPLIT_COMMAND,
b);c&&(a.preventDefault(),a.stopPropagation());this.releasePositionObject_(b);goog.userAgent.WEBKIT&&this.handleEnterWebkitInternal(a);this.processParagraphTagsInternal(a,c);this.fieldObject.dispatchChange()}else goog.userAgent.GECKO&&a.keyCode==goog.events.KeyCodes.DELETE&&this.handleDeleteGecko(a);return!1};goog.editor.plugins.EnterHandler.prototype.handleKeyUp=function(a){if(goog.userAgent.GECKO&&this.fieldObject.inModalMode())return!1;this.handleKeyUpInternal(a);return!1};
goog.editor.plugins.EnterHandler.prototype.handleKeyUpInternal=function(a){(goog.userAgent.IE||goog.userAgent.OPERA)&&a.keyCode==goog.events.KeyCodes.ENTER&&this.ensureBlockIeOpera(goog.dom.TagName.DIV,!0)};
goog.editor.plugins.EnterHandler.prototype.handleEnterGecko_=function(a){var b=this.fieldObject.getRange(),c=!b||b.isCollapsed(),d=this.deleteCursorSelection_(),e=this.fieldObject.execCommand(goog.editor.plugins.Blockquote.SPLIT_COMMAND,d);e&&(a.preventDefault(),a.stopPropagation());this.releasePositionObject_(d);e||this.handleEnterAtCursorGeckoInternal(a,c,b)};goog.editor.plugins.EnterHandler.prototype.handleEnterWebkitInternal=goog.nullFunction;
goog.editor.plugins.EnterHandler.prototype.handleEnterAtCursorGeckoInternal=goog.nullFunction;goog.editor.plugins.EnterHandler.DO_NOT_ENSURE_BLOCK_NODES_=goog.object.createSet(goog.dom.TagName.LI,goog.dom.TagName.DIV,goog.dom.TagName.H1,goog.dom.TagName.H2,goog.dom.TagName.H3,goog.dom.TagName.H4,goog.dom.TagName.H5,goog.dom.TagName.H6);goog.editor.plugins.EnterHandler.isBrElem=function(a){return goog.editor.node.isEmpty(a)&&1==a.getElementsByTagName(goog.dom.TagName.BR).length};
goog.editor.plugins.EnterHandler.prototype.ensureBlockIeOpera=function(a,b){for(var c=this.fieldObject.getRange(),d=c.getContainer(),e=this.fieldObject.getElement(),f;d&&d!=e;){var g=d.nodeName;if(g==a||goog.editor.plugins.EnterHandler.DO_NOT_ENSURE_BLOCK_NODES_[g]&&(!b||!goog.editor.plugins.EnterHandler.isBrElem(d))){if(goog.userAgent.OPERA&&f){g==a&&f==d.lastChild&&goog.editor.node.isEmpty(f)&&(goog.dom.insertSiblingAfter(f,d),goog.dom.Range.createFromNodeContents(f).select());break}return}goog.userAgent.OPERA&&
b&&g==goog.dom.TagName.P&&g!=a&&(f=d);d=d.parentNode}if(goog.userAgent.IE&&!goog.userAgent.isVersion(9)){var h=!1,c=c.getBrowserRangeObject(),d=c.duplicate();d.moveEnd("character",1);if(d.text.length&&(h=d.parentElement(),d=d.duplicate(),d.collapse(!1),d=d.parentElement(),h=h!=d&&d!=c.parentElement()))c.move("character",-1),c.select()}this.fieldObject.getEditableDomHelper().getDocument().execCommand("FormatBlock",!1,"<"+a+">");h&&(c.move("character",1),c.select())};
goog.editor.plugins.EnterHandler.prototype.deleteCursorSelection_=function(){return goog.editor.BrowserFeature.HAS_W3C_RANGES?this.deleteCursorSelectionW3C_():this.deleteCursorSelectionIE_()};goog.editor.plugins.EnterHandler.prototype.releasePositionObject_=function(a){goog.editor.BrowserFeature.HAS_W3C_RANGES||a.removeNode(!0)};
goog.editor.plugins.EnterHandler.prototype.deleteCursorSelectionIE_=function(){var a=this.getFieldDomHelper().getDocument(),b=a.selection.createRange(),c=goog.string.createUniqueString();b.pasteHTML('<span id="'+c+'"></span>');a=a.getElementById(c);a.id="";return a};
goog.editor.plugins.EnterHandler.prototype.deleteCursorSelectionW3C_=function(){var a=this.fieldObject.getRange();if(!a.isCollapsed()){var b=!0;if(goog.userAgent.OPERA){var c=a.getStartNode(),d=a.getStartOffset();c==a.getEndNode()&&c.lastChild&&c.lastChild.tagName==goog.dom.TagName.BR&&d==c.childNodes.length-1&&(b=!1)}b&&goog.editor.plugins.EnterHandler.deleteW3cRange_(a)}return goog.editor.range.getDeepEndPoint(a,!0)};
goog.editor.plugins.EnterHandler.deleteW3cRange_=function(a){if(a&&!a.isCollapsed()){var b=!0,c=a.getContainerElement(),d=new goog.dom.NodeOffset(a.getStartNode(),c),e=a.getStartOffset(),f=goog.editor.plugins.EnterHandler.isInOneContainerW3c_(a),g=!f&&goog.editor.plugins.EnterHandler.isPartialEndW3c_(a);a.removeContents();a=goog.dom.Range.createCaret(d.findTargetNode(c),e);a.select();f&&(f=goog.editor.style.getContainer(a.getStartNode()),goog.editor.node.isEmpty(f,!0)&&(b="&nbsp;",goog.userAgent.OPERA&&
f.tagName==goog.dom.TagName.LI&&(b="<br>"),f.innerHTML=b,goog.editor.range.selectNodeStart(f.firstChild),b=!1));g&&(a=goog.editor.style.getContainer(a.getStartNode()),g=goog.editor.node.getNextSibling(a),a&&g&&(goog.dom.append(a,g.childNodes),goog.dom.removeNode(g)));b&&(a=goog.dom.Range.createCaret(d.findTargetNode(c),e),a.select())}};
goog.editor.plugins.EnterHandler.isInOneContainerW3c_=function(a){var b=a.getStartNode();goog.editor.style.isContainer(b)&&(b=b.childNodes[a.getStartOffset()]||b);var b=goog.editor.style.getContainer(b),c=a.getEndNode();goog.editor.style.isContainer(c)&&(c=c.childNodes[a.getEndOffset()]||c);c=goog.editor.style.getContainer(c);return b==c};
goog.editor.plugins.EnterHandler.isPartialEndW3c_=function(a){var b=a.getEndNode(),a=a.getEndOffset(),c=b;if(goog.editor.style.isContainer(c)){var d=c.childNodes[a];if(!d||d.nodeType==goog.dom.NodeType.ELEMENT&&goog.editor.style.isContainer(d))return!1}for(d=goog.editor.style.getContainer(c);d!=c;){if(goog.editor.node.getNextSibling(c))return!0;c=c.parentNode}return a!=goog.editor.node.getLength(b)};goog.editor.plugins.TagOnEnterHandler=function(a){this.tag=a;goog.editor.plugins.EnterHandler.call(this)};goog.inherits(goog.editor.plugins.TagOnEnterHandler,goog.editor.plugins.EnterHandler);goog.editor.plugins.TagOnEnterHandler.prototype.getTrogClassId=function(){return"TagOnEnterHandler"};goog.editor.plugins.TagOnEnterHandler.prototype.getNonCollapsingBlankHtml=function(){return this.tag==goog.dom.TagName.P?"<p>&nbsp;</p>":this.tag==goog.dom.TagName.DIV?"<div><br></div>":"<br>"};
goog.editor.plugins.TagOnEnterHandler.prototype.activeOnUneditableFields=goog.functions.TRUE;goog.editor.plugins.TagOnEnterHandler.prototype.isSupportedCommand=function(a){return a==goog.editor.Command.DEFAULT_TAG};goog.editor.plugins.TagOnEnterHandler.prototype.queryCommandValue=function(a){return a==goog.editor.Command.DEFAULT_TAG?this.tag:null};
goog.editor.plugins.TagOnEnterHandler.prototype.handleBackspaceInternal=function(a,b){goog.editor.plugins.TagOnEnterHandler.superClass_.handleBackspaceInternal.call(this,a,b);goog.userAgent.GECKO&&this.markBrToNotBeRemoved_(b,!0)};goog.editor.plugins.TagOnEnterHandler.prototype.processParagraphTagsInternal=function(){(goog.userAgent.OPERA||goog.userAgent.IE)&&this.tag!=goog.dom.TagName.P&&this.ensureBlockIeOpera(this.tag)};
goog.editor.plugins.TagOnEnterHandler.prototype.handleDeleteGecko=function(a){var b=this.fieldObject.getRange(),c=goog.editor.style.getContainer(b&&b.getContainerElement());this.fieldObject.getElement().lastChild==c&&goog.editor.plugins.EnterHandler.isBrElem(c)?(a.preventDefault(),a.stopPropagation()):(this.markBrToNotBeRemoved_(b,!1),this.deleteBrGecko(a))};
goog.editor.plugins.TagOnEnterHandler.prototype.handleKeyUpInternal=function(a){goog.userAgent.GECKO?a.keyCode==goog.events.KeyCodes.DELETE?this.removeBrIfNecessary_(!1):a.keyCode==goog.events.KeyCodes.BACKSPACE&&this.removeBrIfNecessary_(!0):(goog.userAgent.IE||goog.userAgent.OPERA)&&a.keyCode==goog.events.KeyCodes.ENTER&&this.ensureBlockIeOpera(this.tag,!0)};goog.editor.plugins.TagOnEnterHandler.BrOrNbspSurroundedWithWhiteSpace_="[\t\n\r ]*(<br[^>]*/?>|&nbsp;)[\t\n\r ]*";
goog.editor.plugins.TagOnEnterHandler.emptyLiRegExp_=RegExp("^"+goog.editor.plugins.TagOnEnterHandler.BrOrNbspSurroundedWithWhiteSpace_+"$");goog.editor.plugins.TagOnEnterHandler.prototype.ensureNodeIsWrappedW3c_=function(a,b){if(b==this.fieldObject.getElement())var c=goog.dom.getAncestor(a,function(a){return b==a.parentNode},!0),b=goog.editor.plugins.TagOnEnterHandler.wrapInContainerW3c_(this.tag,{node:c,offset:0},b);return b};
goog.editor.plugins.TagOnEnterHandler.prototype.handleEnterWebkitInternal=function(){if(this.tag==goog.dom.TagName.DIV){var a=this.fieldObject.getRange(),b=goog.editor.style.getContainer(a.getContainerElement()),a=goog.editor.range.getDeepEndPoint(a,!0);this.ensureNodeIsWrappedW3c_(a.node,b);goog.dom.Range.createCaret(a.node,a.offset).select()}};
goog.editor.plugins.TagOnEnterHandler.prototype.handleEnterAtCursorGeckoInternal=function(a,b,c){var d=null;b&&(d=goog.dom.getAncestorByTagNameAndClass(c&&c.getContainerElement(),goog.dom.TagName.LI));b=d&&d.innerHTML.match(goog.editor.plugins.TagOnEnterHandler.emptyLiRegExp_)?this.breakOutOfEmptyListItemGecko_(d):this.handleRegularEnterGecko_();this.scrollCursorIntoViewGecko_(b);goog.editor.plugins.EnterHandler.isBrElem(b)&&(b.normalize(),c=b.getElementsByTagName(goog.dom.TagName.BR)[0],c.previousSibling&&
c.previousSibling.nodeType==goog.dom.NodeType.TEXT&&(b=c.previousSibling));goog.editor.range.selectNodeStart(b);a.preventDefault();a.stopPropagation()};
goog.editor.plugins.TagOnEnterHandler.prototype.breakOutOfEmptyListItemGecko_=function(a){var b=a.parentNode,c=b.parentNode,c=c.tagName==goog.dom.TagName.OL||c.tagName==goog.dom.TagName.UL,c=goog.dom.getDomHelper(a).createElement(c?goog.dom.TagName.LI:this.tag);if(a.previousSibling){if(a.nextSibling){for(var d=b.cloneNode(!1);a.nextSibling;)d.appendChild(a.nextSibling);goog.dom.insertSiblingAfter(d,b)}goog.dom.insertSiblingAfter(c,b)}else goog.dom.insertSiblingBefore(c,b);goog.editor.node.isEmpty(b)&&
goog.dom.removeNode(b);goog.dom.removeNode(a);c.innerHTML="&nbsp;";return c};
goog.editor.plugins.TagOnEnterHandler.wrapInContainerW3c_=function(a,b,c){for(var d=b.node;d.previousSibling&&!goog.editor.style.isContainer(d.previousSibling);)d=d.previousSibling;for(b=b.node;b.nextSibling&&!goog.editor.style.isContainer(b.nextSibling);)b=b.nextSibling;for(a=c.ownerDocument.createElement(a);d!=b;){var e=d.nextSibling;goog.dom.appendChild(a,d);d=e}d=b.nextSibling;goog.dom.appendChild(a,b);c.insertBefore(a,d);return a};
goog.editor.plugins.TagOnEnterHandler.prototype.markBrToNotBeRemoved_=function(a,b){var c=a.getFocusNode(),d=a.getFocusOffset();if(goog.editor.node.getLength(c)==(b?d:d+1))if((c=c.nextSibling)&&c.tagName==goog.dom.TagName.BR)this.brToKeep_=c};
goog.editor.plugins.TagOnEnterHandler.prototype.removeBrIfNecessary_=function(a){var b=this.fieldObject.getRange(),c=b.getFocusNode(),b=b.getFocusOffset(),d;if(a&&""==c.data)d=c.nextSibling;else if(a&&0==b){for(a=c;a&&!a.previousSibling&&a.parentNode!=this.fieldObject.getElement();)a=a.parentNode;d=a.previousSibling}else c.length==b&&(d=c.nextSibling);if(d&&!(d.tagName!=goog.dom.TagName.BR||this.brToKeep_==d))goog.dom.removeNode(d),c.nodeType==goog.dom.NodeType.TEXT&&(c.data=goog.editor.plugins.TagOnEnterHandler.trimTabsAndLineBreaks_(c.data),
goog.dom.Range.createCaret(c,Math.min(b,c.length)).select())};goog.editor.plugins.TagOnEnterHandler.trimTabsAndLineBreaks_=function(a){return a.replace(/^[\t\n\r]|[\t\n\r]$/g,"")};
goog.editor.plugins.TagOnEnterHandler.prototype.handleRegularEnterGecko_=function(){var a=this.fieldObject.getRange(),b=goog.editor.style.getContainer(a.getContainerElement());if(goog.editor.plugins.EnterHandler.isBrElem(b))b.tagName==goog.dom.TagName.BODY&&(b=this.ensureNodeIsWrappedW3c_(b.getElementsByTagName(goog.dom.TagName.BR)[0],b)),a=b.cloneNode(!0),goog.dom.insertSiblingAfter(a,b);else{b.firstChild||(b.innerHTML="&nbsp;");var a=goog.editor.range.getDeepEndPoint(a,!0),b=this.ensureNodeIsWrappedW3c_(a.node,
b),a=goog.editor.plugins.TagOnEnterHandler.splitDomAndAppend_(a.node,a.offset,b),b=goog.editor.plugins.TagOnEnterHandler.findAnchorInTraversal_(b),c=goog.editor.plugins.TagOnEnterHandler.findAnchorInTraversal_(a,!0);b&&c&&b.tagName==goog.dom.TagName.A&&c.tagName==goog.dom.TagName.A&&(b=goog.editor.node.isEmpty(b,!1)?b:c,goog.dom.flattenElement(b))}return a};
goog.editor.plugins.TagOnEnterHandler.prototype.scrollCursorIntoViewGecko_=function(a){if(this.fieldObject.isFixedHeight()){var b=this.fieldObject.getElement(),a=goog.style.getPageOffsetTop(a)+a.offsetHeight,c=this.getFieldDomHelper(),d=this.getFieldDomHelper().getWindow(),c=c.getDocumentScroll().y,d=goog.dom.getViewportSize(d).height;a>d+c&&(b.tagName==goog.dom.TagName.BODY&&goog.editor.node.isStandardsMode(b)&&(b=b.parentNode),b.scrollTop=a-d)}};
goog.editor.plugins.TagOnEnterHandler.splitDom_=function(a,b,c){c||(c=a.ownerDocument.body);var d=a.nodeType==goog.dom.NodeType.TEXT,e;d?goog.userAgent.IE&&b==a.nodeValue.length?(e=goog.dom.getDomHelper(a).createTextNode(""),goog.dom.insertSiblingAfter(e,a)):e=a.splitText(b):a=b?a.childNodes[b-1]:e=a.firstChild||a;b=goog.editor.node.splitDomTreeAt(a,e,c);d&&(e=goog.editor.plugins.TagOnEnterHandler.joinTextNodes_(e,!0),goog.editor.plugins.TagOnEnterHandler.replaceWhiteSpaceWithNbsp_(e,!0,!!e.nextSibling),
a=goog.editor.plugins.TagOnEnterHandler.joinTextNodes_(a,!1),goog.editor.plugins.TagOnEnterHandler.replaceWhiteSpaceWithNbsp_(a,!1,!1));return b};goog.editor.plugins.TagOnEnterHandler.splitDomAndAppend_=function(a,b,c){a=goog.editor.plugins.TagOnEnterHandler.splitDom_(a,b,c);goog.dom.insertSiblingAfter(a,c);return a};
goog.editor.plugins.TagOnEnterHandler.joinTextNodes_=function(a,b){if(a&&"#text"==a.nodeName){for(var c=b?"nextSibling":"previousSibling",d=b?"previousSibling":"nextSibling",e=[a.nodeValue];a[c]&&a[c].nodeType==goog.dom.NodeType.TEXT;)a=a[c],e.push(a.nodeValue),goog.dom.removeNode(a[d]);b||e.reverse();a.nodeValue=e.join("")}return a};
goog.editor.plugins.TagOnEnterHandler.replaceWhiteSpaceWithNbsp_=function(a,b,c){a.nodeValue=a.nodeValue.replace(b?/^[ \t\r\n]+/:/[ \t\r\n]+$/,goog.string.Unicode.NBSP);!c&&""==a.nodeValue&&(a.nodeValue=goog.string.Unicode.NBSP)};goog.editor.plugins.TagOnEnterHandler.findAnchorInTraversal_=function(a,b){for(;(a=b?a.firstChild:a.lastChild)&&a.tagName!=goog.dom.TagName.A;);return a};fyre.v1.editor.plugins={};fyre.v1.editor.plugins.TagOnEnterHandler=function(a){goog.editor.plugins.TagOnEnterHandler.call(this,a)};goog.inherits(fyre.v1.editor.plugins.TagOnEnterHandler,goog.editor.plugins.TagOnEnterHandler);fyre.v1.editor.plugins.TagOnEnterHandler.prototype.handleKeyDown=function(a){a.keyCode==goog.events.KeyCodes.BACKSPACE&&this.handleBackspaceInternal(a,this.fieldObject.getRange())};
fyre.v1.editor.plugins.TagOnEnterHandler.prototype.handleEnterWebkitInternal=function(a){if(this.tag!==goog.dom.TagName.P)fyre.v1.editor.plugins.TagOnEnterHandler.superClass_.handleEnterWebkitInternal.call(this,a);else{var b=this.fieldObject.getRange(),c=null;(!b||b.isCollapsed())&&(c=goog.dom.getAncestorByTagNameAndClass(b&&b.getContainerElement(),goog.dom.TagName.LI));c&&c.innerHTML.match(goog.editor.plugins.TagOnEnterHandler.emptyLiRegExp_)&&(b=this.breakOutOfEmptyListItemGecko_(c),goog.editor.range.selectNodeStart(b),
a.preventDefault(),a.stopPropagation())}};goog.editor.Link=function(a,b){this.anchor_=a;this.isNew_=b};goog.editor.Link.prototype.getAnchor=function(){return this.anchor_};goog.editor.Link.prototype.getCurrentText=function(){this.currentText_||(this.currentText_=goog.dom.getRawTextContent(this.getAnchor()));return this.currentText_};goog.editor.Link.prototype.isNew=function(){return this.isNew_};goog.editor.Link.prototype.initializeUrl=function(a){this.getAnchor().href=a};
goog.editor.Link.prototype.removeLink=function(){goog.dom.flattenElement(this.anchor_);this.anchor_=null};goog.editor.Link.prototype.setTextAndUrl=function(a,b){var c=this.getAnchor();c.href=b;var d=this.getCurrentText();if(a!=d){var e=goog.editor.node.getLeftMostLeaf(c);e.nodeType==goog.dom.NodeType.TEXT&&(e=e.parentNode);goog.dom.getRawTextContent(e)!=d&&(e=c);goog.dom.removeChildren(e);c=goog.dom.getDomHelper(e);goog.dom.appendChild(e,c.createTextNode(a));this.currentText_=null}this.isNew_=!1};
goog.editor.Link.prototype.placeCursorRightOf=function(){var a=this.getAnchor();if(goog.editor.BrowserFeature.GETS_STUCK_IN_LINKS){var b;b=a.nextSibling;if(!b||!(b.nodeType==goog.dom.NodeType.TEXT&&(goog.string.startsWith(b.data,goog.string.Unicode.NBSP)||goog.string.startsWith(b.data," "))))b=goog.dom.getDomHelper(a).createTextNode(goog.string.Unicode.NBSP),goog.dom.insertSiblingAfter(b,a);goog.dom.Range.createCaret(b,1).select()}else goog.editor.range.placeCursorNextTo(a,!1)};
goog.editor.Link.prototype.updateLinkDisplay_=function(a,b){this.initializeUrl(b);this.placeCursorRightOf();a.execCommand(goog.editor.Command.UPDATE_LINK_BUBBLE)};goog.editor.Link.prototype.finishLinkCreation=function(a){var b=this.getCurrentText();goog.editor.Link.isLikelyUrl(b)?(0>b.search(/:/)&&(b="http://"+goog.string.trimLeft(b)),this.updateLinkDisplay_(a,b)):goog.editor.Link.isLikelyEmailAddress(b)?this.updateLinkDisplay_(a,"mailto:"+b):a.execCommand(goog.editor.Command.MODAL_LINK_EDITOR,this)};
goog.editor.Link.createNewLink=function(a,b,c){var d=new goog.editor.Link(a,!0);d.initializeUrl(b);c&&(a.target=c);return d};
goog.editor.Link.isLikelyUrl=function(a){if(/\s/.test(a)||goog.editor.Link.isLikelyEmailAddress(a))return!1;var b=!1;/^[^:\/?#.]+:/.test(a)||(a="http://"+a,b=!0);a=goog.uri.utils.split(a);if(-1!=goog.array.indexOf(["mailto","aim"],a[goog.uri.utils.ComponentIndex.SCHEME]))return!0;var c=a[goog.uri.utils.ComponentIndex.DOMAIN];if(!c||b&&-1==c.indexOf("."))return!1;b=a[goog.uri.utils.ComponentIndex.PATH];return!b||0==b.indexOf("/")};goog.editor.Link.LIKELY_EMAIL_ADDRESS_=/^[\w-]+(\.[\w-]+)*\@([\w-]+\.)+(\d+|\w\w+)$/i;
goog.editor.Link.isLikelyEmailAddress=function(a){return goog.editor.Link.LIKELY_EMAIL_ADDRESS_.test(a)};goog.editor.Link.isMailto=function(a){return!!a&&goog.string.startsWith(a,"mailto:")};goog.editor.plugins.BasicTextFormatter=function(){goog.editor.Plugin.call(this)};goog.inherits(goog.editor.plugins.BasicTextFormatter,goog.editor.Plugin);goog.editor.plugins.BasicTextFormatter.prototype.getTrogClassId=function(){return"BTF"};goog.editor.plugins.BasicTextFormatter.prototype.logger=goog.debug.Logger.getLogger("goog.editor.plugins.BasicTextFormatter");
goog.editor.plugins.BasicTextFormatter.COMMAND={LINK:"+link",FORMAT_BLOCK:"+formatBlock",INDENT:"+indent",OUTDENT:"+outdent",STRIKE_THROUGH:"+strikeThrough",HORIZONTAL_RULE:"+insertHorizontalRule",SUBSCRIPT:"+subscript",SUPERSCRIPT:"+superscript",UNDERLINE:"+underline",BOLD:"+bold",ITALIC:"+italic",FONT_SIZE:"+fontSize",FONT_FACE:"+fontName",FONT_COLOR:"+foreColor",BACKGROUND_COLOR:"+backColor",ORDERED_LIST:"+insertOrderedList",UNORDERED_LIST:"+insertUnorderedList",JUSTIFY_CENTER:"+justifyCenter",
JUSTIFY_FULL:"+justifyFull",JUSTIFY_RIGHT:"+justifyRight",JUSTIFY_LEFT:"+justifyLeft"};goog.editor.plugins.BasicTextFormatter.SUPPORTED_COMMANDS_=goog.object.transpose(goog.editor.plugins.BasicTextFormatter.COMMAND);goog.editor.plugins.BasicTextFormatter.prototype.isSupportedCommand=function(a){return a in goog.editor.plugins.BasicTextFormatter.SUPPORTED_COMMANDS_};goog.editor.plugins.BasicTextFormatter.prototype.getRange_=function(){return this.fieldObject.getRange()};
goog.editor.plugins.BasicTextFormatter.prototype.getDocument_=function(){return this.getFieldDomHelper().getDocument()};
goog.editor.plugins.BasicTextFormatter.prototype.execCommandInternal=function(a,b){var c,d,e,f,g,h=b;switch(a){case goog.editor.plugins.BasicTextFormatter.COMMAND.BACKGROUND_COLOR:goog.isNull(h)||(goog.editor.BrowserFeature.EATS_EMPTY_BACKGROUND_COLOR?this.applyBgColorManually_(h):goog.userAgent.OPERA?this.execCommandHelper_("hiliteColor",h):this.execCommandHelper_(a,h));break;case goog.editor.plugins.BasicTextFormatter.COMMAND.LINK:g=this.toggleLink_(h);break;case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_CENTER:case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_FULL:case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_RIGHT:case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_LEFT:this.justify_(a);
break;default:goog.userAgent.IE&&a==goog.editor.plugins.BasicTextFormatter.COMMAND.FORMAT_BLOCK&&h&&(h="<"+h+">");if(a==goog.editor.plugins.BasicTextFormatter.COMMAND.FONT_COLOR&&goog.isNull(h))break;switch(a){case goog.editor.plugins.BasicTextFormatter.COMMAND.INDENT:case goog.editor.plugins.BasicTextFormatter.COMMAND.OUTDENT:goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&(goog.userAgent.GECKO&&(d=!0),goog.userAgent.OPERA&&(d=a==goog.editor.plugins.BasicTextFormatter.COMMAND.OUTDENT?!this.getDocument_().queryCommandEnabled("outdent"):
!0));case goog.editor.plugins.BasicTextFormatter.COMMAND.ORDERED_LIST:case goog.editor.plugins.BasicTextFormatter.COMMAND.UNORDERED_LIST:goog.editor.BrowserFeature.LEAVES_P_WHEN_REMOVING_LISTS&&this.queryCommandStateInternal_(this.getDocument_(),a)?e=this.fieldObject.queryCommandValue(goog.editor.Command.DEFAULT_TAG)!=goog.dom.TagName.P:goog.editor.BrowserFeature.CAN_LISTIFY_BR||this.convertBreaksToDivs_(),goog.userAgent.GECKO&&goog.editor.BrowserFeature.FORGETS_FORMATTING_WHEN_LISTIFYING&&!this.queryCommandValue(a)&&
(f|=this.beforeInsertListGecko_());case goog.editor.plugins.BasicTextFormatter.COMMAND.FORMAT_BLOCK:c=!!this.fieldObject.getPluginByClassId("Bidi");break;case goog.editor.plugins.BasicTextFormatter.COMMAND.SUBSCRIPT:case goog.editor.plugins.BasicTextFormatter.COMMAND.SUPERSCRIPT:goog.editor.BrowserFeature.NESTS_SUBSCRIPT_SUPERSCRIPT&&this.applySubscriptSuperscriptWorkarounds_(a);break;case goog.editor.plugins.BasicTextFormatter.COMMAND.UNDERLINE:case goog.editor.plugins.BasicTextFormatter.COMMAND.BOLD:case goog.editor.plugins.BasicTextFormatter.COMMAND.ITALIC:d=
goog.userAgent.GECKO&&goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&this.queryCommandValue(a);break;case goog.editor.plugins.BasicTextFormatter.COMMAND.FONT_COLOR:case goog.editor.plugins.BasicTextFormatter.COMMAND.FONT_FACE:d=goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&goog.userAgent.GECKO}this.execCommandHelper_(a,h,c,!!d);f&&this.getDocument_().execCommand("Delete",!1,!0);e&&this.getDocument_().execCommand("FormatBlock",!1,"<div>")}goog.userAgent.GECKO&&!this.fieldObject.inModalMode()&&this.focusField_();
return g};goog.editor.plugins.BasicTextFormatter.prototype.focusField_=function(){this.getFieldDomHelper().getWindow().focus()};
goog.editor.plugins.BasicTextFormatter.prototype.queryCommandValue=function(a){var b;switch(a){case goog.editor.plugins.BasicTextFormatter.COMMAND.LINK:return this.isNodeInState_(goog.dom.TagName.A);case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_CENTER:case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_FULL:case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_RIGHT:case goog.editor.plugins.BasicTextFormatter.COMMAND.JUSTIFY_LEFT:return this.isJustification_(a);case goog.editor.plugins.BasicTextFormatter.COMMAND.FORMAT_BLOCK:return goog.editor.plugins.BasicTextFormatter.getSelectionBlockState_(this.fieldObject.getRange());
case goog.editor.plugins.BasicTextFormatter.COMMAND.INDENT:case goog.editor.plugins.BasicTextFormatter.COMMAND.OUTDENT:case goog.editor.plugins.BasicTextFormatter.COMMAND.HORIZONTAL_RULE:return!1;case goog.editor.plugins.BasicTextFormatter.COMMAND.FONT_SIZE:case goog.editor.plugins.BasicTextFormatter.COMMAND.FONT_FACE:case goog.editor.plugins.BasicTextFormatter.COMMAND.FONT_COLOR:case goog.editor.plugins.BasicTextFormatter.COMMAND.BACKGROUND_COLOR:return this.queryCommandValueInternal_(this.getDocument_(),
a,goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&goog.userAgent.GECKO);case goog.editor.plugins.BasicTextFormatter.COMMAND.UNDERLINE:case goog.editor.plugins.BasicTextFormatter.COMMAND.BOLD:case goog.editor.plugins.BasicTextFormatter.COMMAND.ITALIC:b=goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&goog.userAgent.GECKO;default:return this.queryCommandStateInternal_(this.getDocument_(),a,b)}};
goog.editor.plugins.BasicTextFormatter.prototype.prepareContentsHtml=function(a){goog.editor.BrowserFeature.COLLAPSES_EMPTY_NODES&&a.match(/^\s*<script/i)&&(a="&nbsp;"+a);goog.editor.BrowserFeature.CONVERT_TO_B_AND_I_TAGS&&(a=a.replace(/<(\/?)strong([^\w])/gi,"<$1b$2"),a=a.replace(/<(\/?)em([^\w])/gi,"<$1i$2"));return a};
goog.editor.plugins.BasicTextFormatter.prototype.cleanContentsDom=function(a){for(var a=a.getElementsByTagName(goog.dom.TagName.IMG),b=0,c;c=a[b];b++)goog.editor.BrowserFeature.SHOWS_CUSTOM_ATTRS_IN_INNER_HTML&&(c.removeAttribute("tabIndex"),c.removeAttribute("tabIndexSet"),goog.removeUid(c),c.oldTabIndex&&(c.tabIndex=c.oldTabIndex))};
goog.editor.plugins.BasicTextFormatter.prototype.cleanContentsHtml=function(a){if(goog.editor.BrowserFeature.MOVES_STYLE_TO_HEAD){for(var b=this.fieldObject.getEditableDomHelper().getElementsByTagNameAndClass(goog.dom.TagName.HEAD),c=[],d=b.length,e=1;e<d;++e)for(var f=b[e].getElementsByTagName(goog.dom.TagName.STYLE),g=f.length,h=0;h<g;++h)c.push(f[h].outerHTML);return c.join("")+a}return a};
goog.editor.plugins.BasicTextFormatter.prototype.handleKeyboardShortcut=function(a,b,c){if(!c)return!1;var d;switch(b){case "b":d=goog.editor.plugins.BasicTextFormatter.COMMAND.BOLD;break;case "i":d=goog.editor.plugins.BasicTextFormatter.COMMAND.ITALIC;break;case "u":d=goog.editor.plugins.BasicTextFormatter.COMMAND.UNDERLINE;break;case "s":return!0}return d?(this.fieldObject.execCommand(d),!0):!1};goog.editor.plugins.BasicTextFormatter.BR_REGEXP_=goog.userAgent.IE?/<br([^\/>]*)\/?>/gi:/<br([^\/>]*)\/?>(?!<\/(div|p)>)/gi;
goog.editor.plugins.BasicTextFormatter.prototype.convertBreaksToDivs_=function(){if(!goog.userAgent.IE&&!goog.userAgent.OPERA)return!1;var a=this.getRange_(),b=a.getContainerElement(),c=this.getDocument_();goog.editor.plugins.BasicTextFormatter.BR_REGEXP_.lastIndex=0;return goog.editor.plugins.BasicTextFormatter.BR_REGEXP_.test(b.innerHTML)?(a=a.saveUsingCarets(),b.tagName==goog.dom.TagName.P?goog.editor.plugins.BasicTextFormatter.convertParagraphToDiv_(b,!0):(b.innerHTML=b.innerHTML.replace(goog.editor.plugins.BasicTextFormatter.BR_REGEXP_,
'<p$1 trtempbr="temp_br">'),b=goog.array.toArray(b.getElementsByTagName(goog.dom.TagName.P)),goog.iter.forEach(b,function(a){if("temp_br"==a.getAttribute("trtempbr")){a.removeAttribute("trtempbr");if(goog.string.isBreakingWhitespace(goog.dom.getTextContent(a))){var b=goog.userAgent.IE?c.createTextNode(goog.string.Unicode.NBSP):c.createElement(goog.dom.TagName.BR);a.appendChild(b)}goog.editor.plugins.BasicTextFormatter.convertParagraphToDiv_(a)}})),a.restore(),!0):!1};
goog.editor.plugins.BasicTextFormatter.convertParagraphToDiv_=function(a,b){if(goog.userAgent.IE||goog.userAgent.OPERA){var c=a.outerHTML.replace(/<(\/?)p/gi,"<$1div");b&&(c=c.replace(goog.editor.plugins.BasicTextFormatter.BR_REGEXP_,"</div><div$1>"));goog.userAgent.OPERA&&!/<\/div>$/i.test(c)&&(c+="</div>");a.outerHTML=c}};goog.editor.plugins.BasicTextFormatter.convertToRealExecCommand_=function(a){return 0==a.indexOf("+")?a.substring(1):a};
goog.editor.plugins.BasicTextFormatter.prototype.justify_=function(a){this.execCommandHelper_(a,null,!1,!0);goog.userAgent.GECKO&&this.execCommandHelper_(a,null,!1,!0);(!goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS||!goog.userAgent.GECKO)&&goog.iter.forEach(this.fieldObject.getRange(),goog.editor.plugins.BasicTextFormatter.convertContainerToTextAlign_)};
goog.editor.plugins.BasicTextFormatter.convertContainerToTextAlign_=function(a){a=goog.editor.style.getContainer(a);a.align&&(a.style.textAlign=a.align,a.removeAttribute("align"))};
goog.editor.plugins.BasicTextFormatter.prototype.execCommandHelper_=function(a,b,c,d){var e=null;c&&(e=this.fieldObject.queryCommandValue(goog.editor.Command.DIR_RTL)?"rtl":this.fieldObject.queryCommandValue(goog.editor.Command.DIR_LTR)?"ltr":null);var a=goog.editor.plugins.BasicTextFormatter.convertToRealExecCommand_(a),f,g;goog.userAgent.IE&&(g=this.applyExecCommandIEFixes_(a),f=g[0],g=g[1]);goog.userAgent.WEBKIT&&(f=this.applyExecCommandSafariFixes_(a));goog.userAgent.GECKO&&this.applyExecCommandGeckoFixes_(a);
goog.editor.BrowserFeature.DOESNT_OVERRIDE_FONT_SIZE_IN_STYLE_ATTR&&"fontsize"==a.toLowerCase()&&this.removeFontSizeFromStyleAttrs_();c=this.getDocument_();d&&goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&(c.execCommand("styleWithCSS",!1,!0),goog.userAgent.OPERA&&this.invalidateInlineCss_());c.execCommand(a,!1,b);d&&goog.editor.BrowserFeature.HAS_STYLE_WITH_CSS&&c.execCommand("styleWithCSS",!1,!1);goog.userAgent.WEBKIT&&!goog.userAgent.isVersion("526")&&"formatblock"==a.toLowerCase()&&b&&/^[<]?h\d[>]?$/i.test(b)&&
this.cleanUpSafariHeadings_();/insert(un)?orderedlist/i.test(a)&&(goog.userAgent.WEBKIT&&this.fixSafariLists_(),goog.userAgent.IE&&(this.fixIELists_(),g&&goog.dom.removeNode(g)));f&&goog.dom.removeNode(f);e&&this.fieldObject.execCommand(e)};
goog.editor.plugins.BasicTextFormatter.prototype.applyBgColorManually_=function(a){var b=goog.userAgent.GECKO,c=this.fieldObject.getRange(),d,e;c&&c.isCollapsed()&&(d=this.getFieldDomHelper().createTextNode(b?" ":""),e=c.getStartNode(),e=e.nodeType==goog.dom.NodeType.ELEMENT?e:e.parentNode,""==e.innerHTML?(e.style.textIndent="-10000px",e.appendChild(d)):(e=this.getFieldDomHelper().createDom("span",{style:"text-indent:-10000px"},d),c.replaceContentsWithNode(e)),goog.dom.Range.createFromNodeContents(d).select());
this.execCommandHelper_("hiliteColor",a,!1,!0);d&&(b&&(d.data=""),e.style.textIndent="")};
goog.editor.plugins.BasicTextFormatter.prototype.toggleLink_=function(a){this.fieldObject.isSelectionEditable()||this.focusField_();var b=this.getRange_(),c=b&&b.getContainerElement();if((c=goog.dom.getAncestorByTagNameAndClass(c,goog.dom.TagName.A))&&goog.editor.node.isEditable(c))goog.dom.flattenElement(c);else if(a=this.createLink_(b,"/",a)){if(!this.fieldObject.execCommand(goog.editor.Command.MODAL_LINK_EDITOR,a))if(b=this.fieldObject.getAppWindow().prompt(goog.ui.editor.messages.MSG_LINK_TO,
"http://"))a.setTextAndUrl(a.getCurrentText()||b,b),a.placeCursorRightOf();else return b=goog.editor.range.saveUsingNormalizedCarets(goog.dom.Range.createFromNodeContents(a.getAnchor())),a.removeLink(),b.restore().select(),null;return a}return null};
goog.editor.plugins.BasicTextFormatter.prototype.createLink_=function(a,b,c){var d=null,e=a&&a.getContainerElement();if(e&&e.tagName==goog.dom.TagName.IMG)return null;if(a&&a.isCollapsed())a=a.getTextRange(0).getBrowserRangeObject(),goog.editor.BrowserFeature.HAS_W3C_RANGES?(d=this.getFieldDomHelper().createElement(goog.dom.TagName.A),a.insertNode(d)):goog.editor.BrowserFeature.HAS_IE_RANGES&&(a.pasteHTML("<a id='newLink'></a>"),d=this.getFieldDomHelper().getElement("newLink"),d.removeAttribute("id"));
else{var f=goog.string.createUniqueString();this.execCommandHelper_("CreateLink",f);goog.array.forEach(this.fieldObject.getElement().getElementsByTagName(goog.dom.TagName.A),function(a){goog.string.endsWith(a.href,f)&&(d=a)})}return goog.editor.Link.createNewLink(d,b,c)};goog.editor.plugins.BasicTextFormatter.brokenExecCommandsIE_={indent:1,outdent:1,insertOrderedList:1,insertUnorderedList:1,justifyCenter:1,justifyFull:1,justifyRight:1,justifyLeft:1,ltr:1,rtl:1};
goog.editor.plugins.BasicTextFormatter.blockquoteHatingCommandsIE_={insertOrderedList:1,insertUnorderedList:1};
goog.editor.plugins.BasicTextFormatter.prototype.applySubscriptSuperscriptWorkarounds_=function(a){if(!this.queryCommandValue(a)){var a=a==goog.editor.plugins.BasicTextFormatter.COMMAND.SUBSCRIPT?goog.editor.plugins.BasicTextFormatter.COMMAND.SUPERSCRIPT:goog.editor.plugins.BasicTextFormatter.COMMAND.SUBSCRIPT,b=goog.editor.plugins.BasicTextFormatter.convertToRealExecCommand_(a);this.queryCommandValue(a)||this.getDocument_().execCommand(b,!1,null);this.getDocument_().execCommand(b,!1,null)}};
goog.editor.plugins.BasicTextFormatter.prototype.removeFontSizeFromStyleAttrs_=function(){var a=goog.editor.range.expand(this.fieldObject.getRange(),this.fieldObject.getElement());goog.iter.forEach(goog.iter.filter(a,function(b,c,d){return d.isStartTag()&&a.containsNode(b)}),function(a){goog.style.setStyle(a,"font-size","");goog.userAgent.GECKO&&0==a.style.length&&null!=a.getAttribute("style")&&a.removeAttribute("style")})};
goog.editor.plugins.BasicTextFormatter.prototype.applyExecCommandIEFixes_=function(a){var b=[],c=null,d=this.getRange_(),e=this.getFieldDomHelper();if(a in goog.editor.plugins.BasicTextFormatter.blockquoteHatingCommandsIE_){var f=d&&d.getContainerElement();if(f){for(var g=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.BLOCKQUOTE,null,f),h,i=0;i<g.length;i++)if(d.containsNode(g[i])){h=g[i];break}if(f=h||goog.dom.getAncestorByTagNameAndClass(f,"BLOCKQUOTE"))c=e.createDom("div",{style:"height:0"}),
goog.dom.appendChild(f,c),b.push(c),h?d=goog.dom.Range.createFromNodes(h,0,c,0):d.containsNode(c)&&(d=goog.dom.Range.createFromNodes(d.getStartNode(),d.getStartOffset(),c,0)),d.select()}}h=this.fieldObject;!h.usesIframe()&&!c&&a in goog.editor.plugins.BasicTextFormatter.brokenExecCommandsIE_&&(a=h.getElement(),d&&d.isCollapsed()&&!goog.dom.getFirstElementChild(a)&&(c=d.getTextRange(0).getBrowserRangeObject(),d=c.duplicate(),d.moveToElementText(a),d.collapse(!1),d.isEqual(c)&&(d=e.createTextNode(goog.string.Unicode.NBSP),
a.appendChild(d),c.move("character",1),c.move("character",-1),c.select(),b.push(d))),c=e.createDom("div",{style:"height:0"}),goog.dom.appendChild(a,c),b.push(c));return b};goog.editor.plugins.BasicTextFormatter.prototype.cleanUpSafariHeadings_=function(){goog.iter.forEach(this.getRange_(),function(a){"Apple-style-span"==a.className&&(a.style.fontSize="",a.style.fontWeight="")})};
goog.editor.plugins.BasicTextFormatter.prototype.fixSafariLists_=function(){var a=!1;goog.iter.forEach(this.getRange_(),function(b){var c=b.tagName;if(c==goog.dom.TagName.UL||c==goog.dom.TagName.OL)if(a){if(c=goog.dom.getPreviousElementSibling(b)){var d=b.ownerDocument.createRange();d.setStartAfter(c);d.setEndBefore(b);if(goog.string.isEmpty(d.toString())&&c.nodeName==b.nodeName){for(;c.lastChild;)b.insertBefore(c.lastChild,b.firstChild);c.parentNode.removeChild(c)}}}else a=!0})};
goog.editor.plugins.BasicTextFormatter.orderedListTypes_={1:1,a:1,A:1,i:1,I:1};goog.editor.plugins.BasicTextFormatter.unorderedListTypes_={disc:1,circle:1,square:1};
goog.editor.plugins.BasicTextFormatter.prototype.fixIELists_=function(){for(var a=this.getRange_(),a=a&&a.getContainer();a&&a.tagName!=goog.dom.TagName.UL&&a.tagName!=goog.dom.TagName.OL;)a=a.parentNode;a&&(a=a.parentNode);if(a){var b=goog.array.toArray(a.getElementsByTagName(goog.dom.TagName.UL));goog.array.extend(b,goog.array.toArray(a.getElementsByTagName(goog.dom.TagName.OL)));goog.array.forEach(b,function(a){var b=a.type;if(b&&!(a.tagName==goog.dom.TagName.UL?goog.editor.plugins.BasicTextFormatter.unorderedListTypes_:
goog.editor.plugins.BasicTextFormatter.orderedListTypes_)[b])a.type=""})}};goog.editor.plugins.BasicTextFormatter.brokenExecCommandsSafari_={justifyCenter:1,justifyFull:1,justifyRight:1,justifyLeft:1,formatBlock:1};goog.editor.plugins.BasicTextFormatter.hangingExecCommandWebkit_={insertOrderedList:1,insertUnorderedList:1};
goog.editor.plugins.BasicTextFormatter.prototype.applyExecCommandSafariFixes_=function(a){var b;goog.editor.plugins.BasicTextFormatter.brokenExecCommandsSafari_[a]&&(b=this.getFieldDomHelper().createDom("div",{style:"height: 0"},"x"),goog.dom.appendChild(this.fieldObject.getElement(),b));goog.editor.plugins.BasicTextFormatter.hangingExecCommandWebkit_[a]&&(a=this.fieldObject.getElement(),b=this.getFieldDomHelper().createDom("div",{style:"height: 0"},"x"),a.insertBefore(b,a.firstChild));return b};
goog.editor.plugins.BasicTextFormatter.prototype.applyExecCommandGeckoFixes_=function(a){if(goog.userAgent.isVersion("1.9")&&"formatblock"==a.toLowerCase()){var a=this.getRange_(),b=a.getStartNode();if(a.isCollapsed()&&b&&b.tagName==goog.dom.TagName.BODY){var c=a.getStartOffset();if((b=b.childNodes[c])&&b.tagName==goog.dom.TagName.BR)a=a.getBrowserRangeObject(),a.setStart(b,0),a.setEnd(b,0)}}};
goog.editor.plugins.BasicTextFormatter.prototype.invalidateInlineCss_=function(){var a=[],b=this.fieldObject.getRange().getContainerElement();do a.push(b);while(b=b.parentNode);a=goog.iter.chain(goog.iter.toIterator(this.fieldObject.getRange()),goog.iter.toIterator(a));a=goog.iter.filter(a,goog.editor.style.isContainer);goog.iter.forEach(a,function(a){var b=a.style.outline;a.style.outline="0px solid red";a.style.outline=b})};
goog.editor.plugins.BasicTextFormatter.prototype.beforeInsertListGecko_=function(){var a=this.fieldObject.queryCommandValue(goog.editor.Command.DEFAULT_TAG);if(a==goog.dom.TagName.P||a==goog.dom.TagName.DIV)return!1;a=this.getRange_();if(a.isCollapsed()&&a.getContainer().nodeType!=goog.dom.NodeType.TEXT){var b=this.getFieldDomHelper().createTextNode(goog.string.Unicode.NBSP);a.insertNode(b,!1);goog.dom.Range.createFromNodeContents(b).select();return!0}return!1};
goog.editor.plugins.BasicTextFormatter.getSelectionBlockState_=function(a){var b=null;goog.iter.forEach(a,function(a,d,e){if(!e.isEndTag()){a=goog.editor.style.getContainer(a).tagName;b=b||a;if(b!=a)throw b=null,goog.iter.StopIteration;e.skipTag()}});return b};goog.editor.plugins.BasicTextFormatter.SUPPORTED_JUSTIFICATIONS_={center:1,justify:1,right:1,left:1};
goog.editor.plugins.BasicTextFormatter.prototype.isJustification_=function(a){a=a.replace("+justify","").toLowerCase();"full"==a&&(a="justify");var b=this.fieldObject.getPluginByClassId("Bidi");if(b)return a==b.getSelectionAlignment();var c=this.getRange_();if(!c)return!1;for(var d=c.getContainerElement(),b=goog.array.filter(d.childNodes,function(a){return goog.editor.node.isImportant(a)&&c.containsNode(a,!0)}),b=b.length?b:[d],d=0;d<b.length;d++){var e=goog.editor.style.getContainer(b[d]);if(a!=
goog.editor.plugins.BasicTextFormatter.getNodeJustification_(e))return!1}return!0};goog.editor.plugins.BasicTextFormatter.getNodeJustification_=function(a){var b=goog.style.getComputedTextAlign(a),b=b.replace(/^-(moz|webkit)-/,"");goog.editor.plugins.BasicTextFormatter.SUPPORTED_JUSTIFICATIONS_[b]||(b=a.align||"left");return b};
goog.editor.plugins.BasicTextFormatter.prototype.isNodeInState_=function(a){var b=this.getRange_(),b=b&&b.getContainerElement(),a=goog.dom.getAncestorByTagNameAndClass(b,a);return!!a&&goog.editor.node.isEditable(a)};goog.editor.plugins.BasicTextFormatter.prototype.queryCommandStateInternal_=function(a,b,c){return this.queryCommandHelper_(!0,a,b,c)};goog.editor.plugins.BasicTextFormatter.prototype.queryCommandValueInternal_=function(a,b,c){return this.queryCommandHelper_(!1,a,b,c)};
goog.editor.plugins.BasicTextFormatter.prototype.queryCommandHelper_=function(a,b,c,d){c=goog.editor.plugins.BasicTextFormatter.convertToRealExecCommand_(c);if(d){var e=this.getDocument_();e.execCommand("styleWithCSS",!1,!0)}a=a?b.queryCommandState(c):b.queryCommandValue(c);d&&e.execCommand("styleWithCSS",!1,!1);return a};fyre.v1.editor.plugins.BasicTextFormatter=function(){goog.editor.plugins.BasicTextFormatter.call(this)};goog.inherits(fyre.v1.editor.plugins.BasicTextFormatter,goog.editor.plugins.BasicTextFormatter);
fyre.v1.editor.plugins.BasicTextFormatter.prototype.execCommandInternal=function(a,b){this.fieldObject.isEverModified_||(this.fieldObject.clearBeforeFirstInsert&&(this.fieldObject.setHtml(!1,null,!0),this.fieldObject.clearBeforeFirstInsert=!1),this.fieldObject.focusAndPlaceCursorAtStart());return fyre.v1.editor.plugins.BasicTextFormatter.superClass_.execCommandInternal.call(this,a,b)};goog.dom.ViewportSizeMonitor=function(a){goog.events.EventTarget.call(this);this.window_=a||window;this.listenerKey_=goog.events.listen(this.window_,goog.events.EventType.RESIZE,this.handleResize_,!1,this);this.size_=goog.dom.getViewportSize(this.window_);this.isPollingRequired_()&&(this.windowSizePollInterval_=window.setInterval(goog.bind(this.checkForSizeChange_,this),goog.dom.ViewportSizeMonitor.WINDOW_SIZE_POLL_RATE))};goog.inherits(goog.dom.ViewportSizeMonitor,goog.events.EventTarget);
goog.dom.ViewportSizeMonitor.getInstanceForWindow=function(a){var a=a||window,b=goog.getUid(a);return goog.dom.ViewportSizeMonitor.windowInstanceMap_[b]=goog.dom.ViewportSizeMonitor.windowInstanceMap_[b]||new goog.dom.ViewportSizeMonitor(a)};goog.dom.ViewportSizeMonitor.windowInstanceMap_={};goog.dom.ViewportSizeMonitor.WINDOW_SIZE_POLL_RATE=500;goog.dom.ViewportSizeMonitor.prototype.listenerKey_=null;goog.dom.ViewportSizeMonitor.prototype.window_=null;
goog.dom.ViewportSizeMonitor.prototype.size_=null;goog.dom.ViewportSizeMonitor.prototype.windowSizePollInterval_=null;goog.dom.ViewportSizeMonitor.prototype.isPollingRequired_=function(){return goog.userAgent.WEBKIT&&goog.userAgent.WINDOWS||goog.userAgent.OPERA&&this.window_.self!=this.window_.top};goog.dom.ViewportSizeMonitor.prototype.getSize=function(){return this.size_?this.size_.clone():null};
goog.dom.ViewportSizeMonitor.prototype.disposeInternal=function(){goog.dom.ViewportSizeMonitor.superClass_.disposeInternal.call(this);this.listenerKey_&&(goog.events.unlistenByKey(this.listenerKey_),this.listenerKey_=null);this.windowSizePollInterval_&&(window.clearInterval(this.windowSizePollInterval_),this.windowSizePollInterval_=null);this.size_=this.window_=null};goog.dom.ViewportSizeMonitor.prototype.handleResize_=function(){this.checkForSizeChange_()};
goog.dom.ViewportSizeMonitor.prototype.checkForSizeChange_=function(){var a=goog.dom.getViewportSize(this.window_);goog.math.Size.equals(a,this.size_)||(this.size_=a,this.dispatchEvent(goog.events.EventType.RESIZE))};goog.ui.editor.Bubble=function(a,b){goog.events.EventTarget.call(this);this.dom_=goog.dom.getDomHelper(a);this.eventHandler_=new goog.events.EventHandler(this);this.viewPortSizeMonitor_=new goog.dom.ViewportSizeMonitor(this.dom_.getWindow());this.panels_={};this.bubbleContainer_=this.dom_.createDom(goog.dom.TagName.DIV,{className:goog.ui.editor.Bubble.BUBBLE_CLASSNAME});goog.style.showElement(this.bubbleContainer_,!1);goog.dom.appendChild(a,this.bubbleContainer_);goog.style.setStyle(this.bubbleContainer_,
"zIndex",b);this.bubbleContents_=this.createBubbleDom(this.dom_,this.bubbleContainer_);this.closeBox_=this.dom_.createDom(goog.dom.TagName.DIV,{className:"tr_bubble_closebox",innerHTML:"&nbsp;"});this.bubbleContents_.appendChild(this.closeBox_);goog.editor.style.makeUnselectable(this.bubbleContainer_,this.eventHandler_);this.popup_=new goog.ui.PopupBase(this.bubbleContainer_)};goog.inherits(goog.ui.editor.Bubble,goog.events.EventTarget);goog.ui.editor.Bubble.BUBBLE_CLASSNAME="tr_bubble";
goog.ui.editor.Bubble.prototype.createBubbleDom=function(a,b){return b};goog.ui.editor.Bubble.prototype.logger=goog.debug.Logger.getLogger("goog.ui.editor.Bubble");goog.ui.editor.Bubble.prototype.disposeInternal=function(){goog.ui.editor.Bubble.superClass_.disposeInternal.call(this);goog.dom.removeNode(this.bubbleContainer_);this.bubbleContainer_=null;this.eventHandler_.dispose();this.eventHandler_=null;this.viewPortSizeMonitor_.dispose();this.viewPortSizeMonitor_=null};
goog.ui.editor.Bubble.prototype.getContentElement=function(){return this.bubbleContents_};goog.ui.editor.Bubble.prototype.getContainerElement=function(){return this.bubbleContainer_};goog.ui.editor.Bubble.prototype.getEventHandler=function(){return this.eventHandler_};goog.ui.editor.Bubble.prototype.handleWindowResize_=function(){this.isVisible()&&this.reposition()};goog.ui.editor.Bubble.prototype.hasPanelOfType=function(a){return goog.object.some(this.panels_,function(b){return b.type==a})};
goog.ui.editor.Bubble.prototype.addPanel=function(a,b,c,d,e){var f=goog.string.createUniqueString(),b=new goog.ui.editor.Bubble.Panel_(this.dom_,f,a,b,c,!e);this.panels_[f]=b;for(var g,c=0,e=this.bubbleContents_.childNodes.length-1;c<e;c++){var h=this.bubbleContents_.childNodes[c];if(this.panels_[h.id].type>a){g=h;break}}goog.dom.insertSiblingBefore(b.element,g||this.bubbleContents_.lastChild);d(b.getContentElement());goog.editor.style.makeUnselectable(b.element,this.eventHandler_);a=goog.object.getCount(this.panels_);
1==a?this.openBubble_():2==a&&goog.dom.classes.add(this.bubbleContainer_,"tr_multi_bubble");this.reposition();return f};goog.ui.editor.Bubble.prototype.removePanel=function(a){goog.dom.removeNode(this.panels_[a].element);delete this.panels_[a];a=goog.object.getCount(this.panels_);1>=a&&goog.dom.classes.remove(this.bubbleContainer_,"tr_multi_bubble");0==a?this.closeBubble_():this.reposition()};
goog.ui.editor.Bubble.prototype.openBubble_=function(){this.eventHandler_.listen(this.closeBox_,goog.events.EventType.CLICK,this.closeBubble_).listen(this.viewPortSizeMonitor_,goog.events.EventType.RESIZE,this.handleWindowResize_).listen(this.popup_,goog.ui.PopupBase.EventType.HIDE,this.handlePopupHide);this.popup_.setVisible(!0);this.reposition()};goog.ui.editor.Bubble.prototype.closeBubble_=function(){this.popup_.setVisible(!1)};
goog.ui.editor.Bubble.prototype.handlePopupHide=function(){for(var a in this.panels_)goog.dom.removeNode(this.panels_[a].element);this.panels_={};goog.dom.classes.remove(this.bubbleContainer_,"tr_multi_bubble");this.eventHandler_.removeAll();this.dispatchEvent(goog.ui.Component.EventType.HIDE)};goog.ui.editor.Bubble.prototype.isVisible=function(){return this.popup_.isVisible()};goog.ui.editor.Bubble.VERTICAL_CLEARANCE_=goog.userAgent.IE?4:2;
goog.ui.editor.Bubble.MARGIN_BOX_=new goog.math.Box(goog.ui.editor.Bubble.VERTICAL_CLEARANCE_,0,goog.ui.editor.Bubble.VERTICAL_CLEARANCE_,0);
goog.ui.editor.Bubble.prototype.reposition=function(){var a=null,b=!0,c;for(c in this.panels_)var d=this.panels_[c],a=d.targetElement,b=b&&d.preferBottomPosition;c=goog.positioning.OverflowStatus.FAILED;a=goog.style.isRightToLeft(this.bubbleContainer_)!=goog.style.isRightToLeft(a);b&&(c=this.positionAtAnchor_(a?goog.positioning.Corner.BOTTOM_END:goog.positioning.Corner.BOTTOM_START,goog.positioning.Corner.TOP_START,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.FAIL_Y));c&goog.positioning.OverflowStatus.FAILED&&
(c=this.positionAtAnchor_(a?goog.positioning.Corner.TOP_END:goog.positioning.Corner.TOP_START,goog.positioning.Corner.BOTTOM_START,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.FAIL_Y));c&goog.positioning.OverflowStatus.FAILED&&(c=this.positionAtAnchor_(a?goog.positioning.Corner.BOTTOM_END:goog.positioning.Corner.BOTTOM_START,goog.positioning.Corner.TOP_START,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.ADJUST_Y),c&goog.positioning.OverflowStatus.FAILED&&this.logger.warning("reposition(): positionAtAnchor() failed with "+
c))};goog.ui.editor.Bubble.prototype.positionAtAnchor_=function(a,b,c){var d=null,e;for(e in this.panels_){var f=this.panels_[e].targetElement;if(!d||goog.dom.contains(f,d))d=this.panels_[e].targetElement}return goog.positioning.positionAtAnchor(d,a,this.bubbleContainer_,b,null,goog.ui.editor.Bubble.MARGIN_BOX_,c)};
goog.ui.editor.Bubble.Panel_=function(a,b,c,d,e,f){this.type=c;this.targetElement=e;this.preferBottomPosition=f;this.element=a.createDom(goog.dom.TagName.DIV,{className:"tr_bubble_panel",id:b},a.createDom(goog.dom.TagName.DIV,{className:"tr_bubble_panel_title"},d+":"),a.createDom(goog.dom.TagName.DIV,{className:"tr_bubble_panel_content"}))};goog.ui.editor.Bubble.Panel_.prototype.getContentElement=function(){return this.element.lastChild};goog.editor.plugins.AbstractBubblePlugin=function(){goog.editor.Plugin.call(this);this.eventRegister=new goog.events.EventHandler(this)};goog.inherits(goog.editor.plugins.AbstractBubblePlugin,goog.editor.Plugin);goog.editor.plugins.AbstractBubblePlugin.OPTION_LINK_CLASSNAME_="tr_option-link";goog.editor.plugins.AbstractBubblePlugin.LINK_CLASSNAME_="tr_bubble_link";goog.editor.plugins.AbstractBubblePlugin.DASH_NBSP_STRING=goog.string.Unicode.NBSP+"-"+goog.string.Unicode.NBSP;
goog.editor.plugins.AbstractBubblePlugin.defaultBubbleFactory_=function(a,b){return new goog.ui.editor.Bubble(a,b)};goog.editor.plugins.AbstractBubblePlugin.bubbleFactory_=goog.editor.plugins.AbstractBubblePlugin.defaultBubbleFactory_;goog.editor.plugins.AbstractBubblePlugin.setBubbleFactory=function(a){goog.editor.plugins.AbstractBubblePlugin.bubbleFactory_=a};goog.editor.plugins.AbstractBubblePlugin.bubbleMap_={};goog.editor.plugins.AbstractBubblePlugin.prototype.panelId_=null;
goog.editor.plugins.AbstractBubblePlugin.prototype.setBubbleParent=function(a){this.bubbleParent_=a};goog.editor.plugins.AbstractBubblePlugin.prototype.getBubbleDom=function(){return this.dom_};goog.editor.plugins.AbstractBubblePlugin.prototype.getTrogClassId=goog.functions.constant("AbstractBubblePlugin");goog.editor.plugins.AbstractBubblePlugin.prototype.getTargetElement=function(){return this.targetElement_};
goog.editor.plugins.AbstractBubblePlugin.prototype.handleKeyUp=function(){this.isVisible()&&this.handleSelectionChange();return!1};
goog.editor.plugins.AbstractBubblePlugin.prototype.handleSelectionChange=function(a,b){var c;if(a)c=a.target;else if(b)c=b;else{var d=this.fieldObject.getRange();if(d){var e=d.getStartNode(),f=d.getEndNode(),g=d.getStartOffset(),h=d.getEndOffset();goog.userAgent.IE&&d.isCollapsed()&&e!=f&&(d=goog.dom.Range.createCaret(e,g));e.nodeType==goog.dom.NodeType.ELEMENT&&e==f&&g==h-1&&(e=e.childNodes[g],e.nodeType==goog.dom.NodeType.ELEMENT&&(c=e))}c=c||d&&d.getContainerElement()}return this.handleSelectionChangeInternal_(c)};
goog.editor.plugins.AbstractBubblePlugin.prototype.handleSelectionChangeInternal_=function(a){if(a&&(a=this.getBubbleTargetFromSelection(a))){if(a!=this.targetElement_||!this.panelId_)this.panelId_&&this.closeBubble(),this.createBubble(a);return!1}this.panelId_&&this.closeBubble();return!1};goog.editor.plugins.AbstractBubblePlugin.prototype.disable=function(a){if(a.isUneditable()){var b=goog.editor.plugins.AbstractBubblePlugin.bubbleMap_[a.id];b&&(b.dispose(),delete goog.editor.plugins.AbstractBubblePlugin.bubbleMap_[a.id])}};
goog.editor.plugins.AbstractBubblePlugin.prototype.getSharedBubble_=function(){var a=this.bubbleParent_||this.fieldObject.getAppWindow().document.body;this.dom_=goog.dom.getDomHelper(a);var b=goog.editor.plugins.AbstractBubblePlugin.bubbleMap_[this.fieldObject.id];b||(b=goog.editor.plugins.AbstractBubblePlugin.bubbleFactory_.call(null,a,this.fieldObject.getBaseZindex()),goog.editor.plugins.AbstractBubblePlugin.bubbleMap_[this.fieldObject.id]=b);return b};
goog.editor.plugins.AbstractBubblePlugin.prototype.createBubble=function(a){var b=this.getSharedBubble_();b.hasPanelOfType(this.getBubbleType())||(this.targetElement_=a,this.panelId_=b.addPanel(this.getBubbleType(),this.getBubbleTitle(),a,goog.bind(this.createBubbleContents,this),this.shouldPreferBubbleAboveElement()),this.eventRegister.listen(b,goog.ui.Component.EventType.HIDE,this.handlePanelClosed_),this.onShow())};goog.editor.plugins.AbstractBubblePlugin.prototype.getBubbleType=function(){return""};
goog.editor.plugins.AbstractBubblePlugin.prototype.getBubbleTitle=function(){return""};goog.editor.plugins.AbstractBubblePlugin.prototype.shouldPreferBubbleAboveElement=goog.functions.FALSE;goog.editor.plugins.AbstractBubblePlugin.prototype.registerClickHandler=function(a,b){this.eventRegister.listen(a,goog.events.EventType.CLICK,b)};goog.editor.plugins.AbstractBubblePlugin.prototype.closeBubble=function(){this.panelId_&&(this.getSharedBubble_().removePanel(this.panelId_),this.handlePanelClosed_())};
goog.editor.plugins.AbstractBubblePlugin.prototype.onShow=goog.nullFunction;goog.editor.plugins.AbstractBubblePlugin.prototype.handlePanelClosed_=function(){this.panelId_=this.targetElement_=null;this.eventRegister.removeAll()};goog.editor.plugins.AbstractBubblePlugin.prototype.isVisible=function(){return!!this.panelId_};goog.editor.plugins.AbstractBubblePlugin.prototype.reposition=function(){var a=this.getSharedBubble_();a&&a.reposition()};
goog.editor.plugins.AbstractBubblePlugin.prototype.createLinkOption=function(a){return this.dom_.createDom(goog.dom.TagName.SPAN,{id:a,className:goog.editor.plugins.AbstractBubblePlugin.OPTION_LINK_CLASSNAME_},this.dom_.createTextNode(goog.editor.plugins.AbstractBubblePlugin.DASH_NBSP_STRING))};goog.editor.plugins.AbstractBubblePlugin.prototype.createLink=function(a,b,c,d){a=this.createLinkHelper(a,b,!1,d);c&&this.registerClickHandler(a,c);return a};
goog.editor.plugins.AbstractBubblePlugin.prototype.createLinkHelper=function(a,b,c,d){b=this.dom_.createDom(c?goog.dom.TagName.A:goog.dom.TagName.SPAN,{className:goog.editor.plugins.AbstractBubblePlugin.LINK_CLASSNAME_},b);this.setupLink(b,a,d);goog.editor.style.makeUnselectable(b,this.eventRegister);return b};goog.editor.plugins.AbstractBubblePlugin.prototype.setupLink=function(a,b,c){c?c.appendChild(a):(c=this.dom_.getElement(b))&&goog.dom.replaceNode(a,c);a.id=b};goog.editor.plugins.LinkBubble=function(a){goog.editor.plugins.AbstractBubblePlugin.call(this);this.extraActions_=goog.array.toArray(arguments);this.actionSpans_=[];this.safeToOpenSchemes_=["http","https","ftp"]};goog.inherits(goog.editor.plugins.LinkBubble,goog.editor.plugins.AbstractBubblePlugin);goog.editor.plugins.LinkBubble.LINK_TEXT_ID_="tr_link-text";goog.editor.plugins.LinkBubble.TEST_LINK_SPAN_ID_="tr_test-link-span";goog.editor.plugins.LinkBubble.TEST_LINK_ID_="tr_test-link";
goog.editor.plugins.LinkBubble.CHANGE_LINK_SPAN_ID_="tr_change-link-span";goog.editor.plugins.LinkBubble.CHANGE_LINK_ID_="tr_change-link";goog.editor.plugins.LinkBubble.DELETE_LINK_SPAN_ID_="tr_delete-link-span";goog.editor.plugins.LinkBubble.DELETE_LINK_ID_="tr_delete-link";goog.editor.plugins.LinkBubble.LINK_DIV_ID_="tr_link-div";var MSG_LINK_BUBBLE_TEST_LINK=goog.getMsg("Go to link: "),MSG_LINK_BUBBLE_CHANGE=goog.getMsg("Change"),MSG_LINK_BUBBLE_REMOVE=goog.getMsg("Remove");
goog.editor.plugins.LinkBubble.prototype.stopReferrerLeaks_=!1;goog.editor.plugins.LinkBubble.prototype.blockOpeningUnsafeSchemes_=!0;goog.editor.plugins.LinkBubble.prototype.stopReferrerLeaks=function(){this.stopReferrerLeaks_=!0};goog.editor.plugins.LinkBubble.prototype.setBlockOpeningUnsafeSchemes=function(a){this.blockOpeningUnsafeSchemes_=a};goog.editor.plugins.LinkBubble.prototype.setSafeToOpenSchemes=function(a){this.safeToOpenSchemes_=a};
goog.editor.plugins.LinkBubble.prototype.getTrogClassId=function(){return"LinkBubble"};goog.editor.plugins.LinkBubble.prototype.isSupportedCommand=function(a){return a==goog.editor.Command.UPDATE_LINK_BUBBLE};goog.editor.plugins.LinkBubble.prototype.execCommandInternal=function(a){a==goog.editor.Command.UPDATE_LINK_BUBBLE&&this.updateLink_()};goog.editor.plugins.LinkBubble.prototype.updateLink_=function(){var a=this.getTargetElement();this.closeBubble();this.createBubble(a)};
goog.editor.plugins.LinkBubble.prototype.getBubbleTargetFromSelection=function(a){a=goog.dom.getAncestorByTagNameAndClass(a,goog.dom.TagName.A);if(!a){var b=this.fieldObject.getRange();b&&b.isCollapsed()&&0==b.getStartOffset()&&(b=b.getStartNode().previousSibling)&&b.tagName==goog.dom.TagName.A&&(a=b)}return a};goog.editor.plugins.LinkBubble.prototype.setTestLinkUrlFn=function(a){this.testLinkUrlFn_=a};
goog.editor.plugins.LinkBubble.prototype.getTargetUrl=function(){return this.getTargetElement().getAttribute("href")||""};goog.editor.plugins.LinkBubble.prototype.getBubbleType=function(){return goog.dom.TagName.A};goog.editor.plugins.LinkBubble.prototype.getBubbleTitle=function(){return goog.ui.editor.messages.MSG_LINK_CAPTION};
goog.editor.plugins.LinkBubble.prototype.createBubbleContents=function(a){var b=this.getLinkToTextObj_(),c=b.valid?"black":"red",d=this.shouldOpenUrl(b.linkText);if(goog.editor.Link.isLikelyEmailAddress(b.linkText)||!b.valid||!d)c=this.dom_.createDom(goog.dom.TagName.SPAN,{id:goog.editor.plugins.LinkBubble.LINK_TEXT_ID_,style:"color:"+c},this.dom_.createTextNode(b.linkText));else{var e=this.dom_.createDom(goog.dom.TagName.SPAN,{id:goog.editor.plugins.LinkBubble.TEST_LINK_SPAN_ID_},MSG_LINK_BUBBLE_TEST_LINK),
c=this.dom_.createDom(goog.dom.TagName.SPAN,{id:goog.editor.plugins.LinkBubble.LINK_TEXT_ID_,style:"color:"+c},""),b=goog.string.truncateMiddle(b.linkText,48);this.createLink(goog.editor.plugins.LinkBubble.TEST_LINK_ID_,this.dom_.createTextNode(b).data,this.testLink,c)}d=this.createLinkOption(goog.editor.plugins.LinkBubble.CHANGE_LINK_SPAN_ID_);this.createLink(goog.editor.plugins.LinkBubble.CHANGE_LINK_ID_,MSG_LINK_BUBBLE_CHANGE,this.showLinkDialog_,d);this.actionSpans_=[];for(b=0;b<this.extraActions_.length;b++){var f=
this.extraActions_[b],g=this.createLinkOption(f.spanId_);this.actionSpans_.push(g);this.createLink(f.linkId_,f.message_,function(){f.actionFn_(this.getTargetUrl())},g)}g=this.createLinkOption(goog.editor.plugins.LinkBubble.DELETE_LINK_SPAN_ID_);this.createLink(goog.editor.plugins.LinkBubble.DELETE_LINK_ID_,MSG_LINK_BUBBLE_REMOVE,this.deleteLink_,g);this.onShow();e=this.dom_.createDom(goog.dom.TagName.DIV,{id:goog.editor.plugins.LinkBubble.LINK_DIV_ID_},e||"",c,d);for(b=0;b<this.actionSpans_.length;b++)e.appendChild(this.actionSpans_[b]);
e.appendChild(g);goog.dom.appendChild(a,e)};goog.editor.plugins.LinkBubble.prototype.testLink=function(){goog.window.open(this.getTestLinkAction_(),{target:"_blank",noreferrer:this.stopReferrerLeaks_},this.fieldObject.getAppWindow())};goog.editor.plugins.LinkBubble.prototype.isInvalidUrl=goog.functions.FALSE;
goog.editor.plugins.LinkBubble.prototype.getLinkToTextObj_=function(){var a,b=this.getTargetUrl();this.isInvalidUrl(b)?(b=goog.getMsg("invalid url"),a=!0):goog.editor.Link.isMailto(b)&&(b=b.substring(7));return{linkText:b,valid:!a}};goog.editor.plugins.LinkBubble.prototype.showLinkDialog_=function(){this.fieldObject.execCommand(goog.editor.Command.MODAL_LINK_EDITOR,new goog.editor.Link(this.getTargetElement(),!1));this.closeBubble()};
goog.editor.plugins.LinkBubble.prototype.deleteLink_=function(){this.fieldObject.dispatchBeforeChange();var a=this.getTargetElement(),b=a.lastChild;goog.dom.flattenElement(a);goog.editor.range.placeCursorNextTo(b,!1);this.closeBubble();this.fieldObject.dispatchChange()};
goog.editor.plugins.LinkBubble.prototype.onShow=function(){if(this.dom_.getElement(goog.editor.plugins.LinkBubble.LINK_DIV_ID_)){var a=this.dom_.getElement(goog.editor.plugins.LinkBubble.TEST_LINK_SPAN_ID_);if(a){var b=this.getTargetUrl();goog.style.showElement(a,!goog.editor.Link.isMailto(b))}for(a=0;a<this.extraActions_.length;a++){var b=this.extraActions_[a],c=this.dom_.getElement(b.spanId_);c&&goog.style.showElement(c,b.toShowFn_(this.getTargetUrl()))}}};
goog.editor.plugins.LinkBubble.prototype.getTestLinkAction_=function(){var a=this.getTargetUrl();return this.testLinkUrlFn_?this.testLinkUrlFn_(a):a};goog.editor.plugins.LinkBubble.prototype.shouldOpenUrl=function(a){return!this.blockOpeningUnsafeSchemes_||this.isSafeSchemeToOpen_(a)};goog.editor.plugins.LinkBubble.prototype.isSafeSchemeToOpen_=function(a){a=goog.uri.utils.getScheme(a)||"http";return goog.array.contains(this.safeToOpenSchemes_,a.toLowerCase())};
goog.editor.plugins.LinkBubble.Action=function(a,b,c,d,e){this.spanId_=a;this.linkId_=b;this.message_=c;this.toShowFn_=d;this.actionFn_=e};goog.editor.plugins.UndoRedoState=function(a){this.asynchronous_=a};goog.inherits(goog.editor.plugins.UndoRedoState,goog.events.EventTarget);goog.editor.plugins.UndoRedoState.ACTION_COMPLETED="action_completed";goog.editor.plugins.UndoRedoState.prototype.isAsynchronous=function(){return this.asynchronous_};goog.editor.plugins.UndoRedoManager=function(){goog.events.EventTarget.call(this);this.maxUndoDepth_=100;this.undoStack_=[];this.redoStack_=[];this.pendingActions_=[]};goog.inherits(goog.editor.plugins.UndoRedoManager,goog.events.EventTarget);goog.editor.plugins.UndoRedoManager.EventType={STATE_CHANGE:"state_change",STATE_ADDED:"state_added",BEFORE_UNDO:"before_undo",BEFORE_REDO:"before_redo"};goog.editor.plugins.UndoRedoManager.prototype.inProgressActionKey_=null;
goog.editor.plugins.UndoRedoManager.prototype.setMaxUndoDepth=function(a){this.maxUndoDepth_=a};
goog.editor.plugins.UndoRedoManager.prototype.addState=function(a){if(0==this.undoStack_.length||!a.equals(this.undoStack_[this.undoStack_.length-1])){this.undoStack_.push(a);this.undoStack_.length>this.maxUndoDepth_&&this.undoStack_.shift();var b=this.redoStack_.length;this.redoStack_.length=0;this.dispatchEvent({type:goog.editor.plugins.UndoRedoManager.EventType.STATE_ADDED,state:a});(1==this.undoStack_.length||b)&&this.dispatchStateChange_()}};
goog.editor.plugins.UndoRedoManager.prototype.dispatchStateChange_=function(){this.dispatchEvent(goog.editor.plugins.UndoRedoManager.EventType.STATE_CHANGE)};goog.editor.plugins.UndoRedoManager.prototype.undo=function(){this.shiftState_(this.undoStack_,this.redoStack_)};goog.editor.plugins.UndoRedoManager.prototype.redo=function(){this.shiftState_(this.redoStack_,this.undoStack_)};goog.editor.plugins.UndoRedoManager.prototype.hasUndoState=function(){return 0<this.undoStack_.length};
goog.editor.plugins.UndoRedoManager.prototype.hasRedoState=function(){return 0<this.redoStack_.length};goog.editor.plugins.UndoRedoManager.prototype.shiftState_=function(a,b){if(a.length){var c=a.pop();b.push(c);this.addAction_({type:a==this.undoStack_?goog.editor.plugins.UndoRedoManager.EventType.BEFORE_UNDO:goog.editor.plugins.UndoRedoManager.EventType.BEFORE_REDO,func:a==this.undoStack_?c.undo:c.redo,state:c});(0==a.length||1==b.length)&&this.dispatchStateChange_()}};
goog.editor.plugins.UndoRedoManager.prototype.addAction_=function(a){this.pendingActions_.push(a);1==this.pendingActions_.length&&this.doAction_()};
goog.editor.plugins.UndoRedoManager.prototype.doAction_=function(){if(!(this.inProgressActionKey_||0==this.pendingActions_.length)){var a=this.pendingActions_.shift();this.dispatchEvent({type:a.type,state:a.state})&&(a.state.isAsynchronous()?(this.inProgressActionKey_=goog.events.listen(a.state,goog.editor.plugins.UndoRedoState.ACTION_COMPLETED,this.finishAction_,!1,this),a.func.call(a.state)):(a.func.call(a.state),this.doAction_()))}};
goog.editor.plugins.UndoRedoManager.prototype.finishAction_=function(){goog.events.unlistenByKey(this.inProgressActionKey_);this.inProgressActionKey_=null;this.doAction_()};goog.editor.plugins.UndoRedoManager.prototype.clearHistory=function(){if(0<this.undoStack_.length||0<this.redoStack_.length)this.undoStack_.length=0,this.redoStack_.length=0,this.dispatchStateChange_()};goog.editor.plugins.UndoRedoManager.prototype.undoPeek=function(){return this.undoStack_[this.undoStack_.length-1]};
goog.editor.plugins.UndoRedoManager.prototype.redoPeek=function(){return this.redoStack_[this.redoStack_.length-1]};goog.editor.plugins.UndoRedo=function(a){goog.editor.Plugin.call(this);this.setUndoRedoManager(a||new goog.editor.plugins.UndoRedoManager);this.eventHandlers_={};this.currentStates_={};this.initialFieldChange_=null;this.boundRestoreState_=goog.bind(this.restoreState,this)};goog.inherits(goog.editor.plugins.UndoRedo,goog.editor.Plugin);goog.editor.plugins.UndoRedo.prototype.logger=goog.debug.Logger.getLogger("goog.editor.plugins.UndoRedo");goog.editor.plugins.UndoRedo.prototype.inProgressUndo_=null;
goog.editor.plugins.UndoRedo.COMMAND={UNDO:"+undo",REDO:"+redo"};goog.editor.plugins.UndoRedo.SUPPORTED_COMMANDS_=goog.object.transpose(goog.editor.plugins.UndoRedo.COMMAND);goog.editor.plugins.UndoRedo.prototype.setMaxUndoDepth=function(a){this.undoManager_.setMaxUndoDepth(a)};
goog.editor.plugins.UndoRedo.prototype.setUndoRedoManager=function(a){this.managerStateChangeKey_&&goog.events.unlistenByKey(this.managerStateChangeKey_);this.undoManager_=a;this.managerStateChangeKey_=goog.events.listen(this.undoManager_,goog.editor.plugins.UndoRedoManager.EventType.STATE_CHANGE,this.dispatchCommandValueChange_,!1,this)};goog.editor.plugins.UndoRedo.prototype.isSupportedCommand=function(a){return a in goog.editor.plugins.UndoRedo.SUPPORTED_COMMANDS_};
goog.editor.plugins.UndoRedo.prototype.registerFieldObject=function(a){this.fieldObject=a};goog.editor.plugins.UndoRedo.prototype.unregisterFieldObject=function(a){this.disable(a);this.fieldObject=null};goog.editor.plugins.UndoRedo.prototype.getCurrentFieldObject=function(){return this.fieldObject};goog.editor.plugins.UndoRedo.prototype.getFieldObject=function(){return this.fieldObject};goog.editor.plugins.UndoRedo.prototype.getCurrentEventTarget=function(){return this.fieldObject};
goog.editor.plugins.UndoRedo.prototype.enable=function(a){if(!this.isEnabled(a)){a.clearDelayedChange();var b=new goog.events.EventHandler(this);goog.editor.BrowserFeature.USE_MUTATION_EVENTS||b.listen(a,goog.editor.Field.EventType.BEFORECHANGE,this.handleBeforeChange_);b.listen(a,goog.editor.Field.EventType.DELAYEDCHANGE,this.handleDelayedChange_);b.listen(a,goog.editor.Field.EventType.BLUR,this.handleBlur_);this.eventHandlers_[a.getHashCode()]=b;this.updateCurrentState_(a)}};
goog.editor.plugins.UndoRedo.prototype.disable=function(a){a.clearDelayedChange();var b=this.eventHandlers_[a.getHashCode()];b&&(b.dispose(),delete this.eventHandlers_[a.getHashCode()]);this.currentStates_[a.getHashCode()]&&delete this.currentStates_[a.getHashCode()]};goog.editor.plugins.UndoRedo.prototype.isEnabled=function(a){return!!this.eventHandlers_[a.getHashCode()]};
goog.editor.plugins.UndoRedo.prototype.disposeInternal=function(){goog.editor.plugins.UndoRedo.superClass_.disposeInternal.call(this);for(var a in this.eventHandlers_)this.eventHandlers_[a].dispose(),delete this.eventHandlers_[a];this.fieldObject=null;this.undoManager_&&(this.undoManager_.dispose(),delete this.undoManager_)};goog.editor.plugins.UndoRedo.prototype.getTrogClassId=function(){return"UndoRedo"};
goog.editor.plugins.UndoRedo.prototype.execCommand=function(a){a==goog.editor.plugins.UndoRedo.COMMAND.UNDO?this.undoManager_.undo():a==goog.editor.plugins.UndoRedo.COMMAND.REDO&&this.undoManager_.redo()};goog.editor.plugins.UndoRedo.prototype.queryCommandValue=function(a){var b=null;a==goog.editor.plugins.UndoRedo.COMMAND.UNDO?b=this.undoManager_.hasUndoState():a==goog.editor.plugins.UndoRedo.COMMAND.REDO&&(b=this.undoManager_.hasRedoState());return b};
goog.editor.plugins.UndoRedo.prototype.dispatchCommandValueChange_=function(){this.getCurrentEventTarget().dispatchEvent({type:goog.editor.Field.EventType.COMMAND_VALUE_CHANGE,commands:[goog.editor.plugins.UndoRedo.COMMAND.REDO,goog.editor.plugins.UndoRedo.COMMAND.UNDO]})};
goog.editor.plugins.UndoRedo.prototype.restoreState=function(a,b,c){var d=this.getFieldObject(a.fieldHashCode);if(d){d.stopChangeEvents(!0,!0);try{d.dispatchBeforeChange();d.execCommand(goog.editor.Command.CLEAR_LOREM,!0);d.getElement().innerHTML=b;c&&c.select();var e=this.getCurrentFieldObject();d.focus();e&&e.getHashCode()!=a.fieldHashCode&&e.execCommand(goog.editor.Command.UPDATE_LOREM);this.currentStates_[a.fieldHashCode].setUndoState(b,c)}catch(f){this.logger.severe("Error while restoring undo state",
f)}finally{this.inProgressUndo_=a,d.dispatchChange(),d.dispatchSelectionChangeEvent()}}};
goog.editor.plugins.UndoRedo.prototype.handleKeyboardShortcut=function(a,b,c){if(c){var d;"z"==b?d=a.shiftKey?goog.editor.plugins.UndoRedo.COMMAND.REDO:goog.editor.plugins.UndoRedo.COMMAND.UNDO:"y"==b&&(d=goog.editor.plugins.UndoRedo.COMMAND.REDO);if(d)return(a=d==goog.editor.plugins.UndoRedo.COMMAND.UNDO?this.undoManager_.undoPeek():this.undoManager_.redoPeek())&&a.fieldHashCode?this.getCurrentFieldObject().execCommand(d):this.execCommand(d),!0}return!1};
goog.editor.plugins.UndoRedo.prototype.clearHistory=function(){this.fieldObject.stopChangeEvents(!0,!0);this.undoManager_.clearHistory();this.fieldObject.startChangeEvents()};goog.editor.plugins.UndoRedo.prototype.refreshCurrentState=function(a){this.isEnabled(a)&&(this.currentStates_[a.getHashCode()]&&delete this.currentStates_[a.getHashCode()],this.updateCurrentState_(a))};
goog.editor.plugins.UndoRedo.prototype.handleBeforeChange_=function(a){if(!this.inProgressUndo_){var a=a.target,b=a.getHashCode();this.initialFieldChange_!=b&&(this.initialFieldChange_=b,this.updateCurrentState_(a))}};goog.editor.plugins.UndoRedo.prototype.handleDelayedChange_=function(a){this.inProgressUndo_?(a=this.inProgressUndo_,this.inProgressUndo_=null,a.dispatchEvent(goog.editor.plugins.UndoRedoState.ACTION_COMPLETED)):this.updateCurrentState_(a.target)};
goog.editor.plugins.UndoRedo.prototype.handleBlur_=function(a){(a=a.target)&&a.clearDelayedChange()};goog.editor.plugins.UndoRedo.prototype.getCursorPosition_=function(a){a=new goog.editor.plugins.UndoRedo.CursorPosition_(a);return!a.isValid()?null:a};
goog.editor.plugins.UndoRedo.prototype.updateCurrentState_=function(a){var b=a.getHashCode(),c,d;a.queryCommandValue(goog.editor.Command.USING_LOREM)?(c="",d=null):(c=a.getElement().innerHTML,d=this.getCursorPosition_(a));var e=this.currentStates_[b];if(e){if(e.undoContent_==c)return;if(""==c||""==e.undoContent_)if(a=a.getInjectableContents("",{}),c==a&&""==e.undoContent_||e.undoContent_==a&&""==c)return;e.setRedoState(c,d);this.undoManager_.addState(e)}this.currentStates_[b]=new goog.editor.plugins.UndoRedo.UndoState_(b,
c,d,this.boundRestoreState_)};goog.editor.plugins.UndoRedo.UndoState_=function(a,b,c,d){goog.editor.plugins.UndoRedoState.call(this,!0);this.fieldHashCode=a;this.restore_=d;this.setUndoState(b,c)};goog.inherits(goog.editor.plugins.UndoRedo.UndoState_,goog.editor.plugins.UndoRedoState);goog.editor.plugins.UndoRedo.UndoState_.prototype.undo=function(){this.restore_(this,this.undoContent_,this.undoCursorPosition_)};
goog.editor.plugins.UndoRedo.UndoState_.prototype.redo=function(){this.restore_(this,this.redoContent_,this.redoCursorPosition_)};goog.editor.plugins.UndoRedo.UndoState_.prototype.setUndoState=function(a,b){this.undoContent_=a;this.undoCursorPosition_=b};goog.editor.plugins.UndoRedo.UndoState_.prototype.setRedoState=function(a,b){this.redoContent_=a;this.redoCursorPosition_=b};
goog.editor.plugins.UndoRedo.UndoState_.prototype.equals=function(a){return this.fieldHashCode==a.fieldHashCode&&this.undoContent_==a.undoContent_&&this.redoContent_==a.redoContent_};goog.editor.plugins.UndoRedo.CursorPosition_=function(a){this.field_=a;var b=a.getEditableDomHelper().getWindow(),a=(a=a.getRange())&&a.isRangeInDocument()&&a.getWindow()==b?a:null;goog.editor.BrowserFeature.HAS_W3C_RANGES?this.initW3C_(a):goog.editor.BrowserFeature.HAS_IE_RANGES&&this.initIE_(a)};
goog.editor.plugins.UndoRedo.CursorPosition_.prototype.initW3C_=function(a){this.isValid_=!1;if(a){var b=a.getAnchorNode(),c=a.getFocusNode();if(b&&c){var d=a.getAnchorOffset(),b=new goog.dom.NodeOffset(b,this.field_.getElement()),e=a.getFocusOffset(),c=new goog.dom.NodeOffset(c,this.field_.getElement());a.isReversed()?(this.startOffset_=c,this.startChildOffset_=e,this.endOffset_=b,this.endChildOffset_=d):(this.startOffset_=b,this.startChildOffset_=d,this.endOffset_=c,this.endChildOffset_=e);this.isValid_=
!0}}};
goog.editor.plugins.UndoRedo.CursorPosition_.prototype.initIE_=function(a){this.isValid_=!1;if(a){var b=a.getTextRange(0).getBrowserRangeObject();if(goog.dom.contains(this.field_.getElement(),b.parentElement())){a=this.field_.getEditableDomHelper().getDocument().body.createTextRange();a.moveToElementText(this.field_.getElement());var c=b.duplicate();c.collapse(!0);c.setEndPoint("StartToStart",a);this.startOffset_=goog.editor.plugins.UndoRedo.CursorPosition_.computeEndOffsetIE_(c);b=b.duplicate();b.setEndPoint("StartToStart",
a);this.endOffset_=goog.editor.plugins.UndoRedo.CursorPosition_.computeEndOffsetIE_(b);this.isValid_=!0}}};goog.editor.plugins.UndoRedo.CursorPosition_.prototype.isValid=function(){return this.isValid_};goog.editor.plugins.UndoRedo.CursorPosition_.prototype.toString=function(){return goog.editor.BrowserFeature.HAS_W3C_RANGES?"W3C:"+this.startOffset_.toString()+"\n"+this.startChildOffset_+":"+this.endOffset_.toString()+"\n"+this.endChildOffset_:"IE:"+this.startOffset_+","+this.endOffset_};
goog.editor.plugins.UndoRedo.CursorPosition_.prototype.select=function(){var a=this.getRange_(this.field_.getElement());a&&(goog.editor.BrowserFeature.HAS_IE_RANGES&&this.field_.getElement().focus(),goog.dom.Range.createFromBrowserRange(a).select())};
goog.editor.plugins.UndoRedo.CursorPosition_.prototype.getRange_=function(a){if(goog.editor.BrowserFeature.HAS_W3C_RANGES){var b=this.startOffset_.findTargetNode(a),a=this.endOffset_.findTargetNode(a);return!b||!a?null:goog.dom.Range.createFromNodes(b,this.startChildOffset_,a,this.endChildOffset_).getBrowserRangeObject()}b=a.ownerDocument.body.createTextRange();b.moveToElementText(a);b.collapse(!0);b.moveEnd("character",this.endOffset_);b.moveStart("character",this.startOffset_);return b};
goog.editor.plugins.UndoRedo.CursorPosition_.computeEndOffsetIE_=function(a){var b=a.duplicate(),c=a.text,d=c.length;b.collapse(!0);b.moveEnd("character",d);for(var e,f=10;(e=b.compareEndPoints("EndToEnd",a))&&!(d-=e,b.moveEnd("character",-e),--f,0==f););a=0;for(b=c.indexOf("\n\r");-1!=b;)++a,b=c.indexOf("\n\r",b+1);return d+a};fyre.v1.editor.plugins.KeyShortcutHandler=function(a){this.eventTypes=goog.isString(a)?[a]:a;goog.editor.Plugin.call(this)};goog.inherits(fyre.v1.editor.plugins.KeyShortcutHandler,goog.editor.Plugin);fyre.v1.editor.plugins.KeyShortcutHandler.prototype.getTrogClassId=function(){return"KeyShortcutHandler"};fyre.v1.editor.plugins.KeyShortcutHandler.EventType={MODIFIER_ENTER:"shortcut_modifier_enter",ENTER:"shortcut_enter"};
fyre.v1.editor.plugins.KeyShortcutHandler.EVENT_MAP=function(){var a=fyre.v1.editor.plugins.KeyShortcutHandler.EventType,b={};b[a.MODIFIER_ENTER]=function(a,b){return b&&13===a.keyCode};b[a.ENTER]=function(a){return 13===a.keyCode};return b}();
fyre.v1.editor.plugins.KeyShortcutHandler.prototype.handleKeyboardShortcut=function(a,b,c){var d=fyre.v1.editor.plugins.KeyShortcutHandler.EVENT_MAP,e=!1;goog.array.forEach(this.eventTypes,function(b){d[b](a,c)&&(this.fieldObject.dispatchEvent(b),e=!0)},this);return e};goog.async.ConditionalDelay=function(a,b){goog.Disposable.call(this);this.listener_=a;this.handler_=b;this.delay_=new goog.async.Delay(goog.bind(this.onTick_,this),0,this)};goog.inherits(goog.async.ConditionalDelay,goog.Disposable);goog.async.ConditionalDelay.prototype.interval_=0;goog.async.ConditionalDelay.prototype.runUntil_=0;goog.async.ConditionalDelay.prototype.isDone_=!1;
goog.async.ConditionalDelay.prototype.disposeInternal=function(){this.delay_.dispose();delete this.listener_;delete this.handler_;goog.async.ConditionalDelay.superClass_.disposeInternal.call(this)};goog.async.ConditionalDelay.prototype.start=function(a,b){this.stop();this.isDone_=!1;var c=b||0;this.interval_=Math.max(a||0,0);this.runUntil_=0>c?-1:goog.now()+c;this.delay_.start(0>c?this.interval_:Math.min(this.interval_,c))};goog.async.ConditionalDelay.prototype.stop=function(){this.delay_.stop()};
goog.async.ConditionalDelay.prototype.isActive=function(){return this.delay_.isActive()};goog.async.ConditionalDelay.prototype.isDone=function(){return this.isDone_};goog.async.ConditionalDelay.prototype.onSuccess=function(){};goog.async.ConditionalDelay.prototype.onFailure=function(){};
goog.async.ConditionalDelay.prototype.onTick_=function(){if(this.listener_.call(this.handler_))this.isDone_=!0,this.onSuccess();else if(0>this.runUntil_)this.delay_.start(this.interval_);else{var a=this.runUntil_-goog.now();if(0>=a)this.onFailure();else this.delay_.start(Math.min(this.interval_,a))}};goog.events.PasteHandler=function(a){goog.events.EventTarget.call(this);this.element_=a;this.oldValue_=this.element_.value;this.eventHandler_=new goog.events.EventHandler(this);this.lastTime_=goog.now();goog.userAgent.WEBKIT||goog.userAgent.IE||goog.userAgent.GECKO&&goog.userAgent.isVersion("1.9")?this.eventHandler_.listen(a,goog.events.EventType.PASTE,this.dispatch_):this.eventHandler_.listen(a,[goog.events.EventType.KEYDOWN,goog.events.EventType.BLUR,goog.events.EventType.FOCUS,goog.events.EventType.MOUSEOVER,
"input"],this.handleEvent_);this.delay_=new goog.async.ConditionalDelay(goog.bind(this.checkUpdatedText_,this))};goog.inherits(goog.events.PasteHandler,goog.events.EventTarget);goog.events.PasteHandler.EventType={PASTE:"paste",AFTER_PASTE:"after_paste"};goog.events.PasteHandler.MANDATORY_MS_BETWEEN_INPUT_EVENTS_TIE_BREAKER=400;goog.events.PasteHandler.PASTE_POLLING_PERIOD_MS_=50;goog.events.PasteHandler.PASTE_POLLING_TIMEOUT_MS_=200;goog.events.PasteHandler.State={INIT:"init",FOCUSED:"focused",TYPING:"typing"};
goog.events.PasteHandler.prototype.state_=goog.events.PasteHandler.State.INIT;goog.events.PasteHandler.prototype.logger_=goog.debug.Logger.getLogger("goog.events.PasteHandler");goog.events.PasteHandler.prototype.disposeInternal=function(){goog.events.PasteHandler.superClass_.disposeInternal.call(this);this.eventHandler_.dispose();this.eventHandler_=null;this.delay_.dispose();this.delay_=null};goog.events.PasteHandler.prototype.getState=function(){return this.state_};
goog.events.PasteHandler.prototype.getEventHandler=function(){return this.eventHandler_};goog.events.PasteHandler.prototype.checkUpdatedText_=function(){if(this.oldValue_==this.element_.value)return!1;this.logger_.info("detected textchange after paste");this.dispatchEvent(goog.events.PasteHandler.EventType.AFTER_PASTE);return!0};
goog.events.PasteHandler.prototype.dispatch_=function(a){a=new goog.events.BrowserEvent(a.getBrowserEvent());a.type=goog.events.PasteHandler.EventType.PASTE;try{this.dispatchEvent(a)}finally{a.dispose()}goog.Timer.callOnce(function(){this.checkUpdatedText_()||this.delay_.start(goog.events.PasteHandler.PASTE_POLLING_PERIOD_MS_,goog.events.PasteHandler.PASTE_POLLING_TIMEOUT_MS_)},0,this)};
goog.events.PasteHandler.prototype.handleEvent_=function(a){switch(this.state_){case goog.events.PasteHandler.State.INIT:this.handleUnderInit_(a);break;case goog.events.PasteHandler.State.FOCUSED:this.handleUnderFocused_(a);break;case goog.events.PasteHandler.State.TYPING:this.handleUnderTyping_(a);break;default:this.logger_.severe("invalid "+this.state_+" state")}this.lastTime_=goog.now();this.oldValue_=this.element_.value;this.logger_.info(a.type+" -> "+this.state_);this.previousEvent_=a.type};
goog.events.PasteHandler.prototype.handleUnderInit_=function(a){switch(a.type){case goog.events.EventType.BLUR:this.state_=goog.events.PasteHandler.State.INIT;break;case goog.events.EventType.FOCUS:this.state_=goog.events.PasteHandler.State.FOCUSED;break;case goog.events.EventType.MOUSEOVER:this.state_=goog.events.PasteHandler.State.INIT;this.element_.value!=this.oldValue_&&(this.logger_.info("paste by dragdrop while on init!"),this.dispatch_(a));break;default:this.logger_.severe("unexpected event "+
a.type+"during init")}};
goog.events.PasteHandler.prototype.handleUnderFocused_=function(a){switch(a.type){case "input":var b=this.lastTime_+goog.events.PasteHandler.MANDATORY_MS_BETWEEN_INPUT_EVENTS_TIE_BREAKER;if(goog.now()>b||this.previousEvent_==goog.events.EventType.FOCUS)this.logger_.info("paste by textchange while focused!"),this.dispatch_(a);break;case goog.events.EventType.BLUR:this.state_=goog.events.PasteHandler.State.INIT;break;case goog.events.EventType.KEYDOWN:this.logger_.info("key down ... looking for ctrl+v");if(goog.userAgent.MAC&&
goog.userAgent.OPERA&&0==a.keyCode||goog.userAgent.MAC&&goog.userAgent.OPERA&&17==a.keyCode)break;this.state_=goog.events.PasteHandler.State.TYPING;break;case goog.events.EventType.MOUSEOVER:this.element_.value!=this.oldValue_&&(this.logger_.info("paste by dragdrop while focused!"),this.dispatch_(a));break;default:this.logger_.severe("unexpected event "+a.type+" during focused")}};
goog.events.PasteHandler.prototype.handleUnderTyping_=function(a){switch(a.type){case "input":this.state_=goog.events.PasteHandler.State.FOCUSED;break;case goog.events.EventType.BLUR:this.state_=goog.events.PasteHandler.State.INIT;break;case goog.events.EventType.KEYDOWN:if(a.ctrlKey&&a.keyCode==goog.events.KeyCodes.V||a.shiftKey&&a.keyCode==goog.events.KeyCodes.INSERT||a.metaKey&&a.keyCode==goog.events.KeyCodes.V)this.logger_.info("paste by ctrl+v while keypressed!"),this.dispatch_(a);break;case goog.events.EventType.MOUSEOVER:this.element_.value!=
this.oldValue_&&(this.logger_.info("paste by dragdrop while keypressed!"),this.dispatch_(a));break;default:this.logger_.severe("unexpected event "+a.type+" during keypressed")}};fyre.v1.editor.plugins.PasteFilter=function(){goog.editor.Plugin.call(this)};goog.inherits(fyre.v1.editor.plugins.PasteFilter,goog.editor.Plugin);fyre.v1.editor.plugins.PasteFilter.COMMAND="+filtercontent";fyre.v1.editor.plugins.PasteFilter.VALID_ATTRIBUTES={A:new goog.structs.Set(["href","target"]),IMG:new goog.structs.Set(["src"]),MENTION:new goog.structs.Set("class,data-lf-handle,data-lf-provider,href,target,vocab,typeof,rel,resource,property".split(",")),SPAN:new goog.structs.Set(["property"])};
fyre.v1.editor.plugins.PasteFilter.VALID_TAGS=new goog.structs.Set("A,B,BLOCKQUOTE,BR,EM,I,LABEL,LI,OL,P,SPAN,STRONG,U,UL,#text".split(","));fyre.v1.editor.plugins.PasteFilter.prototype.getTrogClassId=function(){return"FilterContent"};
fyre.v1.editor.plugins.PasteFilter.prototype.enable=function(a){fyre.v1.editor.plugins.PasteFilter.superClass_.enable.call(this,a);a=new goog.events.PasteHandler(a.getElement());goog.events.listen(a,goog.events.PasteHandler.EventType.PASTE,goog.bind(this.cleanEditorOnPaste_,this))};fyre.v1.editor.plugins.PasteFilter.prototype.cleanEditorOnPaste_=function(){setTimeout(goog.bind(function(){this.cleanElement(this.fieldObject.getElement())},this),100)};
fyre.v1.editor.plugins.PasteFilter.prototype.cleanAttributes=function(a){if(a.attributes){var b=fyre.v1.editor.plugins.PasteFilter.VALID_ATTRIBUTES,c=goog.object.get(b,a.nodeName,new goog.structs.Set);"A"===a.nodeName&&goog.dom.classes.has(a,"fyre-mention")&&(c=b.MENTION);goog.array.forEachRight(a.attributes,function(b){c.contains(b.name)||a.removeAttribute(b.name)})}};
fyre.v1.editor.plugins.PasteFilter.prototype.cleanElement=function(a){goog.array.forEachRight(a.childNodes,function(a){0<a.childNodes.length&&this.cleanElement(a);fyre.v1.editor.plugins.PasteFilter.VALID_TAGS.contains(a.nodeName)?this.cleanAttributes(a):goog.dom.flattenElement(a)},this)};fyre.v1.editor.plugins.PasteFilter.prototype.shouldUseRanges_=function(){var a=goog.userAgent.IE&&!goog.userAgent.isDocumentMode(10);return goog.userAgent.GECKO||a};
fyre.v1.editor.plugins.PasteFilter.prototype.onPaste_=function(a){if(this.shouldUseRanges_())this.cleanEditorOnPaste_();else{a.preventDefault();var b=this.getClipboardData(a);this.fieldObject.execCommand(fyre.v1.editor.plugins.PasteFilter.COMMAND,b,a.target)}};fyre.v1.editor.plugins.PasteFilter.prototype.getClipboardData=function(a){return a.getBrowserEvent().clipboardData?a.getBrowserEvent().clipboardData.getData("text/plain"):window.clipboardData?window.clipboardData.getData("Text"):"<p></p>"};
fyre.v1.editor.plugins.PasteFilter.prototype.isSupportedCommand=function(a){return a==fyre.v1.editor.plugins.PasteFilter.COMMAND};
fyre.v1.editor.plugins.PasteFilter.prototype.processLines_=function(a,b){var c=a.replace(/<[^>]*>?/g,"").split(/\r\n|\r|\n/g);b&&(c=a.split(/<br>|\r\n|\r|\n/g),c=goog.array.map(c,function(a){return a.replace(/<[^>]*>?/g,"")}));var d=c.length,e=document.createDocumentFragment();fyre.v1.util.forEach(c,function(a,b){var c=goog.string.trim(a);e.appendChild(document.createTextNode(c));d-1!==b&&e.appendChild(document.createElement(goog.dom.TagName.BR))});return e};
fyre.v1.editor.plugins.PasteFilter.prototype.execCommand=function(a,b,c){var d=this.getFieldDomHelper(),e=this.fieldObject.getRange(),f=c.parentNode;if(a!==fyre.v1.editor.plugins.PasteFilter.COMMAND)return!1;this.fieldObject.stopChangeEvents(!0,!0);e.isCollapsed()||(d.getDocument().execCommand("delete",!1,null),e=this.fieldObject.getRange());b=this.processLines_(b);a=!0;switch(c.tagName){case goog.dom.TagName.BR:if(f.tagName===goog.dom.TagName.P){1===f.children.length&&f.firstChild.tagName===goog.dom.TagName.BR&&
f.removeChild(f.firstChild);f.appendChild(b);c=f;break}case goog.dom.TagName.BODY:c=d.createElement(goog.dom.TagName.P);c.appendChild(b);e.insertNode(c,!0);break;case goog.dom.TagName.P:if(f&&f.tagName===goog.dom.TagName.P){f.appendChild(b);c=f;break}default:(a=c.children)&&1===a.length&&c.firstChild.tagName===goog.dom.TagName.BR&&c.removeChild(c.firstChild),a=!1,d=e.getStartNode(),e.insertNode(b,!0),e=d.parentNode,d=goog.array.indexOf(e.childNodes,d),e=goog.dom.Range.createCaret(e.childNodes[d+2],
0),goog.editor.range.placeCursorNextTo(e.getStartNode(),!0)}this.fieldObject.dispatchChange();this.fieldObject.dispatchSelectionChangeEvent();a&&goog.editor.range.placeCursorNextTo(c,!1);return!1};fyre.v1.editor.plugins.MediaUrlListener=function(){goog.editor.Plugin.call(this)};goog.inherits(fyre.v1.editor.plugins.MediaUrlListener,goog.editor.Plugin);fyre.v1.editor.plugins.MediaUrlListener.EVENTS=fyre.v1.editor.plugins.MediaUrlListener.prototype.EVENTS={ACTION:"action"};fyre.v1.editor.plugins.MediaUrlListener.COMMAND="+spacekey";fyre.v1.editor.plugins.MediaUrlListener.EMBEDLY_REGEX=fyre.v1.editor.plugins.MediaUrlListener.prototype.EMBEDLY_REGEX=/(http:\/\/\S*[youtube\.com|flickr\.com|twitpic\.com|imgur\.com|img\.ly|tinypic\.com|vimeo\.com]\S*)/ig;
fyre.v1.editor.plugins.MediaUrlListener.prototype.getTrogClassId=goog.functions.constant(fyre.v1.editor.plugins.MediaUrlListener.COMMAND);fyre.v1.editor.plugins.MediaUrlListener.prototype.isSupportedCommand=function(a){return a==fyre.v1.editor.plugins.MediaUrlListener.COMMAND};fyre.v1.editor.plugins.MediaUrlListener.prototype.handleKeyUp=function(){};
fyre.v1.editor.plugins.MediaUrlListener.prototype.findMediaUrlsInBody_=function(){goog.array.forEach(this.fieldObject.field.childNodes,function(a){a=goog.dom.getTextContent(a).match(this.EMBEDLY_REGEX);goog.array.forEach(a||[],function(a){this.trigger(this.EVENTS.ACTION,a)},this)},this)};goog.object.extend(fyre.v1.editor.plugins.MediaUrlListener.prototype,fyre.v1.lib.Backbone.Events);fyre.v1.editor.plugins.MentionBubble=function(){goog.editor.plugins.LinkBubble.call(this)};goog.inherits(fyre.v1.editor.plugins.MentionBubble,goog.editor.plugins.LinkBubble);fyre.v1.editor.plugins.MentionBubble.MENTION_CLASS="fyre-mention";fyre.v1.editor.plugins.MentionBubble.prototype.createBubble=function(a){fyre.v1.dom(a).hasClass(fyre.v1.editor.plugins.MentionBubble.MENTION_CLASS)&&fyre.v1.editor.plugins.MentionBubble.superClass_.createBubble.call(this,a)};
fyre.v1.editor.plugins.MentionBubble.prototype.createBubbleContents=function(a){var b=this.dom_.createDom(goog.dom.TagName.DIV,{id:goog.editor.plugins.LinkBubble.LINK_DIV_ID_}),c=this.createLinkOption(goog.editor.plugins.LinkBubble.DELETE_LINK_SPAN_ID_);this.createLink(goog.editor.plugins.LinkBubble.DELETE_LINK_ID_,MSG_LINK_BUBBLE_REMOVE,this.deleteLink_,c);this.onShow();b.appendChild(c);goog.dom.appendChild(a,b)};
fyre.v1.editor.plugins.MentionBubble.prototype.getBubbleTargetFromSelection=function(a){if(a.tagName==goog.dom.TagName.A&&goog.dom.classes.has(a,"fyre-mention"))return a};fyre.v1.editor.plugins.MentionBubble.prototype.createLinkOption=function(a){return this.dom_.createDom(goog.dom.TagName.SPAN,{id:a,className:goog.editor.plugins.AbstractBubblePlugin.OPTION_LINK_CLASSNAME_})};
fyre.v1.editor.plugins.MentionBubble.prototype.deleteLink_=function(){fyre.v1.dom(this.getTargetElement()).remove();this.closeBubble();this.fieldObject.dispatchChange()};fyre.v1.editor.plugins.MentionBubble.prototype.getTrogClassId=function(){return"MentionBubble"};fyre.v1.editor.plugins.Mentions=function(a,b,c){this._currentPartial=null;this.model_=a;this.menu_=b;this.popup_=c;goog.editor.Plugin.call(this)};goog.inherits(fyre.v1.editor.plugins.Mentions,goog.editor.Plugin);fyre.v1.editor.plugins.Mentions.COMMAND="+mention";fyre.v1.editor.plugins.Mentions.prototype.getTrogClassId=goog.functions.constant(fyre.v1.editor.plugins.Mentions.COMMAND);fyre.v1.editor.plugins.Mentions.prototype.isSupportedCommand=function(a){return a==fyre.v1.editor.plugins.Mentions.COMMAND};
fyre.v1.editor.plugins.Mentions.prototype.domHelper=function(){return this.fieldObject.getEditableDomHelper()};fyre.v1.editor.plugins.Mentions.prototype.handleSelectionChange=function(){var a=this.fieldObject.getRange(),b;(b=a?a.getContainerElement():null)&&this._isPartial(b)?(this._currentPartial=b,this.popup_.setVisible(!0)):(this._currentPartial=null,this.popup_.setVisible(!1));this.setMenuFilter_()};
fyre.v1.editor.plugins.Mentions.prototype.mentionToSoy=function(a){var b=fyre.v1.model.Mention.ATTRIBUTES;return{displayName:a.get(b.DISPLAY_NAME),jid:a.get(b.JID),prefix:a.get(b.PREFIX),profileUrl:a.get(b.PROFILE_URL),provider:a.get(b.PROVIDER),handle:a.get(b.HANDLE)}};
fyre.v1.editor.plugins.Mentions.prototype.execCommandInternal=function(a,b){var c=this.mentionToSoy(b),c=fyre.templates.core.misc.mention(c),c=this.domHelper().htmlToDocumentFragment(c),d=this.fieldObject.getRange(),e=this.domHelper().createDom(goog.dom.TagName.SPAN,"fyre-mention-space","\u00a0");this._currentPartial?(goog.dom.replaceNode(c,this._currentPartial),this._exitPartial()):d?d.replaceContentsWithNode(c):(d=fyre.v1.dom(this.fieldObject.getElement()),d.last().append(goog.dom.createTextNode(" ")),
d.last().append(c));goog.dom.insertSiblingAfter(e,c);this._placeCursorNextTo(e,!1);this.closePopup_()};fyre.v1.editor.plugins.Mentions.prototype.getClosestMentionToCursor=function(){var a=this.fieldObject.getRange(),b=a.getContainerElement();if(fyre.v1.dom(b).hasClass("fyre-mention"))return b;if(b.parentNode){if(fyre.v1.dom(b.parentNode).hasClass("fyre-mention"))return b.parentNode;if(0==a.getStartOffset()&&b.previousSibling&&fyre.v1.dom(b.previousSibling).hasClass("fyre-mention"))return b.previousSibling}};
fyre.v1.editor.plugins.Mentions.prototype.handleKeyPress=function(a){if("@"===String.fromCharCode(a.charCode))return this._currentPartial&&this._exitPartial(),this._currentPartial=this._createPartial(),this.fieldObject.getRange().replaceContentsWithNode(this._currentPartial),this._placeCursorNextTo(this._currentPartial.childNodes[0],!1),this.popup_.setVisible(!0),a.preventDefault(),!0};
fyre.v1.editor.plugins.Mentions.prototype.handleKeyDown=function(a){var b=a.keyCode==goog.events.KeyCodes.ENTER,c=a.keyCode==goog.events.KeyCodes.TAB,d=a.keyCode==goog.events.KeyCodes.BACKSPACE,e=a.keyCode==goog.events.KeyCodes.UP,f=a.keyCode==goog.events.KeyCodes.DOWN;this._currentPartial&&!this._currentPartial.parentNode&&this._exitPartial();if(d&&(d=this.getClosestMentionToCursor()))return goog.dom.removeNode(d),!0;if(this.popup_.isVisible()){if(this.menu_.getHighlighted()&&(b||c))return this.execCommandInternal(fyre.v1.editor.plugins.Mentions.COMMAND,
this.menu_.getHighlighted().getModel()),a.preventDefault(),a.stopPropagation(),!0;if(e||f)e?this.menu_.highlightPrevious():this.menu_.highlightNext(),a.preventDefault(),a.stopPropagation()}this._currentPartial&&b&&this._exitPartial()};fyre.v1.editor.plugins.Mentions.prototype.handleKeyUp=function(a){var b=goog.array.contains(this.validationKeyCodes,a.keyCode);goog.events.KeyCodes.isTextModifyingKeyEvent(a)&&this.setMenuFilter_();b&&this._currentPartial&&!this._validatePartial()&&this._exitPartial()};
fyre.v1.editor.plugins.Mentions.prototype.setMenuFilter_=function(){this.menu_.setFilter(this._currentPartial?goog.dom.getTextContent(this._currentPartial).substring(1):"")};fyre.v1.editor.plugins.Mentions.prototype._isPartial=function(a){return a.tagName==goog.dom.TagName.SPAN&&goog.dom.classes.has(a,"fyre-mention-partial")};fyre.v1.editor.plugins.Mentions.prototype._createPartial=function(){return this.domHelper().createDom(goog.dom.TagName.SPAN,"fyre-mention-partial","@")};
fyre.v1.editor.plugins.Mentions.prototype._exitPartial=function(){this._currentPartial.parentNode&&this._placeCursorNextTo(this._currentPartial,!1,!0);this.menu_.setFilter();this.closePopup_()};
fyre.v1.editor.plugins.Mentions.prototype._placeCursorNextTo=function(a,b,c){goog.isBoolean(c)&&c&&goog.userAgent.WEBKIT?(c=this.domHelper().createDom(goog.dom.TagName.SPAN,"fyre-mention-space","\u00a0"),goog.dom.insertSiblingAfter(c,a),goog.editor.range.placeCursorNextTo(c,b),goog.dom.removeNode(c)):goog.editor.range.placeCursorNextTo(a,b)};
fyre.v1.editor.plugins.Mentions.prototype._flattenCurrentNode=function(){this._currentNode&&(this._currentNode.parentElement&&goog.dom.flattenElement(this._currentNode),this._currentNode=null)};
fyre.v1.editor.plugins.Mentions.prototype.cleanContentsDom=function(a){goog.array.forEach(goog.dom.getElementsByClass("fyre-mention-space",a),goog.dom.flattenElement);goog.array.forEach(goog.dom.getElementsByClass("fyre-mention-partial",a),goog.dom.flattenElement);goog.array.forEach(goog.dom.getElementsByClass("fyre-mention",a),function(a){"@"==goog.dom.getTextContent(a.childNodes[0])&&goog.dom.setTextContent(a.childNodes[0],"")});return a};
fyre.v1.editor.plugins.Mentions.prototype.validationKeyCodes=[goog.events.KeyCodes.TAB,goog.events.KeyCodes.SPACE];fyre.v1.editor.plugins.Mentions.prototype._validatePartial=function(){var a=!1;this.menu_.forEachChild(function(b){a=a||!this.menu_.hasPersistentVisibility(b)&&b.isVisible()},this);return a};fyre.v1.editor.plugins.Mentions.prototype.closePopup_=function(){this.menu_.setHighlighted();this.popup_.setVisible(!1)};fyre.v1.Editor=function(a,b){this.initialize(a||{});fyre.v1.ui.FyreComponent.call(this,b)};goog.inherits(fyre.v1.Editor,fyre.v1.ui.FyreComponent);
fyre.v1.Editor.prototype.initialize=function(a){fyre.v1.Editor.superClass_.initialize.call(this,a);this.comment=a.comment;this.conv=a.conv;this.viewModel=a.viewModel||new fyre.v1.editor.EditorModel;this._config=this.viewModel.get(this.viewModel.ATTRIBUTES.CONFIG);this._toolbarPopups={};this._toolbarControls={};this.postDisabled_=!1;this.parent=a.parent;this.postType=a.postType;this.view=a.view};
fyre.v1.Editor.prototype._setupHandlers=function(){this.viewModel.on(this.viewModel.attributeChangeEvent(this.viewModel.ATTRIBUTES.USERAUTH),this.handleUserAuthChange,this);this.viewModel.on(this.viewModel.attributeChangeEvent(this.viewModel.ATTRIBUTES.BODY),this.handleBodyChange,this);this.field_.addListener(goog.events.EventType.CLICK,this.handleEditorClick);goog.events.listen(this.field_,fyre.v1.editor.plugins.KeyShortcutHandler.EventType.MODIFIER_ENTER,goog.bind(this.handlePost,this));this.field_.addListener(goog.editor.Field.EventType.FOCUS,
this.makeTrigger(this.EVENTS.FOCUS))};fyre.v1.Editor.prototype.handleEditorClick=function(a){var b=fyre.v1.editor.CLASSES;if((a.shiftKey||a.ctrlKey||a.metaKey)&&(fyre.v1.dom(a.target).hasClass(b.MENTION)||fyre.v1.dom(a.target.parentNode).hasClass(b.MENTION)))return a.preventDefault(),a.stopPropagation(),!1};
fyre.v1.Editor.prototype.TOOLBAR_CONTROLS={FORMAT:"format",MEDIA:"media",MENTION:"mention",CANCEL:"cancel",POST:"post",POST2_TW:"twitter",POST2_FB:"facebook",POST2_LI:"linkedin",POST2_GP:"google-plus",FOLLOW:"follow",HTML:"html"};fyre.v1.Editor.CLASSES=fyre.v1.Editor.prototype.CLASSES={EDITOR_CONTAINER:"fyre-editor-container",EDITOR_EDITABLE:"fyre-editor-editable",EDITOR_FIELD:"fyre-editor-field",EDITOR_TOOLBAR:"fyre-editor-toolbar",MENTION:"fyre-mention",SMALL:"fyre-editor-small"};
fyre.v1.Editor.EVENTS=fyre.v1.Editor.prototype.EVENTS={CANCEL:"cancel",FETCH_FRIENDS:"fetchFriends",SUBMITTED:"submitted",POST_TO_CLICKED:"postTo",FOLLOW_CHANGE:"followChange",CONTENT_CHANGED:"contentChanged",FOCUS:"focus"};
fyre.v1.Editor.prototype.getToolbarButtons=function(){var a=fyre.v1.Editor.prototype.TOOLBAR_CONTROLS,b=fyre.v1.editor.LeftButtonRenderer.getInstance(),c=fyre.v1.editor.RightButtonRenderer.getInstance(),d=this.viewModel.get(this.viewModel.ATTRIBUTES.POST_TYPE);return[[a.FORMAT,b,"","fyre-format-button"],[a.MENTION,b,"","fyre-mention-button"],[a.MEDIA,b,"","fyre-embed-button"],[a.FOLLOW,b,"","fyre-follow-button"],[a.POST,c,"","fyre-post-button fyre-post-button-enabled fyre-post-button-"+d],[a.CANCEL,
c,"Cancel","fyre-cancel-button"],[a.POST2_FB,c,"","fyre-post-to fyre-post-to-facebook"],[a.POST2_TW,c,"","fyre-post-to fyre-post-to-twitter"],[a.POST2_LI,c,"","fyre-post-to fyre-post-to-linkedin"],[a.POST2_GP,c,"","fyre-post-to fyre-post-to-google-plus"]]};
fyre.v1.Editor.prototype.CONFIG_CONTROL_MAP=function(){var a=fyre.v1.editor.CONFIG_KEYS,b=fyre.v1.Editor.prototype.TOOLBAR_CONTROLS,c={};c[b.FORMAT]=a.RTE_TOOLBAR;c[b.MEDIA]=a.ALLOW_MEDIA;c[b.MENTION]=a.MENTIONS_TOOLBAR;c[b.FOLLOW]=a.FOLLOW_TOOLBAR;c[b.CANCEL]=a.CANCEL_TOOLBAR;c[b.POST2_TW]=a.POST_TO_TWITTER;c[b.POST2_FB]=a.POST_TO_FACEBOOK;c[b.POST2_LI]=a.POST_TO_LINKEDIN;c[b.POST2_GP]=a.POST_TO_GOOGLE_PLUS;return c}();
fyre.v1.Editor.prototype._toolbarControlActive=function(a){return a==this.TOOLBAR_CONTROLS.POST||this._config[this.CONFIG_CONTROL_MAP[a]]};fyre.v1.Editor.prototype.enterDocument=function(){this._setupHandlers();fyre.v1.Editor.superClass_.enterDocument.call(this)};
fyre.v1.Editor.prototype.createDomInternal=function(){fyre.v1.Editor.superClass_.createDomInternal.call(this);var a=fyre.v1.Editor.CLASSES,b="fyre-editor-"+goog.getUid(this.element_);this.$dom_.html(fyre.templates.core.editor.main()).hide();this.containerEl_=this.$dom_.getByClass(a.EDITOR_CONTAINER);this.toolbarEl_=this.containerEl_.getByClass(a.EDITOR_TOOLBAR);this.editableEl_=this.containerEl_.getByClass(a.EDITOR_EDITABLE);this.editableEl_.first().attr("id",b);(this.useSeamlessEditor=this._config[this._config.KEYS.XX_USE_SEAMLESS_EDITOR])?
(this.field_=new goog.editor.SeamlessField(b),this._config[this._config.KEYS.MAX_HEIGHT]=null):this.field_=new goog.editor.Field(b);this.field_.clearBeforeFirstInsert=!1;goog.userAgent.WEBKIT&&(this.field_.isHttps_=!0);this.registerPlugins();this.toolbar=this.createToolbar(document);this.$dom_.hide();this.$dom_.show();this.field_.makeEditable();goog.dom.classes.add(this.field_.getElement(),a.EDITOR_FIELD);this._config[this._config.KEYS.MAX_HEIGHT]&&(this.field_.addListener(goog.events.EventType.KEYUP,
this.handleEditorResize_,!1,this),this.field_.addListener(goog.events.EventType.KEYDOWN,this.handleEditorResizeOnEnter_,!1,this));this.initialSize_=goog.style.getSize(this.editableEl_.element);this.initializeContent_();this._config[this._config.KEYS.MINIMAL]&&(this.attachMinimalListeners(),this.setMinimal(!0));this.injectCssStylesheet(fyre.v1.config.servers.assets+"/css/editor.css");a=this._config[this._config.KEYS.EDITOR_CSS];goog.isObject(a)&&!goog.isArray(a)?this.injectCssObject(a):goog.isArray(a)||
goog.isString(a)&&goog.string.startsWith(a,"http")?this.injectCssStylesheet(a):goog.isString(a)&&this.injectCssStyles(a)};fyre.v1.Editor.prototype.injectCssStylesheet=function(a){var b=this.field_.getEditableDomHelper().getDocument();goog.isString(a)&&(a=[a]);goog.array.forEach(a,function(a){fyre.v1.util.ScriptLoader.loadCSS(a,b)})};
fyre.v1.Editor.prototype.injectCssStyles=function(a){var b=this.field_.getEditableDomHelper().getDocument(),c=b.createElement("style");c.setAttribute("type","text/css");c.styleSheet?c.styleSheet.cssText=a:(a=b.createTextNode(a),c.appendChild(a));a=b.head;a||(a=b.createElement("head"),b.appendChild(a));a.appendChild(c)};
fyre.v1.Editor.prototype.injectCssObject=function(a){var b="";goog.object.forEach(a,function(a,d){b+=goog.string.subs("%s:%s !important;",d,a)});this.injectCssStyles(goog.string.subs("body { %s }",b))};fyre.v1.Editor.prototype.setResize=function(a){this.useSeamlessEditor?this.resizeDisabled_=!0:(this.resizeDisabled_=!a)?goog.style.setHeight(this.editableEl_.element,this.initialSize_.height):this.handleEditorResize_()};
fyre.v1.Editor.prototype.handleEditorResizeOnEnter_=function(a){if(!this.resizeDisabled_){if(a.keyCode==goog.events.KeyCodes.ENTER){var b=goog.style.getStyle(this.editableEl_.element,"font-size").replace("px","");b||(b=12);this.setResizeHeight_(Math.floor(2.2*parseInt(b,10)))}a.keyCode==goog.events.KeyCodes.ESC&&this.closeAllMenus()}};
fyre.v1.Editor.prototype.setResizeHeight_=function(a){var b=fyre.v1.dom(this.field_.getElement()).last(),b=b.exists()?goog.style.getPageOffsetTop(b.element)+b.element.offsetHeight+10:this.initialSize_.height;goog.style.setHeight(this.editableEl_.element,Math.max(this.initialSize_.height,Math.min(this._config[this._config.KEYS.MAX_HEIGHT],b+(a||0))))};fyre.v1.Editor.prototype.handleEditorResize_=function(a){this.resizeDisabled_||a&&13==a.keyCode||this.setResizeHeight_()};
fyre.v1.Editor.prototype.setHtml=function(a,b,c){this.field_.setHtml(a,b,c)};fyre.v1.Editor.prototype.disposeInternal=function(){this.editableEl_=this.toolbarEl_=this.containerEl_=null;this.field_&&(this.getHandler().unlisten(this.field_,fyre.v1.editor.plugins.KeyShortcutHandler.EventType.MODIFIER_ENTER),this.field_.makeUneditable(),this.field_.dispose());this.errorComp_&&this.errorComp_.dispose();this.mediaDrawer_&&this.mediaDrawer_.dispose();this.mediaDrawer_=null;fyre.v1.Editor.superClass_.disposeInternal.call(this)};
fyre.v1.Editor.prototype.initializeContent_=function(){var a=this.viewModel.get(this.viewModel.ATTRIBUTES.BODY);a?this.setHtml(!1,goog.string.trim(a),!0):goog.userAgent.IE&&this.setHtml(!0," ",!0)};fyre.v1.Editor.prototype.registerPlugins=function(){this.field_.registerPlugin(new fyre.v1.editor.plugins.TagOnEnterHandler(goog.dom.TagName.P));this.field_.registerPlugin(new goog.editor.plugins.UndoRedo);this.field_.registerPlugin(new fyre.v1.editor.plugins.PasteFilter);this.field_.registerPlugin(new fyre.v1.editor.plugins.KeyShortcutHandler(fyre.v1.editor.plugins.KeyShortcutHandler.EventType.MODIFIER_ENTER))};
fyre.v1.Editor.prototype.createToolbar=function(){var a;a=goog.array.filter(goog.array.map(this.getToolbarButtons(),this.createBuiltinToolbarButton_,this),goog.functions.identity);a.push(new goog.ui.ToolbarSeparator);a=goog.ui.editor.DefaultToolbar.makeToolbar(a,this.toolbarEl_.element);this.setupToolbarControls();return a};fyre.v1.Editor.prototype.createBuiltinToolbarButton_=function(a){return this.addBuiltinToolbarButton_.apply(this,a)};
fyre.v1.Editor.prototype.addBuiltinToolbarButton_=function(a,b,c,d){if(this._toolbarControlActive(a))return b=this.createToolbarButton(b,c,d),this._toolbarControls[a]=b};fyre.v1.Editor.prototype.createToolbarButton=function(a,b,c){a=new goog.ui.CustomButton(b,a);a.enableClassName(c,!0);return a};fyre.v1.Editor.prototype.addToolbarButtonAfter=function(a,b,c){var d=0;if(b){d=this.toolbar.indexOfChild(b);if(-1==d){goog.asserts.fail();return}d++}this.toolbar.addChildAt(a,d,c)};
fyre.v1.Editor.prototype.getToolbar=function(){return this.toolbar};fyre.v1.Editor.prototype.getBuiltinToolbarControl=function(a){return this._toolbarControls[a]};fyre.v1.Editor.prototype.setupToolbarControls=function(){goog.object.forEach(this._toolbarControls,this._setupToolbarControl,this)};
fyre.v1.Editor.prototype._setupToolbarControl=function(a,b){var c=this.TOOLBAR_CONTROLS;switch(b){case c.FORMAT:this.field_.registerPlugin(new fyre.v1.editor.plugins.BasicTextFormatter);this.createFormattingControl(a);break;case c.MEDIA:this.createEmbedControl_(a);this.createMediaDrawer_();break;case c.MENTION:this.createMentionsControl(a);this.field_.registerPlugin(new fyre.v1.editor.plugins.Mentions(this.viewModel,this.mentionsMenu,this._toolbarPopups[this.TOOLBAR_CONTROLS.MENTION]));this.field_.registerPlugin(new fyre.v1.editor.plugins.MentionBubble);
break;case c.CANCEL:this.createCancelControl(a);break;case c.FOLLOW:this.createFollowControl(a);break;case c.POST:this.createPostControl(a);break;case c.POST2_FB:case c.POST2_TW:case c.POST2_LI:this.createPostToControl(b,a)}};fyre.v1.Editor.prototype.createCancelControl=function(a){this.getHandler().listen(a,goog.ui.Component.EventType.ACTION,this.makeTrigger(this.EVENTS.CANCEL))};
fyre.v1.Editor.prototype.createPostToControl=function(a,b){this.getHandler().listen(b,goog.ui.Component.EventType.ACTION,this.makeTrigger(this.EVENTS.POST_TO_CLICKED,a))};
fyre.v1.Editor.prototype.createFormattingControl=function(a){var b=[goog.editor.Command.BOLD,goog.editor.Command.ITALIC,goog.editor.Command.UNDERLINE,goog.editor.Command.LINK,goog.editor.Command.ORDERED_LIST,goog.editor.Command.UNORDERED_LIST],c=goog.dom.createDom("div","fyre-format-toolbar"),b=goog.ui.editor.DefaultToolbar.makeToolbar(b,c);new goog.ui.editor.ToolbarController(this.field_,b);this._toolbarPopups[this.TOOLBAR_CONTROLS.FORMAT]=this.setupToolbarPopup(a,c)};
fyre.v1.Editor.prototype.createMentionsControl=function(a){this.mentionsMenu=new fyre.v1.editor.MentionsMenu(this.viewModel);this.mentionsMenu.setFocusable(!0);this.mentionsMenu.on(this.mentionsMenu.EVENTS.CLICKED,function(a,c){c.preventDefault();c.stopPropagation();this.field_.execCommand("+mention",a)},this);this._toolbarPopups[this.TOOLBAR_CONTROLS.MENTION]=this.setupToolbarPopup(a,null,goog.bind(function(a){if(!a.getElement()){this.mentionsMenu.render();var c=this.mentionsMenu.getElement();goog.style.showElement(c);
this.toolbarEl_.append(c);a.setElement(c)}},this));this.mentionsMenu.on(this.mentionsMenu.EVENTS.FETCH_FRIENDS,goog.bind(function(){this.trigger(this.EVENTS.FETCH_FRIENDS)},this),this)};fyre.v1.Editor.prototype.createEmbedControl_=function(a){this.getHandler().listen(a,goog.ui.Component.EventType.ACTION,this.handleMediaButtonClicked_)};
fyre.v1.Editor.prototype.handleMediaButtonClicked_=function(){this.dispatchEvent({type:fyre.v2.editor.EVENTS.MEDIA_UPLOAD_CLICKED,successCallback:goog.bind(this.mediaDrawer_.addMedia,this.mediaDrawer_)})};fyre.v1.Editor.prototype.createMediaDrawer_=function(){var a=this.viewModel.get(this.viewModel.ATTRIBUTES.MEDIA);this.mediaDrawer_=new fyre.v2.editor.MediaDrawer(a);this.mediaDrawer_.renderBefore(this.toolbarEl_.element);this.mediaDrawer_.setParent(this)};
fyre.v1.Editor.prototype.setupToolbarPopup=function(a,b,c){var d;b&&(goog.style.showElement(b),this.toolbarEl_.append(b));d=new goog.ui.Popup(b,new goog.positioning.AnchoredPosition(a.getElement(),goog.positioning.Corner.BOTTOM_LEFT));d.setHideOnEscape(!0);d.setAutoHide(!0);this.getHandler().listen(a,goog.ui.Component.EventType.ACTION,function(){this.handleToolbarButtonClick(d,a)});this.getHandler().listen(d,goog.ui.PopupBase.EventType.BEFORE_SHOW,function(){c&&c(d);this.closeAllMenus()});this.getHandler().listen(d,
goog.ui.PopupBase.EventType.BEFORE_HIDE,function(){fyre.v1.dom(a.element_).removeClass("fyre-button-left-open")});return d};fyre.v1.Editor.prototype.handleToolbarButtonClick=function(a,b){var c=fyre.v1.dom(b.element_);a.isOrWasRecentlyVisible()?c.removeClass("fyre-button-left-open"):c.addClass("fyre-button-left-open");a.setVisible(!a.isOrWasRecentlyVisible())};fyre.v1.Editor.prototype.closeAllMenus=function(){goog.object.forEach(this._toolbarPopups,function(a){a.setVisible(!1)})};
fyre.v1.Editor.prototype.createFollowControl=function(a){this.getHandler().listen(a,goog.ui.Component.EventType.ACTION,this._handleFollowClick,this);this.viewModel.onChange(this.viewModel.ATTRIBUTES.FOLLOWING,this._setFollowerButtonText,this);this._setFollowerButtonText()};
fyre.v1.Editor.prototype._setFollowerButtonText=function(){this._toolbarControls[this.TOOLBAR_CONTROLS.FOLLOW].setCaption(this.viewModel.get(this.viewModel.ATTRIBUTES.FOLLOWING)?this._config[this._config.KEYS.UNFOLLOW_BUTTON_TEXT]:this._config[this._config.KEYS.FOLLOW_BUTTON_TEXT])};fyre.v1.Editor.prototype._handleFollowClick=function(){this.trigger(this.EVENTS.FOLLOW_CHANGE,!this.viewModel.get(this.viewModel.ATTRIBUTES.FOLLOWING))};
fyre.v1.Editor.prototype.createPostControl=function(a){this.changePostControlText(this._config[this.viewModel.get(this.viewModel.ATTRIBUTES.USERAUTH)?this._config.KEYS.POST_BUTTON_TEXT_AUTH:this._config.KEYS.POST_BUTTON_TEXT_ANON]);this.getHandler().listen(a,goog.ui.Component.EventType.ACTION,this.handlePost,this)};fyre.v1.Editor.prototype.changePostControlText=function(a){this._toolbarControls[this.TOOLBAR_CONTROLS.POST].setCaption(a)};fyre.v1.Editor.prototype.changeCancelControlText=function(a){this._toolbarControls[this.TOOLBAR_CONTROLS.CANCEL].setCaption(a)};
fyre.v1.Editor.prototype.showSpinner=function(){this.editableEl_.append(fyre.v1.dom.create(fyre.templates.core.editor.spinner()))};fyre.v1.Editor.prototype.disablePostButton=function(){this.postDisabled_=!0;fyre.v1.dom(this._toolbarControls[fyre.v1.Editor.prototype.TOOLBAR_CONTROLS.POST].getElement()).swapClass("fyre-post-button-enabled","fyre-post-button-disabled")};
fyre.v1.Editor.prototype.enablePostButton=function(){this.postDisabled_=!1;fyre.v1.dom(this._toolbarControls[fyre.v1.Editor.prototype.TOOLBAR_CONTROLS.POST].getElement()).swapClass("fyre-post-button-disabled","fyre-post-button-enabled")};fyre.v1.Editor.prototype.focus=function(){this.field_.focus()};
fyre.v1.Editor.prototype.focusAndPlaceCursorAtEnd=function(a){this.focus();if(!goog.userAgent.IE||goog.userAgent.isVersion(9))if(!this.field_.getRange()||a)a=this.field_.field.childNodes,a.length&&(a=a[a.length-1].childNodes,goog.editor.range.placeCursorNextTo(a[a.length-1]))};fyre.v1.Editor.prototype.hideSpinner=function(){var a=this.$dom_.getByClass("fyre-editor-spinner");a&&a.remove()};
fyre.v1.Editor.prototype.showError=function(a){this.errorComp_&&this.errorComp_.dispose();a=goog.object.get(this._config,this._config.ERRORS[a]||a,this._config[this._config.KEYS.DEFAULT_ERROR]);this.errorComp_=new fyre.v1.editor.ErrorNotification(a);this.errorComp_.render();this.editableEl_.append(this.errorComp_.getElement());this.errorComp_.show()};fyre.v1.Editor.prototype.hideError=function(){this.errorComp_&&this.errorComp_.hide()};
fyre.v1.Editor.prototype.attachMinimalListeners=function(){goog.events.listen(this.field_,goog.editor.Field.EventType.FOCUS,goog.bind(function(){this.setMinimal(!1)},this));goog.events.listen(document,goog.events.EventType.CLICK,goog.bind(function(a){fyre.v1.dom(a.target).hasAncestorByClass("fyre-editor-container")||this.setMinimal(!0)},this))};
fyre.v1.Editor.prototype.setMinimal=function(a){a?(this.saveState(),this.setHtml(!1,this._config[this._config.KEYS.MINIMAL_TEXT]),fyre.v1.dom(this.el).addClass("fyre-editor-minimal"),this.handleRemoveToolbarElements()):(this.loadState(),this.field_.focus(),fyre.v1.dom(this.el).removeClass("fyre-editor-minimal"))};
fyre.v1.Editor.prototype.handleUserAuthChange=function(){this.changePostControlText(this.viewModel.get(this.viewModel.ATTRIBUTES.USERAUTH)?this._config[this._config.KEYS.POST_BUTTON_TEXT_AUTH]:this._config[this._config.KEYS.POST_BUTTON_TEXT_ANON])};fyre.v1.Editor.prototype.handleBodyChange=function(){var a=this.viewModel.get(this.viewModel.ATTRIBUTES.BODY);this.setHtml(!1,goog.string.trim(a),!0)};
fyre.v1.Editor.prototype.handleMediaChange=function(a){a=a.collection;goog.asserts.assert(a==this.viewModel.get(this.viewModel.ATTRIBUTES.MEDIA));var b=this._toolbarControls[fyre.v1.Editor.prototype.TOOLBAR_CONTROLS.MEDIA];a.length?b.setEnabled(!1):b.setEnabled(!0)};
fyre.v1.Editor.prototype.clear=function(){var a=this.viewModel.get(this.viewModel.ATTRIBUTES.MEDIA);this.clearPostingState();this.viewModel.set(this.viewModel.ATTRIBUTES.BODY,"");this.closeAllMenus();try{this.handleEditorResize_()}catch(b){}a&&a.reset()};fyre.v1.Editor.prototype.serializeState=function(){var a=this.viewModel.ATTRIBUTES,b={};b[a.BODY]=this.getContents();this.viewModel.get(a.MEDIA)&&(b[a.MEDIA]=this.viewModel.get(a.MEDIA).toJSON());return b};
fyre.v1.Editor.prototype.loadState=function(a){var b=this.viewModel.ATTRIBUTES;this.viewModel.set(b.BODY,a[b.BODY]);a[b.MEDIA]&&this.viewModel.get(b.MEDIA).add(a[b.MEDIA])};fyre.v1.Editor.prototype.mention=function(a){this.field_.execCommand("+mention",a)};
fyre.v1.Editor.prototype.handlePost=function(){if(!this.postDisabled_){var a=this.viewModel.ATTRIBUTES,b=this.getContents(),c=this._config.KEYS,d=this._config[c.MAX_CHARS];this.viewModel.set(a.BODY,b);goog.dom.getNodeTextLength(this.field_.field)>=d?(this._config[c.ERROR_MAX_CHARS]=goog.string.subs(this._config[c.ERROR_MAX_CHARS],d),this.setErrorState(c.ERROR_MAX_CHARS)):(this.trigger(this.EVENTS.SUBMITTED,{body:fyre.v1.util.stripEmptyHtml(b),comment:this.comment,conv:this.conv,parent:this.parent,
type:this.postType}),(a=this._toolbarControls[fyre.v1.Editor.prototype.TOOLBAR_CONTROLS.MEDIA])&&a.setEnabled(!0))}};fyre.v1.Editor.prototype.setPostingState=function(){this.mediaDrawer_&&this.mediaDrawer_.hide();this.disablePostButton();this.hideError();this.showSpinner()};fyre.v1.Editor.prototype.clearPostingState=function(){this.enablePostButton();this.hideSpinner()};fyre.v1.Editor.prototype.setErrorState=function(a){this.clearPostingState();this.showError(a)};
fyre.v1.Editor.prototype.getContents=function(){return this.field_.getCleanContents()};fyre.v1.Editor.prototype.canBeSmall=function(){this.$dom_.addClass(fyre.v1.Editor.CLASSES.SMALL)};fyre.v1.MobileEditor=function(a,b){this.initialize(a||{});fyre.v1.ui.FyreComponent.call(this,b)};goog.inherits(fyre.v1.MobileEditor,fyre.v1.ui.FyreComponent);
fyre.v1.MobileEditor.CLASSES=fyre.v1.MobileEditor.prototype.CLASSES={CANCEL:"fyre-cancel-button",CONTAINER:"fyre-editor-container",EDITABLE:"fyre-editor-editable",EMBED:"fyre-embed-button",POST:"fyre-post-button",POST_ENABLED:"fyre-post-button-enabled",POST_DISABLED:"fyre-post-button-disabled",SMALL:"fyre-editor-small",SPINNER:"fyre-editor-spinner",TOOLBAR:"fyre-editor-toolbar"};fyre.v1.MobileEditor.EVENTS=fyre.v1.MobileEditor.prototype.EVENTS={SUBMITTED:"submitted",CANCEL:"cancel",FOCUS:"focus"};
fyre.v1.MobileEditor.prototype.initialize=function(a){fyre.v1.MobileEditor.superClass_.initialize.call(this,a);this.viewModel=a.viewModel||new fyre.v1.editor.EditorModel;this._config=this.viewModel.get(this.viewModel.ATTRIBUTES.CONFIG);this._toolbarControls={};this.postDisabled_=!1;this.parent=a.parent;this.postType=a.postType};fyre.v1.MobileEditor.TOOLBAR_CONTROLS=fyre.v1.MobileEditor.prototype.TOOLBAR_CONTROLS={CANCEL:"cancel",MEDIA:"media",POST:"post"};
fyre.v1.MobileEditor.prototype.CONFIG_CONTROL_MAP=function(){var a=fyre.v1.editor.CONFIG_KEYS,b=fyre.v1.MobileEditor.TOOLBAR_CONTROLS,c={};c[b.CANCEL]=a.CANCEL_TOOLBAR;c[b.MEDIA]=a.ALLOW_MEDIA;return c}();
fyre.v1.MobileEditor.prototype.getToolbarButtons=function(){var a=this.TOOLBAR_CONTROLS,b=fyre.v1.editor.RightButtonRenderer.getInstance(),c=fyre.v1.editor.LeftButtonRenderer.getInstance(),d=this.CLASSES,e=this.viewModel.get(this.viewModel.ATTRIBUTES.POST_TYPE);return[[a.MEDIA,c,"",d.EMBED],[a.POST,b,"",goog.string.subs("%s %s %s-%s",d.POST,d.POST_ENABLED,d.POST,e)],[a.CANCEL,b,"Cancel",d.CANCEL]]};
fyre.v1.MobileEditor.prototype.enterDocument=function(){this.viewModel.on(this.viewModel.attributeChangeEvent(this.viewModel.ATTRIBUTES.USERAUTH),this.handleUserAuthChange,this);this.viewModel.on(this.viewModel.attributeChangeEvent(this.viewModel.ATTRIBUTES.BODY),this.handleBodyChange,this);fyre.v1.MobileEditor.superClass_.enterDocument.call(this)};
fyre.v1.MobileEditor.prototype.createDomInternal=function(){var a=this.CLASSES,b="fyre-editor-"+goog.getUid(this.element_);this.$dom_.html(fyre.templates.core.editor.mobileMain());this.containerEl_=this.$dom_.getByClass(a.CONTAINER);this.toolbarEl_=this.containerEl_.getByClass(a.TOOLBAR);this.editableEl_=this.containerEl_.getByClass(a.EDITABLE);this.textArea_=this.editableEl_.first();this.field_=new goog.editor.Field(b);this.createToolbar();this.initialSize_=goog.style.getSize(this.editableEl_.element);
this.initializeContent_()};fyre.v1.MobileEditor.prototype.disposeInternal=function(){this.editableEl_=this.toolbarEl_=this.containerEl_=null;this.errorComp_&&this.errorComp_.dispose();this.mediaDrawer_&&this.mediaDrawer_.dispose();this.mediaDrawer_=null;fyre.v1.MobileEditor.superClass_.disposeInternal.call(this)};
fyre.v1.MobileEditor.prototype.getHtmlContent=function(){for(var a=this.textArea_.element.value.split("@"),b=1,c=a.length;b<c;b++)a[b]=this.rewriteMention_(a[b]);a=goog.string.buildString("<p>",a.join(""),"</p>");return a=a.replace(/(\r\n|\r|\n)/g,"</p><p>")};
fyre.v1.MobileEditor.prototype.rewriteMention_=function(a){for(var b,c,d,e=0,f=a.length;e<f;e++)if(c=this.getMatchingMentionName_(a.substring(0,e+1)))b=c,d=e;return b?(b=b.toMention(),b.set(b.ATTRIBUTES.PREFIX,""),fyre.templates.core.misc.mention(b.toJSON())+a.substring(d+1)):"@"+a};
fyre.v1.MobileEditor.prototype.getMatchingMentionName_=function(a){var b=this.viewModel.get(this.viewModel.ATTRIBUTES.FOLLOWERS),c=this.viewModel.get(this.viewModel.ATTRIBUTES.SOCIAL_FRIENDS),a=goog.bind(this.matchAuthorName_,this,a);return b&&b.find(a)||c&&c.find(a)};fyre.v1.MobileEditor.prototype.matchAuthorName_=function(a,b){return a==b.get(b.ATTRIBUTES.DISPLAY_NAME)?b:null};
fyre.v1.MobileEditor.prototype.setHtmlContent=function(a){a=goog.string.trim(a);a=a.replace(/(<([^>]+)>)/ig,"").replace(/<\/p>\s*<p>/g,"\r\n");this.textArea_.element.value=a};fyre.v1.MobileEditor.prototype.initializeContent_=function(){var a=this.viewModel.get(this.viewModel.ATTRIBUTES.BODY),b=this.viewModel.ATTRIBUTES.USERAUTH?this._config.KEYS.POST_BUTTON_TEXT_AUTH:this._config.KEYS.POST_BUTTON_TEXT_ANON;a&&this.setHtmlContent(a);this.changePostControlText(this._config[b])};
fyre.v1.MobileEditor.prototype._toolbarControlActive=function(a){return a==this.TOOLBAR_CONTROLS.POST||this._config[this.CONFIG_CONTROL_MAP[a]]};fyre.v1.MobileEditor.prototype.createToolbar=function(){var a;a=goog.array.filter(goog.array.map(this.getToolbarButtons(),this.createToolbarButton,this),goog.functions.identity);a.push(new goog.ui.ToolbarSeparator);return goog.ui.editor.DefaultToolbar.makeToolbar(a,this.toolbarEl_.element)};
fyre.v1.MobileEditor.prototype.createToolbarButton=function(a){return this._createToolbarButton.apply(this,a)};
fyre.v1.MobileEditor.prototype._createToolbarButton=function(a,b,c,d){if(this._toolbarControlActive(a)){b=new goog.ui.CustomButton(c,b);b.enableClassName(d,!0);this._toolbarControls[a]=b;switch(a){case this.TOOLBAR_CONTROLS.POST:this.getHandler().listen(b,goog.ui.Component.EventType.ACTION,this.handlePost,this);break;case this.TOOLBAR_CONTROLS.CANCEL:this.getHandler().listen(b,goog.ui.Component.EventType.ACTION,this.makeTrigger(this.EVENTS.CANCEL));break;case this.TOOLBAR_CONTROLS.MEDIA:this.createEmbedControl_(b),
this.createMediaDrawer_()}return b}};fyre.v1.MobileEditor.prototype.createEmbedControl_=function(a){this.getHandler().listen(a,goog.ui.Component.EventType.ACTION,this.handleMediaButtonClicked_)};fyre.v1.MobileEditor.prototype.handleMediaButtonClicked_=function(){this.dispatchEvent({type:fyre.v2.editor.EVENTS.MEDIA_UPLOAD_CLICKED,successCallback:goog.bind(this.mediaDrawer_.addMedia,this.mediaDrawer_)})};
fyre.v1.MobileEditor.prototype.createMediaDrawer_=function(){var a=this.viewModel.get(this.viewModel.ATTRIBUTES.MEDIA);this.mediaDrawer_=new fyre.v2.editor.MediaDrawer(a);this.mediaDrawer_.renderBefore(this.toolbarEl_.element);this.mediaDrawer_.setParent(this)};
fyre.v1.MobileEditor.prototype.createPostControl=function(a){this.changePostControlText(this._config[this.viewModel.ATTRIBUTES.USERAUTH?this._config.KEYS.POST_BUTTON_TEXT_AUTH:this._config.KEYS.POST_BUTTON_TEXT_ANON]);this.getHandler().listen(a,goog.ui.Component.EventType.ACTION,this.handlePost,this)};fyre.v1.MobileEditor.prototype.showSpinner=function(){this.editableEl_.append(fyre.v1.dom.create(fyre.templates.core.editor.spinner()))};
fyre.v1.MobileEditor.prototype.disablePostButton=function(){var a=this.CLASSES,b=this._toolbarControls[this.TOOLBAR_CONTROLS.POST].getElement();this.postDisabled_=!0;goog.dom.classes.swap(b,a.POST_ENABLED,a.POST_DISABLED)};fyre.v1.MobileEditor.prototype.enablePostButton=function(){var a=this.CLASSES,b=this._toolbarControls[this.TOOLBAR_CONTROLS.POST].getElement();this.postDisabled_=!1;goog.dom.classes.swap(b,a.POST_DISABLED,a.POST_ENABLED)};fyre.v1.MobileEditor.prototype.focus=function(){this.textArea_.element.focus()};
fyre.v1.MobileEditor.prototype.focusAndPlaceCursorAtEnd=function(){this.focus()};fyre.v1.MobileEditor.prototype.hideSpinner=function(){var a=this.$dom_.getByClass(this.CLASSES.SPINNER);a&&a.remove()};
fyre.v1.MobileEditor.prototype.showError=function(a){this.errorComp_&&this.errorComp_.dispose();a=goog.object.get(this._config,this._config.ERRORS[a]||a,this._config[this._config.KEYS.DEFAULT_ERROR]);this.errorComp_=new fyre.v1.editor.ErrorNotification(a);this.errorComp_.render();this.editableEl_.append(this.errorComp_.getElement());this.errorComp_.show()};fyre.v1.MobileEditor.prototype.hideError=function(){this.errorComp_&&this.errorComp_.hide()};
fyre.v1.MobileEditor.prototype.changePostControlText=function(a){this._toolbarControls[this.TOOLBAR_CONTROLS.POST].setCaption(a)};fyre.v1.MobileEditor.prototype.changeCancelControlText=function(a){this._toolbarControls[this.TOOLBAR_CONTROLS.CANCEL].setCaption(a)};fyre.v1.MobileEditor.prototype.handleUserAuthChange=function(){this.changePostControlText(this.viewModel.get(this.viewModel.ATTRIBUTES.USERAUTH)?this._config[this._config.KEYS.POST_BUTTON_TEXT_AUTH]:this._config[this._config.KEYS.POST_BUTTON_TEXT_ANON])};
fyre.v1.MobileEditor.prototype.handleBodyChange=function(){this.setHtmlContent(this.viewModel.get(this.viewModel.ATTRIBUTES.BODY))};fyre.v1.MobileEditor.prototype.clear=function(){var a=this.viewModel.get(this.viewModel.ATTRIBUTES.MEDIA);this.setHtmlContent("");this.viewModel.set(this.viewModel.ATTRIBUTES.BODY,"");this.clearPostingState();a&&a.reset()};fyre.v1.MobileEditor.prototype.serializeState=function(){var a={};a[this.viewModel.ATTRIBUTES.BODY]=this.getHtmlContent();return a};
fyre.v1.MobileEditor.prototype.loadState=function(a){var b=this.viewModel.ATTRIBUTES;this.viewModel.set(b.BODY,a[b.BODY])};fyre.v1.MobileEditor.prototype.mention=function(){};fyre.v1.MobileEditor.prototype.handlePost=function(){if(!this.postDisabled_){var a=this.viewModel.ATTRIBUTES,b=this.getHtmlContent();this.viewModel.set(a.BODY,b);this.trigger(this.EVENTS.SUBMITTED,{body:b,comment:this.comment,conv:this.conv,parent:this.parent,type:this.postType})}};
fyre.v1.MobileEditor.prototype.setPostingState=function(){this.mediaDrawer_&&this.mediaDrawer_.hide();this.disablePostButton();this.hideError();this.showSpinner()};fyre.v1.MobileEditor.prototype.clearPostingState=function(){this.enablePostButton();this.hideSpinner()};fyre.v1.MobileEditor.prototype.setErrorState=function(a){this.clearPostingState();this.showError(a)};fyre.v1.MobileEditor.prototype.setResize=function(){goog.style.setHeight(this.editableEl_.element,100)};
fyre.v1.MobileEditor.prototype.getContents=function(){return""};fyre.v1.MobileEditor.prototype.canBeSmall=function(){this.$dom_.addClass(fyre.v1.MobileEditor.CLASSES.SMALL)};fyre.conv.view.BaseEditorView=function(a,b){this.context=a;this.initialize(b);fyre.v1.ui.FyreComponent.call(this)};goog.inherits(fyre.conv.view.BaseEditorView,fyre.v1.ui.FyreComponent);fyre.conv.view.BaseEditorView.CLASSES=fyre.conv.view.BaseEditorView.prototype.CLASSES={RAW_HTML:"fyre-editor-rawhtml",EDITOR_PREVIEW:"fyre-editor-preview"};
fyre.conv.view.BaseEditorView.prototype.initialize=function(a){fyre.conv.view.BaseEditorView.superClass_.initialize.call(this,a);this.parentId=a.parentId;goog.asserts.assert(a.viewModel);this.viewModel=a.viewModel;this.commentModel=new fyre.conv.model.Comment;this.stateKey_=a.stateKey||"fyre-editorstate-main";this.busHandler=new fyre.conv.view.EditorViewHandler(a,this);this._setupViewModel(this.viewModel,a);fyre.v1.util.browser.isMobile()?(this.editor=new fyre.v1.MobileEditor({viewModel:this.viewModel}),
this.isMobile=!0):(this.editor=new fyre.v1.Editor({viewModel:this.viewModel}),this.editor.on(this.editor.EVENTS.POST_TO_CLICKED,this.handlePostToClick,this),this.editor.on(this.editor.EVENTS.FOLLOW_CHANGE,this.handleFollowChange,this),this.editor.on(this.editor.EVENTS.FETCH_FRIENDS,goog.bind(this.retrieveSocialFriends,this,!0),this),this.htmlPreviewComp_=new fyre.conv.view.editor.PreviewComponent(this.commentModel),this.getHandler().listen(this.htmlPreviewComp_,fyre.conv.view.editor.PreviewComponent.events.CANCELED,
this.handlePreviewCancelled),this.rawHtmlButton_=this.editor.createToolbarButton(fyre.v1.editor.LeftButtonRenderer.getInstance(),"","fyre-html-button"),this.getHandler().listen(this.rawHtmlButton_,goog.ui.Component.EventType.ACTION,this.handleRawHtmlButtonClick));this.addChild(this.editor);fyre.conv.user.on(fyre.conv.user.attributeChangeEvent(fyre.conv.user.ATTRIBUTES.TOKEN_EXPIRED),function(a){a&&(this.editor.disablePostButton(),this.editor.showError(fyre.v1.editor.CONFIG_KEYS.ERROR_EXPIRED))},this);
this.loadState();this.autoHide_=!1;this.autoHideSkipElms_=[];this.wasFocused_=!1;this.editor.on(this.editor.EVENTS.SUBMITTED,this.postComment,this)};fyre.conv.view.BaseEditorView.prototype.createDomInternal=function(){fyre.conv.view.BaseEditorView.superClass_.createDomInternal.call(this);this.editor.decorate(this.element_,!0);this.setupRawHtmlButton()};
fyre.conv.view.BaseEditorView.prototype.enterDocument=function(){this.getHandler().listenOnce(this.element_,goog.events.EventType.CLICK,this.handleClick);fyre.conv.view.BaseEditorView.superClass_.enterDocument.call(this)};
fyre.conv.view.BaseEditorView.prototype._setupViewModel=function(a){var b=a.ATTRIBUTES;a.get(b.MEDIA);a.has(b.FOLLOWERS)||a.set(b.FOLLOWERS,this.context.collectionService.followers());a.has(b.SOCIAL_FRIENDS)||a.set(b.SOCIAL_FRIENDS,this.context.authenticationService.getSocialFriends());a.has(b.CONV_AUTHORS)||a.set(b.CONV_AUTHORS,this.context.collectionService.authors());fyre.conv.user.on(fyre.conv.user.attributeChangeEvent(fyre.conv.user.ATTRIBUTES.ID),function(){this.viewModel.set(a.ATTRIBUTES.USERAUTH,
fyre.conv.user.id)},this);this.viewModel.set(a.ATTRIBUTES.USERAUTH,fyre.conv.user.id);return a};fyre.conv.view.BaseEditorView.prototype.handleFollowChange=function(a){this.context.authenticationService.ensureLogin(this.context.collectionService.collection(),goog.bind(this.context.collectionService.follow,this.context.collectionService,a))};
fyre.conv.view.BaseEditorView.prototype.handlePostToClick=function(a,b){var c=null;switch(a){case "twitter":c=fyre.v1.enums.social.services.TWITTER;break;case "facebook":c=fyre.v1.enums.social.services.FACEBOOK;break;case "linkedin":c=fyre.v1.enums.social.services.LINKEDIN;break;case "google-plus":c=fyre.v1.enums.social.services.GOOGLE_PLUS;break;default:goog.asserts.assert(!1,"Unknown post to type: "+a)}var d=fyre.v1.dom(b.target.getContentElement()),e=this.editor.viewModel.ATTRIBUTES,f=this.editor.viewModel.get(e.SHARE_TYPES),
g=this.context.authenticationService;this.context.authenticationService.ensureLogin(this.context.collectionService.collection(),goog.bind(g.getOAuthToken,g,fyre.conv.user,c,goog.bind(function(){goog.array.contains(f,a)?(goog.array.remove(f,a),this.editor.viewModel.set(e.SHARE_TYPES,f),d.removeClass("fyre-post-to-selected")):(f.push(a),this.editor.viewModel.set(e.SHARE_TYPES,f),d.addClass("fyre-post-to-selected"))},this),goog.bind(function(){d.removeClass("fyre-post-to-selected")},this)),goog.nullFunction)};
fyre.conv.view.BaseEditorView.prototype.addMention=function(a){this.editor.field.execCommand("+mention",a)};
fyre.conv.view.BaseEditorView.prototype.buildPostData=function(){var a=this.commentModel,b=this.viewModel;a.set(a.ATTRIBUTES.BODY_HTML,fyre.v1.util.stripEmptyHtml(b.get(b.ATTRIBUTES.BODY)));a.set(a.ATTRIBUTES.CONV,this.context.collectionService.collection().id);a.set(a.ATTRIBUTES.PARENT_ID,this.parentId);var c=b.get(b.ATTRIBUTES.MEDIA),d=c.map(function(a){return a.get("source_url")});a.set(a.ATTRIBUTES.MEDIA,c);a.set(a.ATTRIBUTES.EMBEDDED_URLS,d);var e=0;goog.array.forEach(b.get(b.ATTRIBUTES.SHARE_TYPES),
function(b){switch(b){case "twitter":e|=a.SHARE_TYPES.TWITTER;break;case "facebook":e|=a.SHARE_TYPES.FACEBOOK;break;case "linkedin":e|=a.SHARE_TYPES.LINKEDIN;break;default:goog.asserts.fail("Unknown post to type: "+b)}});a.set(a.ATTRIBUTES.SHARE_TYPES,e);return a};fyre.conv.view.BaseEditorView.prototype.loadState=function(){var a=fyre.v1.util.jsoncookie.getb64(this.stateKey_);a&&(this.editor.loadState(a),goog.net.cookies.remove(this.stateKey_))};
fyre.conv.view.BaseEditorView.prototype.saveState=function(){fyre.v1.util.jsoncookie.setb64(this.stateKey_,this.editor.serializeState(),600)};fyre.conv.view.BaseEditorView.prototype.handleClick=function(){this.wasFocused_||fyre.conv.bus.subscribe(fyre.conv.events.USER_LOGGED_IN,this.retrieveSocialFriends,this);this.wasFocused_=!0;this.retrieveSocialFriends()};
fyre.conv.view.BaseEditorView.prototype.retrieveSocialFriends=function(a){(fyre.conv.user.id&&this.wasFocused_||a)&&this.context.authenticationService.fetchSocialFriends(a,goog.bind(this.handleRetrieveSocialFriendComplete,this))};fyre.conv.view.BaseEditorView.prototype.handleRetrieveSocialFriendComplete=function(){this.editor.mentionsMenu.trigger(this.editor.mentionsMenu.EVENTS.FETCH_FRIENDS_COMPLETE)};fyre.conv.view.BaseEditorView.prototype.setPostingState=function(){this.editor.setPostingState()};
fyre.conv.view.BaseEditorView.prototype.clearPostingState=function(){this.editor.clearPostingState()};fyre.conv.view.BaseEditorView.prototype.clear=function(){this.commentModel.set(this.commentModel.ATTRIBUTES.RAW_HTML,null);this.editor.clear()};fyre.conv.view.BaseEditorView.prototype.setErrorState=function(a){this.editor.setErrorState(a)};fyre.conv.view.BaseEditorView.prototype.setAutoHide=function(a,b){this.autoHide_=a;b&&(this.autoHideSkipElms_=goog.isArray(b)?b:[b])};
fyre.conv.view.BaseEditorView.prototype.setResize=function(a){this.editor.setResize(a)};
fyre.conv.view.BaseEditorView.prototype.show=function(){fyre.v1.dom(this.element_).show();var a=goog.dom.getOwnerDocument(this.element_);if(this.autoHide_)if(this.getHandler().listen(a,goog.events.EventType.CLICK,this.handleDocumentClick_,!0),goog.userAgent.IE){var b;try{b=a.activeElement}catch(c){}for(;b&&"IFRAME"==b.nodeName;){try{var d=goog.dom.getFrameContentDocument(b)}catch(e){break}a=d;b=a.activeElement}this.getHandler().listen(a,goog.events.EventType.CLICK,this.handleDocumentClick_,!0);this.getHandler().listen(a,
goog.events.EventType.DEACTIVATE,this.handleDocumentBlur_)}else this.getHandler().listen(a,goog.events.EventType.BLUR,this.handleDocumentBlur_)};fyre.conv.view.BaseEditorView.prototype.hide=function(){fyre.v1.dom(this.element_).hide()};fyre.conv.view.BaseEditorView.prototype.isHidden=function(){return fyre.v1.dom(this.element_).isHidden()};
fyre.conv.view.BaseEditorView.prototype.handleDocumentClick_=function(a){var b=a.target;this.autoHide_&&(a=fyre.v1.util.some(this.autoHideSkipElms_,function(a){return goog.dom.contains(a,b)}),!goog.dom.contains(this.element_,b)&&!a&&!this.isHidden()&&(goog.userAgent.IE?window.setTimeout(goog.bind(this.hide,this),250):this.hide()))};
fyre.conv.view.BaseEditorView.prototype.handleDocumentBlur_=function(a){var b=goog.dom.getOwnerDocument(this.element_);if(goog.userAgent.IE||goog.userAgent.OPERA||goog.userAgent.GECKO){if(a=b.activeElement,!a||goog.dom.contains(this.element_,a)||"BODY"==a.tagName)return}else if(a.target!=b)return;this.isHidden()||(goog.userAgent.IE?window.setTimeout(goog.bind(this.hide,this),250):this.hide())};
fyre.conv.view.BaseEditorView.prototype.disposeInternal=function(){fyre.conv.user.off(null,null,this);this.getHandler().dispose();this.busHandler&&this.busHandler.dispose();this.editor.off();this.editor.dispose();fyre.conv.view.BaseEditorView.superClass_.disposeInternal.call(this)};
fyre.conv.view.BaseEditorView.prototype.setupRawHtmlButton=function(){if(!this.isMobile&&this.editor&&this.editor.getToolbar()){var a=this.context.collectionService.collection(),b=fyre.conv.user.get(fyre.conv.model.User.ATTRIBUTES.MODERATOR),b=b&&a.get(a.ATTRIBUTES.RAW_HTML),a=this.rawHtmlButton_.getParent()==this.editor.getToolbar(),c=this.htmlPreviewComp_.getElement();b&&!a&&(this.editor.addToolbarButtonAfter(this.rawHtmlButton_,this.editor.getBuiltinToolbarControl(this.editor.TOOLBAR_CONTROLS.MENTION),
!0),c||(this.htmlPreviewComp_.render(),this.dom_.replaceNode(this.htmlPreviewComp_.getElement(),this.getElementByClass(this.CLASSES.EDITOR_PREVIEW))));!b&&a&&(this.editor.getToolbar().removeChild(this.rawHtmlButton_,!0),c&&goog.style.showElement(c,!1))}};
fyre.conv.view.BaseEditorView.prototype.handleRawHtmlButtonClick=function(){var a=new goog.ui.Textarea,b=this.commentModel.get(this.commentModel.ATTRIBUTES.RAW_HTML);a.addClassName(this.CLASSES.RAW_HTML);b&&a.setValue(b.body);var b=fyre.v1.ui.Dialog.getInstance(),c=fyre.conv.i18n.textEnumeration;b.setTitle(c.get(c.KEYS.CUSTOM_HTML_DIALOG_TITLE));b.addChild(a,!0);c=goog.bind(function(){var b=a.getValue(),b=goog.string.isEmptySafe(b)?null:{body:b};this.commentModel.set(this.commentModel.ATTRIBUTES.RAW_HTML,
b)},this);b.handleOkClick(c);var d=this.autoHide_;this.setAutoHide(!1);c=goog.bind(function(){this.setAutoHide(d)},this);this.getHandler().listen(b,goog.ui.Dialog.EventType.AFTER_HIDE,c);b.open();a.setMinHeight(200)};fyre.conv.view.BaseEditorView.prototype.handlePreviewCancelled=function(){this.commentModel.set(this.commentModel.ATTRIBUTES.RAW_HTML,null)};fyre.conv.view.BaseEditorView.prototype.postComment=function(){this.setPostingState()};fyre.conv.view.EditorDisabled=function(a){goog.ui.Component.call(this,a)};goog.inherits(fyre.conv.view.EditorDisabled,goog.ui.Component);fyre.conv.view.EditorDisabled.prototype.decorateInternal=function(a){a.innerHTML=fyre.templates.core.editor.disabled();this.element_=a};fyre.conv.view.EditorDisabled.prototype.getToolbar=function(){return null};fyre.conv.view.EditorView=function(a,b){fyre.conv.view.BaseEditorView.call(this,a,b)};goog.inherits(fyre.conv.view.EditorView,fyre.conv.view.BaseEditorView);fyre.conv.view.EditorView.prototype.decorateInternal=function(a){fyre.conv.view.EditorView.superClass_.decorateInternal.call(this,a);this.inDocument_=!0;this.updateVisibility_();this.collection_.isLiveChat()&&(this.editor.field_.clearBeforeFirstInsert=!0)};
fyre.conv.view.EditorView.prototype.registerCollection=function(a){goog.asserts.assert(!this.collection_);this.collection_=a;this.updateVisibility_();fyre.conv.user.onChange(fyre.conv.model.User.ATTRIBUTES.MODERATOR,this.updateVisibility_,this)};
fyre.conv.view.EditorView.prototype.updateVisibility_=function(){if(this.inDocument_&&this.collection_){var a=fyre.conv.model.User.ATTRIBUTES.MODERATOR;!fyre.conv.user.get(a)&&this.collection_.isLiveBlog()?this.hide():(this.show(),this.collection_.isLiveBlog()&&fyre.conv.user.get(a)&&fyre.v1.client.FilepickerClient.getInstance().init())}};
fyre.conv.view.EditorView.prototype.initialize=function(a){this.hasFocused_=!1;a.collectionModel&&this.registerCollection(a.collectionModel);fyre.conv.user.on(fyre.conv.user.EVENTS.CHANGE,this.handleUserUpdated,this);var b=new fyre.v1.editor.EditorModel;b.set(b.ATTRIBUTES.USER,fyre.conv.user);var c=fyre.conv.view.EditorConfig(a),d=this.collection_.isLiveBlog(),e=this.collection_.isLiveChat(),f=!this.collection_.get(fyre.conv.model.Collection.ATTRIBUTES.COMMENTS_ENABLED);d&&(c[c.KEYS.ALLOW_MEDIA]=
!0);e&&(d=fyre.conv.i18n.textEnumeration,c[c.KEYS.POST_BUTTON_TEXT_ANON]=d.get(d.KEYS.LIVECHAT_POST),c[c.KEYS.POST_BUTTON_TEXT_AUTH]=d.get(d.KEYS.LIVECHAT_POST),fyre.v1.util.browser.isMobile()||(e=d.get(d.KEYS.LIVECHAT_WINDOWS_INSTR),goog.userAgent.WINDOWS||(e=d.get(d.KEYS.LIVECHAT_OTHER_INSTR)),b.set(b.ATTRIBUTES.BODY,e)));f?this.editor=new fyre.conv.view.EditorDisabled:(b.set(b.ATTRIBUTES.CONFIG,c),a.viewModel=b,fyre.conv.view.EditorView.superClass_.initialize.call(this,a),this.editor.on(this.editor.EVENTS.FOCUS,
this.handleFocus,this))};
fyre.conv.view.EditorView.prototype.postComment=function(){var a=this.buildPostData(),b=this.context.collectionService.collection(),c=goog.string.isEmpty(a.get(a.ATTRIBUTES.BODY_HTML));if(c=(c=c&&!(b.isLiveBlog()&&a.get(a.ATTRIBUTES.EMBEDDED_URLS).length))&&!a.get(a.ATTRIBUTES.RAW_HTML))this.editor.setErrorState(fyre.v1.editor.CONFIG_KEYS.ERROR_EMPTY);else{this.editor.setPostingState();this.context.actionQueueService.enqueue(fyre.conv.service.ActionQueueService.ACTION_TYPES.POST,a);try{this.context.authenticationService.ensureLogin(this.context.collectionService.collection(),
goog.bind(this.context.commentService.postMessage,this.context.commentService,a,goog.bind(this.busHandler.commentPostSuccess,this.busHandler),goog.bind(this.busHandler.commentPostFailure,this.busHandler)),goog.bind(this.editor.clearPostingState,this.editor))}catch(d){if(!(d instanceof fyre.v1.errors.CommentCharacterLimitReached))return;this.editor.setErrorState(fyre.v1.editor.CONFIG_KEYS.ERROR_MAX_CHARS)}this.dispatchEvent({type:fyre.conv.stream.EVENTS.POST_COMMENT})}};
fyre.conv.view.EditorView.prototype.handleFocus=function(){this.collection_.isLiveChat()&&!this.hasFocused_&&this.editor.field_.clearBeforeFirstInsert&&this.editor.setHtml(!0,null,!0);this.editor.field_.clearBeforeFirstInsert=!1;this.hasFocused_=!0};fyre.conv.view.EditorView.prototype.handleUserUpdated=function(){if(this.isInDocument()){var a=this.context.collectionService.collection(),b=fyre.conv.user.get(fyre.conv.model.User.ATTRIBUTES.MODERATOR);a.isLiveBlog()&&!b?this.hide():this.show();this.setupRawHtmlButton()}};fyre.conv.author.EVENTS={AUTHOR_CLICK:"author_click",AUTHOR_FETCH:"author_fetch"};fyre.v1.ui.Tooltip=function(a,b,c){goog.ui.Tooltip.call(this,a,b,c);this.tooltipString=b||"";this.setHtml(fyre.templates.core.misc.tooltip(this.getSoyData()))};goog.inherits(fyre.v1.ui.Tooltip,goog.ui.Tooltip);fyre.v1.ui.Tooltip.prototype.showDelayMs_=200;fyre.v1.ui.Tooltip.prototype.getPositioningStrategy=function(){return new fyre.v1.ui.Tooltip.Position(this.activeEl_)};fyre.v1.ui.Tooltip.prototype.getSoyData=function(){var a={};a.message=this.tooltipString;return a};
fyre.v1.ui.Tooltip.Position=function(a,b,c){b=b||goog.positioning.Corner.BOTTOM_RIGHT;goog.positioning.AnchoredPosition.call(this,a,b,c)};goog.inherits(fyre.v1.ui.Tooltip.Position,goog.positioning.AnchoredPosition);
fyre.v1.ui.Tooltip.Position.prototype.reposition=function(a,b,c){var d=goog.style.getContentBoxSize(this.element),d=new goog.math.Coordinate(d.width,d.height+25),b=goog.positioning.positionAtAnchor(this.element,this.corner,a,b,d,c,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.FAIL_Y);goog.style.setPosition(a.lastChild,0);b&&goog.positioning.OverflowStatus.FAILED&&(d=new goog.math.Coordinate(0,-5),goog.positioning.positionAtAnchor(this.element,goog.positioning.Corner.TOP_RIGHT,a,goog.positioning.Corner.BOTTOM_LEFT,
d,c,goog.positioning.Overflow.ADJUST_X|goog.positioning.Overflow.ADJUST_Y),goog.positioning.Overflow.ADJUST_X&&goog.style.setPosition(a.lastChild,a.offsetWidth-(this.element.offsetParent.offsetWidth-this.element.offsetLeft+this.element.offsetWidth/2)))};fyre.conv.view.FollowerView=function(a,b){goog.ui.Component.call(this,b);this.model_=a};goog.inherits(fyre.conv.view.FollowerView,goog.ui.Component);fyre.conv.view.FollowerView.prototype.createDom=function(){this.element_=goog.soy.renderAsElement(fyre.templates.conv.misc.follower,this.getSoyData())};
fyre.conv.view.FollowerView.prototype.enterDocument=function(){fyre.conv.view.FollowerView.superClass_.enterDocument.call(this);this.tooltip=new fyre.v1.ui.Tooltip(this.element_,this.model_.get(fyre.conv.model.Author.ATTRIBUTES.DISPLAY_NAME));this.getHandler().listen(this.element_,goog.events.EventType.CLICK,this.handleClick_)};fyre.conv.view.FollowerView.prototype.disposeInternal=function(){fyre.conv.view.FollowerView.superClass_.disposeInternal.call(this);this.tooltip&&this.tooltip.dispose()};
fyre.conv.view.FollowerView.prototype.getSoyData=function(){var a=fyre.conv.model.Author.ATTRIBUTES,b={};b.avatar=this.model_.get(a.AVATAR);b.defaultAvatar=this.model_.get(a.DEFAULT_AVATAR);b.displayName=this.model_.get(a.DISPLAY_NAME);b.id=this.model_.id;b.ident=this.model_.id.replace(/[@.]/g,"-");b.profileUrl=this.model_.get(a.PROFILE_URL);return b};fyre.conv.view.FollowerView.prototype.handleClick_=function(a){a.preventDefault();a.stopPropagation();this.dispatchEvent({author:this.model_,type:fyre.conv.author.EVENTS.AUTHOR_CLICK})};fyre.conv.view.FollowerViewContainer=function(a,b){goog.ui.Component.call(this,b);this.followers=a};goog.inherits(fyre.conv.view.FollowerViewContainer,goog.ui.Component);fyre.conv.view.FollowerViewContainer.MAX_VISIBLE_FOLLOWERS=10;fyre.conv.view.FollowerViewContainer.prototype.disposeInternal=function(){fyre.conv.view.FollowerViewContainer.superClass_.disposeInternal.call(this);delete this.followers};
fyre.conv.view.FollowerViewContainer.prototype.exitDocument=function(){fyre.conv.view.FollowerViewContainer.superClass_.exitDocument.call(this);this.followers.off(null,null,this)};fyre.conv.view.FollowerViewContainer.prototype.handleAddFollower_=function(a){var a=new fyre.conv.view.FollowerView(a),b=this.getChildCount();if(b===fyre.conv.view.FollowerViewContainer.MAX_VISIBLE_FOLLOWERS){var c=this.removeChildAt(b-1);c&&(c.dispose(),b--)}0<b?this.addChildAt(a,0,!0):this.addChild(a,!0)};
fyre.conv.view.FollowerViewContainer.prototype.handleRemoveFollower_=function(a){var b;this.forEachChild(function(c){a.id===c.model_.id&&(b=c)});b&&(this.removeChild(b),b.dispose())};fyre.conv.view.FollowerViewContainer.prototype.handleRenderComplete=function(){this.followers.on(this.followers.EVENTS.ADD,this.handleAddFollower_,this);this.followers.on(this.followers.EVENTS.REMOVE,this.handleRemoveFollower_,this);this.renderLatest_()};
fyre.conv.view.FollowerViewContainer.prototype.renderLatest_=function(){var a=this.followers.models.reverse().slice(0,fyre.conv.view.FollowerViewContainer.MAX_VISIBLE_FOLLOWERS);goog.array.forEach(a,this.handleAddFollower_,this)};fyre.conv.view.HelpView=function(a){this.isOpen=!1;goog.ui.Component.call(this,a)};goog.inherits(fyre.conv.view.HelpView,goog.ui.Component);fyre.conv.view.HelpView.CLASSES={TOUCH:"fyre-box-mobile-touch"};fyre.conv.view.HelpView.prototype.getSoyData=function(){var a=fyre.v1.config.servers.assetsBase;return{down_arrow:a+"/images/down_arrow.png",logo:a+"/images/lf-logo.png"}};
fyre.conv.view.HelpView.prototype.decorateInternal=function(a){a.innerHTML=fyre.templates.conv.app.helper(this.getSoyData());this.element_=a};
fyre.conv.view.HelpView.prototype.enterDocument=function(){fyre.v1.util.browser.isMobile()?(this.getHandler().listen(this.element_,goog.events.EventType.TOUCHEND,this.handleElementTouch_),this.getHandler().listen(this.element_,goog.events.EventType.CLICK,this.handleElementClickMobile_)):this.getHandler().listen(this.element_,goog.events.EventType.CLICK,this.handleElementClick_);fyre.conv.view.HelpView.superClass_.enterDocument.call(this)};
fyre.conv.view.HelpView.prototype.handleElementClick_=function(a){if(this.isOpen&&(a=goog.dom.getAncestor(a.target,function(a){if(a.nodeName===goog.dom.TagName.LI)return!0},!0,3)))this.closeDropDown_(),window.location=a.children[0].href};
fyre.conv.view.HelpView.prototype.handleElementTouch_=function(a){if(this.isOpen)this.handleElementClick_(a.getBrowserEvent());else{var b=fyre.conv.view.HelpView.CLASSES;a.stopPropagation();a.preventDefault();goog.dom.classes.add(this.element_,b.TOUCH);this.setBodyTouchHandler_();this.isOpen=!0}};fyre.conv.view.HelpView.prototype.handleElementClickMobile_=function(a){a.preventDefault();a.stopPropagation()};
fyre.conv.view.HelpView.prototype.setBodyTouchHandler_=function(){this.getHandler().listen(document,goog.events.EventType.TOUCHEND,this.handleBodyTouch_)};fyre.conv.view.HelpView.prototype.handleBodyTouch_=function(a){a=a.getBrowserEvent().target;goog.dom.contains(this.element_,a)||this.closeDropDown_()};
fyre.conv.view.HelpView.prototype.closeDropDown_=function(){goog.dom.classes.remove(this.element_,fyre.conv.view.HelpView.CLASSES.TOUCH);this.isOpen=!1;this.getHandler().unlisten(document,goog.events.EventType.TOUCHEND,this.handleBodyTouch_)};fyre.conv.view.LivecountView=function(a,b,c,d){goog.ui.Component.call(this,d);this.followers=a;this.model_=b;this.showMinimal=c};goog.inherits(fyre.conv.view.LivecountView,goog.ui.Component);fyre.conv.view.LivecountView.prototype.decorateInternal=function(a){fyre.conv.view.LivecountView.superClass_.decorateInternal.call(this,a);this.renderLivecount()};
fyre.conv.view.LivecountView.prototype.enterDocument=function(){fyre.conv.view.LivecountView.superClass_.enterDocument.call(this);this.model_.on(fyre.v1.model.Collection.EVENTS.CHANGE,this.renderLivecount,this)};fyre.conv.view.LivecountView.prototype.exitDocument=function(){this.model_.off(null,null,this);this.followers.off(null,null,this);fyre.conv.view.LivecountView.superClass_.exitDocument.call(this)};
fyre.conv.view.LivecountView.prototype.getSoyData=function(){var a=this.model_.get(fyre.conv.model.Livecount.ATTRIBUTES.LISTENERS),b=fyre.conv.i18n.textEnumeration,c={};c.num=a+this.followers.length;c.showMinimal=this.showMinimal;c.strings={listeners:b.get(b.KEYS.LISTENERS),listener:b.get(b.KEYS.LISTENER)};return c};
fyre.conv.view.LivecountView.prototype.handleRenderComplete=function(){var a=fyre.v1.model.Model.EVENTS;this.followers.on(a.ADD,this.renderLivecount,this);this.followers.on(a.REMOVE,this.renderLivecount,this);this.renderLivecount()};fyre.conv.view.LivecountView.prototype.renderLivecount=function(){this.element_.innerHTML=fyre.templates.conv.misc.livecount(this.getSoyData())};fyre.conv.model.Notification=function(a){fyre.v1.model.Model.call(this,a)};goog.inherits(fyre.conv.model.Notification,fyre.v1.model.Model);fyre.conv.model.Notification.prototype.ATTRIBUTES=fyre.conv.model.Notification.ATTRIBUTES={AVATAR:"avatar",EL:"el",DISPLAY_NAME:"displayName",ID:"id",PREVIEW:"preview",LIST_VISIBLE:"list_visible"};
fyre.conv.model.Notification.prototype.defaults=function(){var a={},b=fyre.conv.model.Notification.ATTRIBUTES;a[b.AVATAR]="http://livefyre-avatar.s3.amazonaws.com/a/1/e0913311699d6c9738da5373c9c5c02c/50.jpg";a[b.DISPLAY_NAME]="";a[b.PREVIEW]="";a[b.ID]=null;a[b.EL]=null;a[b.LIST_VISIBLE]=!0;return a}();fyre.conv.view.NotificationComponent=function(a,b){this.model_=a;goog.ui.Component.call(this,b)};goog.inherits(fyre.conv.view.NotificationComponent,goog.ui.Component);fyre.conv.view.NotificationComponent.CLASSES={CLOSE:"fyre-notifier-close"};fyre.conv.view.NotificationComponent.EVENTS={ELEMENT_CLICKED:"elClicked",CLOSE_CLICKED:"closeClicked"};
fyre.conv.view.NotificationComponent.prototype.getSoyData=function(){var a=fyre.conv.model.Notification.ATTRIBUTES,b=this.model_;return{preview:b.get(a.PREVIEW),avatar:b.get(a.AVATAR),displayName:b.get(a.DISPLAY_NAME)}};fyre.conv.view.NotificationComponent.prototype.createDom=function(){this.element_=goog.soy.renderAsElement(fyre.templates.conv.misc.notifierUser,this.getSoyData())};
fyre.conv.view.NotificationComponent.prototype.enterDocument=function(){this.closeButtonEl_=this.getElementByClass(fyre.conv.view.NotificationComponent.CLASSES.CLOSE);var a=goog.events.EventType.CLICK;this.getHandler().listen(this.element_,a,this.handleElementClick);this.getHandler().listen(this.closeButtonEl_,a,this.handleCloseClick);(new goog.fx.dom.FadeInAndShow(this.element_,500)).play();fyre.conv.view.NotificationComponent.superClass_.enterDocument.call(this)};
fyre.conv.view.NotificationComponent.prototype.handleElementClick=function(a){a.preventDefault();a.stopPropagation();this.dispatchEvent({type:fyre.conv.view.NotificationComponent.EVENTS.ELEMENT_CLICKED,component:this})};fyre.conv.view.NotificationComponent.prototype.handleCloseClick=function(a){a.preventDefault();a.stopPropagation();this.dispatchEvent({type:fyre.conv.view.NotificationComponent.EVENTS.CLOSE_CLICKED,component:this})};
fyre.conv.view.NotificationComponent.prototype.disposeInternal=function(){(new goog.fx.dom.FadeOutAndHide(this.element_,500)).play();fyre.conv.view.NotificationComponent.superClass_.disposeInternal.call(this)};fyre.conv.view.NotificationViewHandler=function(a){fyre.v1.handler.HandlerBase.call(this,{},a);this.collection=this.parent.context.collectionService.collection()};goog.inherits(fyre.conv.view.NotificationViewHandler,fyre.v1.handler.HandlerBase);
fyre.conv.view.NotificationViewHandler.prototype.handleMessageAdded=function(a){var b=a.getModel(),c=b.get(b.ATTRIBUTES.AUTHOR),d=a.getElement(),e=this.collection.isLiveBlog(),f=this.collection.isLiveChat(),g=b.get(b.ATTRIBUTES.PARENT_ID);if(!(e&&g||f))if(!(this.parent.initTime>b.get(b.ATTRIBUTES.EVENT))&&(!fyre.conv.user||!(c&&fyre.conv.user.id===c.id))){b=this.parent.getSiblingYOffset(d);c=fyre.v1.dom.pageYOffset(window);e=goog.dom.getViewportSize(window).height+c;if("none"!==d.style.display){if(e>
b)return}else if(c<b&&e>b)return;this.parent.add(a)}};fyre.v1.util.handler([fyre.conv.events.MESSAGE_ADDED_TO_DOM],fyre.conv.view.NotificationViewHandler.prototype.handleMessageAdded);fyre.conv.view.NotificationViewHandler.prototype.handleMessageDisplayed=function(a){this.parent.remove(a)};fyre.v1.util.handler([fyre.conv.events.MESSAGE_DISPLAYED],fyre.conv.view.NotificationViewHandler.prototype.handleMessageDisplayed);
fyre.conv.view.NotificationViewHandler.prototype.handleMessageEdited=function(a){(a=fyre.conv.model.Comment.fromState(a,this.collection))&&a.get(a.ATTRIBUTES.REPLACES)&&this.parent.updateNotification(a)};fyre.v1.util.handler([fyre.conv.events.STREAM_MESSAGE_RECEIVED],fyre.conv.view.NotificationViewHandler.prototype.handleMessageEdited);fyre.conv.view.NotificationViewHandler.prototype.handleMessageRemoved=function(a){this.parent.remove(a.getModel().id)};
fyre.v1.util.handler([fyre.conv.events.MESSAGE_REMOVED_FROM_DOM,fyre.conv.events.COMMENT_HIDDEN],fyre.conv.view.NotificationViewHandler.prototype.handleMessageRemoved);fyre.conv.view.NotificationViewHandler.prototype.disposeInternal=function(){delete this.collection;fyre.conv.view.NotificationViewHandler.superClass_.disposeInternal.call(this)};fyre.v1.util.scrollTo=function(a){if(!fyre.v1.util.scrollTo.isScrolling_){var b=window,c=fyre.v1.dom.pageYOffset(b),d=new fyre.v1.util.scrollToAnimate(b,[0,c],[0,a],1500,goog.fx.easing.easeOut);goog.events.listen(d,goog.fx.Transition.EventType.BEGIN,function(){fyre.v1.util.scrollTo.isScrolling_=!0});goog.events.listen(d,goog.fx.Transition.EventType.END,function(){fyre.v1.util.scrollTo.isScrolling_=!1;goog.events.removeAll(d);d.dispose()});d.play()}};fyre.v1.util.scrollTo.isScrolling_=!1;
fyre.v1.util.scrollToAnimate=function(a,b,c,d,e){goog.fx.dom.PredefinedEffect.call(this,a,b,c,d,e)};goog.inherits(fyre.v1.util.scrollToAnimate,goog.fx.dom.PredefinedEffect);fyre.v1.util.scrollToAnimate.prototype.updateStyle=function(){this.element.scrollTo(Math.round(this.coords[0]),Math.round(this.coords[1]))};fyre.conv.view.NotificationView=function(a,b,c){this.isLiveBlog_=b;this.context=a;this.handler=new fyre.conv.view.NotificationViewHandler(this);this.resetStartTime();this.components={archive:{},visList:{}};this.unrenderedComponents=[];this.isOpen=!1;goog.ui.Component.call(this,c)};goog.inherits(fyre.conv.view.NotificationView,goog.ui.Component);fyre.conv.view.NotificationView.MAX_SHOWN=5;fyre.conv.view.NotificationView.RENDER_DELAY=2500;fyre.conv.view.NotificationView.DIR={UP:"fyre-notifier-up",DOWN:"fyre-notifier-down"};
fyre.conv.view.NotificationView.CLASSES={VISIBLE:"fyre-notifier-list",ARCHIVE:"fyre-notifier-archive",COUNTER:"fyre-notifier-counter",WRAPPER:"fyre-notifier",OPEN:"fyre-notifier-base",CLOSE:"fyre-notifier-base-close",HIDE:"fyre-hidden"};fyre.conv.view.NotificationView.prototype.resetStartTime=function(){this.initTime=1E3*(new Date).getTime()};
fyre.conv.view.NotificationView.prototype.enterDocument=function(){if(this.element_){var a=fyre.conv.view.NotificationView.CLASSES;goog.style.showElement(this.element_,!1);goog.dom.classes.remove(this.element_,a.HIDE);var b=goog.bind(function(){this.domRenderDelay_=null;fyre.conv.view.NotificationView.superClass_.enterDocument.call(this)},this);this.domRenderDelay_=setTimeout(b,fyre.conv.view.NotificationView.RENDER_DELAY);this.visListEl_=this.getElementByClass(a.VISIBLE);this.archiveEl_=this.getElementByClass(a.ARCHIVE);
this.totalEl_=this.getElementByClass(a.COUNTER);this.wrapperEl_=this.getElementByClass(a.WRAPPER);b=goog.events.EventType.CLICK;this.getHandler().listen(this.getElementByClass(a.OPEN),b,this.handleOpen);this.getHandler().listen(this.getElementByClass(a.CLOSE),b,this.handleClose);this.handleBacklog_()}};
fyre.conv.view.NotificationView.prototype.getSoyData=function(){var a={},b=fyre.conv.i18n.textEnumeration,b=this.isLiveBlog_?b.get(b.KEYS.LIVEBLOG_POSTS):b.get(b.KEYS.COMMENTS);a.strings={commentsLabel:fyre.v1.util.toTitleCase(b)};return a};fyre.conv.view.NotificationView.prototype.createDom=function(){this.element_=goog.soy.renderAsElement(fyre.templates.conv.misc.notifier,this.getSoyData())};
fyre.conv.view.NotificationView.prototype.handleBacklog_=function(){for(var a=0,b=this.unrenderedComponents.length;a<b;a++)this.add(this.unrenderedComponents[a])};fyre.conv.view.NotificationView.prototype.handleOpen=function(a){a.preventDefault();this.transferComponents();this.isOpen?(this.isOpen=!1,a=0):(this.isOpen=!0,a=48*goog.object.getKeys(this.components.archive).length);this.slideDom_(this.wrapperEl_,a)};
fyre.conv.view.NotificationView.prototype.slideDom_=function(a,b){var c=goog.style.getSize(a).height;(new fyre.v1.dom(a)).slideY(247,function(){},c,b)};fyre.conv.view.NotificationView.prototype.handleClose=function(a){a.preventDefault();goog.style.showElement(this.element_,!1);this.dispose()};
fyre.conv.view.NotificationView.prototype.handleElementClick=function(a){var a=a.component.getModel(),b=a.get(fyre.conv.model.Notification.ATTRIBUTES.EL),b=this.getSiblingYOffset(b)-goog.style.getSize(b).height;fyre.v1.util.scrollTo(b);this.remove(a.id);this.refreshCount()};fyre.conv.view.NotificationView.prototype.handleCloseSingleNotification=function(a){this.remove(a.component.getModel().id);this.refreshCount()};
fyre.conv.view.NotificationView.prototype.add=function(a){if(this.isInDocument()){var b=a.getModel(),c=fyre.conv.model.Comment.ATTRIBUTES,d=b.get(c.AUTHOR);if(d){var c=b.get(c.BODY_HTML),e=fyre.conv.model.Author.ATTRIBUTES,a=new fyre.conv.model.Notification({id:b.id,avatar:d.get(e.AVATAR),displayName:d.get(e.DISPLAY_NAME),preview:c?c.replace(/(<([^>]+)>)/ig,""):"",el:a.getElement()});this.isOpen?this.addArchive(a):this.addList(a);this.refreshCount();this.element_&&goog.style.showElement(this.element_,
!0)}}else this.unrenderedComponents.push(a)};fyre.conv.view.NotificationView.prototype.addList=function(a){this._add(a,this.components.visList,this.visListEl_);var a=a.id,b=this.components.visList[a];b&&(b.timer=this.setListTimer(a))};fyre.conv.view.NotificationView.prototype.addArchive=function(a){this._add(a,this.components.archive,this.archiveEl_)};
fyre.conv.view.NotificationView.prototype._add=function(a,b,c){if(a.get(fyre.conv.model.Notification.ATTRIBUTES.PREVIEW)){var d=new fyre.conv.view.NotificationComponent(a,this);b[a.id]=d;this.addChild(d);(a=goog.dom.getFirstElementChild(c))?d.renderBefore(a):d.render(c);c=fyre.conv.view.NotificationComponent.EVENTS;this.getHandler().listen(d,c.ELEMENT_CLICKED,this.handleElementClick);this.getHandler().listen(d,c.CLOSE_CLICKED,this.handleCloseSingleNotification);this.slideContainer(fyre.conv.view.NotificationView.DIR.UP)}};
fyre.conv.view.NotificationView.prototype.slideContainer=function(){var a;a=this.isOpen?goog.object.getKeys(this.components.archive).length:goog.object.getKeys(this.components.visList).length;fyre.conv.view.NotificationView.MAX_SHOWN>=a&&this.slideDom_(this.wrapperEl_,48*a)};
fyre.conv.view.NotificationView.prototype.remove=function(a){a in this.components.visList&&this.removeList(a);a in this.components.archive&&this.removeArchive(a);this.isInDocument()&&this.refreshCount();for(var b=0,c=this.unrenderedComponents.length;b<c;b++)if(a===this.unrenderedComponents[b].getModel().id){goog.array.removeAt(this.unrenderedComponents,b);break}};
fyre.conv.view.NotificationView.prototype.removeList=function(a){var b=this.components.visList[a];window.clearTimeout(b.timer);this.getHandler().unlisten(b,null);b.dispose();delete this.components.visList[a];this.slideContainer(fyre.conv.view.NotificationView.DIR.DOWN)};fyre.conv.view.NotificationView.prototype.removeArchive=function(a){var b=this.components.archive[a];this.getHandler().unlisten(b,null);b.dispose();delete this.components.archive[a];this.slideContainer(fyre.conv.view.NotificationView.DIR.DOWN)};
fyre.conv.view.NotificationView.prototype.removeAll=function(){fyre.v1.util.forEach(this.components.visList,function(a){this.removeList(a.getModel().id)},this);fyre.v1.util.forEach(this.components.archive,function(a){this.removeArchive(a.getModel().id)},this);this.refreshCount()};fyre.conv.view.NotificationView.prototype.transferComponents=function(){fyre.v1.util.forEach(this.components.visList,function(a){a=a.getModel();this.removeList(a.id);this.addArchive(a)},this);this.components.visList={}};
fyre.conv.view.NotificationView.prototype.refreshCount=function(){var a=goog.object.getKeys(this.components.archive).length+goog.object.getKeys(this.components.visList).length;this.totalEl_.innerHTML=a;0===a&&goog.style.showElement(this.element_,!1)};
fyre.conv.view.NotificationView.prototype.updateNotification=function(a){var b=a.ATTRIBUTES,c=fyre.conv.model.Notification.ATTRIBUTES,d=a.get(b.REPLACES),e=a.id,f=this.components.archive[d],g=this.components.visList[d];f&&(f=f.getModel(),f.set(c.ID,e),f.set(c.PREVIEW,a.get(b.BODY_HTML).replace(/(<([^>]+)>)/ig,"")),this.addArchive(f),this.removeArchive(d));g&&(g=g.getModel(),g.set(c.ID,e),g.set(c.PREVIEW,a.get(b.BODY_HTML).replace(/(<([^>]+)>)/ig,"")),this.addList(g),this.removeList(d))};
fyre.conv.view.NotificationView.prototype.setListTimer=function(a){return window.setTimeout(goog.bind(function(){this.addArchive(this.components.visList[a].getModel());this.removeList(a)},this),1E4)};fyre.conv.view.NotificationView.prototype.getSiblingYOffset=function(a){a=fyre.v1.dom(a).getSiblingOrParent();return goog.style.getPageOffset(a.element).y};
fyre.conv.view.NotificationView.prototype.disposeInternal=function(){var a=function(a){clearTimeout(a.timer);a.dispose()};this.domRenderDelay_&&(clearTimeout(this.domRenderDelay_),this.domRenderDelay_=null);goog.object.forEach(this.components.visList,a);goog.object.forEach(this.components.archive,a);goog.array.forEach(this.unrenderedComponents,a);this.handler.dispose();this.unrenderedComponents=this.handler=this.components=null;fyre.conv.view.NotificationView.superClass_.disposeInternal.call(this)};fyre.conv.view.HighVelocityView=function(a){goog.ui.Component.call(this,a);this.queuedComments_=new goog.structs.Set;this.orderedTopLevelQueue_=[];this.topLevelToDescendants_={}};goog.inherits(fyre.conv.view.HighVelocityView,goog.ui.Component);fyre.conv.view.HighVelocityView.CLASSES={REFRESH:"fyre-velocity-refresh",NEXT:"fyre-velocity-next",COUNT:"fyre-velocity-count",TEXT:"fyre-velocity-text"};
fyre.conv.view.HighVelocityView.prototype.createDom=function(){this.element_=goog.soy.renderAsElement(fyre.templates.conv.misc.highVelocity,this.getSoyData())};fyre.conv.view.HighVelocityView.prototype.getSoyData=function(){var a={},b=fyre.conv.i18n.textEnumeration;a.count=this.count_;a.strings={newComments:this.getTextString(),refresh:b.get(b.KEYS.REFRESH)};return a};
fyre.conv.view.HighVelocityView.prototype.enterDocument=function(){var a=fyre.conv.view.HighVelocityView.CLASSES;this.refreshEl_=this.getElementByClass(a.REFRESH);this.nextEl_=this.getElementByClass(a.NEXT);this.countEl_=this.getElementByClass(a.COUNT);this.textEl_=this.getElementByClass(a.TEXT);a=fyre.conv.stream.EVENTS;this.getHandler().listen(this.refreshEl_,goog.events.EventType.CLICK,goog.partial(this.handleClick_,a.STREAM_REFRESH_CLICKED));this.getHandler().listen(this.nextEl_,goog.events.EventType.CLICK,
goog.partial(this.handleClick_,a.SHOW_NEXT_CLICKED));fyre.conv.view.HighVelocityView.superClass_.enterDocument.call(this)};fyre.conv.view.HighVelocityView.prototype.exitDocument=function(){this.textEl_=this.countEl_=this.nextEl_=this.refreshEl_=null;fyre.conv.view.HighVelocityView.superClass_.exitDocument.call(this)};fyre.conv.view.HighVelocityView.prototype.show=function(){goog.style.showElement(this.element_,!0)};
fyre.conv.view.HighVelocityView.prototype.hide=function(){goog.style.showElement(this.element_,!1)};fyre.conv.view.HighVelocityView.prototype.handleClick_=function(a,b){b.preventDefault();this.dispatchEvent(a)};fyre.conv.view.HighVelocityView.prototype.getCount=function(){return this.queuedComments_.getCount()};fyre.conv.view.HighVelocityView.prototype.clear=function(){this.queuedComments_.clear();this.orderedTopLevelQueue_=[];this.handleCountChange_();this.topLevelToDescendants_={}};
fyre.conv.view.HighVelocityView.prototype.addId=function(a,b){this.queuedComments_.add(a);this.handleCountChange_();b?goog.object.containsKey(this.topLevelToDescendants_,b)?this.topLevelToDescendants_[b].push(a):this.topLevelToDescendants_[b]=[a]:this.orderedTopLevelQueue_.push(a)};
fyre.conv.view.HighVelocityView.prototype.removeId=function(a,b){this.queuedComments_.remove(a);if(b){var c=this.getDescendantIds(b);c&&(goog.array.remove(c,a),goog.array.isEmpty(c)&&delete this.topLevelToDescendants_[b])}goog.array.isEmpty(this.getDescendantIds(a)||[])||delete this.orderedTopLevelQueue_[a];this.handleCountChange_()};fyre.conv.view.HighVelocityView.prototype.hasId=function(a){return this.queuedComments_.contains(a)};fyre.conv.view.HighVelocityView.prototype.getDescendantIds=function(a){return this.topLevelToDescendants_[a]};
fyre.conv.view.HighVelocityView.prototype.getOrderedTopLevelIds=function(){return this.orderedTopLevelQueue_};fyre.conv.view.HighVelocityView.prototype.getTextString=function(){var a=fyre.conv.i18n.textEnumeration;return 1==this.getCount()?a.get(a.KEYS.NEW_COMMENT):a.get(a.KEYS.NEW_COMMENTS)};fyre.conv.view.HighVelocityView.prototype.handleCountChange_=function(){var a=this.getCount();this.countEl_.innerHTML=a;this.textEl_.innerHTML=this.getTextString();0===a?this.hide():this.show()};fyre.conv.view.ShowMoreComponent=function(a){goog.ui.Component.call(this,a);this.isLoading_=!1};goog.inherits(fyre.conv.view.ShowMoreComponent,goog.ui.Component);fyre.conv.view.ShowMoreComponent.CLASSES={CONTAINER:"fyre-stream-more-container",LOADING:"fyre-stream-more-loading"};fyre.conv.view.ShowMoreComponent.prototype.decorateInternal=function(a){fyre.conv.view.ShowMoreComponent.superClass_.decorateInternal.call(this,a);this.container_=this.getElementByClass(fyre.conv.view.ShowMoreComponent.CLASSES.CONTAINER)};
fyre.conv.view.ShowMoreComponent.prototype.enterDocument=function(){fyre.conv.view.ShowMoreComponent.superClass_.enterDocument.call(this);this.getHandler().listen(this.element_,goog.events.EventType.CLICK,this.handleClick)};fyre.conv.view.ShowMoreComponent.prototype.handleClick=function(){this.isLoading_||(this.setLoading(),this.dispatchEvent(fyre.conv.stream.EVENTS.SHOW_MORE))};fyre.conv.view.ShowMoreComponent.prototype.hide=function(){goog.style.showElement(this.element_,!1)};
fyre.conv.view.ShowMoreComponent.prototype.setLoading=function(){this.setWidth();goog.dom.classes.add(this.container_,fyre.conv.view.ShowMoreComponent.CLASSES.LOADING);this.isLoading_=!0};fyre.conv.view.ShowMoreComponent.prototype.setRequestComplete=function(){this.container_&&(goog.style.setStyle(this.container_,"width",null),goog.dom.classes.remove(this.container_,fyre.conv.view.ShowMoreComponent.CLASSES.LOADING),this.isLoading_=!1)};
fyre.conv.view.ShowMoreComponent.prototype.setWidth=function(){var a=goog.style.getSize(this.container_).width;goog.style.setWidth(this.container_,a)};fyre.conv.view.ShowMoreComponent.prototype.show=function(){goog.style.showElement(this.element_,!0)};fyre.conv.comment={};fyre.conv.comment.EVENTS={FLAG_MOBILE_CLICK:"mobile_flag_butn",OPEN_REPLY_EDITOR:"open_reply_editor",REPLIES_TOGGLE:"replies_toggle",VELOCITY_REPLIES_QUEUE_CLICK:"velocity_replies_clicked"};fyre.conv.view.DividerCounter=function(a,b){this.count_=a||0;this.highVelocityMode_=!1;goog.ui.Component.call(this,b)};goog.inherits(fyre.conv.view.DividerCounter,goog.ui.Component);fyre.conv.view.DividerCounter.CLASSES={REPLY_TEXT:"fyre-comment-reply-text",REPLY_COUNT:"fyre-comment-reply-count"};fyre.conv.view.DividerCounter.EVENTS={CLICKED:"dividerCounterClicked"};
fyre.conv.view.DividerCounter.prototype.createDom=function(){this.element_=goog.soy.renderAsElement(fyre.templates.conv.comment.dividerCounter,this.getSoyData())};fyre.conv.view.DividerCounter.prototype.enterDocument=function(){var a=fyre.conv.view.DividerCounter.CLASSES;this.replyCountEl_=this.getElementByClass(a.REPLY_COUNT);this.replyTextEl_=this.getElementByClass(a.REPLY_TEXT);this.getHandler().listen(this.element_,goog.events.EventType.CLICK,this.handleClick);this.setCount(this.count_);fyre.conv.view.DividerCounter.superClass_.enterDocument.call(this)};
fyre.conv.view.DividerCounter.prototype.handleClick=function(a){a.preventDefault();this.dispatchEvent(fyre.conv.view.DividerCounter.EVENTS.CLICKED)};fyre.conv.view.DividerCounter.prototype.getReplyString=goog.abstractFunction;fyre.conv.view.DividerCounter.prototype.getSoyData=function(){return{highVelocityMode:this.highVelocityMode_}};fyre.conv.view.DividerCounter.prototype.setCount=function(a){a&&(this.count_=a);this.replyTextEl_.innerHTML=this.getReplyString();this.replyCountEl_.innerHTML=a};
fyre.conv.view.DividerReplyCounter=function(a){fyre.conv.view.DividerCounter.call(this,a)};goog.inherits(fyre.conv.view.DividerReplyCounter,fyre.conv.view.DividerCounter);fyre.conv.view.DividerReplyCounter.prototype.getReplyString=function(){var a=fyre.conv.i18n.textEnumeration;return 1==this.count_?a.get(a.KEYS.REPLIES_SINGULAR):a.get(a.KEYS.REPLIES_PLURAL)};fyre.conv.view.DividerVelocityCounter=function(a){fyre.conv.view.DividerCounter.call(this,a);this.highVelocityMode_=!0};
goog.inherits(fyre.conv.view.DividerVelocityCounter,fyre.conv.view.DividerCounter);fyre.conv.view.DividerVelocityCounter.prototype.getReplyString=function(){var a=fyre.conv.i18n.textEnumeration;return 1==this.count_?a.get(a.KEYS.NEW_REPLY):a.get(a.KEYS.NEW_REPLIES)};fyre.conv.view.DividerComponent=function(a,b,c,d){goog.ui.Component.call(this,d);this.replyCount=a;this.streamedReplyCount=0;this.state=fyre.conv.view.DividerComponent.STATES.EXPANDED;this.highVelocityMode_=!0===b;this.isTopLevel_=!0===c;this.dividerHandler_=this.dividerCounter_=this.collapseEl_=null};goog.inherits(fyre.conv.view.DividerComponent,goog.ui.Component);
fyre.conv.view.DividerComponent.CLASSES={ACTIVE:"fyre-divider-active",COLLAPSE:"fyre-comment-collapse",EXPAND:"fyre-comment-expand",DIVIDER:"fyre-comment-divider",FORCE:"fyre-comment-divider-force"};fyre.conv.view.DividerComponent.STATES={COLLAPSED:"collapsed",EXPANDED:"expanded"};
fyre.conv.view.DividerComponent.prototype.enterDocument=function(){var a=fyre.conv.view.DividerComponent.CLASSES;this.collapseEl_=this.getElementByClass(a.COLLAPSE);this.dividerEl_=this.getElementByClass(a.DIVIDER);this.getHandler().listen(this.collapseEl_,goog.events.EventType.CLICK,this.handleDividerClick_);this.showToggle_()&&(goog.dom.classes.add(this.element_,a.ACTIVE),goog.style.showElement(this.collapseEl_,!0));fyre.conv.view.DividerComponent.superClass_.enterDocument.call(this)};
fyre.conv.view.DividerComponent.prototype.exitDocument=function(){this.dividerEl_=this.collapseEl_=null;fyre.conv.view.DividerComponent.superClass_.exitDocument.call(this)};fyre.conv.view.DividerComponent.prototype.showToggle_=function(){return!this.isTopLevel_?!1:!this.highVelocityMode_?0<this.replyCount:0<this.replyCount||0<this.streamedReplyCount};fyre.conv.view.DividerComponent.prototype.handleDividerClick_=function(a){a.preventDefault();this.toggleDivider()};
fyre.conv.view.DividerComponent.prototype.openDivider=function(){this.toggleDivider(fyre.conv.view.DividerComponent.STATES.EXPANDED)};
fyre.conv.view.DividerComponent.prototype.setStreamCount=function(a){this.streamedReplyCount=Math.max(0,a-this.replyCount);this.removeCounter();0===this.streamedReplyCount?this.state===fyre.conv.view.DividerComponent.STATES.COLLAPSED&&this.addCounter():(this.addCounter(!0),a=fyre.conv.view.DividerComponent.CLASSES,goog.dom.classes.add(this.element_,a.ACTIVE),goog.dom.classes.add(this.element_,a.FORCE))};
fyre.conv.view.DividerComponent.prototype.setReplyCount=function(a){this.replyCount=a;this.element_&&(0===this.replyCount?(this.removeCounter(),goog.dom.classes.remove(this.element_,fyre.conv.view.DividerComponent.CLASSES.ACTIVE),goog.style.showElement(this.collapseEl_,!1)):(this.showToggle_()&&(goog.style.showElement(this.collapseEl_,!0),goog.dom.classes.add(this.element_,fyre.conv.view.DividerComponent.CLASSES.ACTIVE)),this.dividerCounter_&&this.dividerCounter_.setCount(this.replyCount)))};
fyre.conv.view.DividerComponent.prototype.toggleDivider=function(a){var b=fyre.conv.view.DividerComponent.STATES;this.state=a=goog.isString(a)?a:this.state===b.EXPANDED?b.COLLAPSED:b.EXPANDED;this.dispatchEvent({type:fyre.conv.comment.EVENTS.REPLIES_TOGGLE,show:a===b.EXPANDED});this.state===b.COLLAPSED?this.handleChangeToCollapse_():this.handleChangeToOpen_()};
fyre.conv.view.DividerComponent.prototype.toggleDividerVelocity=function(){var a=fyre.conv.view.DividerComponent.STATES;this.dispatchEvent(fyre.conv.comment.EVENTS.VELOCITY_REPLIES_QUEUE_CLICK);this.replyCount+=this.streamedReplyCount;this.streamedReplyCount=0;this.showToggle_()&&goog.style.showElement(this.collapseEl_,0<this.replyCount);this.state=a.EXPANDED;this.handleChangeToOpen_()};
fyre.conv.view.DividerComponent.prototype.handleChangeToCollapse_=function(){var a=fyre.conv.view.DividerComponent.CLASSES;goog.dom.classes.remove(this.element_,a.COLLAPSE);goog.dom.classes.add(this.element_,a.EXPAND);this.highVelocityMode_&&0<this.streamedReplyCount||this.addCounter()};
fyre.conv.view.DividerComponent.prototype.handleChangeToOpen_=function(){var a=fyre.conv.view.DividerComponent.CLASSES;goog.dom.classes.remove(this.element_,a.EXPAND,a.ACTIVE);this.showToggle_()&&goog.dom.classes.add(this.element_,a.COLLAPSE);this.replyCount+=this.streamedReplyCount;this.streamedReplyCount=0;this.removeCounter()};fyre.conv.view.DividerComponent.prototype.handleCounterClicked_=function(a){a.call(this);this.removeCounter()};
fyre.conv.view.DividerComponent.prototype.addCounter=function(a){a?(this.dividerCounter_=new fyre.conv.view.DividerVelocityCounter(this.streamedReplyCount),a=this.toggleDividerVelocity):(this.dividerCounter_=new fyre.conv.view.DividerReplyCounter(this.replyCount),a=this.toggleDivider);this.addChild(this.dividerCounter_);this.dividerCounter_.renderBefore(this.dividerEl_);this.dividerHandler_=new goog.events.EventHandler(this);this.dividerHandler_.listen(this.dividerCounter_,fyre.conv.view.DividerCounter.EVENTS.CLICKED,
goog.partial(this.handleCounterClicked_,a))};fyre.conv.view.DividerComponent.prototype.removeCounter=function(){this.dividerCounter_&&this.element_&&(goog.dom.classes.remove(this.element_,fyre.conv.view.DividerComponent.CLASSES.FORCE),this.dividerHandler_.dispose(),this.dividerHandler_=null,this.removeChild(this.dividerCounter_),this.dividerCounter_.dispose(),this.dividerCounter_=null)};fyre.conv.comment.ui={};fyre.conv.comment.ui.ReplyButton=function(a){goog.ui.Component.call(this);this.EVENTS=fyre.conv.comment.ui.ReplyButton.EVENTS;this.model_=a;this.strings_=this.getStrings()};goog.inherits(fyre.conv.comment.ui.ReplyButton,goog.ui.Component);fyre.conv.comment.ui.ReplyButton.EVENTS={REPLY_CLICKED:"replyClicked"};fyre.conv.comment.ui.ReplyButton.prototype.getSoyData=function(){return{descendentCount:this.model_.get(fyre.conv.model.Comment.ATTRIBUTES.DESCENDENT_COUNT),strings:this.strings_}};
fyre.conv.comment.ui.ReplyButton.prototype.createDom=function(){var a=this.getSoyData();this.element_=goog.soy.renderAsElement(fyre.templates.conv.comment.replyButton,a)};
fyre.conv.comment.ui.ReplyButton.prototype.enterDocument=function(){fyre.conv.comment.ui.ReplyButton.superClass_.enterDocument.call(this);this.getHandler().listen(this.element_,goog.events.EventType.CLICK,this.handleClick);if(this.model_.isLiveblogPost())this.model_.onChange(fyre.conv.model.Comment.ATTRIBUTES.DESCENDENT_COUNT,this.updateReplies_,this)};
fyre.conv.comment.ui.ReplyButton.prototype.exitDocument=function(){fyre.conv.comment.ui.ReplyButton.superClass_.exitDocument.call(this);this.model_.off(null,null,this)};fyre.conv.comment.ui.ReplyButton.prototype.disposeInternal=function(){fyre.conv.comment.ui.ReplyButton.superClass_.disposeInternal.call(this);this.model_=null};fyre.conv.comment.ui.ReplyButton.prototype.handleClick=function(a){a.preventDefault();this.dispatchEvent({type:this.EVENTS.REPLY_CLICKED})};
fyre.conv.comment.ui.ReplyButton.prototype.updateReplies_=function(a){goog.asserts.assert(a==this.model_);a.get(fyre.conv.model.Comment.ATTRIBUTES.EXPANDING)||(a=this.getSoyData(),a=fyre.templates.conv.comment.replyButtonContents(a),this.getElement().innerHTML=a)};fyre.conv.comment.ui.ReplyButton.prototype.getStrings=function(){var a=fyre.conv.i18n.textEnumeration;return{reply:a.get(a.KEYS.REPLY),repliesSingular:a.get(a.KEYS.REPLIES_SINGULAR),repliesPlural:a.get(a.KEYS.REPLIES_PLURAL)}};fyre.v1.util.TimeZone=function(){};fyre.v1.util.TimeZone.MILLISECONDS_PER_HOUR_=36E5;fyre.v1.util.TimeZone.NameType={STD_SHORT_NAME:0,STD_LONG_NAME:1,DLT_SHORT_NAME:2,DLT_LONG_NAME:3};fyre.v1.util.TimeZone.createTimeZone=function(a){if("number"==typeof a)return fyre.v1.util.TimeZone.createSimpleTimeZone_(a);var b=new fyre.v1.util.TimeZone;b.timeZoneId_=a.id;b.standardOffset_=-a.std_offset;b.tzNames_=a.names;b.transitions_=a.transitions;return b};
fyre.v1.util.TimeZone.createSimpleTimeZone_=function(a){var b=new fyre.v1.util.TimeZone;b.standardOffset_=a;b.timeZoneId_=fyre.v1.util.TimeZone.composePosixTimeZoneID_(a);a=fyre.v1.util.TimeZone.composeUTCString_(a);b.tzNames_=[a,a];b.transitions_=[];return b};fyre.v1.util.TimeZone.composeGMTString_=function(a){var b=["GMT"];b.push(0>=a?"+":"-");a=Math.abs(a);b.push(goog.string.padNumber(Math.floor(a/60)%100,2),":",goog.string.padNumber(a%60,2));return b.join("")};
fyre.v1.util.TimeZone.composePosixTimeZoneID_=function(a){if(0==a)return"Etc/GMT";var b=["Etc/GMT",0>a?"-":"+"],a=Math.abs(a);b.push(Math.floor(a/60)%100);a%=60;0!=a&&b.push(":",goog.string.padNumber(a,2));return b.join("")};fyre.v1.util.TimeZone.composeUTCString_=function(a){if(0==a)return"UTC";var b=["UTC",0>a?"+":"-"],a=Math.abs(a);b.push(Math.floor(a/60)%100);a%=60;0!=a&&b.push(":",a);return b.join("")};
fyre.v1.util.TimeZone.prototype.getTimeZoneData=function(){return{id:this.timeZoneId_,std_offset:-this.standardOffset_,names:goog.array.clone(this.tzNames_),transitions:goog.array.clone(this.transitions_)}};
fyre.v1.util.TimeZone.prototype.getDaylightAdjustment=function(a){for(var a=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes())/fyre.v1.util.TimeZone.MILLISECONDS_PER_HOUR_,b=0;b<this.transitions_.length&&a>=this.transitions_[b];)b+=2;return 0==b?0:this.transitions_[b-1]};fyre.v1.util.TimeZone.prototype.getGMTString=function(a){return fyre.v1.util.TimeZone.composeGMTString_(this.getOffset(a))};
fyre.v1.util.TimeZone.prototype.getLongName=function(a){return this.tzNames_[this.isDaylightTime(a)?fyre.v1.util.TimeZone.NameType.DLT_LONG_NAME:fyre.v1.util.TimeZone.NameType.STD_LONG_NAME]};fyre.v1.util.TimeZone.prototype.getOffset=function(a){return this.standardOffset_-this.getDaylightAdjustment(a)};
fyre.v1.util.TimeZone.prototype.getRFCTimeZoneString=function(a){var a=-this.getOffset(a),b=[0>a?"-":"+"],a=Math.abs(a);b.push(goog.string.padNumber(Math.floor(a/60)%100,2),goog.string.padNumber(a%60,2));return b.join("")};fyre.v1.util.TimeZone.prototype.getShortName=function(a){return this.tzNames_[this.isDaylightTime(a)?fyre.v1.util.TimeZone.NameType.DLT_SHORT_NAME:fyre.v1.util.TimeZone.NameType.STD_SHORT_NAME]};fyre.v1.util.TimeZone.prototype.getTimeZoneId=function(){return this.timeZoneId_};
fyre.v1.util.TimeZone.prototype.isDaylightTime=function(a){return 0<this.getDaylightAdjustment(a)};goog.i18n.DateTimeSymbols=goog.i18n.DateTimeSymbols_en_ISO={ERAS:["BC","AD"],ERANAMES:["Before Christ","Anno Domini"],NARROWMONTHS:"J,F,M,A,M,J,J,A,S,O,N,D".split(","),STANDALONENARROWMONTHS:"J,F,M,A,M,J,J,A,S,O,N,D".split(","),MONTHS:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),STANDALONEMONTHS:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),SHORTMONTHS:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),
STANDALONESHORTMONTHS:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),WEEKDAYS:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),STANDALONEWEEKDAYS:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),SHORTWEEKDAYS:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),STANDALONESHORTWEEKDAYS:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),NARROWWEEKDAYS:"S,M,T,W,T,F,S".split(","),STANDALONENARROWWEEKDAYS:"S,M,T,W,T,F,S".split(","),SHORTQUARTERS:["Q1","Q2","Q3","Q4"],
QUARTERS:["1st quarter","2nd quarter","3rd quarter","4th quarter"],AMPMS:["AM","PM"],DATEFORMATS:["EEEE, y MMMM dd","y MMMM d","y MMM d","yyyy-MM-dd"],TIMEFORMATS:["HH:mm:ss v","HH:mm:ss z","HH:mm:ss","HH:mm"],AVAILABLEFORMATS:{Md:"M/d",MMMMd:"MMMM d",MMMd:"MMM d"},FIRSTDAYOFWEEK:0,WEEKENDRANGE:[5,6],FIRSTWEEKCUTOFFDAY:3};fyre.v1.util.DateTimeFormat=function(a){goog.asserts.assert(goog.isDef(a),"Pattern must be defined");this.patternParts_=[];"number"==typeof a?this.applyStandardPattern_(a):this.applyPattern_(a)};
fyre.v1.util.DateTimeFormat.Format={FULL_DATE:0,LONG_DATE:1,MEDIUM_DATE:2,SHORT_DATE:3,FULL_TIME:4,LONG_TIME:5,MEDIUM_TIME:6,SHORT_TIME:7,FULL_DATETIME:8,LONG_DATETIME:9,MEDIUM_DATETIME:10,SHORT_DATETIME:11};fyre.v1.util.DateTimeFormat.TOKENS_=[/^\'(?:[^\']|\'\')*\'/,/^(?:G+|y+|M+|k+|S+|E+|a+|h+|K+|H+|c+|L+|Q+|d+|m+|s+|v+|z+|Z+)/,/^[^\'GyMkSEahKHcLQdmsvzZ]+/];fyre.v1.util.DateTimeFormat.PartTypes_={QUOTED_STRING:0,FIELD:1,LITERAL:2};
fyre.v1.util.DateTimeFormat.prototype.applyPattern_=function(a){for(;a;)for(var b=0;b<fyre.v1.util.DateTimeFormat.TOKENS_.length;++b){var c=a.match(fyre.v1.util.DateTimeFormat.TOKENS_[b]);if(c){c=c[0];a=a.substring(c.length);b==fyre.v1.util.DateTimeFormat.PartTypes_.QUOTED_STRING&&("''"==c?c="'":(c=c.substring(1,c.length-1),c=c.replace(/\'\'/,"'")));this.patternParts_.push({text:c,type:b});break}}};
fyre.v1.util.DateTimeFormat.prototype.format=function(a,b){var c=b?6E4*(a.getTimezoneOffset()-b.getOffset(a)):0,d=c?new Date(a.getTime()+c):a,e=d;b&&d.getTimezoneOffset()!=a.getTimezoneOffset()&&(e=new Date(a.getTime()+(c+(0<c?-864E5:864E5))));for(var c=[],f=0;f<this.patternParts_.length;++f){var g=this.patternParts_[f].text;fyre.v1.util.DateTimeFormat.PartTypes_.FIELD==this.patternParts_[f].type?c.push(this.formatField_(g,a,d,e,b)):c.push(g)}return c.join("")};
fyre.v1.util.DateTimeFormat.prototype.applyStandardPattern_=function(a){if(4>a)a=goog.i18n.DateTimeSymbols.DATEFORMATS[a];else if(8>a)a=goog.i18n.DateTimeSymbols.TIMEFORMATS[a-4];else if(12>a)a=goog.i18n.DateTimeSymbols.DATEFORMATS[a-8]+" "+goog.i18n.DateTimeSymbols.TIMEFORMATS[a-8];else{this.applyStandardPattern_(fyre.v1.util.DateTimeFormat.Format.MEDIUM_DATETIME);return}this.applyPattern_(a)};
fyre.v1.util.DateTimeFormat.prototype.localizeNumbers_=function(a){if(void 0===goog.i18n.DateTimeSymbols.ZERODIGIT)return a;for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);b.push(48<=d&&57>=d?String.fromCharCode(goog.i18n.DateTimeSymbols.ZERODIGIT+d-48):a.charAt(c))}return b.join("")};fyre.v1.util.DateTimeFormat.prototype.formatEra_=function(a,b){var c=0<b.getFullYear()?1:0;return 4<=a?goog.i18n.DateTimeSymbols.ERANAMES[c]:goog.i18n.DateTimeSymbols.ERAS[c]};
fyre.v1.util.DateTimeFormat.prototype.formatYear_=function(a,b){var c=b.getFullYear();0>c&&(c=-c);return this.localizeNumbers_(2==a?goog.string.padNumber(c%100,2):""+c)};fyre.v1.util.DateTimeFormat.prototype.formatMonth_=function(a,b){var c=b.getMonth();switch(a){case 5:return goog.i18n.DateTimeSymbols.NARROWMONTHS[c];case 4:return goog.i18n.DateTimeSymbols.MONTHS[c];case 3:return goog.i18n.DateTimeSymbols.SHORTMONTHS[c];default:return this.localizeNumbers_(goog.string.padNumber(c+1,a))}};
fyre.v1.util.DateTimeFormat.prototype.format24Hours_=function(a,b){return this.localizeNumbers_(goog.string.padNumber(b.getHours()||24,a))};fyre.v1.util.DateTimeFormat.prototype.formatFractionalSeconds_=function(a,b){return this.localizeNumbers_((b.getTime()%1E3/1E3).toFixed(Math.min(3,a)).substr(2)+(3<a?goog.string.padNumber(0,a-3):""))};fyre.v1.util.DateTimeFormat.prototype.formatDayOfWeek_=function(a,b){var c=b.getDay();return 4<=a?goog.i18n.DateTimeSymbols.WEEKDAYS[c]:goog.i18n.DateTimeSymbols.SHORTWEEKDAYS[c]};
fyre.v1.util.DateTimeFormat.prototype.formatAmPm_=function(a,b){var c=b.getHours();return goog.i18n.DateTimeSymbols.AMPMS[12<=c&&24>c?1:0]};fyre.v1.util.DateTimeFormat.prototype.format1To12Hours_=function(a,b){return this.localizeNumbers_(goog.string.padNumber(b.getHours()%12||12,a))};fyre.v1.util.DateTimeFormat.prototype.format0To11Hours_=function(a,b){return this.localizeNumbers_(goog.string.padNumber(b.getHours()%12,a))};
fyre.v1.util.DateTimeFormat.prototype.format0To23Hours_=function(a,b){return this.localizeNumbers_(goog.string.padNumber(b.getHours(),a))};fyre.v1.util.DateTimeFormat.prototype.formatStandaloneDay_=function(a,b){var c=b.getDay();switch(a){case 5:return goog.i18n.DateTimeSymbols.STANDALONENARROWWEEKDAYS[c];case 4:return goog.i18n.DateTimeSymbols.STANDALONEWEEKDAYS[c];case 3:return goog.i18n.DateTimeSymbols.STANDALONESHORTWEEKDAYS[c];default:return this.localizeNumbers_(goog.string.padNumber(c,1))}};
fyre.v1.util.DateTimeFormat.prototype.formatStandaloneMonth_=function(a,b){var c=b.getMonth();switch(a){case 5:return goog.i18n.DateTimeSymbols.STANDALONENARROWMONTHS[c];case 4:return goog.i18n.DateTimeSymbols.STANDALONEMONTHS[c];case 3:return goog.i18n.DateTimeSymbols.STANDALONESHORTMONTHS[c];default:return this.localizeNumbers_(goog.string.padNumber(c+1,a))}};
fyre.v1.util.DateTimeFormat.prototype.formatQuarter_=function(a,b){var c=Math.floor(b.getMonth()/3);return 4>a?goog.i18n.DateTimeSymbols.SHORTQUARTERS[c]:goog.i18n.DateTimeSymbols.QUARTERS[c]};fyre.v1.util.DateTimeFormat.prototype.formatDate_=function(a,b){return this.localizeNumbers_(goog.string.padNumber(b.getDate(),a))};fyre.v1.util.DateTimeFormat.prototype.formatMinutes_=function(a,b){return this.localizeNumbers_(goog.string.padNumber(b.getMinutes(),a))};
fyre.v1.util.DateTimeFormat.prototype.formatSeconds_=function(a,b){return this.localizeNumbers_(goog.string.padNumber(b.getSeconds(),a))};fyre.v1.util.DateTimeFormat.prototype.formatTimeZoneRFC_=function(a,b,c){c=c||goog.i18n.TimeZone.createTimeZone(b.getTimezoneOffset());return 4>a?c.getRFCTimeZoneString(b):this.localizeNumbers_(c.getGMTString(b))};
fyre.v1.util.DateTimeFormat.prototype.formatTimeZone_=function(a,b,c){c=c||goog.i18n.TimeZone.createTimeZone(b.getTimezoneOffset());return 4>a?c.getShortName(b):c.getLongName(b)};fyre.v1.util.DateTimeFormat.prototype.formatTimeZoneId_=function(a,b){b=b||goog.i18n.TimeZone.createTimeZone(a.getTimezoneOffset());return b.getTimeZoneId()};
fyre.v1.util.DateTimeFormat.prototype.formatField_=function(a,b,c,d,e){var f=a.length;switch(a.charAt(0)){case "G":return this.formatEra_(f,c);case "y":return this.formatYear_(f,c);case "M":return this.formatMonth_(f,c);case "k":return this.format24Hours_(f,d);case "S":return this.formatFractionalSeconds_(f,d);case "E":return this.formatDayOfWeek_(f,c);case "a":return this.formatAmPm_(f,d);case "h":return this.format1To12Hours_(f,d);case "K":return this.format0To11Hours_(f,d);case "H":return this.format0To23Hours_(f,
d);case "c":return this.formatStandaloneDay_(f,c);case "L":return this.formatStandaloneMonth_(f,c);case "Q":return this.formatQuarter_(f,c);case "d":return this.formatDate_(f,c);case "m":return this.formatMinutes_(f,d);case "s":return this.formatSeconds_(f,d);case "v":return this.formatTimeZoneId_(b,e);case "z":return this.formatTimeZone_(f,b,e);case "Z":return this.formatTimeZoneRFC_(f,b,e);default:return""}};fyre.v1.util.date={};fyre.v1.util.date.DAY_MS=864E5;fyre.v1.util.date.MINUTE_MS=6E4;fyre.v1.util.date.Unit={MINUTES:0,HOURS:1,DAYS:2};fyre.v1.util.date.datetimeToString=function(a,b){b||(b="MMM d, yyyy");return(new fyre.v1.util.DateTimeFormat(b)).format(a)};
fyre.v1.util.date.prettyDate=function(a,b,c,d){var e=goog.now()-a,e=Math.floor(e/fyre.v1.util.date.MINUTE_MS),f=fyre.v1.util.date.formatPast(+a);if(""===f||e>=b)f=fyre.v1.util.date.datetimeToString(a,c);"0 minutes ago"===f&&(f="just now");d&&goog.object.some(d,function(a,b){if(-1===f.indexOf(b))return!1;f=f.replace(b,a);return!0});return f};
fyre.v1.util.date.twitterDate=function(a){var b=(new Date).getTimezoneOffset()/60,c=Math.floor(a.getTime()/1E3)+b,b=Math.floor(goog.now()/1E3)+b-c;if(0>b)return"1s";if(60>b)return b+"s";b=Math.floor(b/60);if(60>b)return b+"m";b=Math.floor(b/24);if(24>b)return b+"h";b=Math.floor(b/365);return 365>b?fyre.v1.util.date.datetimeToString(a,"dd MMM"):fyre.v1.util.date.datetimeToString(a,"dd MMM yyyy")};fyre.v1.util.date.formatPast=function(a){var b=goog.now();b<a&&(a=b);return fyre.v1.util.date.formatPast_(a)};
fyre.v1.util.date.formatPast_=function(a){var b=goog.now(),c=Math.floor((b-a)/fyre.v1.util.date.MINUTE_MS),d=!1;0>c&&(d=!0,c*=-1);if(60>c)return fyre.v1.util.date.getMessage_(c,d,fyre.v1.util.date.Unit.MINUTES);c=Math.floor(c/60);if(24>c)return fyre.v1.util.date.getMessage_(c,d,fyre.v1.util.date.Unit.HOURS);c=(new Date).getTimezoneOffset()*fyre.v1.util.date.MINUTE_MS;c=Math.floor((b+c)/fyre.v1.util.date.DAY_MS)-Math.floor((a+c)/fyre.v1.util.date.DAY_MS);d&&(c*=-1);return 14>c?fyre.v1.util.date.getMessage_(c,
d,fyre.v1.util.date.Unit.DAYS):""};
fyre.v1.util.date.getMessage_=function(a,b,c){if(!b&&c==fyre.v1.util.date.Unit.MINUTES)return b=goog.getMsg("{$num} minute ago",{num:a}),c=goog.getMsg("{$num} minutes ago",{num:a}),1==a?b:c;if(b&&c==fyre.v1.util.date.Unit.MINUTES)return b=goog.getMsg("in {$num} minute",{num:a}),c=goog.getMsg("in {$num} minutes",{num:a}),1==a?b:c;if(!b&&c==fyre.v1.util.date.Unit.HOURS)return b=goog.getMsg("{$num} hour ago",{num:a}),c=goog.getMsg("{$num} hours ago",{num:a}),1==a?b:c;if(b&&c==fyre.v1.util.date.Unit.HOURS)return b=
goog.getMsg("in {$num} hour",{num:a}),c=goog.getMsg("in {$num} hours",{num:a}),1==a?b:c;if(!b&&c==fyre.v1.util.date.Unit.DAYS)return b=goog.getMsg("{$num} day ago",{num:a}),c=goog.getMsg("{$num} days ago",{num:a}),1==a?b:c;return b&&c==fyre.v1.util.date.Unit.DAYS?(b=goog.getMsg("in {$num} day",{num:a}),c=goog.getMsg("in {$num} days",{num:a}),1==a?b:c):""};fyre.conv.view.ApprovalControls=function(a){this.headerEl_=a;goog.ui.Component.call(this)};goog.inherits(fyre.conv.view.ApprovalControls,goog.ui.Component);fyre.conv.view.ApprovalControls.CLASSES={ACTIONS_WRAPPER:"fyre-mod-actions",APPROVE:"fyre-mod-approve",DENY:"fyre-mod-deny",HIDE:"fyre-hide",MOD_APPROVE:"fyre-message-mod-approvable",PENDING_WRAPPER:"fyre-pending",USER_APPROVE:"fyre-message-user-approvable"};fyre.conv.view.ApprovalControls.EVENTS={APPROVE_CLICKED:"approveClicked",DENY_CLICKED:"denyClicked"};
fyre.conv.view.ApprovalControls.prototype.getSoyData=function(){var a=fyre.conv.i18n.textEnumeration,b={};b.strings={pending:a.get(a.KEYS.PENDING_COMMENT)};return b};fyre.conv.view.ApprovalControls.prototype.decorateInternal=function(a){a.innerHTML=fyre.templates.conv.comment.approvable(this.getSoyData());this.element_=a};
fyre.conv.view.ApprovalControls.prototype.handleModeratorChange=function(){if(this.isInDocument()){var a=fyre.conv.user.get(fyre.conv.user.ATTRIBUTES.MODERATOR),b=fyre.conv.view.ApprovalControls.CLASSES;goog.dom.classes.add(this.modActionsWrapperEl_,b.HIDE);goog.dom.classes.remove(this.headerEl_,b.MOD_APPROVE,b.USER_APPROVE);a?(goog.dom.classes.add(this.headerEl_,b.MOD_APPROVE),goog.dom.classes.remove(this.modActionsWrapperEl_,b.HIDE)):goog.dom.classes.add(this.headerEl_,b.USER_APPROVE);goog.dom.classes.remove(this.pendingWrapperEl_,
b.HIDE)}};
fyre.conv.view.ApprovalControls.prototype.enterDocument=function(){fyre.conv.view.ApprovalControls.superClass_.enterDocument.call(this);var a=fyre.conv.view.ApprovalControls.EVENTS,b=goog.events.EventType.CLICK,c=fyre.conv.view.ApprovalControls.CLASSES;this.modApproveEl_=this.getElementByClass(c.APPROVE);this.modDenyEl_=this.getElementByClass(c.DENY);this.modActionsWrapperEl_=this.getElementByClass(c.ACTIONS_WRAPPER);this.pendingWrapperEl_=this.getElementByClass(c.PENDING_WRAPPER);this.getHandler().listen(this.modApproveEl_,b,
goog.partial(this.handleClick_,a.APPROVE_CLICKED));this.getHandler().listen(this.modDenyEl_,b,goog.partial(this.handleClick_,a.DENY_CLICKED));a=fyre.conv.user;a.on(a.attributeChangeEvent(fyre.conv.user.ATTRIBUTES.MODERATOR),this.handleModeratorChange,this);this.handleModeratorChange()};fyre.conv.view.ApprovalControls.prototype.handleClick_=function(a,b){b.preventDefault();this.dispatchEvent(a)};
fyre.conv.view.ApprovalControls.prototype.exitDocument=function(){fyre.conv.user.off(null,null,this);var a=fyre.conv.view.ApprovalControls.CLASSES;goog.dom.classes.remove(this.headerEl_,a.MOD_APPROVE,a.USER_APPROVE);fyre.conv.view.ApprovalControls.superClass_.exitDocument.call(this)};fyre.conv.view.ApprovalControls.prototype.disposeInternal=function(){this.pendingWrapperEl_=this.modActionsWrapperEl_=this.modDenyEl_=this.modApproveEl_=this.template_=null;fyre.conv.view.ApprovalControls.superClass_.disposeInternal.call(this)};fyre.conv.view.CommentActions=function(a,b,c,d,e){this.deletable_=b;this.banable_=a;this.tweetId_=d;this.flaggable_=c;goog.ui.Component.call(this,e)};goog.inherits(fyre.conv.view.CommentActions,goog.ui.Component);fyre.conv.view.CommentActions.EVENTS={DELETE_CLICKED:"delete_clicked",BAN_CLICKED:"ban_clicked",SHARE_CLICKED:"share_clicked",FLAG_CLICKED:"flag_clicked",BOZO_CLICKED:"bozo_clicked"};
fyre.conv.view.CommentActions.CLASSES={DELETE_LINK:"fyre-delete-link",BAN_LINK:"fyre-ban-link",SHARE_LINK:"fyre-share-link",FLAG_LINK:"fyre-flag-link",BOZO_LINK:"fyre-bozo-link"};fyre.conv.view.CommentActions.EventMap=function(){var a={},b=fyre.conv.view.CommentActions.CLASSES,c=fyre.conv.view.CommentActions.EVENTS;a[b.BAN_LINK]=c.BAN_CLICKED;a[b.SHARE_LINK]=c.SHARE_CLICKED;a[b.FLAG_LINK]=c.FLAG_CLICKED;a[b.DELETE_LINK]=c.DELETE_CLICKED;a[b.BOZO_LINK]=c.BOZO_CLICKED;return a}();
fyre.conv.view.CommentActions.prototype.getSoyData=function(){return{baseUrl:"https://twitter.com/intent/",tweetId:this.tweetId_,deletable:this.deletable_,banable:this.banable_,flaggable:this.flaggable_,strings:this.getStrings_()}};fyre.conv.view.CommentActions.prototype.decorateInternal=function(a){var b=this.getSoyData();a.innerHTML=fyre.templates.conv.comment.actions(b);this.element_=a};
fyre.conv.view.CommentActions.prototype.getStrings_=function(){var a=fyre.conv.i18n.textEnumeration,b=a.KEYS;return{ban:a.get(b.BAN),banTooltip:a.get(b.BAN_USER_TOOLTIP),del:a.get(b.DELETE),deleteTooltip:a.get(b.DELETE_COMMENT_TOOLTIP),flag:a.get(b.FLAG),flagTooltip:a.get(b.FLAG_COMMENT_TOOLTIP),reply:a.get(b.REPLY),share:a.get(b.SHARE),shareTooltip:a.get(b.SHARE_COMMENT_TOOLTIP),bozo:a.get(b.BOZO),bozoTooltip:a.get(b.BOZO_COMMENT_TOOLTIP)}};
fyre.conv.view.CommentActions.prototype.enterDocument=function(){fyre.conv.view.CommentActions.superClass_.enterDocument.call(this);this.getHandler().listen(this.element_,goog.events.EventType.CLICK,this.handleClick_);this.tweetId_&&fyre.v1.util.ScriptLoader.loadScript("http://platform.twitter.com/widgets.js")};
fyre.conv.view.CommentActions.prototype.handleClick_=function(a){a.preventDefault();var b;a.target.tagName==goog.dom.TagName.A?b=goog.dom.classes.get(a.target):a.target.tagName==goog.dom.TagName.SPAN&&(b=goog.dom.classes.get(goog.dom.getParentElement(a.target)));goog.array.some(b,function(a){if(a=fyre.conv.view.CommentActions.EventMap[a])return this.dispatchEvent(a),!0},this)};fyre.conv.view.EditorContainer=function(){goog.ui.Component.call(this)};goog.inherits(fyre.conv.view.EditorContainer,goog.ui.Component);fyre.conv.view.EditorContainer.prototype.createDom=function(){this.element_=goog.soy.renderAsElement(fyre.templates.conv.comment.editorContainer)};fyre.conv.view.EditorContainer.prototype.hide=function(){goog.style.showElement(this.element_,!1)};fyre.conv.view.EditorContainer.prototype.show=function(){goog.style.showElement(this.element_,!0)};
fyre.conv.view.EditorContainer.prototype.isVisible=function(){return goog.style.isElementShown(this.element_)};fyre.conv.view.EditComponent=function(a,b,c){goog.ui.Component.call(this,c);this.EVENTS=fyre.conv.view.EditComponent.EVENTS;this.model_=a;this.interval=b;this.remainingTime_=0;this.timeout_=null};goog.inherits(fyre.conv.view.EditComponent,goog.ui.Component);fyre.conv.view.EditComponent.EVENTS={EDIT_CLICKED:"edit_clicked"};fyre.conv.view.EditComponent.CLASSES={EDIT:"fyre-comment-edit",INTERVAL:"fyre-comment-edit-interval"};
fyre.conv.view.EditComponent.EDIT_SOURCES=new goog.structs.Set([fyre.v1.enums.content.source.LIVEFYRE,fyre.v1.enums.content.source.IMPORT,fyre.v1.enums.content.source.FYREHOSE_LIVEFYRE,fyre.v1.enums.content.source.FYREHOSE_IMPORT]);fyre.conv.view.EditComponent.prototype.getSoyData=function(){var a=fyre.conv.user,b=fyre.conv.i18n.textEnumeration;return{moderator:a.get(a.ATTRIBUTES.MODERATOR),strings:{edit:b.get(b.KEYS.EDIT)}}};
fyre.conv.view.EditComponent.prototype.createDom=function(){var a=fyre.templates.conv.comment.edit,b=this.getSoyData();this.element_=goog.soy.renderAsElement(a,b);this.editIntervalContainerEl_=this.getElementByClass(fyre.conv.view.EditComponent.CLASSES.INTERVAL)};
fyre.conv.view.EditComponent.prototype.enterDocument=function(){fyre.conv.view.EditComponent.superClass_.enterDocument.call(this);var a=this.getTimeToEdit_(),b=fyre.conv.user;this.getHandler().listen(this.element_,goog.events.EventType.CLICK,this.handleClick_);b.get(b.ATTRIBUTES.MODERATOR)||(0>a?this.dispose():this.countDown_(Math.ceil(a/60)))};fyre.conv.view.EditComponent.prototype.handleClick_=function(a){a.preventDefault();this.dispatchEvent({type:this.EVENTS.EDIT_CLICKED})};
fyre.conv.view.EditComponent.isContentEditable=function(a){return!fyre.conv.user.isGuest()&&fyre.conv.view.EditComponent.EDIT_SOURCES.contains(a)};fyre.conv.view.EditComponent.prototype.getTimeToEdit_=function(){var a=this.model_.get(this.model_.ATTRIBUTES.CREATED),b=this.model_.get(this.model_.ATTRIBUTES.UPDATED)||0;return Math.floor(60*this.interval-((new Date).getTime()/1E3-(a>b?a:b)))};
fyre.conv.view.EditComponent.prototype.countDown_=function(a){this.editIntervalContainerEl_.innerHTML=a;this.timeout_=setTimeout(goog.bind(function(){a--;0<a?this.countDown_(a):this.dispose()},this),6E4)};fyre.conv.view.EditComponent.prototype.disposeInternal=function(){clearTimeout(this.timeout_);this.model_=null;fyre.conv.view.EditComponent.superClass_.disposeInternal.call(this)};fyre.conv.view.ExpandedMedia=function(a,b){this.model_=a;fyre.v1.ui.FyreComponent.call(this,b)};goog.inherits(fyre.conv.view.ExpandedMedia,fyre.v1.ui.FyreComponent);fyre.conv.view.ExpandedMedia.prototype.getSoyData=function(){var a=fyre.conv.model.MessageMedia.ATTRIBUTES;return{html:this.model_.get(a.HTML),type:this.model_.get(a.TYPE),url:this.model_.get(a.URL),thumbnailUrl:this.model_.get(a.THUMBNAIL_URL),title:this.model_.get(a.TITLE),expandable:this.model_.get(a.EXPANDABLE)}};
fyre.conv.view.ExpandedMedia.prototype.createDomInternal=function(){fyre.conv.view.ExpandedMedia.superClass_.createDomInternal.call(this);var a=this.getSoyData();this.$dom_.html(fyre.templates.conv.comment.mediaExpanded(a));switch(this.model_.get(this.model_.ATTRIBUTES.TYPE)){case this.model_.EMBEDLY_TYPES.VIDEO:this.setUpVideo_();break;case this.model_.EMBEDLY_TYPES.RICH:this.handleRichMedia_(a)}};
fyre.conv.view.ExpandedMedia.prototype.handleRichMedia_=function(a){var b=goog.style.getSize(fyre.v1.dom.getByClass("fyre-widget").element).width,c=this.getElementByClass("fyre-rich-media-content"),a=fyre.v1.util.htmlExtractNodes(a.html),d=goog.dom.htmlToDocumentFragment(a.html);goog.dom.appendChild(c,d);goog.array.forEach(a.script,function(a){a.src?(a=goog.dom.createDom(goog.dom.TagName.SCRIPT,{src:a.src}),c.appendChild(a)):goog.globalEval(a.innerHTML)},this);fyre.v1.util.browser.isMobile()&&this.model_.get(fyre.conv.model.MessageMedia.ATTRIBUTES.WIDTH)>
b&&(a=goog.dom.getChildren(c),a.length&&(a[0].width=b-10))};fyre.conv.view.ExpandedMedia.prototype.disposeInternal=function(){this.$dom_.empty();fyre.conv.view.ExpandedMedia.superClass_.disposeInternal.call(this)};
fyre.conv.view.ExpandedMedia.prototype.setUpVideo_=function(){fyre.v1.util.browser.isMobile()||(this.videoLink_=this.$dom_.getByClass("fyre-comment-media-link"),this.videoImg_=this.$dom_.getByClass("fyre-comment-media-img"),this.videoPlayButton_=this.$dom_.getByClass("fyre-comment-media-play"),this.getHandler().listen(this.videoLink_.element,goog.events.EventType.CLICK,this.handleVideoPlayClick))};fyre.conv.view.ExpandedMedia.prototype.handleVideoPlayClick=function(a){a.preventDefault();this.showVideo(!0)};
fyre.conv.view.ExpandedMedia.prototype.showVideo=function(a){this.$dom_.html(this.buildEmbed_(this.model_.get(this.model_.ATTRIBUTES.HTML),a))};fyre.conv.view.ExpandedMedia.prototype.buildEmbed_=function(a,b){var c=goog.dom.htmlToDocumentFragment(a),d=goog.Uri.parse(c.src),e=parseInt(c.width,10),f=parseInt(c.height,10)/e,g=goog.style.getSize(this.$dom_.element);d.setParameterValue("autoplay",b?1:0);c.src=d.toString();e>g.width&&(c.width=g.width,c.height=f*g.width);return goog.dom.getOuterHtml(c)};fyre.conv.view.FlagMobile=function(a){goog.ui.Component.call(this,a)};goog.inherits(fyre.conv.view.FlagMobile,goog.ui.Component);fyre.conv.view.FlagMobile.prototype.createDom=function(){this.decorateInternal(goog.soy.renderAsElement(fyre.templates.conv.comment.flagMobileButton))};fyre.conv.view.FlagMobile.prototype.enterDocument=function(){fyre.conv.view.FlagMobile.superClass_.enterDocument.call(this);var a=goog.events.EventType.CLICK;this.getHandler().listen(this.getElement(),a,this.handleClick_)};
fyre.conv.view.FlagMobile.prototype.handleClick_=function(a){a.preventDefault();this.dispatchEvent(fyre.conv.comment.EVENTS.FLAG_MOBILE_CLICK)};fyre.conv.view.FlagModal=function(a,b){this.model_=a;goog.ui.Component.call(this,b)};goog.inherits(fyre.conv.view.FlagModal,goog.ui.Component);fyre.conv.view.FlagModal.CLASSES={FLAG_AS:"fyre-modal-flagas",FLAG_FORM:"fyre-modal-flag-form",FLAG_ERROR:"fyre-modal-select-error"};
fyre.conv.view.FlagModal.prototype.getSoyData=function(){var a=fyre.conv.i18n.textEnumeration;return{displayName:this.model_.get(this.model_.ATTRIBUTES.DISPLAY_NAME),flagTypes:this.getFlagTypes_(),strings:{email:a.get(a.KEYS.FLAG_EMAIL),emailPlaceholder:a.get(a.KEYS.FLAG_EMAIL_PLACEHOLDER),notes:a.get(a.KEYS.FLAG_NOTES),notesPlaceholder:a.get(a.KEYS.FLAG_NOTES_PLACEHOLDER),subtitle:a.get(a.KEYS.FLAG_SUBTITLE)}}};
fyre.conv.view.FlagModal.prototype.getFlagTypes_=function(){var a=fyre.v1.enums.content.flags,b=fyre.conv.i18n.textEnumeration,c=b.KEYS,d={},e=[];d[a.SPAM]=b.get(c.FLAG_SPAM);d[a.OFFENSIVE]=b.get(c.FLAG_OFFENSIVE);d[a.DISAGREE]=b.get(c.FLAG_DISAGREE);d[a.OFFTOPIC]=b.get(c.FLAG_OFFTOPIC);goog.object.forEach(d,function(a,b){e.push({label:a,val:b})});return e};
fyre.conv.view.FlagModal.prototype.createDom=function(){var a=this.getSoyData();this.element_=goog.dom.createDom("div");this.element_.innerHTML=fyre.templates.conv.comment.flagModal(a)};fyre.conv.view.FlagModal.prototype.disposeInternal=function(){fyre.conv.view.FlagModal.superClass_.disposeInternal.call(this);this.model_=null};fyre.conv.view.LikeContainer=function(a,b,c){this.disableAvatars_=b;this.model_=a;this.hasUserLiked_=!1;goog.ui.Component.call(this,c)};goog.inherits(fyre.conv.view.LikeContainer,goog.ui.Component);fyre.conv.view.LikeContainer.EVENTS={LIKE_CLICKED:"like_clicked"};fyre.conv.view.LikeContainer.CLASSES={LIKE_BTN:"fyre-comment-like-btn",LIKE_IMGS:"fyre-comment-like-imgs",LIKE_COUNT:"fyre-comment-like-count"};fyre.conv.view.LikeContainer.COUNT=4;
fyre.conv.view.LikeContainer.getLikeSoyData=function(a){var b=a.get(fyre.conv.model.Opine.ATTRIBUTES.AUTHOR),c=fyre.conv.model.Author.ATTRIBUTES;return{opineId:a.get(c.ID),profileUrl:b.get(c.PROFILE_URL),displayName:b.get(c.DISPLAY_NAME),avatar:b.get(c.AVATAR),defaultAvatar:b.get(c.DEFAULT_AVATAR)}};fyre.conv.view.LikeContainer.prototype.getSoyData=function(){return{strings:{like:fyre.conv.i18n.textEnumeration.get(fyre.conv.i18n.textEnumeration.KEYS.LIKE)},count:this.model_.length,likes:this.getLikesModelsAsSoyData_()}};
fyre.conv.view.LikeContainer.prototype.decorateInternal=function(a){fyre.conv.view.LikeContainer.superClass_.decorateInternal.call(this,a);a.innerHTML=fyre.templates.conv.comment.likeContainer(this.getSoyData())};fyre.conv.view.LikeContainer.prototype.handleLikeModelChange_=function(){this.renderUserLiked_();this.updateCount_();this.disableAvatars_||this.renderLikesDom_()};
fyre.conv.view.LikeContainer.prototype.updateCount_=function(){var a=this.model_.length;this.countContainer_.innerHTML=0===a?"":a};fyre.conv.view.LikeContainer.prototype.getLikesModelsAsSoyData_=function(){for(var a=Math.min(fyre.conv.view.LikeContainer.COUNT,this.model_.length),b=[],c,d=0;d<a;d++)c=this.model_.length-1-d,c=this.model_.at(c),b.push(fyre.conv.view.LikeContainer.getLikeSoyData(c));return b};
fyre.conv.view.LikeContainer.prototype.renderLikesDom_=function(){var a=fyre.templates.conv.comment.likeAvatar,b=this.getLikesModelsAsSoyData_(),c=document.createDocumentFragment();goog.dom.removeChildren(this.authorContainer_);b.length&&(goog.array.forEach(b,function(b){b=goog.soy.renderAsFragment(a,b);c.appendChild(b)}),this.authorContainer_.appendChild(c))};
fyre.conv.view.LikeContainer.prototype.renderUserLiked_=function(){var a=fyre.conv.i18n.textEnumeration,b=fyre.conv.model.Opine.ATTRIBUTES,c=this.model_.some(function(a){return a.get(b.AUTHOR_ID)===fyre.conv.user.id});this.hasUserLiked_!==c&&(this.hasUserLiked_=c,this.likeBtn_.innerHTML=a.get(c?a.KEYS.UNLIKE:a.KEYS.LIKE))};
fyre.conv.view.LikeContainer.prototype.enterDocument=function(){var a=goog.events.EventType.CLICK,b=fyre.conv.view.LikeContainer.CLASSES,c=fyre.conv.user;this.authorContainer_=this.getElementByClass(b.LIKE_IMGS);this.likeBtn_=this.getElementByClass(b.LIKE_BTN);this.countContainer_=this.getElementByClass(b.LIKE_COUNT);this.getHandler().listen(this.likeBtn_,a,this.handleLikeBtnClick_);this.getHandler().listen(this.authorContainer_,a,this.handleAuthorContainerClick_);this.model_.on(this.model_.EVENTS.ADD,
this.handleLikeModelChange_,this);this.model_.on(this.model_.EVENTS.REMOVE,this.handleLikeModelChange_,this);c.on(c.attributeChangeEvent(fyre.conv.user.ATTRIBUTES.ID),this.renderUserLiked_,this);fyre.conv.view.LikeContainer.superClass_.enterDocument.call(this)};fyre.conv.view.LikeContainer.prototype.exitDocument=function(){this.countContainer_=this.likeBtn_=this.authorContainer_=null;this.model_.off(null,null,this);fyre.conv.user.off(null,null,this);fyre.conv.view.LikeContainer.superClass_.exitDocument.call(this)};
fyre.conv.view.LikeContainer.prototype.handleLikeBtnClick_=function(){this.dispatchEvent(fyre.conv.view.LikeContainer.EVENTS.LIKE_CLICKED)};
fyre.conv.view.LikeContainer.prototype.handleAuthorContainerClick_=function(a){var b=(a.target.nodeName===goog.dom.TagName.IMG?a.target.parentElement:a.target).getAttribute("data-opineid");goog.asserts.assertString(b);b=this.model_.get(b).get(fyre.conv.model.Opine.ATTRIBUTES.AUTHOR);a.preventDefault();this.dispatchEvent({type:fyre.conv.author.EVENTS.AUTHOR_CLICK,author:b})};fyre.conv.view.MediaThumbnail=function(a,b){this.model_=a;fyre.v1.ui.FyreComponent.call(this,b)};goog.inherits(fyre.conv.view.MediaThumbnail,fyre.v1.ui.FyreComponent);fyre.conv.view.MediaThumbnail.prototype.getSoyData=function(){var a=fyre.conv.model.MessageMedia.ATTRIBUTES;return{thumbnailUrl:this.model_.get(a.THUMBNAIL_URL),type:this.model_.get(a.TYPE)}};fyre.conv.view.MediaThumbnail.prototype.createDomInternal=function(){fyre.conv.view.MediaThumbnail.superClass_.createDomInternal.call(this);this.$dom_.html(fyre.templates.conv.comment.mediaThumbnail(this.getSoyData()))};
fyre.conv.view.MediaThumbnail.prototype.enterDocument=function(){fyre.conv.view.MediaThumbnail.superClass_.enterDocument.call(this);this.getHandler().listen(this.element_,goog.events.EventType.CLICK,this.makeTrigger(this.EVENTS.ACTION,this.model_))};fyre.conv.view.MediaThumbnailDrawer=function(a,b){fyre.v1.ui.FyreComponent.call(this,b);this.model_=a;this.model_.on(this.model_.EVENTS.ADD,this.addMedia,this)};goog.inherits(fyre.conv.view.MediaThumbnailDrawer,fyre.v1.ui.FyreComponent);fyre.conv.view.MediaThumbnailDrawer.prototype.createDomInternal=function(){fyre.conv.view.MediaThumbnailDrawer.superClass_.createDomInternal.call(this);this.setChildVisibility_()};
fyre.conv.view.MediaThumbnailDrawer.prototype.setChildVisibility_=function(){switch(this.getChildCount()){case 0:break;case 1:this.$dom_.first().hide();break;default:this.$dom_.first().show()}};fyre.conv.view.MediaThumbnailDrawer.prototype.addMedia=function(a){a=new fyre.conv.view.MediaThumbnail(a);this.addChild(a,!0);a.on(a.EVENTS.ACTION,this.makeTrigger(this.EVENTS.ACTION));this.setChildVisibility_()};
fyre.conv.view.MediaThumbnailDrawer.prototype.exitDocument=function(){this.model_.off(null,null,this);fyre.conv.view.MediaThumbnailDrawer.superClass_.exitDocument.call(this)};fyre.templates.conv.user={};
fyre.templates.conv.user.guest=function(a){return'<div class="fyre-box-wrapper"><a class="fyre-user-profile-link fyre-user-loggedin" target="_blank">'+(!a.disableAvatars?'<img src="'+a.avatar+'" class="fyre-user-avatar-25" alt="'+soy.$$escapeHtml(a.displayName)+'" onerror="javascript:this.src=\''+soy.$$escapeHtml(a.defaultAvatar)+"';\" />":"")+'<span class="fyre-user-drop">'+soy.$$escapeHtml(a.displayName)+' <em>(guest)</em></span></a> <ul class="fyre-box-list"><li class="fyre-logout-link"><a title="'+soy.$$escapeHtml(a.strings.signOut)+
'">'+soy.$$escapeHtml(a.strings.signOut)+"</a></li></ul></div>"};fyre.templates.conv.user.anonymous=function(){return'<a rel="nofollow" class="fyre-user-loggedout"></a>'};
fyre.templates.conv.user.detail=function(a){return'<div class="fyre-box-wrapper"><a class="fyre-user-profile-link fyre-user-loggedin">'+(!a.disableAvatars?'<img src="'+a.avatar+'" class="fyre-user-avatar-25" alt="'+soy.$$escapeHtml(a.displayName)+'" onerror="javascript:this.src=\''+soy.$$escapeHtml(a.defaultAvatar)+"';\" />":"")+' <span class="fyre-user-drop">'+a.displayName+'</span></a><ul class="fyre-box-list"><li class="fyre-edit-profile-link"><a title="'+soy.$$escapeHtml(a.strings.editProfile)+
'">'+soy.$$escapeHtml(a.strings.editProfile)+"</a></li>"+(a.moderator?'<li class="fyre-admin-link"><a href="'+soy.$$escapeHtml(a.adminUrl)+'" title="'+soy.$$escapeHtml(a.strings.siteAdmin)+'" target="_blank">'+soy.$$escapeHtml(a.strings.siteAdmin)+"</a></li>":"")+'<li class="fyre-logout-link"><a title="'+soy.$$escapeHtml(a.strings.signOut)+'">'+soy.$$escapeHtml(a.strings.signOut)+"</a></li></ul></div>"};fyre.templates.conv.user.hovercardBase=function(){return'<div class="fyre-hovercard" style="display: none;"><div class="fyre-hovercard-body"></div><div class="fyre-hovercard-arrow"></div></div>'};
fyre.templates.conv.user.hovercardLivefyre=function(a){for(var b='<div class="fyre-hovercard-connections">',c=a.connections,d=c.length,e=0;e<d;e++)var f=c[e],b=b+('<a href="'+soy.$$escapeHtml(f.profileUrl)+'" target="_blank"><img src="'+soy.$$escapeHtml(a.assetUrl)+"/images/hovercard/"+soy.$$escapeHtml(f.provider)+'.png" /></a>');return b+='</div><div class="fyre-hovercard-display-name">'+(a.profileUrl?'<a href="'+soy.$$escapeHtml(a.profileUrl)+'" target="_blank">'+soy.$$escapeHtml(a.fullName)+"</a>":
soy.$$escapeHtml(a.fullName))+"</div>"+(a.showRating?'<div class="fyre-hovercard-rating">'+soy.$$escapeHtml(a.rating)+" pts</div>":"")+(a.profileUrl?'<div class="fyre-hovercard-username"><a href="'+soy.$$escapeHtml(a.profileUrl)+'" target="_blank">'+soy.$$escapeHtml(a.prettyProfileUrl)+"</a></div>":"")+'<p class="fyre-hovercard-bio">'+soy.$$escapeHtml(a.bio)+'</p><a class="fyre-hovercard-button">'+soy.$$escapeHtml(a.strings.viewProfile)+"</a>"};
fyre.templates.conv.user.hovercardFacebook=function(a){return'<div class="fyre-hovercard-social-button fyre-hovercard-social-button-facebook"><iframe src="https://www.facebook.com/plugins/subscribe.php?href=https%3A%2F%2Fwww.facebook.com%2F'+soy.$$escapeHtml(a.displayName)+'&amp;layout=button_count&amp;show_faces=false&amp;colorscheme=light&amp;font=lucida+grande&amp;" scrolling="no" frameborder="0" style="position: relative; right: 15px; border:none; overflow:hidden; height:25px;" allowTransparency="true"></iframe></div><div class="fyre-hovercard-display-name">'+
soy.$$escapeHtml(a.fullName)+'</div><div class="fyre-hovercard-username">'+(a.hasDisplayName?'<a href="'+soy.$$escapeHtml(a.profileUrl)+'" target="_blank">fb.me/'+soy.$$escapeHtml(a.displayName)+"</a>":"")+"</div>"};
fyre.templates.conv.user.hovercardTwitter=function(a){return'<div class="fyre-hovercard-social-button fyre-hovercard-social-button-twitter"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/follow_button.html?screen_name='+soy.$$escapeHtml(a.displayName)+'&show_count=false&show_screen_name=false" style="width:60px; height:20px;"></iframe></div><div class="fyre-hovercard-display-name">'+soy.$$escapeHtml(a.fullName)+'</div><div class="fyre-hovercard-username">'+
(a.hasDisplayName?'<a href="http://twitter.com/'+soy.$$escapeHtml(a.displayName)+'" target="_blank">@'+soy.$$escapeHtml(a.displayName)+"</a>":"")+'</div><p class="fyre-hovercard-bio">'+soy.$$escapeHtml(a.bio)+"</p>"};fyre.templates.conv.user.hovercardDetail=function(a){return a.isTwitter?fyre.templates.conv.user.hovercardTwitter(a):a.isFacebook?fyre.templates.conv.user.hovercardFacebook(a):fyre.templates.conv.user.hovercardLivefyre(a)};
fyre.templates.conv.user.hovercardFail=function(a){return'<div class="fyre-hovercard-fail">Error loading @'+soy.$$escapeHtml(a.displayName)+"</div>"};fyre.templates.conv.user.hovercardLoading=function(a){return'<div class="fyre-hovercard-loading">Loading @'+soy.$$escapeHtml(a.displayName)+' <\!--[if IE]><img src="'+soy.$$escapeHtml(a.assetUrl)+'/images/hovercard/spinner-slide.gif" alt="" /><![endif]--\><\!--[if !IE]><\!--\><img src="'+soy.$$escapeHtml(a.assetUrl)+'/images/hovercard/spinner-ball.png" alt="" /><\!--<![endif]--\></div>'};fyre.conv.view.UserHovercardContent=function(a,b,c){this.model_=a;this.isCustomNetwork_=fyre.conv.config.customNetwork;this.showRatings_=b||!1;goog.ui.Component.call(this,c)};goog.inherits(fyre.conv.view.UserHovercardContent,goog.ui.Component);fyre.conv.view.UserHovercardContent.CLASSES={PROFILE_BTN:"fyre-hovercard-button"};
fyre.conv.view.UserHovercardContent.prototype.decorateInternal=function(a){fyre.conv.view.UserHovercardContent.superClass_.decorateInternal.call(this,a);a.innerHTML=fyre.templates.conv.user.hovercardDetail(this.getSoyData());(this.profileBtnEl_=this.getElementByClass(fyre.conv.view.UserHovercardContent.CLASSES.PROFILE_BTN))&&this.getHandler().listen(this.profileBtnEl_,goog.events.EventType.CLICK,this.handleProfileClick)};
fyre.conv.view.UserHovercardContent.prototype.disposeInternal=function(){this.profileBtnEl_=null;fyre.conv.view.UserHovercardContent.superClass_.disposeInternal.call(this)};
fyre.conv.view.UserHovercardContent.prototype.getSoyData=function(){var a=fyre.conv.model.Author.ATTRIBUTES,b=fyre.conv.i18n.textEnumeration,c=this.model_.get(a.FIRST_NAME),d=this.model_.get(a.LAST_NAME),e={};e.assetUrl=fyre.conv.config.servers.assets;e.bio=this.model_.get(a.BIO);e.displayName=this.model_.get(a.DISPLAY_NAME);e.hasDisplayName=!!e.displayName;e.profileUrl=this.model_.get(a.PROFILE_URL);e.prettyProfileUrl="";e.profileUrl&&(e.prettyProfileUrl=this.isCustomNetwork_?e.profileUrl.replace("http://",
""):"livefyre.com/"+e.displayName);e.rating=this.model_.get(a.RATING);e.source=this.model_.get(a.TYPE)||fyre.conv.model.Author.TYPES.DEFAULT;e.showRating=!this.isCustomNetwork_||this.showRatings_;e.isFacebook=this.model_.isFacebook();e.isTwitter=this.model_.isTwitter();var f=[];this.isCustomNetwork_||f.push({provider:"livefyre",profileUrl:e.profileUrl});goog.array.extend(f,this.model_.get(a.CONNECTIONS));e.connections=f;e.fullName=e.displayName;c&&d&&(e.fullName=goog.string.buildString(c," ",d));
e.strings={viewProfile:b.get(b.KEYS.HOVERCARD_VIEW_PROFILE)};return e};fyre.conv.view.UserHovercardContent.prototype.handleProfileClick=function(a){a.preventDefault();this.dispatchEvent({type:fyre.conv.author.EVENTS.AUTHOR_CLICK,author:this.model_})};fyre.conv.view.UserHovercard=function(a,b,c){b=fyre.conv.view.UserHovercard.CLASSES;this.className=b.BASE;this.dom_=c||(a?goog.dom.getDomHelper(goog.dom.getElement(a)):goog.dom.getDomHelper());a=this.dom_.getDocument().body;this.$dom_=goog.dom.getElementByClass(this.className,a);this.$dom_||(this.$dom_=fyre.v1.dom.create(fyre.templates.conv.user.hovercardBase()),goog.dom.append(a,this.$dom_.element));this.bodyElement=this.$dom_.getByClass(b.BODY);goog.ui.Popup.call(this,this.$dom_.element);this.cursorPosition=
new goog.math.Coordinate(1,1);this.handler_=new goog.events.EventHandler(this);this.elements_=new goog.structs.Set;this.enabled_=!0;return this};goog.inherits(fyre.conv.view.UserHovercard,goog.ui.Tooltip);goog.addSingletonGetter(fyre.conv.view.UserHovercard);fyre.conv.view.UserHovercard.prototype.showDelayMs_=100;fyre.conv.view.UserHovercard.prototype.hideDelayMs_=100;fyre.conv.view.UserHovercard.CLASSES={BASE:"fyre-hovercard",BELOW:"fyre-hovercard-below",BODY:"fyre-hovercard-body"};
fyre.conv.view.UserHovercard.prototype.adjustPosition=function(){var a=fyre.conv.view.UserHovercard.CLASSES,b=this.$dom_.element,c=0;b.clientHeight&&(this.isBelowElement_()?(c=this.anchor.offsetHeight+2,this.$dom_.addClass(a.BELOW)):(c=-b.clientHeight,this.$dom_.removeClass(a.BELOW)),this.setMargin(c,void 0,void 0,-10))};
fyre.conv.view.UserHovercard.prototype.attach=function(a,b,c){this.enabled_&&(fyre.conv.view.UserHovercard.superClass_.attach.call(this,a),c?(this.setParentEventTarget(c),b=goog.isFunction(b)?goog.bind(b,c,a):goog.nullFunction,a.callback=b):a.callback=goog.nullFunction)};fyre.conv.view.UserHovercard.prototype.disposeComponent=function(){this.component&&this.component.dispose()};
fyre.conv.view.UserHovercard.prototype.getPositioningStrategy=function(a){a=goog.ui.Tooltip.Activation.FOCUS;a=fyre.conv.view.UserHovercard.superClass_.getPositioningStrategy.call(this,a);a.corner=goog.positioning.Corner.TOP_LEFT;return a};fyre.conv.view.UserHovercard.prototype.getSoyData=function(){var a=fyre.conv.model.Author.ATTRIBUTES,b={};b.assetUrl=fyre.conv.config.servers.assets;b.displayName="";this.model_&&(b.displayName=this.model_.get(a.DISPLAY_NAME));return b};
fyre.conv.view.UserHovercard.prototype.handleMouseOver=function(a){this.getAnchorFromElement(a.target).callback();fyre.conv.view.UserHovercard.superClass_.handleMouseOver.call(this,a)};fyre.conv.view.UserHovercard.prototype.isBelowElement_=function(){var a=this.$dom_.element;return parseInt(a.style.top.replace("px",""),10)-a.clientHeight<goog.dom.getDocumentScroll().y};fyre.conv.view.UserHovercard.prototype.onShow_=function(){fyre.conv.view.UserHovercard.superClass_.onShow_.call(this);this.adjustPosition()};
fyre.conv.view.UserHovercard.prototype.positionAndShow_=function(a,b){this.model_.isGuest()||(this.setMargin(null),this.anchor=a,this.setPosition(b||this.getPositioningStrategy(goog.ui.Tooltip.Activation.FOCUS)),this.setVisible(!0))};
fyre.conv.view.UserHovercard.prototype.setDetailedHovercard=function(){this.disposeComponent();this.component=new fyre.conv.view.UserHovercardContent(this.model_,this.showRatings_);this.component.setParentEventTarget(this);this.component.decorate(this.bodyElement.element);setTimeout(goog.bind(this.adjustPosition,this),20)};fyre.conv.view.UserHovercard.prototype.setFailHovercard=function(){this.disposeComponent();this.bodyElement.html(fyre.templates.conv.user.hovercardFail(this.getSoyData()))};
fyre.conv.view.UserHovercard.prototype.setLoadingHovercard=function(){this.disposeComponent();this.bodyElement.html(fyre.templates.conv.user.hovercardLoading(this.getSoyData()))};
fyre.conv.view.UserHovercard.prototype.setModel=function(a){this.model_&&this.model_.off(null,null,this);this.model_=a;a=fyre.conv.model.Author.ATTRIBUTES;goog.isDefAndNotNull(this.model_.get(a.BIO))?this.setDetailedHovercard():(this.setLoadingHovercard(),this.model_.on(this.model_.attributeChangeEvent(a.BIO),this.setDetailedHovercard,this),this.dispatchEvent({type:fyre.conv.author.EVENTS.AUTHOR_FETCH,author:this.model_,errorCallback:goog.bind(this.setFailHovercard,this)}))};
fyre.conv.view.UserHovercard.prototype.setEnabled=function(a,b){goog.isDefAndNotNull(a)&&(this.enabled_=a,this.showRatings_=b)};fyre.v2.dom={};fyre.v2.dom.truncate={};fyre.v2.dom.truncate.TRUNCATE_DEFAULTS={MAX_LENGTH:1E3,MORE:"See more",LESS:"Show less",MORE_STRING:"..."};fyre.v2.dom.truncate.TRUNCATE_CLASSES={FULL_CONTENT:"fyre-comment-full-content",MORE_ELLIPSIS:"fyre-comment-truncate-more-ellipsis",MORE_STRING:"fyre-comment-truncate-more-string",TOGGLE:"fyre-comment-truncate-toggle",TRUNCATED_CONTENT:"fyre-comment-truncated-content",SHOW_MORE:"fyre-comment-truncate-more",SHOW_LESS:"fyre-comment-truncate-less"};
fyre.v2.dom.truncate.truncate=function(a,b){b=b||fyre.v2.dom.truncate.TRUNCATE_DEFAULTS.MAX_LENGTH;if(!fyre.v2.dom.truncate.shouldTruncate(a,b))return a;var c=fyre.v2.dom.truncate.recursivelyTruncate_(a,b);goog.dom.classes.add(c,fyre.v2.dom.truncate.TRUNCATE_CLASSES.TRUNCATED_CONTENT);return c};fyre.v2.dom.truncate.recursivelyTruncate_=function(a,b){return a.nodeType==goog.dom.NodeType.TEXT?fyre.v2.dom.truncate.truncateText_(a,b):fyre.v2.dom.truncate.truncateNode_(a,b)};
fyre.v2.dom.truncate.shouldTruncate=function(a,b){b=b||fyre.v2.dom.truncate.TRUNCATE_DEFAULTS.MAX_LENGTH;return goog.dom.getTextContent(a).length>b};fyre.v2.dom.truncate.truncateNode_=function(a,b){for(var c=a.cloneNode(!1),d=a.childNodes,e=b,f=0;f<d.length&&0<e;f++){var g=fyre.v2.dom.truncate.recursivelyTruncate_(d[f],e);g&&(g instanceof Array?goog.array.forEach(g,function(a){c.appendChild(a);e-=goog.dom.getTextContent(a).length}):(c.appendChild(g),e-=goog.dom.getTextContent(g).length))}return c};
fyre.v2.dom.truncate.truncateText_=function(a,b){goog.asserts.assert(a.nodeType==goog.dom.NodeType.TEXT);var c=goog.dom.getRawTextContent(a);if(!goog.string.trim(c))return"";var d=0<b?c.slice(0,b):"",e=goog.dom.createTextNode(d),f=[];f.push(e);d&&c.length>b&&(c=goog.dom.createDom(goog.dom.TagName.SPAN,{"class":fyre.v2.dom.truncate.TRUNCATE_CLASSES.MORE_ELLIPSIS},fyre.v2.dom.truncate.TRUNCATE_DEFAULTS.MORE_STRING),f.push(c));return f};
fyre.v2.dom.truncate.findNodeForMore=function(a){return goog.dom.getElementByClass(fyre.v2.dom.truncate.TRUNCATE_CLASSES.MORE_ELLIPSIS,a)};fyre.v2.dom.truncate.findNodeForLess=function(a){var b=goog.dom.getLastElementChild(a);return b&&b.nodeName==goog.dom.TagName.P?goog.dom.getChildren(b)?fyre.v2.dom.truncate.findNodeForLess_(b):b:a};fyre.v2.ui={};fyre.v2.ui.TruncatedText=function(a,b,c,d){this.charLimit_=a;this.showMoreLabel_=b?b:fyre.v2.dom.truncate.TRUNCATE_DEFAULTS.MORE;this.showLessLabel_=c?c:fyre.v2.dom.truncate.TRUNCATE_DEFAULTS.LESS;this.truncateDisplayed_=!1;goog.ui.Component.call(this,d)};goog.inherits(fyre.v2.ui.TruncatedText,goog.ui.Component);fyre.v2.ui.TruncatedText.prototype.createDom=function(){goog.asserts.assert(!1,"This component is used as a decorator to an existing element")};
fyre.v2.ui.TruncatedText.prototype.decorateInternal=function(a){fyre.v2.ui.TruncatedText.superClass_.decorateInternal.call(this,a);var b=fyre.v2.dom.truncate.TRUNCATE_CLASSES;this.truncatedNode_=fyre.v2.dom.truncate.truncate(this.element_,this.charLimit_);this.truncateDisplayed_=!0;goog.dom.classes.add(a,b.FULL_CONTENT);goog.style.showElement(a,!1);goog.dom.insertSiblingAfter(this.truncatedNode_,a);var c=fyre.v2.dom.truncate.findNodeForMore(this.truncatedNode_),d=goog.dom.createDom(goog.dom.TagName.A,
{href:"#more"},this.showMoreLabel_);goog.dom.classes.add(d,b.TOGGLE);goog.dom.classes.add(d,b.SHOW_MORE);goog.dom.appendChild(c,d);a=fyre.v2.dom.truncate.findNodeForLess(a);c=goog.dom.createDom(goog.dom.TagName.A,{href:"#less"},this.showLessLabel_);goog.dom.classes.add(c,b.TOGGLE);goog.dom.classes.add(c,b.SHOW_LESS);goog.dom.appendChild(a,c)};
fyre.v2.ui.TruncatedText.prototype.enterDocument=function(){fyre.v2.ui.TruncatedText.superClass_.enterDocument.call(this);if(this.truncatedNode_){var a=goog.dom.getElementByClass(fyre.v2.dom.truncate.TRUNCATE_CLASSES.SHOW_MORE,this.truncatedNode_);this.getHandler().listen(a,goog.events.EventType.CLICK,this.handleToggleTruncateClick);a=goog.dom.getElementByClass(fyre.v2.dom.truncate.TRUNCATE_CLASSES.SHOW_LESS,this.element_);this.getHandler().listen(a,goog.events.EventType.CLICK,this.handleToggleTruncateClick)}};
fyre.v2.ui.TruncatedText.prototype.disposeInternal=function(){fyre.v2.ui.TruncatedText.superClass_.disposeInternal.call(this);goog.dom.removeNode(this.truncatedNode_);var a=goog.dom.getElementByClass(fyre.v2.dom.truncate.TRUNCATE_CLASSES.SHOW_LESS,this.element_);goog.dom.removeNode(a);goog.style.showElement(this.element_,!0)};
fyre.v2.ui.TruncatedText.prototype.handleToggleTruncateClick=function(a){a.preventDefault();a=this.element_;goog.style.showElement(this.truncatedNode_,!this.truncateDisplayed_);goog.style.showElement(a,this.truncateDisplayed_);this.truncateDisplayed_=!this.truncateDisplayed_};goog.dom.forms={};goog.dom.forms.getFormDataMap=function(a){var b=new goog.structs.Map;goog.dom.forms.getFormDataHelper_(a,b,goog.dom.forms.addFormDataToMap_);return b};goog.dom.forms.getFormDataString=function(a){var b=[];goog.dom.forms.getFormDataHelper_(a,b,goog.dom.forms.addFormDataToStringBuffer_);return b.join("&")};
goog.dom.forms.getFormDataHelper_=function(a,b,c){for(var d=a.elements,e,f=0;e=d[f];f++)if(!(e.disabled||"fieldset"==e.tagName.toLowerCase())){var g=e.name;switch(e.type.toLowerCase()){case "file":case "submit":case "reset":case "button":break;case "select-multiple":e=goog.dom.forms.getValue(e);if(null!=e)for(var h,i=0;h=e[i];i++)c(b,g,h);break;default:h=goog.dom.forms.getValue(e),null!=h&&c(b,g,h)}}d=a.getElementsByTagName("input");for(f=0;e=d[f];f++)e.form==a&&"image"==e.type.toLowerCase()&&(g=
e.name,c(b,g,e.value),c(b,g+".x","0"),c(b,g+".y","0"))};goog.dom.forms.addFormDataToMap_=function(a,b,c){var d=a.get(b);d||(d=[],a.set(b,d));d.push(c)};goog.dom.forms.addFormDataToStringBuffer_=function(a,b,c){a.push(encodeURIComponent(b)+"="+encodeURIComponent(c))};goog.dom.forms.hasFileInput=function(a){for(var a=a.elements,b,c=0;b=a[c];c++)if(!b.disabled&&b.type&&"file"==b.type.toLowerCase())return!0;return!1};
goog.dom.forms.setDisabled=function(a,b){if("FORM"==a.tagName)for(var c=a.elements,d=0;a=c[d];d++)goog.dom.forms.setDisabled(a,b);else!0==b&&a.blur(),a.disabled=b};goog.dom.forms.focusAndSelect=function(a){a.focus();a.select&&a.select()};goog.dom.forms.hasValue=function(a){return!!goog.dom.forms.getValue(a)};goog.dom.forms.hasValueByName=function(a,b){return!!goog.dom.forms.getValueByName(a,b)};
goog.dom.forms.getValue=function(a){var b=a.type;if(!goog.isDef(b))return null;switch(b.toLowerCase()){case "checkbox":case "radio":return goog.dom.forms.getInputChecked_(a);case "select-one":return goog.dom.forms.getSelectSingle_(a);case "select-multiple":return goog.dom.forms.getSelectMultiple_(a);default:return goog.isDef(a.value)?a.value:null}};goog.dom.$F=goog.dom.forms.getValue;
goog.dom.forms.getValueByName=function(a,b){var c=a.elements[b];if(c.type)return goog.dom.forms.getValue(c);for(var d=0;d<c.length;d++){var e=goog.dom.forms.getValue(c[d]);if(e)return e}return null};goog.dom.forms.getInputChecked_=function(a){return a.checked?a.value:null};goog.dom.forms.getSelectSingle_=function(a){var b=a.selectedIndex;return 0<=b?a.options[b].value:null};
goog.dom.forms.getSelectMultiple_=function(a){for(var b=[],c,d=0;c=a.options[d];d++)c.selected&&b.push(c.value);return b.length?b:null};goog.dom.forms.setValue=function(a,b){var c=a.type;if(goog.isDef(c))switch(c.toLowerCase()){case "checkbox":case "radio":goog.dom.forms.setInputChecked_(a,b);break;case "select-one":goog.dom.forms.setSelectSingle_(a,b);break;case "select-multiple":goog.dom.forms.setSelectMultiple_(a,b);break;default:a.value=goog.isDefAndNotNull(b)?b:""}};
goog.dom.forms.setInputChecked_=function(a,b){a.checked=b?"checked":null};goog.dom.forms.setSelectSingle_=function(a,b){a.selectedIndex=-1;if(goog.isString(b))for(var c,d=0;c=a.options[d];d++)if(c.value==b){c.selected=!0;break}};goog.dom.forms.setSelectMultiple_=function(a,b){goog.isString(b)&&(b=[b]);for(var c,d=0;c=a.options[d];d++)if(c.selected=!1,b)for(var e,f=0;e=b[f];f++)c.value==e&&(c.selected=!0)};fyre.conv.view.CommentView=function(a,b,c){this.appContext=a;this.commentModel=b;var b=this.A_=this.commentModel.ATTRIBUTES,d=fyre.conv.model.Collection.ATTRIBUTES;this.dialog=c;this._expandedMedia=null;this.rawHtmlComp_=new fyre.conv.view.RawHtmlComponent(this.dom_);fyre.conv.user.on(fyre.conv.user.EVENTS.CHANGE,this.handleUserUpdated_,this);this.commentModel.bind("change",this.handleModelChange,this);this.collection_=a.collectionService.collection();c=this.commentModel.get(this.A_.AUTHOR_ID);this.author=
a.collectionService.authors().get(c);this.commentModel.set(b.AUTHOR,this.author);this.replyStateKey_="fyre-editorstate-"+this.commentModel.get(this.A_.ID);this.collapsed=!1;this.hovercard_=new fyre.conv.view.UserHovercard.getInstance;this.hovercard_.setEnabled(this.collection_.get(d.HOVERCARDS_ENABLED),this.appContext.appOpts.userRatingInHovercard);this.collection_.on(this.collection_.attributeChangeEvent(d.COMMENTS_ENABLED),goog.bind(this.handleCommentsEnabledChange_,this));this.collection_.on(this.collection_.attributeChangeEvent(d.REPLIES_ENABLED),
goog.bind(this.handleRepliesEnabledChange_,this));goog.ui.Component.call(this)};goog.inherits(fyre.conv.view.CommentView,goog.ui.Component);
fyre.conv.view.CommentView.CLASSES={ACTIONS:"fyre-comment-actions",AUTHOR:"fyre-comment-author",AUTHOR_TAG:"fyre-comment-author-tag",BODY:"fyre-comment-body",COLLAPSE:"fyre-comment-collapse",COMMENT:"fyre-comment",DATE:"fyre-comment-date",DIVIDER:"fyre-comment-divider",DIVIDER_NARROW:"fyre-comment-divider-narrow",EDITOR:"fyre-editor",EXPAND:"fyre-comment-expand",FLAG_MOBILE_BTN:"fyre-comment-flag-mobile-btn",FOCUSED:"fyre-comment-focused",FOOTER:"fyre-comment-footer",GUEST:"fyre-guest",HAS_REPLIES:"fyre-comment-has-replies",
HEAD:"fyre-comment-head",HIDE:"fyre-hide",HIGHLIGHT:"fyre-comment-highlight",LIKE:"fyre-comment-like",MEDIA_EXPANDED:"fyre-comment-media-expanded",MEDIA_THUMBNAIL:"fyre-comment-media-thumbnails",MENTION:"fyre-mention",PREMOD:"fyre-comment-premod",RAW_HTML:"fyre-comment-raw-html",REPLY:"fyre-comment-reply",SEE_MORE:"fyre-comment-see-more",SOURCE:"fyre-comment-source",TRUNCATED:"fyre-comment-truncated",USER:"fyre-comment-user",USERNAME:"fyre-comment-username",USER_RATING:"fyre-comment-user-rating"};
fyre.conv.view.CommentView.MENTION_ATTRIBUTES={HREF:"href",PROVIDER:"data-lf-provider",RESOURCE:"resource"};fyre.conv.view.CommentView.TRUNCATE_CHARACTER_LIMIT=75;fyre.conv.view.CommentView.TRUNCATABLE_SOURCES=new goog.structs.Set([fyre.v1.enums.content.source.FEED]);fyre.conv.view.CommentView.MAX_COMMENT_BODY_HEIGHT=200;fyre.conv.view.CommentView.prototype.getStrings=function(){var a=fyre.conv.i18n.textEnumeration;return{moderator:a.get(a.KEYS.MODERATOR)}};
fyre.conv.view.CommentView.prototype.decorateInternal=function(a){var b=fyre.conv.view.CommentView.CLASSES,c={},d=fyre.conv.model.Collection.ATTRIBUTES,e=fyre.conv.model.Comment.ATTRIBUTES,f=fyre.conv.model.Author.ATTRIBUTES;c.author={id:this.author.id,avatar:this.author.get(f.AVATAR),profileUrl:this.author.get(f.PROFILE_URL),displayName:this.author.get(f.DISPLAY_NAME),source:this.author.getSourceDisplayName(),rating:this.author.get(f.RATING),tags:this.author.get(f.TAGS),defaultAvatar:fyre.conv.config.defaultAvatar};
c.author.isTwitter=this.author.isTwitter();c.author.isFacebook=this.author.isFacebook();c.author.isGuest=this.author.isGuest();c.author.isFeed=this.author.isFeed();c.author.doShowFeedSource=c.author.isFeed&&c.author.displayName&&c.author.source!=fyre.conv.model.Author.SOURCE_DISPLAY_NAMES[fyre.conv.model.Author.TYPES.DEFAULT];c.author.twitterHandle=this.author.getTwitterHandle();f=this.commentModel.get(e.ANNOTATIONS);c.socialMsgId=f[e.SOCIAL_MSG_ID];c.moderator=this.commentModel.get(e.ANNOTATIONS)[e.MODERATOR];
c.approvable=this.commentModel.get(e.VISIBILITY)===this.commentModel.VISIBILITY.GROUP;c.repliesEnabled=this.collection_.get(d.REPLIES_ENABLED);this.commentModel.isFeed()&&(e=this.getFeedEntryTitle_(),f=this.getFeedEntryLink_(),e&&(c.title=e,c.link=f));c.strings=this.getStrings();c.disableAvatars=this.appContext.appOpts.disableAvatars;a.innerHTML=fyre.templates.conv.comment.comment(c);this.element_=a;goog.array.forEach(c.author.tags,function(a){a=a.toLowerCase().replace(/\s+/g,"-");goog.dom.classes.add(this.element_,
b.AUTHOR_TAG+"-"+a)},this);this.rawHtmlComp_.decorate(this.getElementByClass(b.RAW_HTML));(a=this.commentModel.get(this.A_.RAW_HTML))&&this.rawHtmlComp_.setContent(a.body);this.isMobile_=fyre.v1.util.browser.isMobile();this.flagButtonEl_=this.getElementByClass(b.FLAG_MOBILE_BTN);this.isMobile_&&this.setFlagMobile();this.decorateFlagButton_();a=fyre.conv.model.Collection.MEDIA_DISPLAY_TYPES;this.collection_.get(d.MEDIA_DISPLAY)!==a.LINKS&&(d=this.commentModel.get(this.A_.MEDIA),a=this.getElementByClass(b.MEDIA_THUMBNAIL),
this._mediaThumbs=new fyre.conv.view.MediaThumbnailDrawer(d),this._mediaThumbs.on(this._mediaThumbs.EVENTS.ACTION,this.handleMediaThumbnailClick,this),this._mediaThumbs.decorate(a,!0),goog.array.forEach(d.models,function(a){this._mediaThumbs.addMedia(a)},this))};fyre.conv.view.CommentView.prototype.decorateFlagButton_=function(){var a=fyre.conv.view.CommentView.CLASSES;this.flagMobileButton&&this.flagMobileButton.decorateInternal(this.getElementByClass(a.ACTIONS))};
fyre.conv.view.CommentView.prototype.enterDocument=function(){var a=fyre.conv.view.CommentView.CLASSES,b=fyre.conv.model.Collection.ATTRIBUTES,c=fyre.conv.model.Comment.ATTRIBUTES,d=fyre.conv.comment.EVENTS,e=goog.events.EventType.CLICK,f=this.collection_.get(b.REPLIES_ENABLED),g=this.commentModel.get(c.VISIBILITY)===this.commentModel.VISIBILITY.GROUP,h=this.appContext.appOpts.disableAvatars;goog.dom.classes.add(this.element_.parentNode,a.SOURCE+"-"+this.commentModel.get(c.SOURCE));this.author.isGuest()&&
goog.dom.classes.add(this.element_,a.GUEST);this.footerEl_=this.getElementByClass(a.FOOTER);b=!this.collection_.get(b.COMMENTS_ENABLED)||!f;this.replyButton_=null;b||this.buildReplyButton_();this.editorContainer_=null;(!b||this.isEditable())&&this.buildEditorContainer_();this.isMobile_||this.setActions();this.commentBodyEl_=this.getElementByClass(a.COMMENT);this.commentDateDom_=this.getElementByClass(a.DATE);this.setCommentBody();this.setUserRating(fyre.conv.config.showUserRating&&this.author&&!this.author.get(this.author.ATTRIBUTES.IMPORTED));
this.setApprovable(g);this.setEdit();this.setDateTimer();this.setLikes();g=this.commentModel.get(this.A_.MEDIA);g.on(g.EVENTS.ADD,this.addMedia,this);g.length&&this.addMedia(g.models[0]);goog.net.cookies.containsKey(this.replyStateKey_)&&this.showReplyEditor();g=this.getHandler();h||(!this.commentModel.isImported()&&!this.author.isGuest()&&this.hovercard_.attach(this.getElementByClass(a.USER),this.handleAvatarHovercardOpen,this),g.listen(this.getElementByClass(a.AUTHOR),e,this.handleAuthorClick_));
g.listen(this.getElementByClass(a.USERNAME),e,this.handleAuthorClick_);this.flagMobileButton&&g.listen(this.flagMobileButton,d.FLAG_MOBILE_CLICK,this.handleFlagMobileButtonClick_);this.appContext.bus.trigger(fyre.conv.events.COMMENT_RENDERED,this);fyre.conv.view.CommentView.superClass_.enterDocument.call(this)};fyre.conv.view.CommentView.prototype.getFeedEntryTitle_=function(){return this.commentModel.get(this.A_.FEED_ENTRY).get(fyre.conv.model.FeedEntry.ATTRIBUTES.TITLE)};
fyre.conv.view.CommentView.prototype.getFeedEntryLink_=function(){return this.commentModel.get(this.A_.FEED_ENTRY).get(fyre.conv.model.FeedEntry.ATTRIBUTES.LINK)};fyre.conv.view.CommentView.prototype.handleRepliesEnabledChange_=function(a,b){b?this.buildReplyButton_():this.disposeReplyButton_()};
fyre.conv.view.CommentView.prototype.buildReplyButton_=function(){this.replyButton_||(this.replyButton_=new fyre.conv.comment.ui.ReplyButton(this.commentModel),this.editorContainer_?this.replyButton_.renderBefore(this.editorContainer_.getElement()):this.replyButton_.render(this.footerEl_),this.getHandler().listen(this.replyButton_,this.replyButton_.EVENTS.REPLY_CLICKED,this.handleReplyButtonClick))};
fyre.conv.view.CommentView.prototype.disposeReplyButton_=function(){this.replyButton_&&(this.getHandler().unlisten(this.replyButton_,null,null),this.replyButton_.dispose(),this.replyButton_=null)};fyre.conv.view.CommentView.prototype.buildEditorContainer_=function(){this.editorContainer_||(this.editorContainer_=new fyre.conv.view.EditorContainer,this.editorContainer_.render(this.footerEl_))};
fyre.conv.view.CommentView.prototype.disposeEditorContainer_=function(){this.editorContainer_&&(this.editorContainer_.dispose(),this.editorContainer_=null)};fyre.conv.view.CommentView.prototype.handleCommentsEnabledChange_=function(a,b){b?(this.buildEditorContainer_(),this.buildReplyButton_(),this.setEdit()):(this.isEditable()||(this.editComponent&&this.editComponent.dispose(),this.disposeEditorContainer_()),this.disposeReplyButton_())};
fyre.conv.view.CommentView.prototype.handleAuthorClick_=function(a){a.preventDefault();a=fyre.conv.model.Author.ATTRIBUTES;(!this.author.isGuest()||this.author.get(a.PROFILE_URL))&&this.dispatchEvent({type:fyre.conv.author.EVENTS.AUTHOR_CLICK,author:this.author})};
fyre.conv.view.CommentView.prototype.setMentionListener=function(){var a=this.getElementsByClass(fyre.conv.view.CommentView.CLASSES.MENTION);goog.array.isEmpty(a)||goog.array.forEach(a,function(a){this.getHandler().listen(a,goog.events.EventType.CLICK,this.handleMentionClick);this.hovercard_.attach(a,this.handleMentionHovercardOpen,this)},this)};fyre.conv.view.CommentView.prototype.handleMentionHovercardOpen=function(a){(a=this.createAuthorFromMention(fyre.v1.dom(a)))&&this.hovercard_.setModel(a)};
fyre.conv.view.CommentView.prototype.handleAvatarHovercardOpen=function(){this.hovercard_.setModel(this.author)};fyre.conv.view.CommentView.prototype.handleMentionClick=function(a){var b=fyre.conv.view.CommentView.MENTION_ATTRIBUTES,c=fyre.v1.dom(a.target).parent(),d="livefyre"!==c.attr(b.PROVIDER),e=-1!==c.attr(b.RESOURCE).indexOf("@");!d&&e&&(c.attr(b.RESOURCE).replace("acct:",""),b=this.createAuthorFromMention(c),this.dispatchEvent({type:fyre.conv.author.EVENTS.AUTHOR_CLICK,author:b}),a.preventDefault())};
fyre.conv.view.CommentView.prototype.createAuthorFromMention=function(a){var b=fyre.conv.model.Author.ATTRIBUTES,c=fyre.conv.view.CommentView.MENTION_ATTRIBUTES,d={},e=a.attr(c.RESOURCE).replace("acct:",""),f=goog.dom.getFirstElementChild(a.element).innerHTML;"twitter"===a.attr(c.PROVIDER)&&(e=f+"@twitter.com");var g=this.appContext.collectionService.authors().get(e);if(g)return g;d[b.ID]=e;d[b.DISPLAY_NAME]=f;d[b.PROFILE_URL]=a.attr(c.HREF)?a.attr(c.HREF):fyre.conv.config.servers.web+"/"+d[b.DISPLAY_NAME];
d[b.TYPE]=goog.object.get(fyre.conv.model.Author.TYPES,a.attr(c.PROVIDER).toUpperCase(),fyre.conv.model.Author.TYPES.DEFAULT);g=new fyre.conv.model.Author(d);this.appContext.collectionService.authors().add(g);return g};
fyre.conv.view.CommentView.prototype.handleModelChange=function(){this.isInDocument()&&(this.commentModel.hasChanged(this.A_.VISIBILITY)&&(this.setEdit(),this.setApprovable(this.commentModel.get(this.A_.VISIBILITY)===this.commentModel.VISIBILITY.GROUP)),goog.object.forEach(this.commentModel.changedAttributes(),this.handleAttributeChange,this))};
fyre.conv.view.CommentView.prototype.handleAttributeChange=function(a,b){switch(b){case "created_display":this.commentDateDom_.html(a);break;case this.A_.RAW_HTML:this.rawHtmlComp_.setContent(a?a.body:null);break;case "has_replies":this.setHasReplies(a);break;case this.A_.BODY_HTML:this.commentBodyEl_&&this.setCommentBody(a);break;case this.A_.UPDATED:case this.A_.UPDATED_BY:this.updateDate()}};fyre.conv.view.CommentView.prototype.handleFlagMobileButtonClick_=function(a){a.comment=this.commentModel};
fyre.conv.view.CommentView.prototype.setCommentBody=function(){var a=goog.dom.htmlToDocumentFragment(this.commentModel.get(this.A_.BODY_HTML));a.nodeType!=goog.dom.NodeType.ELEMENT&&(a=goog.dom.createDom(goog.dom.TagName.P,{},a));this.commentBodyEl_.innerHTML="";this.commentBodyEl_.appendChild(a);this.setEdit();this.setMentionListener()};
fyre.conv.view.CommentView.prototype.setActions=function(){var a=fyre.conv.view.CommentView.CLASSES,b=this.isBanable(),c=this.isDeletable(),d=this.isFlaggable();this.actionsPanel&&this.actionsPanel.dispose();var a=this.getElementByClass(a.ACTIONS),e=null;this.commentModel.isTwitter()&&(e=this.commentModel.get(this.commentModel.ATTRIBUTES.ANNOTATIONS)[this.commentModel.ATTRIBUTES.SOCIAL_MSG_ID]);this.actionsPanel=new fyre.conv.view.CommentActions(b,c,d,e);this.addChild(this.actionsPanel);this.actionsPanel.decorate(a);
b=fyre.conv.view.CommentActions.EVENTS;c=this.getHandler();c.listen(this.actionsPanel,b.BAN_CLICKED,this.handleBanButtonClick);c.listen(this.actionsPanel,b.SHARE_CLICKED,this.handleShareButtonClick);c.listen(this.actionsPanel,b.FLAG_CLICKED,this.handleFlagButtonClick);c.listen(this.actionsPanel,b.DELETE_CLICKED,this.handleDeleteButtonClick);c.listen(this.actionsPanel,b.BOZO_CLICKED,this.handleBozoButtonClick)};
fyre.conv.view.CommentView.prototype.setFlagMobile=function(){var a=this.isFlaggable();if(!this.flagMobileButton||this.flagMobileButton.isDisposed())this.flagMobileButton=new fyre.conv.view.FlagMobile,this.addChild(this.flagMobileButton);a?goog.style.showElement(this.flagButtonEl_,!0):goog.style.showElement(this.flagButtonEl_,!1)};
fyre.conv.view.CommentView.prototype.setTruncatedText=function(){var a=this.getElementByClass(fyre.conv.view.CommentView.CLASSES.BODY),b=fyre.conv.view.CommentView.TRUNCATE_CHARACTER_LIMIT;this.isTruncatable(a,b)&&!this.truncatedTextComponent&&(this.truncatedTextComponent=new fyre.v2.ui.TruncatedText(b),this.truncatedTextComponent.decorate(a))};
fyre.conv.view.CommentView.prototype.isTruncatable=function(a,b){var c=this.commentModel.get(fyre.conv.model.Comment.ATTRIBUTES.SOURCE),c=fyre.conv.view.CommentView.TRUNCATABLE_SOURCES.contains(c),d=fyre.v2.dom.truncate.shouldTruncate(a,b);return c&&this.isCommentBodyTooTall()&&d};
fyre.conv.view.CommentView.prototype.isCommentBodyTooTall=function(){var a=this.getElementByClass(fyre.conv.view.CommentView.CLASSES.BODY);return goog.style.getSize(a).height>fyre.conv.view.CommentView.MAX_COMMENT_BODY_HEIGHT?!0:!1};
fyre.conv.view.CommentView.prototype.setLikes=function(){this.likeContainer&&this.likeContainer.dispose();var a=this.getElementByClass(fyre.conv.view.CommentView.CLASSES.LIKE),b=this.commentModel.get(this.A_.LIKES);this.likeContainer=new fyre.conv.view.LikeContainer(b,this.appContext.appOpts.disableAvatars);this.likeContainer.setParent(this);this.likeContainer.decorate(a,!0);this.getHandler().listen(this.likeContainer,fyre.conv.view.LikeContainer.EVENTS.LIKE_CLICKED,this.handleLikeButtonClick)};
fyre.conv.view.CommentView.prototype.setApprovable=function(a){var b=this.getHandler();if(a){var c=fyre.conv.view.CommentView.CLASSES;this.approvableControls||(a=this.getElementByClass(c.PREMOD),c=this.getElementByClass(c.HEAD),this.approvableControls=new fyre.conv.view.ApprovalControls(c),this.addChild(this.approvableControls),this.approvableControls.decorate(a),b.listen(this.approvableControls,fyre.conv.view.ApprovalControls.EVENTS.APPROVE_CLICKED,this.handleModApproveButtonClick),b.listen(this.approvableControls,
fyre.conv.view.ApprovalControls.EVENTS.DENY_CLICKED,this.handleModDenyButtonClick))}else this.approvableControls&&(a=this.removeChild(this.approvableControls,!0),b.unlisten(a,null,null),a.dispose(),this.approvableControls=null)};
fyre.conv.view.CommentView.prototype.handleDeleteButtonClick=function(a){a.preventDefault();try{this.appContext.commentService.deleteMessage(this.commentModel),this.commentModel.set(this.A_.VISIBILITY,this.commentModel.VISIBILITY.NONE)}catch(b){switch(b){case fyre.conv.errors.INSUFFICIENT_PERMISSIONS:this.handleInsufficientPermissions();break;default:throw b;}}};
fyre.conv.view.CommentView.prototype.handleBozoButtonClick=function(a){a.preventDefault();try{this.appContext.commentService.bozoMessage(this.commentModel),this.commentModel.set(this.A_.VISIBILITY,this.commentModel.VISIBILITY.NONE)}catch(b){switch(b){case fyre.conv.errors.INSUFFICIENT_PERMISSIONS:this.handleInsufficientPermissions();break;default:throw b;}}};
fyre.conv.view.CommentView.prototype.handleModDenyButtonClick=function(a){try{a.preventDefault(),this.appContext.commentService.modDenyComment(this.commentModel),this.commentModel.set(this.A_.VISIBILITY,this.commentModel.VISIBILITY.NONE)}catch(b){switch(b){case fyre.conv.errors.INSUFFICIENT_PERMISSIONS:this.handleInsufficientPermissions();break;default:throw b;}}};
fyre.conv.view.CommentView.prototype.handleModApproveButtonClick=function(a){try{a.preventDefault(),this.appContext.commentService.modApproveComment(this.commentModel),this.setApprovable(!1)}catch(b){switch(b){case fyre.conv.errors.INSUFFICIENT_PERMISSIONS:this.handleInsufficientPermissions();break;default:throw b;}}};
fyre.conv.view.CommentView.prototype.handleBanButtonClick=function(a){a.preventDefault();a=fyre.conv.i18n.textEnumeration;this.dialog.setTitle(a.get(a.KEYS.BAN_TITLE));this.dialog.setContent(fyre.templates.core.misc.confirmation({msg:a.get(a.KEYS.BAN_CONFIRMATION)}));this.dialog.open();this.dialog.setButtonText(a.get(a.KEYS.BAN_CONFIRM_BTN),a.get(a.KEYS.BAN_CANCEL_BTN));this.dialog.handleOkClick(goog.bind(function(){try{this.appContext.commentService.modBanAuthor(this.author)}catch(a){switch(a){case fyre.conv.errors.INSUFFICIENT_PERMISSIONS:this.handleInsufficientPermissions();
break;default:throw a;}}},this))};fyre.conv.view.CommentView.prototype.toggleEditButtonUI=function(a){var b=fyre.conv.view.CommentView.CLASSES;goog.array.forEach([b.BODY,b.REPLY,b.LIKE,b.ACTIONS,b.SEE_MORE],function(a){(a=this.getElementByClass(a))&&goog.dom.classes.toggle(a,b.HIDE)},this);a?this.editorContainer_.hide():this.editorContainer_.show()};
fyre.conv.view.CommentView.prototype.handleEditButtonClick=function(a){this.editorContainer_.isVisible()?this.editorContainer_.hide():(a.preventDefault(),this.editMsgEditor||(this.editMsgEditor=this.makeEditCommentEditor_()),this.editMsgEditor.viewModel.set(fyre.v1.editor.EditorModel.ATTRIBUTES.BODY,this.commentModel.get(this.A_.BODY_HTML)),a=this.commentModel.ATTRIBUTES.RAW_HTML,this.editMsgEditor.commentModel.set(a,this.commentModel.get(a)),this.editMsgEditor.editor.focusAndPlaceCursorAtEnd(!0),
this.toggleEditButtonUI())};
fyre.conv.view.CommentView.prototype.makeEditCommentEditor_=function(){var a=new fyre.v1.editor.EditorModel;a.set(fyre.v1.editor.EditorModel.ATTRIBUTES.BODY,this.commentModel.get(this.A_.BODY_HTML));var b=fyre.conv.i18n.textEnumeration,c=fyre.conv.view.EditorConfig({XX_UseSeamlessEditor:this.appContext.appOpts.XX_UseSeamlessEditor,editorCss:this.appContext.appOpts.editorCss});this.replyEditor&&this.disposeReplyEditor();c[c.KEYS.CANCEL_TOOLBAR]=!0;c[c.KEYS.FOLLOW_TOOLBAR]=!1;c[c.KEYS.POST_TO_FACEBOOK]=
!1;c[c.KEYS.POST_TO_TWITTER]=!1;c[c.KEYS.POST_TO_LINKEDIN]=!1;c[c.KEYS.POST_TO_GOOGLE_PLUS]=!1;c[c.KEYS.POST_BUTTON_TEXT_EDIT]=b.get(b.KEYS.LIVECHAT_POST_EDIT);a.set(a.ATTRIBUTES.CONFIG,c);a.set(a.ATTRIBUTES.POST_TYPE,a.POST_TYPE.EDIT);a.set(a.ATTRIBUTES.USER,fyre.conv.user);a=new fyre.conv.view.BaseEditorView(this.appContext,{viewModel:a});a.editor.on(a.editor.EVENTS.CANCEL,this.handleEditCancel,this);a.editor.on(a.editor.EVENTS.SUBMITTED,this.handleEditSubmitted,this);a.decorate(this.editorContainer_.getElement(),
!0);a.editor.changePostControlText(c[c.KEYS.POST_BUTTON_TEXT_EDIT]);a.editor.canBeSmall();a.editor.changeCancelControlText(c[c.KEYS.POST_BUTTON_TEXT_EDIT_CANCEL]);return a};fyre.conv.view.CommentView.prototype.handleEditSubmitted=function(){var a=this.editMsgEditor.buildPostData();a.set(this.A_.ID,this.commentModel.id);this.appContext.commentService.editMessage(a,goog.bind(this.commentEditSuccess,this),goog.bind(this.commentEditFailure,this))};
fyre.conv.view.CommentView.prototype.commentEditSuccess=function(a){this.commentModel.set(this.A_.BODY_HTML,a.content[this.A_.BODY_HTML]);this.commentModel.set(this.A_.RAW_HTML,a.content[this.A_.RAW_HTML]);this.editMsgEditor.clear();this.toggleEditButtonUI(!0);this.setEdit()};fyre.conv.view.CommentView.prototype.commentEditFailure=function(a){this.editMsgEditor.setErrorState(a.error_type)};fyre.conv.view.CommentView.prototype.handleEditCancel=function(){this.toggleEditButtonUI(!0)};
fyre.conv.view.CommentView.prototype.disposeEditMsgEditor=function(){this.editMsgEditor.dispose();this.editMsgEditor=null;this.setEdit()};
fyre.conv.view.CommentView.prototype.handleLikeButtonClick=function(a){var b=this.hasUserLiked()?this.appContext.commentService.unlikeMessage:this.appContext.commentService.likeMessage;a.preventDefault();this.appContext.authenticationService.ensureLogin(this.appContext.collectionService.collection(),goog.bind(function(){try{b.call(this.appContext.commentService,this.commentModel)}catch(a){switch(a){case fyre.conv.errors.LIKED_OWN_COMMENT:this.handleLikedOwnComment(a);break;default:throw a;}}},this))};
fyre.conv.view.CommentView.prototype.hasUserLiked=function(){var a=fyre.conv.model.Opine.ATTRIBUTES,b=this.commentModel.get(this.A_.LIKES),c=fyre.conv.user;return!c?!1:b.some(function(b){return c.id===b.get(a.AUTHOR_ID)?!0:!1})};fyre.conv.view.CommentView.prototype.handleLikedOwnComment=function(){var a=fyre.conv.i18n.textEnumeration,b=fyre.v1.ui.Alert.getInstance();b.setContent(a.get(a.KEYS.ERROR_LIKE_OWN_COMMENT));b.open()};
fyre.conv.view.CommentView.prototype.handleInsufficientPermissions=function(){var a=fyre.conv.i18n.textEnumeration,b=fyre.v1.ui.Alert.getInstance();b.setContent(a.get(a.KEYS.ERROR_INSUFFICIENT_PERMISSIONS));b.open()};
fyre.conv.view.CommentView.prototype.showReplyEditor=function(){var a=this.getElementByClass(fyre.conv.view.CommentView.CLASSES.EDITOR),b=!this.replyEditor;this.editMsgEditor&&this.disposeEditMsgEditor();if(b){var b=new fyre.v1.editor.EditorModel,c=fyre.conv.view.EditorConfig({postToButtons:this.appContext.appOpts.postToButtons,XX_UseSeamlessEditor:this.appContext.appOpts.XX_UseSeamlessEditor,editorCss:this.appContext.appOpts.editorCss});c[c.KEYS.FOLLOW_TOOLBAR]=!1;b.set(b.ATTRIBUTES.CONFIG,c);b.set(b.ATTRIBUTES.USERAUTH,
fyre.conv.user.get("id"));b.set(b.ATTRIBUTES.MEDIA,new fyre.v1.model.MediaCollection);b.set(b.ATTRIBUTES.POST_TYPE,b.POST_TYPE.REPLY);b.set(b.ATTRIBUTES.USER,fyre.conv.user);this.replyEditor=new fyre.conv.view.BaseEditorView(this.appContext,{parentId:this.commentModel.get(this.A_.ID),viewModel:b,stateKey:this.replyStateKey_});this.replyEditor.decorate(a,!0);this.replyEditor.editor.on(this.replyEditor.editor.EVENTS.SUBMITTED,this.handleReplySubmitted,this);a=!this.commentModel.isLiveblogPost();this.replyEditor.setAutoHide(a,
this.replyButton_.getElement());this.replyEditor.setResize(a);this.replyEditor.show();this.replyEditor.editor.focusAndPlaceCursorAtEnd(!0);this.replyEditor.editor.canBeSmall()}else this.replyEditor.isHidden()?(this.replyEditor.show(),this.replyEditor.editor.focusAndPlaceCursorAtEnd(!0),this.replyEditor.editor.canBeSmall()):this.replyEditor.hide();this.dispatchEvent(fyre.conv.comment.EVENTS.OPEN_REPLY_EDITOR)};
fyre.conv.view.CommentView.prototype.disposeReplyEditor=function(){this.replyEditor.dispose();this.replyEditor=null};fyre.conv.view.CommentView.prototype.handleReplyButtonClick=function(a){a.preventDefault();this.showReplyEditor();var b=this.replyEditor.editor,a=b.getContents();if(!fyre.v1.util.hasTextContent(a)){var c=this.author.toMention(),a=this.commentModel.getMentions();this.author.id!==fyre.conv.user.id&&!this.author.isFeed()&&b.mention(c);goog.array.forEach(a,function(a){a.id!==c.id&&b.mention(a)})}};
fyre.conv.view.CommentView.prototype.handleReplySubmitted=function(){var a=this.replyEditor.buildPostData();a.set(this.A_.PARENT_ID,this.commentModel.id);this.appContext.actionQueueService.enqueue(fyre.conv.service.ActionQueueService.ACTION_TYPES.POST,a);this.appContext.authenticationService.ensureLogin(this.appContext.collectionService.collection(),goog.bind(this.appContext.commentService.postMessage,this.appContext.commentService,a,goog.bind(this.commentReplySuccess,this),goog.bind(this.commentReplyFailure,
this)))};fyre.conv.view.CommentView.prototype.commentReplySuccess=function(){this.replyEditor.clear();!this.commentModel.isLiveblogPost()&&this.editorContainer_&&this.editorContainer_.hide()};fyre.conv.view.CommentView.prototype.commentReplyFailure=function(a){this.replyEditor.setErrorState(a.error_type)};fyre.conv.view.CommentView.prototype.handleShareButtonClick=function(a){a.preventDefault();a=this.appContext;a.dialog=this.dialog;var b=this.commentModel.getShareModel();a.shareService.getDelegate(b).show(b)};
fyre.conv.view.CommentView.prototype.handleFlagButtonClick=function(a){var b=fyre.conv.i18n.textEnumeration,c=this.author.get(this.author.ATTRIBUTES.DISPLAY_NAME),c=goog.string.subs(b.get(b.KEYS.FLAG_TITLE),c);a.preventDefault();this.dialog.addChild(new fyre.conv.view.FlagModal(this.author),!0);this.dialog.setTitle(c);this.dialog.open();this.dialog.setButtonText(b.get(b.KEYS.FLAG_CONFIRM_BTN),b.get(b.KEYS.FLAG_CANCEL_BTN));this.dialog.handleOkClick(goog.bind(function(a){var b=fyre.conv.i18n.textEnumeration,
c=this.dialog.getContent(),g=c.getByClass(fyre.conv.view.FlagModal.CLASSES.FLAG_FORM).element,g=goog.dom.forms.getFormDataMap(g).toObject();"none"==g.flagType[0]?(c.getByClass(fyre.conv.view.FlagModal.CLASSES.FLAG_ERROR).show("inline"),a.preventDefault(),a.stopPropagation()):(c=fyre.v1.ui.Alert.getInstance(),g={flagType:g.flagType[0],notes:g.notes[0],email:g.email[0]},g.messageId=this.commentModel.id,g.collectionId=this.collection_.id,this.appContext.commentService.flagMessage(g),this.dialog.close(),
c.setContent(b.get(b.KEYS.FLAG_SUCCESS_MSG)),c.open(),c.setColor(c.COLORS.GREEN),a.preventDefault())},this))};
fyre.conv.view.CommentView.prototype.handleCollapseToggle=function(a){var b=fyre.conv.view.CommentView.CLASSES,c=this.getElementByClass(b.DIVIDER),c=goog.dom.getChildren(c);a.preventDefault();this.collapsed?(goog.dom.classes.swap(c[0],b.EXPAND,b.COLLAPSE),c[1].innerHTML="",this.collapsed=!1):(goog.dom.classes.swap(c[0],b.COLLAPSE,b.EXPAND),c[1].innerHTML=fyre.templates.conv.comment.replycount({replies:this.descendentCount}),this.collapsed=!0);c[2].toggleClass(b.DIVIDER_NARROW);this.replyContainerDom_.showToggle()};
fyre.conv.view.CommentView.prototype.setEdit=function(){var a=this.isEditable();this.editComponent&&this.editComponent.dispose();a&&(this.editComponent=new fyre.conv.view.EditComponent(this.commentModel,this.collection_.get(this.collection_.ATTRIBUTES.EDIT_COMMENT_INTERVAL)),a=goog.dom.getChildren(this.commentBodyEl_),this.editComponent.render(a[a.length-1]),this.getHandler().listen(this.editComponent,this.editComponent.EVENTS.EDIT_CLICKED,this.handleEditButtonClick))};
fyre.conv.view.CommentView.prototype.isEditable=function(){var a=fyre.conv.user,b=a.get(a.ATTRIBUTES.MODERATOR),c=this.commentModel.get(this.A_.SOURCE);return!fyre.conv.view.EditComponent.isContentEditable(c)?!1:b?!0:!this.collection_.get(this.collection_.ATTRIBUTES.EDIT)||this.author.id!==a.get(a.ATTRIBUTES.ID)||this.collection_.get(this.collection_.ATTRIBUTES.PREMOD)&&this.commentModel.isApproved()?!1:!0};
fyre.conv.view.CommentView.prototype.setDateTimer=function(){var a,b=new Date,c;b.setDate(b.getDate()-1);a=this.updateDate();c=goog.bind(function(){a=this.updateDate(a)},this);b.getTime()<a.getTime()&&(this.dateInterval=setInterval(c,6E4))};fyre.conv.view.CommentView.prototype.parseDate_=function(a){var b;isNaN(a)?b=Date.parse(a):(b=new Date(0),b.setUTCSeconds(a));return b};
fyre.conv.view.CommentView.prototype.updateDate=function(a){var b=fyre.conv.i18n.textEnumeration,c,d,e,f,g,h=this.commentModel.get(this.A_.UPDATED_BY);c=this.commentModel.get(h&&h!=this.author.id?this.A_.UPDATED:this.A_.CREATED);this.commentModel.isFeed()&&(c=fyre.conv.model.FeedEntry.ATTRIBUTES,d=this.commentModel.get(this.A_.FEED_ENTRY),c=d.get(c.PUB_DATE)||d.get(c.CREATED_AT));c=this.parseDate_(c);d=this.commentModel.isTwitter()?fyre.v1.util.date.twitterDate:(d=this.appContext.commentService.getDatetimeOverride())||
fyre.v1.util.date.prettyDate;f=this.appContext.commentService.getDatetimeFormat();g=this.appContext.commentService.getMinutesUntilAbsoluteTime();e=d(c,g,f,this.getDateStrings());a&&e!==d(a,g,f)||(h&&h!=this.author.id&&(e=b.get(b.KEYS.MODERATOR_EDIT_TIMESTAMP)+" "+e),this.commentDateDom_.innerHTML=e);return c};
fyre.conv.view.CommentView.prototype.getDateStrings=function(){var a=fyre.conv.i18n.textEnumeration,b={};b["just now"]=a.get(a.KEYS.TIME_JUST_NOW);b["minute ago"]=a.get(a.KEYS.TIME_MINUTES_AGO);b["minutes ago"]=a.get(a.KEYS.TIME_MINUTES_AGO_PLURAL);b["hour ago"]=a.get(a.KEYS.TIME_HOURS_AGO);b["hours ago"]=a.get(a.KEYS.TIME_HOURS_AGO_PLURAL);b["day ago"]=a.get(a.KEYS.TIME_DAYS_AGO);b["days ago"]=a.get(a.KEYS.TIME_DAYS_AGO_PLURAL);return b};
fyre.conv.view.CommentView.prototype.setHasReplies=function(a){var b=fyre.conv.view.CommentView.CLASSES.HAS_REPLIES;a?goog.dom.classes.add(this.element_,b):goog.dom.classes.remove(this.element_,b)};fyre.conv.view.CommentView.prototype.setUserRating=function(a){var b=this.getElementByClass(fyre.conv.view.CommentView.CLASSES.USER_RATING),c=!1;a&&(c=!0);goog.style.showElement(b,c)};
fyre.conv.view.CommentView.prototype.isDeletable=function(){var a=fyre.conv.user;return a.get(a.ATTRIBUTES.MODERATOR)||this.author.id===a.id?!0:!1};fyre.conv.view.CommentView.prototype.isBanable=function(){var a=this.commentModel.get(this.A_.ANNOTATIONS)[this.A_.MODERATOR],b=fyre.conv.user;return this.author.isTwitter()||this.author.isFacebook()||this.author.isFeed()?!1:b.get(b.ATTRIBUTES.MODERATOR)&&!a&&this.author.id!==b.id?!0:!1};
fyre.conv.view.CommentView.prototype.isFlaggable=function(){var a=fyre.conv.user.id,b=this.commentModel.get(this.A_.AUTHOR).id;return a!==b};fyre.conv.view.CommentView.prototype.handleUserUpdated_=function(){this.isInDocument()&&(this.isMobile_?this.setFlagMobile():this.setActions(),this.setEdit())};
fyre.conv.view.CommentView.prototype.addMedia=function(a){var b=fyre.conv.model.MessageMedia.ATTRIBUTES;if(!(this.collection_.get(fyre.conv.model.Collection.ATTRIBUTES.MEDIA_DISPLAY)===fyre.conv.model.Collection.MEDIA_DISPLAY_TYPES.LINKS||a.get(b.TYPE)===fyre.conv.model.MessageMedia.EMBEDLY_TYPES.LINK))if(!goog.isFunction(this.appContext.appOpts.attachmentDelegate)||this.appContext.appOpts.attachmentDelegate(a.toJSON()))this._mediaThumbs&&2>this._mediaThumbs.getChildCount()?this.setExpandedMedia(a):
(this._expandedMedia&&!this._expandedMedia.model_.get(b.EXPANDABLE)&&(this._expandedMedia.dispose(),this._expandedMedia=null),a.get(b.EXPANDABLE)&&!this._expandedMedia&&this.setExpandedMedia(a))};fyre.conv.view.CommentView.prototype.setExpandedMedia=function(a){var b=fyre.conv.view.CommentView.CLASSES;this._expandedMedia&&this._expandedMedia.dispose();this._expandedMedia=new fyre.conv.view.ExpandedMedia(a);this._expandedMedia.decorate(this.getElementByClass(b.MEDIA_EXPANDED),!0)};
fyre.conv.view.CommentView.prototype.handleMediaThumbnailClick=function(a,b){this.setExpandedMedia(a);a.get(a.ATTRIBUTES.EXPANDABLE)||this._expandedMedia.showVideo(!1);b.preventDefault()};fyre.conv.view.CommentView.prototype.exitDocument=function(){fyre.conv.user.off(null,null,this);this.commentModel.off(null,null,this);fyre.conv.view.CommentView.superClass_.exitDocument.call(this)};
fyre.conv.view.CommentView.prototype.disposeInternal=function(){this.disposeReplyButton_();this.editorContainer_&&this.editorContainer_.dispose();this.editComponent&&this.editComponent.dispose();this.truncatedTextComponent&&this.truncatedTextComponent.dispose();window.clearInterval(this.dateInterval);this.dateInterval=null;this._mediaThumbs&&this._mediaThumbs.dispose();fyre.conv.view.CommentView.superClass_.disposeInternal.call(this)};fyre.conv.view.ThreadContainer=function(a,b,c){this.context=a;this.model_=b;this.A_=this.model_.ATTRIBUTES;this.dialog=c;this.visibleDescendents=0;this.model_.bind("change",this.handleModelChange,this);this.collection_=this.context.collectionService.collection();fyre.v1.ui.FyreComponent.call(this)};goog.inherits(fyre.conv.view.ThreadContainer,fyre.v1.ui.FyreComponent);
fyre.conv.view.ThreadContainer.CLASSES={ARTICLE:"fyre-comment-article",COMMENT_REPLIES:"fyre-comment-replies",COMMENT_WRAPPER:"fyre-comment-wrapper",DATE:"fyre-comment-date",DIVIDER:"fyre-comment-divider",EXPANDED:"fyre-liveblog-expanded",FOCUSED:"fyre-comment-focused",HIDING:"fyre-liveblog-hiding",LIVEBLOG_REPLIES:"fyre-liveblog-replies",OPENED:"fyre-liveblog-opened",REPLY_CONTAINER:"fyre-outer-comment-container",REPLY_INDENT:"fyre-comment-replies-indent"};fyre.conv.view.ThreadContainer.EVENTS={THREAD_VIS_CHANGED:"threadVisChanged"};
fyre.conv.view.ThreadContainer.prototype.createDom=function(){var a=this.model_.get(this.A_.ID);this.element_=goog.dom.createDom("article",{"class":fyre.conv.view.ThreadContainer.CLASSES.ARTICLE,"data-message-id":a,id:"fyre-message-"+a});this.$dom_=new fyre.v1.dom(this.element_);this.createDomInternal()};fyre.conv.view.ThreadContainer.prototype.getSoyData=function(){return{isLiveblogPost:this.model_.isLiveblogPost()}};
fyre.conv.view.ThreadContainer.prototype.createDomInternal=function(){var a=fyre.conv.view.ThreadContainer.CLASSES;this.$dom_.html(fyre.templates.conv.comment.threadContainer(this.getSoyData())).hide();this.replyContainerDom_=this.$dom_.getByClass(a.COMMENT_REPLIES)||this.$dom_.getByClass(a.LIVEBLOG_REPLIES);this.replyOuterContainerDom_=this.$dom_.getByClass(a.REPLY_CONTAINER);this.commentDom_=this.$dom_.getByClass(a.COMMENT_WRAPPER);this.dividerDom_=this.$dom_.getByClass(a.DIVIDER);this.renderComment();
this.setReplyIndentation();fyre.conv.view.ThreadContainer.superClass_.createDomInternal.call(this)};
fyre.conv.view.ThreadContainer.prototype.renderComment=function(){var a=fyre.conv.view.ThreadContainer.EVENTS;this.shouldRenderFull()?this.commentComp_||(this.commentComp_=new fyre.conv.view.CommentView(this.context,this.model_,this.dialog),this.commentComp_.setParent(this),this.commentComp_.decorate(this.commentDom_.element),this.commentDom_.show(),this.context.bus.trigger(fyre.conv.events.COMMENT_RENDERED,this),this.dispatchEvent(a.THREAD_VIS_CHANGED)):(this.commentComp_&&(this.context.trigger(fyre.conv.events.COMMENT_HIDDEN,
this),goog.events.unlisten(this.commentComp_,null,null),this.commentComp_.dispose(),this.commentComp_=null,this.dispatchEvent(a.THREAD_VIS_CHANGED)),this.commentDom_.hide(),this.dividerDom_.hide(),this.commentDom_.html(fyre.templates.conv.comment.deleted()),this.showTombstoneIfNec())};fyre.conv.view.ThreadContainer.prototype.disposeInternal=function(){this.collection_.off(null,null,this);this.model_.off(null,null,this);this.commentComp_&&this.commentComp_.dispose();fyre.conv.view.ThreadContainer.superClass_.disposeInternal.call(this)};
fyre.conv.view.ThreadContainer.prototype.shouldRenderFull=function(){var a=this.context.collectionService.authors().get(this.model_.get(this.A_.AUTHOR_ID)),b=this.model_.get(this.A_.BODY_HTML),c=fyre.v1.enums.content.visibility;if(!a||!b)return!1;a=fyre.conv.user.id===a.id;switch(this.model_.get(this.A_.VISIBILITY)){case c.NONE:return!1;case c.EVERYONE:return!0;case c.OWNER:return a;case c.GROUP:return fyre.conv.user.isModerator()||a;default:return goog.asserts.fail("Unknown visibility state"),!1}};
fyre.conv.view.ThreadContainer.prototype.showTombstoneIfNec=function(){!this.commentComp_&&this.visibleDescendents&&(this.commentDom_.show(),this.dividerDom_.show())};fyre.conv.view.ThreadContainer.prototype.handleModelChange=function(){this.isInDocument()&&!this.commentComp_!=!this.shouldRenderFull()&&this.renderComment()};
fyre.conv.view.ThreadContainer.prototype.show=function(a){this.forEachChild(function(a){a.show(!1,!1)});if(this.$dom_&&this.$dom_.isHidden()){var b=goog.style.getSize(this.element_).height;fyre.v1.util.browser.isMobile()&&(a=!1);a&&(this.$dom_.css({height:0}),this.$dom_.slideY(500,function(a){a.css({height:""})},0,b));this.$dom_.show();(a=this.commentComp_)&&a instanceof fyre.conv.view.CommentView&&a.setTruncatedText()}};fyre.conv.view.ThreadContainer.prototype.hide=function(){this.$dom_&&this.$dom_.hide()};
fyre.conv.view.ThreadContainer.prototype.isHidden=function(){return this.$dom_.isHidden()};fyre.conv.view.ThreadContainer.prototype.addChildAt=function(a,b,c){fyre.conv.view.ThreadContainer.superClass_.addChildAt.call(this,a,b,c);b=fyre.conv.view.ThreadContainer.EVENTS;this.getHandler().listen(a,b.THREAD_VIS_CHANGED,goog.partial(this.updateThreadVis,a));this.updateThreadVis(a)};fyre.conv.view.ThreadContainer.prototype.isThreadVisible=function(){return this.commentComp_?!0:!1};
fyre.conv.view.ThreadContainer.prototype.threadVisibleCount=function(){return this.visibleDescendents+(this.commentComp_?1:0)};fyre.conv.view.ThreadContainer.prototype.updateThreadVis=function(){var a=0,b=fyre.conv.view.ThreadContainer.EVENTS;this.forEachChild(function(b){a+=b.threadVisibleCount()});this.visibleDescendents=a;this.showTombstoneIfNec();this.dispatchEvent(b.THREAD_VIS_CHANGED)};fyre.conv.view.ThreadContainer.prototype.getContentElement=function(){return this.replyContainerDom_.element};
fyre.conv.view.ThreadContainer.prototype.setReplyIndentation=function(){var a=fyre.conv.view.ThreadContainer.CLASSES.REPLY_INDENT,b=fyre.conv.model.Collection.ATTRIBUTES;this.model_.get(this.A_.LEVEL)<this.collection_.get(b.NEST_LEVEL)?this.replyContainerDom_.addClass(a):this.replyContainerDom_.removeClass(a)};fyre.conv.view.ThreadContainer.prototype.setFocused=function(){this.$dom_.addClass(fyre.conv.view.ThreadContainer.CLASSES.FOCUSED)};
fyre.conv.view.ThreadContainer.prototype.removeFocused=function(){var a=fyre.conv.view.ThreadContainer.CLASSES;this.$dom_&&this.$dom_.removeClass(a.FOCUSED)};fyre.conv.view.CommentThreadContainer=function(a,b,c){fyre.conv.view.ThreadContainer.call(this,a,b,c);this.hasParent=!!this.model_.get(fyre.conv.model.Comment.ATTRIBUTES.PARENT_ID);b=fyre.conv.model.Collection.ATTRIBUTES;this.highVelocityMode_=a.collectionService.collection().get(b.HIGH_VELOCITY_MODE);this.dividerComp_=null;this.initTime_=1E3*(new Date).getTime()};goog.inherits(fyre.conv.view.CommentThreadContainer,fyre.conv.view.ThreadContainer);
fyre.conv.view.CommentThreadContainer.prototype.disposeInternal=function(){this.dividerComp_&&this.dividerComp_.dispose();this.dividerComp_=null;fyre.conv.view.CommentThreadContainer.superClass_.disposeInternal.call(this)};fyre.conv.view.CommentThreadContainer.prototype.handleCollapseToggle=function(a){a.stopPropagation();a.show?(this.replyOuterContainerDom_.show("block"),this.show()):(this.replyOuterContainerDom_.hide(),this.forEachChild(function(a){a.hide()}))};
fyre.conv.view.CommentThreadContainer.prototype.handleReplyEditorChange_=function(){this.dividerComp_.openDivider()};fyre.conv.view.CommentThreadContainer.prototype.isExpanded=function(){return!0};
fyre.conv.view.CommentThreadContainer.prototype.renderComment=function(){fyre.conv.view.CommentThreadContainer.superClass_.renderComment.call(this);if(this.commentComp_)if(this.dividerComp_)this.dividerComp_.setReplyCount(this.visibleDescendents);else{var a=fyre.conv.comment.EVENTS;this.dividerComp_=new fyre.conv.view.DividerComponent(this.visibleDescendents,this.highVelocityMode_,!this.hasParent);this.dividerComp_.decorate(this.dividerDom_.element);this.dividerComp_.setParent(this);this.getHandler().listen(this.dividerComp_,
a.REPLIES_TOGGLE,this.handleCollapseToggle);this.getHandler().listen(this.dividerComp_,a.VELOCITY_REPLIES_QUEUE_CLICK,this.handleVelocityRepliesShow);this.getHandler().listen(this.commentComp_,a.OPEN_REPLY_EDITOR,this.handleReplyEditorChange_)}};
fyre.conv.view.CommentThreadContainer.prototype.handleVelocityRepliesShow=function(){this.replyOuterContainerDom_.show("block");this.show();var a=this.children_[this.children_.length-1];goog.array.some(this.children_,function(b){if(b.$dom_.isHidden())return a=b,!0});var b=a.getElement(),c=fyre.v1.dom(b).getSiblingOrParent().element,b=goog.style.getPageOffset(c).y+goog.style.getSize(c).height-goog.style.getSize(b).height,c=document.body.scrollTop||document.documentElement.scrollTop,c=(goog.object.containsKey(window,
"innerHeight")?window.innerHeight:document.documentElement.offsetHeight)+c;b>c&&fyre.v1.util.scrollTo(b)};
fyre.conv.view.CommentThreadContainer.prototype.updateThreadVis=function(a){fyre.conv.view.CommentThreadContainer.superClass_.updateThreadVis.call(this,a);var b=fyre.conv.model.Comment.ATTRIBUTES,c=fyre.conv.service.STATE_ENUM_TRANSPORT,d=a.getModel(),c=d.get(b.TRANSPORT)===c.BOOTSTRAP,e=d.get(b.EVENT)<this.initTime_,b=fyre.conv.user.id===d.get(b.AUTHOR_ID),d=a.getParent(),d=d.getElement()?d.isHidden():!0,a=a.getElement()?a.isHidden():!0;goog.isDefAndNotNull(this.dividerComp_)&&(this.highVelocityMode_?
c||e?this.dividerComp_.setReplyCount(this.visibleDescendents):b?(this.dividerComp_.toggleDividerVelocity(),this.dividerComp_.setReplyCount(this.visibleDescendents)):a?d?this.dividerComp_.setReplyCount(this.visibleDescendents):this.dividerComp_.setStreamCount(this.visibleDescendents):this.dividerComp_.setReplyCount(this.visibleDescendents):this.dividerComp_.setReplyCount(this.visibleDescendents))};fyre.conv.widget.dialog={};fyre.conv.widget.dialog.EVENTS={FLAG_CONFIRMATION_MOBILE:"mobile_flag_confirmation"};fyre.conv.view.FlagMobileMenu=function(a){goog.ui.Component.call(this,a);this.i18nFlagNames=this.getStrings_();this.menuPopup_=this.currentComment_=this.lastElement_=null};goog.inherits(fyre.conv.view.FlagMobileMenu,goog.ui.Component);fyre.conv.view.FlagMobileMenu.prototype.createDom=function(){var a=this.getSoyData_(),a=goog.soy.renderAsElement(fyre.templates.conv.comment.flagMobileMenu,a);goog.style.showElement(a,!1);this.decorateInternal(a)};
fyre.conv.view.FlagMobileMenu.prototype.enterDocument=function(){fyre.conv.view.FlagMobileMenu.superClass_.enterDocument.call(this);var a=goog.events.EventType.CLICK,b=fyre.conv.view.FlagMobileMenu.FLAG_LINKS,c=fyre.v1.enums.content.flags,d=this.getHandler(),e;for(e in c)if(c.hasOwnProperty(e)){var f=c[e],g=goog.partial(this.handleFlagTypeClick_,f);d.listen(this.getElementByClass(b[f]),a,g)}};
fyre.conv.view.FlagMobileMenu.prototype.handleFlagTypeClick_=function(a,b){b.preventDefault();var c=fyre.conv.model.Comment.ATTRIBUTES,d=fyre.conv.model.Author.ATTRIBUTES,e=this.currentComment_.id,d=this.currentComment_.get(c.AUTHOR).get(d.DISPLAY_NAME),c=this.currentComment_.get(c.ID);this.getConfirmation_({messageId:e,collectionId:c,flagType:a,notes:null,email:null},d)};
fyre.conv.view.FlagMobileMenu.prototype.getConfirmation_=function(a,b){var c=fyre.v1.enums.content.flags,d=null;switch(a.flagType){case c.SPAM:d=this.i18nFlagNames.flagSpam;break;case c.OFFENSIVE:d=this.i18nFlagNames.flagOffensive;break;case c.DISAGREE:d=this.i18nFlagNames.flagDisagree;break;case c.OFFTOPIC:d=this.i18nFlagNames.flagOfftopic}this.showFromElement(this.lastElement_);this.lastElement_=null;this.dispatchEvent({type:fyre.conv.widget.dialog.EVENTS.FLAG_CONFIRMATION_MOBILE,data:a,flagName:d,
flaggedAuthor:b})};fyre.conv.view.FlagMobileMenu.prototype.getSoyData_=function(){return{strings:this.i18nFlagNames}};
fyre.conv.view.FlagMobileMenu.prototype.showFromElement=function(a,b){this.menuPopup_||(this.getElement(),this.menuPopup_=new goog.ui.Popup(this.getElement()),this.menuPopup_.setHideOnEscape(!0),this.menuPopup_.setAutoHide(!0));if(a===this.lastElement_)goog.style.showElement(this.getElement(),!1),this.currentComment_=this.lastElement_=null;else{var c=goog.positioning.Corner.TOP_LEFT,d=new goog.positioning.AnchoredPosition(a,goog.positioning.Corner.BOTTOM_LEFT);this.menuPopup_.setPinnedCorner(c);this.menuPopup_.setPosition(d);
this.menuPopup_.setVisible(!0);this.currentComment_=b;goog.style.showElement(this.getElement(),!0);this.lastElement_=a}};fyre.conv.view.FlagMobileMenu.FLAG_LINKS=function(a){var b=fyre.v1.enums.content.flags;a[b.SPAM]="fyre-flag-spam-link";a[b.OFFENSIVE]="fyre-flag-offensive-link";a[b.DISAGREE]="fyre-flag-disagree-link";a[b.OFFTOPIC]="fyre-flag-offtopic-link";return a}({});
fyre.conv.view.FlagMobileMenu.prototype.getStrings_=function(){var a=fyre.conv.i18n.textEnumeration,b=a.KEYS;return{flagOffensive:a.get(b.FLAG_OFFENSIVE),flagOffensiveTooltip:a.get(b.FLAG_OFFENSIVE_COMMENT_TOOLTIP),flagSpam:a.get(b.FLAG_SPAM),flagSpamTooltip:a.get(b.FLAG_SPAM_COMMENT_TOOLTIP),flagOfftopic:a.get(b.FLAG_OFFTOPIC),flagOfftopicTooltip:a.get(b.FLAG_OFFTOPIC_COMMENT_TOOLTIP),flagDisagree:a.get(b.FLAG_DISAGREE),flagDisagreeTooltip:a.get(b.FLAG_DISAGREE_COMMENT_TOOLTIP)}};
fyre.conv.view.FlagMobileMenu.prototype.disposeInternal=function(){fyre.conv.view.FlagMobileMenu.superClass_.disposeInternal.call(this);this.currentComment_=this.lastElement_=this.i18nFlagNames=null;this.menuPopup_.dispose()};fyre.conv.view.comment={};fyre.conv.view.comment.model={};fyre.conv.view.comment.model.CommentViewModel=function(){fyre.v1.model.Model.call(this)};goog.inherits(fyre.conv.view.comment.model.CommentViewModel,fyre.v1.model.Model);fyre.conv.view.comment.model.CommentViewModel.ATTRIBUTES=fyre.conv.view.comment.model.CommentViewModel.prototype.ATTRIBUTES={EXPANDED:"expanded"};fyre.v1.dom.fx={};fyre.v1.dom.fx.VariableVerticalDrawer=function(a,b,c,d){goog.fx.Animation.call(this,[0],[1],c,d);goog.asserts.assert(a);goog.asserts.assert(b);this.animEl=a;this.contentEl=b;this.endCallback_=goog.nullFunction()};goog.inherits(fyre.v1.dom.fx.VariableVerticalDrawer,goog.fx.Animation);fyre.v1.dom.fx.VariableVerticalDrawer.prototype.setEndCallback=function(a){this.endCallback_=a||goog.nullFunction};
fyre.v1.dom.fx.VariableVerticalDrawer.prototype.updateStyle=function(){var a=goog.style.getSize(this.contentEl).height*this.coords[0]/1;goog.style.setHeight(this.animEl,a)};fyre.v1.dom.fx.VariableVerticalDrawer.prototype.onAnimate=function(){this.updateStyle();fyre.v1.dom.fx.VariableVerticalDrawer.superClass_.onAnimate.call(this)};fyre.v1.dom.fx.VariableVerticalDrawer.prototype.onEnd=function(){this.updateStyle();fyre.v1.dom.fx.VariableVerticalDrawer.superClass_.onEnd.call(this);this.endCallback_()};
fyre.v1.dom.fx.VariableVerticalDrawer.prototype.onBegin=function(){this.updateStyle();fyre.v1.dom.fx.VariableVerticalDrawer.superClass_.onBegin.call(this)};fyre.conv.view.LiveBlogThreadContainer=function(a,b,c){fyre.conv.view.ThreadContainer.call(this,a,b,c);a=fyre.conv.view.comment.model.CommentViewModel.ATTRIBUTES;this.viewModel=new fyre.conv.view.comment.model.CommentViewModel;if(this.model_.isLiveblogPost())this.viewModel.on(fyre.v1.model.Model.attributeChangeEvent(a.EXPANDED),this.onExpansionStateChange_,this)};goog.inherits(fyre.conv.view.LiveBlogThreadContainer,fyre.conv.view.ThreadContainer);
fyre.conv.view.LiveBlogThreadContainer.prototype.disposeInternal=function(){this.viewModel.off(null,null,this);this.viewModel=null;fyre.conv.view.LiveBlogThreadContainer.superClass_.disposeInternal.call(this)};fyre.conv.view.LiveBlogThreadContainer.prototype.isExpanded=function(){return this.viewModel.get(fyre.conv.view.comment.model.CommentViewModel.ATTRIBUTES.EXPANDED)};
fyre.conv.view.LiveBlogThreadContainer.prototype.onExpansionStateChange_=function(){var a=fyre.conv.view.ThreadContainer.CLASSES;if(this.isExpanded()){this.replyContainerDom_.show();this.$dom_.addClass(a.EXPANDED);var b=new fyre.v1.dom.fx.VariableVerticalDrawer(this.replyOuterContainerDom_.element,this.replyContainerDom_.element,600);b.setEndCallback(goog.bind(function(){this.replyOuterContainerDom_.element.style.height="auto";this.$dom_.addClass(a.OPENED)},this));b.play();b=goog.soy.renderAsElement(fyre.templates.conv.comment.liveblogReplyArrow);
this.liveblogArrowDom_=new fyre.v1.dom(b);var c=this.replyContainerDom_.firstEl();goog.dom.insertSiblingBefore(b,c);this.dispatchEvent({type:fyre.conv.stream.EVENTS.REPLIES_EXPANDED,commentModel:this.model_,threadContainer:this})}else this.$dom_.removeClass(a.OPENED),this.$dom_.addClass(a.HIDING),this.replyOuterContainerDom_.resize(0,null,200,goog.bind(function(){this.$dom_.removeClass(a.HIDING);this.$dom_.removeClass(a.EXPANDED);this.liveblogArrowDom_.remove();this.replyContainerDom_.hide()},this))};
fyre.conv.view.LiveBlogThreadContainer.prototype.onReplyButtonClicked_=function(){var a=fyre.conv.view.comment.model.CommentViewModel.ATTRIBUTES,b=this.viewModel.get(a.EXPANDED);this.viewModel.set(a.EXPANDED,!b)};
fyre.conv.view.LiveBlogThreadContainer.prototype.renderComment=function(){fyre.conv.view.LiveBlogThreadContainer.superClass_.renderComment.call(this);if(this.commentComp_){(this.replyButton_=this.commentDom_.getByClass("fyre-comment-reply"))&&this.getHandler().listen(this.replyButton_.element,goog.events.EventType.CLICK,this.onReplyButtonClicked_);var a=goog.soy.renderAsElement(fyre.templates.conv.comment.liveblogTopDivider);goog.dom.insertChildAt(this.commentDom_.element,a,0)}};goog.structs.Node=function(a,b){this.key_=a;this.value_=b};goog.structs.Node.prototype.getKey=function(){return this.key_};goog.structs.Node.prototype.getValue=function(){return this.value_};goog.structs.Node.prototype.clone=function(){return new goog.structs.Node(this.key_,this.value_)};goog.structs.TreeNode=function(a,b){goog.structs.Node.call(this,a,b)};goog.inherits(goog.structs.TreeNode,goog.structs.Node);goog.structs.TreeNode.EMPTY_ARRAY_=[];goog.structs.TreeNode.prototype.parent_=null;goog.structs.TreeNode.prototype.children_=null;goog.structs.TreeNode.prototype.clone=function(){return new goog.structs.TreeNode(this.getKey(),this.getValue())};goog.structs.TreeNode.prototype.deepClone=function(){var a=this.clone();this.forEachChild(function(b){a.addChild(b.deepClone())});return a};
goog.structs.TreeNode.prototype.getParent=function(){return this.parent_};goog.structs.TreeNode.prototype.isLeaf=function(){return!this.getChildCount()};goog.structs.TreeNode.prototype.isLastChild=function(){var a=this.getParent();return Boolean(a&&this==goog.array.peek(a.getChildren()))};goog.structs.TreeNode.prototype.getChildren=function(){return this.children_||goog.structs.TreeNode.EMPTY_ARRAY_};goog.structs.TreeNode.prototype.getChildAt=function(a){return this.getChildren()[a]||null};
goog.structs.TreeNode.prototype.getChildCount=function(){return this.getChildren().length};goog.structs.TreeNode.prototype.getDepth=function(){for(var a=0,b=this;b.getParent();)a++,b=b.getParent();return a};goog.structs.TreeNode.prototype.getAncestors=function(){for(var a=[],b=this.getParent();b;)a.push(b),b=b.getParent();return a};goog.structs.TreeNode.prototype.getRoot=function(){for(var a=this;a.getParent();)a=a.getParent();return a};
goog.structs.TreeNode.prototype.getSubtreeKeys=function(){var a=[];this.forEachChild(function(b){a.push(b.getKey());b.isLeaf()||a.push(b.getSubtreeKeys())});return a};goog.structs.TreeNode.prototype.contains=function(a){do a=a.getParent();while(a&&a!=this);return Boolean(a)};
goog.structs.TreeNode.findCommonAncestor=function(a){var b=arguments[0];if(!b)return null;for(var c=b.getDepth(),d=1;d<arguments.length;d++)for(var e=arguments[d],f=e.getDepth();e!=b;)f<=c&&(b=b.getParent(),c--),f>c&&(e=e.getParent(),f--);return b};goog.structs.TreeNode.prototype.forEachChild=function(a,b){goog.array.forEach(this.getChildren(),a,b)};goog.structs.TreeNode.prototype.forEachDescendant=function(a,b){goog.array.forEach(this.getChildren(),function(c){a.call(b,c);c.forEachDescendant(a,b)})};
goog.structs.TreeNode.prototype.traverse=function(a,b){!1!==a.call(b,this)&&goog.array.forEach(this.getChildren(),function(c){c.traverse(a,b)})};goog.structs.TreeNode.prototype.setParent=function(a){this.parent_=a};goog.structs.TreeNode.prototype.addChild=function(a){this.addChildAt(a,this.children_?this.children_.length:0)};
goog.structs.TreeNode.prototype.addChildAt=function(a,b){goog.asserts.assert(!a.getParent());a.setParent(this);this.children_=this.children_||[];goog.asserts.assert(0<=b&&b<=this.children_.length);goog.array.insertAt(this.children_,a,b)};
goog.structs.TreeNode.prototype.replaceChildAt=function(a,b){goog.asserts.assert(!a.getParent(),"newChild must not have parent node");var c=this.getChildren(),d=c[b];goog.asserts.assert(d,"Invalid child or child index is given.");d.setParent(null);c[b]=a;a.setParent(this);return d};goog.structs.TreeNode.prototype.replaceChild=function(a,b){return this.replaceChildAt(a,goog.array.indexOf(this.getChildren(),b))};
goog.structs.TreeNode.prototype.removeChildAt=function(a){var b=this.children_&&this.children_[a];return b?(b.setParent(null),goog.array.removeAt(this.children_,a),0==this.children_.length&&delete this.children_,b):null};goog.structs.TreeNode.prototype.removeChild=function(a){return this.removeChildAt(goog.array.indexOf(this.getChildren(),a))};goog.structs.TreeNode.prototype.removeChildren=function(){this.children_&&goog.array.forEach(this.children_,function(a){a.setParent(null)});delete this.children_};fyre.conv.view.StreamView=function(a,b){fyre.v1.ui.FyreComponent.call(this,b);this.context=a;this.commentTree_=new goog.structs.TreeNode(null,this);this.nodeIndex_={};this.sortedComments_=[];this.bottomVisibleComment_=this.topVisibleComment_=null;this.hiddenComments_=[];this.threadContainerFunction=this.context.collectionService.collection().isLiveBlog()?fyre.conv.view.LiveBlogThreadContainer:fyre.conv.view.CommentThreadContainer;this.opines={};this.direction_=this.DIR.NEW;this.dialog=fyre.v1.ui.Dialog.getInstance();
this.resetInitTime_()};goog.inherits(fyre.conv.view.StreamView,fyre.v1.ui.FyreComponent);fyre.conv.view.StreamView.DIR=fyre.conv.view.StreamView.prototype.DIR=fyre.v1.enums.content.direction;fyre.conv.view.StreamView.TARGET_SIZE=fyre.conv.view.StreamView.prototype.TARGET_SIZE=100;fyre.conv.view.StreamView.MIN_SIZE=fyre.conv.view.StreamView.prototype.MIN_SIZE=50;fyre.conv.view.StreamView.CLASSES={MENU_CONTAINER:"fyre-stream-menu-container"};
fyre.conv.view.StreamView.prototype.createDomInternal=function(){fyre.conv.view.StreamView.superClass_.createDomInternal.call(this);this.menuContainerEl_=goog.dom.getElementByClass(fyre.conv.view.StreamView.CLASSES.MENU_CONTAINER,this.$dom_.getParent().element)};fyre.conv.view.StreamView.prototype.enterDocument=function(){this.getHandler().listen(this,fyre.conv.comment.EVENTS.FLAG_MOBILE_CLICK,this.showFlagMobileMenu_);fyre.conv.view.StreamView.superClass_.enterDocument.call(this)};
fyre.conv.view.StreamView.prototype.setShowMore=goog.nullFunction;fyre.conv.view.StreamView.prototype.resetInitTime_=function(){this.initTime=(new Date).getTime()/1E3};fyre.conv.view.StreamView.prototype.isAncestorCollapsed_=function(a){return(a=this.nodeIndex_[a])&&!a.getValue().isExpanded()};
fyre.conv.view.StreamView.prototype.handleMessage=function(a,b,c){var d=fyre.conv.model.Comment.ATTRIBUTES,e=a.get(d.ANCESTOR_ID);e&&e!==a.id&&this.isAncestorCollapsed_(e)?this.handleCollapsedAncestorCount(a):this.nodeIndex_[a.get(d.ID)]?this.updateComment(a,b):this.addComment(a,b,c)};
fyre.conv.view.StreamView.prototype.handleCollapsedAncestorCount=function(a){var b=0,c=fyre.conv.model.Comment.ATTRIBUTES,d=fyre.v1.enums.content.visibility,e=c.LAST_VISIBILITY,f=a.get(c.VISIBILITY)!=d.NONE,d=a.get(e)!=d.NONE;f&&!d?b=1:!f&&d&&(b=-1);a=a.get(c.ANCESTOR_ID);(f=this.nodeIndex_[a])||(f=this.makeShadowNode(a));a=f.getValue().getModel();c=c.DESCENDENT_COUNT;(f=a.get(c))||(f=0);a.set(c,Math.max(f+b,0))};
fyre.conv.view.StreamView.prototype.handleOpine=function(a){var b=a.ATTRIBUTES,c=a.get(a.ATTRIBUTES.ID),d,e;(d=a.get(b.TARGET_ID)?this.nodeIndex_[a.get(b.TARGET_ID)]:this.opines[c])||(d=this.makeShadowNode(a.get(b.TARGET_ID)));e=d.getValue().getModel().get(d.getValue().getModel().ATTRIBUTES.LIKES);a.get(b.VISIBILITY)!==a.VISIBILITY.EVERYONE?(e.remove(c),delete this.opines[c]):(a.get(b.AUTHOR)||a.set(b.AUTHOR,this.context.collectionService.authors().get(a.get(b.AUTHOR_ID))),a.get(b.AUTHOR)&&!this.isDupOpine_(e,
a)&&(e.add(a),this.opines[c]=d))};fyre.conv.view.StreamView.prototype.isDupOpine_=function(a,b){var c=b.ATTRIBUTES;return a.some(function(a){var e=a.get(c.TARGET_ID),a=a.get(c.AUTHOR_ID);return e===b.get(c.TARGET_ID)&&a===b.get(c.AUTHOR_ID)?!0:!1})};fyre.conv.view.StreamView.prototype.handleMedia=function(a){if(a){var b=a.ATTRIBUTES,c=this.nodeIndex_[a.get(b.TARGET_ID)];c||(c=this.makeShadowNode(a.get(b.TARGET_ID)));b=c.getValue().getModel();try{b.get(b.ATTRIBUTES.MEDIA).add(a)}catch(d){}}};
fyre.conv.view.StreamView.prototype.clear=function(){this.commentTree_.removeChildren();this.nodeIndex_={};this.hiddenComments_=[];this.topVisibleComment_=this.bottomVisibleComment_=null;for(this.sortedComments_=[];this.hasChildren();)this.removeChildAt(0).dispose()};fyre.conv.view.StreamView.prototype.hide=function(){this.$dom_.hide()};fyre.conv.view.StreamView.prototype.show=function(){this.$dom_.show("block")};
fyre.conv.view.StreamView.prototype.fadeInAndShow=function(a){a=goog.isNumber(a)?a:300;(new goog.fx.dom.FadeInAndShow(this.$dom_.element,a)).play()};
fyre.conv.view.StreamView.prototype.updateComment=function(a,b){var c=fyre.conv.model.Comment.ATTRIBUTES,d=a.get(c.ID),e=this.nodeIndex_[d];e||goog.asserts.fail("Cannot update a comment that does not already exist");var f=e.getValue().getModel();f.get(c.ID)!=d?f.set(c.AUTHOR,a.get(c.AUTHOR)):(a.unset(c.LIKES),a.unset(c.MEDIA),f.merge(a),e.getParent()||this.addNodeToTree_(e,b),this.showCommentConditional(this.nodeIndex_[f.id],b))};
fyre.conv.view.StreamView.prototype.getComment_=function(a){return(a=this.nodeIndex_[a.ATTRIBUTES?a.get(a.ATTRIBUTES.ID):a])?a.getValue().getModel():null};
fyre.conv.view.StreamView.prototype.addComment=function(a,b,c){var d=a.ATTRIBUTES,e=a.get(d.PARENT_ID);e&&!this.nodeIndex_[e]&&this.makeShadowNode(e);var f=new this.threadContainerFunction(this.context,a,this.dialog),f=this.addNodeToTree_(new goog.structs.TreeNode(a.get(d.ID),f),b);this.showCommentConditional(f,b,c);this.hideLastChildDivider(f);e||goog.array.binaryInsert(this.sortedComments_,a,function(a,b){return a.get(d.EVENT)<b.get(d.EVENT)?-1:a.get(d.EVENT)>b.get(d.EVENT)?1:0})};
fyre.conv.view.StreamView.prototype.hideLastChildDivider=function(){};
fyre.conv.view.StreamView.prototype.highlightComment=function(a,b){if(a){var c=this.nodeIndex_[a];if(c&&(c=c.getValue())&&c.element_&&!c.isHidden()){c.setFocused();var d=c.element_,e=document.documentElement.clientHeight,f=d.offsetTop-(e-(d.children?d.children[0]:d).offsetHeight)/2;for(d.children[0].offsetHeight>e&&(f=d.offsetTop-e/4);d.offsetParent;)f+=d.offsetParent.offsetTop,d=d.offsetParent;goog.userAgent.IE?window.scrollTo(0,f):(e=2E3>Math.abs(window.scrollY-f)?300:1E3,goog.userAgent.GECKO&&
(d=document.getElementsByTagName("html")[0]),(new goog.fx.dom.Scroll(d,[0,window.scrollY],[0,f],e)).play(),goog.isNumber(b)&&setTimeout(goog.bind(c.removeFocused,c),b))}}};
fyre.conv.view.StreamView.prototype.makeShadowNode=function(a){var b=new fyre.conv.model.Comment;b.set(b.ATTRIBUTES.ID,a);b.set(b.ATTRIBUTES.VISIBILITY,b.VISIBILITY.NONE);b.set(b.ATTRIBUTES.COLLECTION,this.context.collectionService.collection());this.nodeIndex_[a]=new goog.structs.TreeNode(a,new this.threadContainerFunction(this.context,b,this.dialog));return this.nodeIndex_[a]};
fyre.conv.view.StreamView.prototype.calcDomInsertIndex=function(a,b){var c=0;goog.array.forEachRight(a.getChildren(),function(a,e){var f=0;e<b&&a.getValue().getElement()&&(f=1);c+=f});return c};
fyre.conv.view.StreamView.prototype.addNodeToTree_=function(a,b){var c=a.getValue(),d=c.getModel(),e=d.ATTRIBUTES,f=d.get(e.ID),g=d.get(e.PARENT_ID),e=this.initTime>d.get(e.CREATED);if(g=g?this.nodeIndex_[g]:this.commentTree_){var h=this.calcInsertIndex(g,d);d.set(d.ATTRIBUTES.LEVEL,g.getDepth());g.addChildAt(a,h);d=this.isNodeContainedInTree(g);g.getValue().addChildAt(a.getValue(),this.calcDomInsertIndex(g,h),d);b&&d&&!e&&this.context.trigger(fyre.conv.events.MESSAGE_ADDED_TO_DOM,c);return this.nodeIndex_[f]=
a}};fyre.conv.view.StreamView.prototype.getContentElement=function(){return this.streamContentDom_.element};fyre.conv.view.StreamView.prototype.showCommentConditional=function(a,b,c){var d=fyre.conv.model.Comment,e=a.getValue(),f=e.getModel(),g=this.initTime>f.get(d.CREATED);f.get(d.PARENT_ID);a=a.getParent();c=c&&!g;e.getElement()&&(a!==this.commentTree_&&a.getValue().isHidden()&&this.showCommentConditional(a,b,!1),b||(e.show(c),this.updateVisTracking(f)))};
fyre.conv.view.StreamView.prototype.updateVisTracking=function(a){var b=fyre.conv.model.Comment.ATTRIBUTES,c=fyre.v1.enums.content.visibility;if(!(a.get(b.PARENT_ID)||a.get(b.VISIBILITY)!==c.EVERYONE)){var d=a.get(b.EVENT),c=this.topVisibleComment_?this.topVisibleComment_.get(b.EVENT)<d:!0,b=this.bottomVisibleComment_?this.bottomVisibleComment_.get(b.EVENT)>d:!0;this.direction_!=this.DIR.NEW&&(c=this.topVisibleComment_?!c:!0,b=this.bottomVisibleComment_?!b:!0);c&&(this.topVisibleComment_=a.clone());
b&&(this.bottomVisibleComment_=a.clone())}};fyre.conv.view.StreamView.prototype.calcInsertIndex=function(a,b){var c=fyre.conv.model.Comment.ATTRIBUTES,d=b.get(c.CREATED),e=a.getChildren(),f=a===this.commentTree_&&this.direction_===this.DIR.NEW;a.getValue()instanceof fyre.conv.view.LiveBlogThreadContainer&&(f=!0);f&&(e=goog.array.clone(e),e.reverse());var g=goog.array.binarySelect(e,function(a){a=a.getValue().getModel();return d<=a.get(c.CREATED)?-1:1}),g=0>g?~g:g;return f?e.length-g:g};
fyre.conv.view.StreamView.prototype.isNodeContainedInTree=function(a){return a.getRoot()==this.commentTree_};fyre.conv.view.StreamView.prototype.showFlagMobileMenu_=function(a){if(!this.flagMobileMenu_||this.flagMobileMenu_.isDisposed())this.flagMobileMenu_=new fyre.conv.view.FlagMobileMenu,this.addChild(this.flagMobileMenu_),this.flagMobileMenu_.render(this.menuContainerEl_);var b=a.target.getElement();this.flagMobileMenu_.showFromElement(goog.dom.getFirstElementChild(b),a.comment)};fyre.conv.view.CommentStreamView=function(a,b,c){if(goog.isBoolean(b)?b:1)this.showMoreComponent_=new fyre.conv.view.ShowMoreComponent,this.showMoreComponent_.setParent(this);this.highVelocityMode_=a.collectionService.collection().get(fyre.conv.model.Collection.ATTRIBUTES.HIGH_VELOCITY_MODE);this.highVelocityComp_=null;this.highVelocityMode_&&(this.highVelocityComp_=new fyre.conv.view.HighVelocityView);fyre.conv.view.StreamView.call(this,a,c)};goog.inherits(fyre.conv.view.CommentStreamView,fyre.conv.view.StreamView);
fyre.conv.view.CommentStreamView.CLASSES={CONTENT:"fyre-stream-content",SHOW_MORE:"fyre-stream-more"};
fyre.conv.view.CommentStreamView.prototype.getSoyData=function(){var a={},b=fyre.conv.i18n.textEnumeration;a.assetUrl=fyre.conv.config.servers.assets;a.displayShowMore=this.showMoreComponent_?!0:!1;var c,d;a.liveblogEnabled?(d=b.get(b.KEYS.LIVEBLOG_POSTS),c=b.get(b.KEYS.SHOW_MORE_LIVEBLOG)):(d=b.get(b.KEYS.COMMENTS),c=b.get(b.KEYS.SHOW_MORE));a.strings={showMoreLabel:c,commentsLabelTitleCase:fyre.v1.util.toTitleCase(d),showMore:b.get(b.KEYS.SHOW_MORE)};return a};
fyre.conv.view.CommentStreamView.prototype.createDomInternal=function(){fyre.conv.view.CommentStreamView.superClass_.createDomInternal.call(this);var a=fyre.conv.view.CommentStreamView.CLASSES;this.$dom_.html(fyre.templates.conv.misc.commentStream(this.getSoyData()));this.streamContentDom_=this.$dom_.getByClass(a.CONTENT);this.showMoreComponent_&&(this.showMoreDom_=this.$dom_.getByClass(a.SHOW_MORE).hide(),this.showMoreComponent_.decorate(this.showMoreDom_.element));this.highVelocityMode_&&(this.highVelocityComp_.renderBefore(this.streamContentDom_.element),
this.highVelocityComp_.setParent(this),this.highVelocityComp_.hide())};
fyre.conv.view.CommentStreamView.prototype.findShowableContent=function(){var a=fyre.v1.dom.pageYOffset(window),b=goog.dom.getViewportSize(window).height,c=[];if(0===this.hiddenComments_.length)return c;for(var d=null,d=null,e=function(c){return c.pageYOffset<a?-1:c.pageYOffset<a+b?0:1},f=goog.bind(function(){return goog.array.binarySelect(this.hiddenComments_,e,this)},this);-1<(d=f());)d=this.hiddenComments_.splice(d,1)[0],c.push(d.id);return c};
fyre.conv.view.CommentStreamView.prototype.updateHiddenComments=function(){var a=this.findShowableContent();goog.array.forEach(a,function(a){var c=this.nodeIndex_[a].getValue();c.show(!0,!0);this.updateVisTracking(c.getModel());this.context.trigger(fyre.conv.events.MESSAGE_DISPLAYED,a)},this)};
fyre.conv.view.CommentStreamView.prototype.shouldIntercept_=function(a){if(!this.highVelocityMode_)return!1;var b=fyre.conv.model.Comment.ATTRIBUTES,c=a.get(b.TRANSPORT)===fyre.conv.service.STATE_ENUM_TRANSPORT.STREAM,d=a.get(b.TRANSPORT)===fyre.conv.service.STATE_ENUM_TRANSPORT.STREAM_ARCHIVE,e=this.initTime>a.get(b.CREATED),a=a.get(b.AUTHOR_ID)===fyre.conv.user.id;return(c||d)&&!e&&!a};
fyre.conv.view.CommentStreamView.prototype.disposeInternal=function(){this.showMoreComponent_.dispose();this.highVelocityComp_&&this.highVelocityComp_.dispose();this.flagMobileMenu_=this.highVelocityComp_=this.showMoreComponent_=null;fyre.conv.view.CommentStreamView.superClass_.disposeInternal.call(this)};
fyre.conv.view.CommentStreamView.prototype.handleHighVelocity_=function(a){var b=a.getValue().getModel(),c=fyre.conv.model.Comment.ATTRIBUTES;if(!b.get(c.PARENT_ID)||this.highVelocityComp_.hasId(a.getParent().getValue().getModel().id)){var d=fyre.v1.enums.content.visibility,e=c.LAST_VISIBILITY,a=b.get(c.VISIBILITY)!==d.NONE,d=b.get(e)&&b.get(e)!==d.NONE,c=b.get(c.ANCESTOR_ID);a&&!d?this.highVelocityComp_.addId(b.id,c):!a&&d&&this.highVelocityComp_.removeId(b.id,c)}};
fyre.conv.view.CommentStreamView.prototype.showCommentConditional=function(a,b,c){var d=a.getValue();if(d.getElement()){var e=d.getModel();if(this.shouldIntercept_(e))this.handleHighVelocity_(a);else if(fyre.conv.view.CommentStreamView.superClass_.showCommentConditional.call(this,a,b,c),a=d.$dom_.getSiblingOrParent().firstEl()){a=goog.style.getPageOffset(a).y;b=fyre.v1.dom.pageYOffset(window);if(b<=a&&(d.show(c),this.updateVisTracking(e),this.innerHeight+b>a)){this.context.trigger(fyre.conv.events.MESSAGE_DISPLAYED,
e.id);return}goog.array.binaryInsert(this.hiddenComments_,{id:e.id,pageYOffset:a},function(a,b){return a.pageYOffset>b.pageYOffset?-1:1})}}};
fyre.conv.view.CommentStreamView.prototype.enterDocument=function(){var a=fyre.conv.stream.EVENTS,b=this.getHandler();this.showMoreComponent_&&b.listen(this.showMoreComponent_,a.SHOW_MORE,this.handleShowMore);this.highVelocityMode_?(b.listen(this.highVelocityComp_,a.SHOW_NEXT_CLICKED,this.handleShowNextClick_),b.listen(this.highVelocityComp_,a.STREAM_REFRESH_CLICKED,this.handleStreamRefreshClick_)):(b.listen(window,goog.events.EventType.SCROLL,this.handleScrollResize),b.listen(window,goog.events.EventType.RESIZE,
this.handleScrollResize));b.listen(this,a.REPLIES_EXPANDED,this.handleRepliesExpanded_);fyre.conv.view.CommentStreamView.superClass_.enterDocument.call(this)};fyre.conv.view.CommentStreamView.prototype.realEnterDocument=function(){this.dispatchEvent({type:fyre.conv.stream.EVENTS.STREAM_RENDERED,direction:fyre.conv.view.StreamView.DIR.NEW})};fyre.conv.view.CommentStreamView.prototype.handleRepliesExpanded_=function(a){a.commentStreamView=this};
fyre.conv.view.CommentStreamView.prototype.handleStreamRefreshClick_=function(a){a.target=this;this.clear();this.highVelocityComp_.clear();this.resetInitTime_()};
fyre.conv.view.CommentStreamView.prototype.handleShowNextClick_=function(){for(var a=fyre.conv.model.Comment.ATTRIBUTES,b=0,c,d,e=this.highVelocityComp_.getOrderedTopLevelIds();10>b;){c=e.shift();if(!c)break;d=this.nodeIndex_[c];d=d.getValue();d.show(!0,!1);d=d.getModel();var f=d.get(a.EVENT),g=0;this.topVisibleComment_&&(g=this.topVisibleComment_.get(a.EVENT));b++;f>g&&(this.topVisibleComment_=d);d=goog.array.clone(this.highVelocityComp_.getDescendantIds(c)||[]);goog.array.forEach(d,function(a){this.highVelocityComp_.removeId(a,
c)},this);this.highVelocityComp_.removeId(c)}};fyre.conv.view.CommentStreamView.prototype.handleScrollResize=function(){this.scrollTimer||(this.scrollTimer=window.setTimeout(goog.bind(function(){this.isDisposed()||(this.updateHiddenComments(),window.clearTimeout(this.scrollTimer),this.scrollTimer=null)},this),330))};fyre.conv.view.CommentStreamView.prototype.showShowMore=function(){this.showMoreDom_.show()};fyre.conv.view.CommentStreamView.prototype.hideShowMore=function(){this.showMoreDom_.hide()};
fyre.conv.view.CommentStreamView.prototype.changeSortOrder=function(a){this.clear();this.show();this.highVelocityComp_&&this.highVelocityComp_.clear();this.direction_=a};
fyre.conv.view.CommentStreamView.prototype.handleShowMore=function(a){a.preventDefault();a.stopPropagation();this.dispatchEvent({type:fyre.conv.stream.EVENTS.SHOW_MORE,childModel:this.commentTree_.getChildAt(this.commentTree_.getChildren().length-1).getValue().getModel(),direction:this.direction_,target:this,successCallback:goog.bind(this.handleShowMoreSuccess,this),failureCallback:goog.bind(this.handleShowMoreFailure,this)})};fyre.conv.view.CommentStreamView.prototype.handleShowMoreSuccess=function(){this.setShowMore()};
fyre.conv.view.CommentStreamView.prototype.handleShowMoreFailure=function(){this.showMoreComponent_.setRequestComplete();var a=fyre.conv.i18n.textEnumeration,b=new fyre.v1.ui.Alert;b.setColor(b.COLORS.RED);b.setContent(a.get(a.KEYS.ERROR_SHOW_MORE));b.open()};
fyre.conv.view.CommentStreamView.prototype.setShowMore=function(){if(this.showMoreComponent_){var a=this.commentTree_.getChildAt(this.commentTree_.getChildren().length-1);if(a){var b=this.context.contentService.hasMoreContent(a.getValue().getModel(),this.direction_);a&&b?this.showMoreComponent_.show():this.showMoreComponent_.hide()}else this.showMoreComponent_.hide()}};fyre.conv.view.ContentNotFoundComponent=function(a,b){this.displayType=a;goog.ui.Component.call(this,b)};goog.inherits(fyre.conv.view.ContentNotFoundComponent,goog.ui.Component);fyre.conv.view.ContentNotFoundComponent.CLASSES={REFRESH:"fyre-stream-refresh"};
fyre.conv.view.ContentNotFoundComponent.prototype.getSoyData=function(){var a=fyre.conv.model.Collection.TOP_CONTENT_DISPLAY_TYPES,b=fyre.conv.i18n.textEnumeration,c={},d=b.get(b.KEYS.HOT_THREADS_CONTENT_NOT_FOUND_MSG);this.displayType===a.TOP_COMMENTS&&(d=b.get(b.KEYS.TOP_COMMENTS_CONTENT_NOT_FOUND_MSG));c.strings={contentNotFoundMsg:d,refreshMsg:b.get(b.KEYS.TOP_CONTENT_REFRESH_MSG)};return c};
fyre.conv.view.ContentNotFoundComponent.prototype.decorateInternal=function(a){var b=fyre.conv.view.ContentNotFoundComponent.CLASSES;fyre.conv.view.ContentNotFoundComponent.superClass_.decorateInternal.call(this,a);this.getElement().innerHTML=fyre.templates.conv.misc.topContentStreamContentNotFound(this.getSoyData());this.refreshEl_=this.getElementByClass(b.REFRESH)};
fyre.conv.view.ContentNotFoundComponent.prototype.enterDocument=function(){fyre.conv.view.ContentNotFoundComponent.superClass_.enterDocument.call(this);this.getHandler().listen(this.refreshEl_,goog.events.EventType.CLICK,this.handleClick_)};fyre.conv.view.ContentNotFoundComponent.prototype.handleClick_=function(a){a.preventDefault();this.dispatchEvent({type:fyre.conv.stream.EVENTS.STREAM_REFRESH_CLICKED})};fyre.conv.view.BreakoutThreadContainer=function(a,b,c){fyre.conv.view.CommentThreadContainer.call(this,a,b,c)};goog.inherits(fyre.conv.view.BreakoutThreadContainer,fyre.conv.view.CommentThreadContainer);
fyre.conv.view.BreakoutThreadContainer.prototype.renderComment=function(){fyre.conv.view.BreakoutThreadContainer.superClass_.renderComment.call(this);if(this.commentComp_&&this.model_.isTopLevel()){var a=fyre.conv.i18n.textEnumeration,a={threadBreakoutButton:a.get(a.KEYS.THREAD_BREAKOUT_BUTTON)},a=goog.soy.renderAsElement(fyre.templates.conv.comment.threadBreakout,a);goog.dom.insertSiblingAfter(a,this.replyOuterContainerDom_.element);this.getHandler().listen(a,goog.events.EventType.CLICK,this.onThreadBreakOutClicked_)}};
fyre.conv.view.BreakoutThreadContainer.prototype.onThreadBreakOutClicked_=function(){this.dispatchEvent({type:fyre.conv.stream.EVENTS.ANIMATION_INIT,threadId:this.model_.id})};fyre.conv.view.TopContentStreamView=function(a,b,c){fyre.conv.view.StreamView.call(this,a,c);b===fyre.conv.model.Collection.TOP_CONTENT_DISPLAY_TYPES.HOT_THREADS&&(this.threadContainerFunction=fyre.conv.view.BreakoutThreadContainer);this.displayType=b};goog.inherits(fyre.conv.view.TopContentStreamView,fyre.conv.view.StreamView);fyre.conv.view.TopContentStreamView.CLASSES={CONTENT:"fyre-stream-content",CONTENT_LOADING:"fyre-content-loading",CONTENT_NOT_FOUND:"fyre-stream-content-not-found"};
fyre.conv.view.TopContentStreamView.prototype.createDomInternal=function(){var a=fyre.conv.view.TopContentStreamView.CLASSES;fyre.conv.view.TopContentStreamView.superClass_.createDomInternal.call(this);this.$dom_.html(fyre.templates.conv.misc.topContentStream());this.streamContentDom_=this.$dom_.getByClass(a.CONTENT);this.contentNotFoundDom_=this.$dom_.getByClass(a.CONTENT_NOT_FOUND).hide();this.spinnerEl_=this.getElementByClass(a.CONTENT_LOADING)};
fyre.conv.view.TopContentStreamView.prototype.hideSpinner=function(){goog.style.setStyle(this.spinnerEl_,"display","none")};fyre.conv.view.TopContentStreamView.prototype.showSpinner=function(){goog.style.setStyle(this.spinnerEl_,"display","block")};fyre.conv.view.TopContentStreamView.prototype.enterDocument=function(){fyre.conv.view.TopContentStreamView.superClass_.enterDocument.call(this);this.getHandler().listen(this,fyre.conv.stream.EVENTS.ANIMATION_INIT,this.handleAnimationInit_)};
fyre.conv.view.TopContentStreamView.prototype.handleAnimationInit_=function(a){a.stopPropagation();var b=this.getScrollCoordinates_(),c=2E3<b[0]-b[1]?1E3:300;this.scrollFx_(b,c);this.fadeOutAndHideFx_(c,goog.bind(function(){this.dispatchEvent({type:fyre.conv.stream.EVENTS.THREAD_BREAKOUT,threadId:a.threadId,successFn:goog.bind(this.hideSpinner,this)});this.showSpinner()},this))};
fyre.conv.view.TopContentStreamView.prototype.getScrollCoordinates_=function(){var a=window.scrollY,b=goog.dom.getElementByClass(fyre.conv.widget.ui.WidgetComponent.CLASSES.WIDGET),b=goog.style.getPageOffsetTop(b);return[a,b]};
fyre.conv.view.TopContentStreamView.prototype.fadeOutAndHideFx_=function(a,b){var c=new goog.fx.dom.FadeOutAndHide(this.streamContentDom_.element,a);c.onEnd=function(){goog.fx.dom.FadeOutAndHide.prototype.onEnd.call(c);goog.style.setStyle(c.element,{display:"block",opacity:"100"});b()};c.play()};
fyre.conv.view.TopContentStreamView.prototype.scrollFx_=function(a,b){var c=document.getElementsByTagName("body")[0],d=a[0],e=a[1];goog.userAgent.IE?window.scrollTo(0,e):(goog.userAgent.GECKO&&(c=document.getElementsByTagName("html")[0]),(new goog.fx.dom.Scroll(c,[0,d],[0,e],b)).play())};fyre.conv.view.TopContentStreamView.prototype.renderContentNotFoundDom=function(){this.initContentNotFoundComponent_()};
fyre.conv.view.TopContentStreamView.prototype.handleStreamRefresh_=function(a){a.stopPropagation();this.disposeContentNotFoundComponent_();this.dispatchEvent(fyre.conv.stream.EVENTS.SORT_ORDER_CHANGED)};
fyre.conv.view.TopContentStreamView.prototype.initContentNotFoundComponent_=function(){this.contentNotFoundComponent_=new fyre.conv.view.ContentNotFoundComponent(this.displayType);this.contentNotFoundComponent_.setParent(this);this.contentNotFoundDom_.show("block");this.contentNotFoundComponent_.decorate(this.contentNotFoundDom_.element);this.getHandler().listen(this.contentNotFoundComponent_,fyre.conv.stream.EVENTS.STREAM_REFRESH_CLICKED,this.handleStreamRefresh_)};
fyre.conv.view.TopContentStreamView.prototype.disposeContentNotFoundComponent_=function(){this.contentNotFoundComponent_&&this.contentNotFoundComponent_.dispose();this.contentNotFoundDom_&&this.contentNotFoundDom_.empty();this.getHandler().unlisten(this.contentNotFoundComponent_,fyre.conv.stream.EVENTS.STREAM_REFRESH_CLICKED,this.handleStreamRefresh_);this.contentNotFoundComponent_=null};
fyre.conv.view.TopContentStreamView.prototype.clear=function(){this.contentNotFoundComponent_&&this.disposeContentNotFoundComponent_();fyre.conv.view.TopContentStreamView.superClass_.clear.call(this)};
fyre.conv.view.TopContentStreamView.prototype.calcInsertIndex=function(a,b){var c=fyre.conv.model.Comment.ATTRIBUTES,d=a.getChildren(),e=this.getScore_(b),f=b.get(c.CREATED),g=goog.bind(function(a){var b=a.getValue().getModel(),a=this.getScore_(b),b=b.get(c.CREATED),b=e===a&&f>=b;return e>a||b?-1:1},this),d=goog.array.binarySelect(d,g);return 0>d?~d:d};
fyre.conv.view.TopContentStreamView.prototype.getScore_=function(a){var b=fyre.conv.model.Comment.ATTRIBUTES,c=fyre.conv.model.Comment.ANNOTATION_TYPES,d=c.SCORE;this.displayType===fyre.conv.model.Collection.TOP_CONTENT_DISPLAY_TYPES.HOT_THREADS&&a.isTopLevel()&&(d=c.THREAD_SCORE);return a.get(b.ANNOTATIONS)[d]||0};
fyre.conv.view.TopContentStreamView.prototype.hideLastChildDivider=function(a){if(this.displayType!==fyre.conv.model.Collection.TOP_CONTENT_DISPLAY_TYPES.TOP_COMMENTS){for(;!(a.getParent()===this.commentTree_);)a=a.getParent();var a=a.getValue().getElementsByClass(fyre.conv.view.ThreadContainer.CLASSES.DIVIDER),b=a.length,c=2<b?b-4:-1;goog.style.showElement(a[b-2],!1);-1<c&&goog.style.showElement(a[c],!0)}};fyre.conv.view.PermalinkStreamView=function(a,b){fyre.conv.view.StreamView.call(this,a,b)};goog.inherits(fyre.conv.view.PermalinkStreamView,fyre.conv.view.StreamView);fyre.conv.view.PermalinkStreamView.CLASSES={CLOSE_BUTTON:"fyre-permalink-close",CONTENT:"fyre-stream-content",HEADER:"fyre-permalink-header",DELETED_HEADER:"fyre-permalink-not-visible",MESSAGE:"fyre-permalink-message"};
fyre.conv.view.PermalinkStreamView.prototype.getSoyData=function(){var a=fyre.conv.i18n.textEnumeration,b={},a={permalinkHeader:a.get(a.KEYS.PERMALINK_HEADER)};b.strings=a;return b};
fyre.conv.view.PermalinkStreamView.prototype.createDomInternal=function(){var a=fyre.conv.view.PermalinkStreamView.CLASSES;fyre.conv.view.PermalinkStreamView.superClass_.createDomInternal.call(this);this.$dom_.html(fyre.templates.conv.misc.permalinkStream(this.getSoyData()));this.streamContentDom_=this.$dom_.getByClass(a.CONTENT);this.permalinkHeaderDom_=this.$dom_.getByClass(a.HEADER);this.permalinkMessageDom_=this.$dom_.getByClass(a.MESSAGE);this.permalinkCloseButtonDom_=this.$dom_.getByClass(a.CLOSE_BUTTON)};
fyre.conv.view.PermalinkStreamView.prototype.enterDocument=function(){this.getHandler().listen(this.permalinkCloseButtonDom_.element,goog.events.EventType.CLICK,this.handlePermalinkClose_);fyre.conv.view.PermalinkStreamView.superClass_.enterDocument.call(this)};
fyre.conv.view.PermalinkStreamView.prototype.start=function(a){this.context.contentService.isContentInHead(a)?this.dispose():(this.dispatchEvent({type:fyre.conv.stream.EVENTS.PAST_PERMALINK_INSERTED,commentId:a,highlightComment:goog.bind(this.highlightComment,this),handleData:goog.bind(this.handleData,this),target:this}),this.initialized_=!0)};
fyre.conv.view.PermalinkStreamView.prototype.handleData=function(){var a=fyre.conv.view.PermalinkStreamView.CLASSES,b=fyre.conv.i18n.textEnumeration;this.permalinkMessageDom_.html(b.get(b.KEYS.PERMALINK_HEADER));this.permalinkHeaderDom_.removeClass(a.DELETED_HEADER);this.streamContentDom_.show("block")};
fyre.conv.view.PermalinkStreamView.prototype.highlightComment=function(a){var b=fyre.conv.view.PermalinkStreamView.CLASSES,c=fyre.conv.i18n.textEnumeration,d=this.nodeIndex_[a];if(!d||!this.isNodeContainedInTree(d)||d.getValue().isHidden())this.streamContentDom_.hide(),this.permalinkHeaderDom_.addClass(b.DELETED_HEADER),this.permalinkMessageDom_.html(c.get(c.KEYS.PERMALINK_HEADER_DELETED));this.show();fyre.conv.view.PermalinkStreamView.superClass_.highlightComment.call(this,a,6E3)};
fyre.conv.view.PermalinkStreamView.prototype.show=function(){goog.style.setStyle(this.element_,"display","block")};fyre.conv.view.PermalinkStreamView.prototype.handlePermalinkClose_=function(){this.dispose()};fyre.conv.view.PermalinkStreamView.prototype.dispose=function(){this.wasDecorated_=!1;fyre.conv.view.PermalinkStreamView.superClass_.dispose.call(this)};
fyre.conv.view.PermalinkStreamView.prototype.showCommentConditional_=function(a,b,c){a.getValue().shouldRenderFull()&&fyre.conv.view.PermalinkStreamView.superClass_.showCommentConditional_.call(this,a,b,c)};fyre.conv.view.StreamHeaderView=function(a,b){goog.ui.Component.call(this,b);this.appContext=a};goog.inherits(fyre.conv.view.StreamHeaderView,goog.ui.Component);
fyre.conv.view.StreamHeaderView.CLASSES={BACK_BUTTON:"fyre-stream-sort-back",CONTENT_LOADING:"fyre-content-loading",FOLLOW_CONVERSATION:"fyre-follow-conversation",SORT_HOT_THREADS:"fyre-stream-sort-hot-threads",SORT_TOP_COMMENTS:"fyre-stream-sort-top-comments",SORT_NEWEST:"fyre-stream-sort-newest",SORT_OLDEST:"fyre-stream-sort-oldest",SORT_SELECTED:"fyre-stream-sort-selected",SORT_OPTIONS:"fyre-stream-sort-options"};fyre.conv.view.StreamHeaderView.DIR=fyre.v1.enums.content.direction;
fyre.conv.view.StreamHeaderView.prototype.setStreamViews=function(a){this.streamViews=a};
fyre.conv.view.StreamHeaderView.prototype.getSoyData=function(){var a={},b=fyre.conv.i18n.textEnumeration,c=this.appContext.collectionService,d=c.collection(),e=fyre.conv.model.Collection.ATTRIBUTES,f=fyre.conv.model.Collection.TOP_CONTENT_DISPLAY_TYPES,g=fyre.conv.user;a.liveblogEnabled=c.collection().isLiveBlog();a.notModerator=!g.get(g.ATTRIBUTES.MODERATOR);a.isFollowing=c.isFollowing(g.id);a.displayTopCommentsTab=d.get(e.TOP_CONTENT_DISPLAY)===f.TOP_COMMENTS;a.displayHotThreadsTab=d.get(e.TOP_CONTENT_DISPLAY)===
f.HOT_THREADS;a.strings={backButton:b.get(b.KEYS.HOT_THREADS_BACK_BUTTON),liveblogFollow:b.get(b.KEYS.LIVEBLOG_FOLLOW),liveblogUnfollow:b.get(b.KEYS.LIVEBLOG_UNFOLLOW),hotThreads:b.get(b.KEYS.HOT_THREADS),newest:b.get(b.KEYS.NEWEST),oldest:b.get(b.KEYS.OLDEST),sep:b.get(b.KEYS.SORT_SEP),topComments:b.get(b.KEYS.TOP_COMMENTS)};return a};
fyre.conv.view.StreamHeaderView.prototype.decorateInternal=function(a){fyre.conv.view.StreamHeaderView.superClass_.decorateInternal.call(this,a);a=fyre.conv.view.StreamHeaderView.CLASSES;this.getElement().innerHTML=fyre.templates.conv.misc.streamHeader(this.getSoyData());this.followerEl_=this.getElementByClass(a.FOLLOW_CONVERSATION);this.sortHotThreadsEl_=this.getElementByClass(a.SORT_HOT_THREADS)||null;this.sortTopCommentsEl_=this.getElementByClass(a.SORT_TOP_COMMENTS)||null;this.sortBackButtonEl_=
this.getElementByClass(a.BACK_BUTTON)||null;this.sortNewestEl_=this.getElementByClass(a.SORT_NEWEST);this.sortOldestEl_=this.getElementByClass(a.SORT_OLDEST);this.sortOptionsEl_=this.getElementByClass(a.SORT_OPTIONS);this.spinnerEl_=this.getElementByClass(a.CONTENT_LOADING);this.hideSpinner()};fyre.conv.view.StreamHeaderView.prototype.hideSpinner=function(){goog.style.showElement(this.spinnerEl_,!1)};
fyre.conv.view.StreamHeaderView.prototype.showSpinner=function(){goog.style.showElement(this.spinnerEl_,!0)};
fyre.conv.view.StreamHeaderView.prototype.enterDocument=function(){var a=this.getHandler();fyre.conv.user.on(fyre.conv.user.EVENTS.CHANGE,this.handleUserUpdated,this);a.listen(this.getElement(),goog.events.EventType.CLICK,this.handleClick_);this.streamViews.topContentStream&&(a.listen(this.streamViews.topContentStream,fyre.conv.stream.EVENTS.SORT_ORDER_CHANGED,this.handleRefreshStream_),a.listen(this.streamViews.topContentStream,fyre.conv.stream.EVENTS.THREAD_BREAKOUT,this.handleThreadBreakout_))};
fyre.conv.view.StreamHeaderView.prototype.handleClick_=function(a){a.preventDefault();this.processEvent_(a.target)};
fyre.conv.view.StreamHeaderView.prototype.processEvent_=function(a){var b=fyre.conv.view.StreamHeaderView.DIR;if(!(goog.dom.classes.has(a,fyre.conv.view.StreamHeaderView.CLASSES.SORT_SELECTED)||"A"!==a.tagName))if(a===this.followerEl_)this.handleFollowerToggle();else switch(this.toggleOptions_(a),this.showSpinner(),a){case this.sortBackButtonEl_:this.dispatchSortBackButtonEvent();break;case this.sortHotThreadsEl_:this.dispatchSortByHotThreadsEvent();break;case this.sortTopCommentsEl_:this.dispatchSortByMostLikesEvent();
break;case this.sortNewestEl_:this.dispatchSortOrderEvent(b.NEW);break;case this.sortOldestEl_:this.dispatchSortOrderEvent(b.OLD);break;default:goog.asserts.fail("Unsupported Sort Type...")}};
fyre.conv.view.StreamHeaderView.prototype.toggleOptions_=function(a){var b=fyre.conv.view.StreamHeaderView.CLASSES,c=[this.sortNewestEl_,this.sortOldestEl_];this.sortBackButtonEl_&&c.push(this.sortBackButtonEl_);this.sortHotThreadsEl_&&c.push(this.sortHotThreadsEl_);this.sortTopCommentsEl_&&c.push(this.sortTopCommentsEl_);goog.array.forEach(c,function(a){goog.dom.classes.remove(a,b.SORT_SELECTED)});goog.dom.classes.add(a,b.SORT_SELECTED)};
fyre.conv.view.StreamHeaderView.prototype.showBackButton_=function(a){goog.style.setStyle(this.sortOptionsEl_,"display",!a?"block":"none");this.sortBackButtonEl_&&goog.style.setStyle(this.sortBackButtonEl_,"display",a?"block":"none")};fyre.conv.view.StreamHeaderView.prototype.selectSortByNewest=function(){this.showBackButton_(!1);this.toggleOptions_(this.sortNewestEl_)};fyre.conv.view.StreamHeaderView.prototype.handleRefreshStream_=function(a){a.stopPropagation();this.processEvent_(this.sortNewestEl_)};
fyre.conv.view.StreamHeaderView.prototype.handleThreadBreakout_=function(a){goog.object.extend(a,{threadBreakoutStream:this.streamViews.threadBreakoutStream,successCallback:goog.bind(function(){a.successFn();this.showBackButton_(!0)},this)})};fyre.conv.view.StreamHeaderView.prototype.dispatchSortBackButtonEvent=function(){this.showBackButton_(!1);this.toggleOptions_(this.sortHotThreadsEl_);this.dispatchSortByHotThreadsEvent()};
fyre.conv.view.StreamHeaderView.prototype.dispatchSortOrderEvent=function(a){this.dispatchEvent({type:fyre.conv.stream.EVENTS.SORT_ORDER_CHANGED,stream:this.streamViews.stream,topContentStream:this.streamViews.topContentStream,direction:a,successCallback:goog.bind(this.hideSpinner,this)})};
fyre.conv.view.StreamHeaderView.prototype.dispatchSortByMostLikesEvent=function(){this.dispatchEvent({type:fyre.conv.stream.EVENTS.SORT_TOP_COMMENTS,stream:this.streamViews.stream,topContentStream:this.streamViews.topContentStream,noDataCallback:goog.bind(function(){this.streamViews.topContentStream.renderContentNotFoundDom()},this),successCallback:goog.bind(this.hideSpinner,this)})};
fyre.conv.view.StreamHeaderView.prototype.dispatchSortByHotThreadsEvent=function(){this.dispatchEvent({type:fyre.conv.stream.EVENTS.SORT_HOT_THREADS,stream:this.streamViews.stream,topContentStream:this.streamViews.topContentStream,noDataCallback:goog.bind(function(){this.streamViews.topContentStream.renderContentNotFoundDom()},this),successCallback:goog.bind(this.hideSpinner,this)})};
fyre.conv.view.StreamHeaderView.prototype.handleFollowerToggle=function(){var a=this.appContext.collectionService;a.collection();var b=fyre.conv.user.ATTRIBUTES,c=fyre.conv.user,d=fyre.conv.i18n.textEnumeration;c.id?(b=a.isFollowing(c.get(b.ID)),a.follow(!b),this.followerEl_.innerHTML=!b?d.get(d.KEYS.LIVEBLOG_UNFOLLOW):d.get(d.KEYS.LIVEBLOG_FOLLOW)):this.appContext.authenticationService.ensureLogin(goog.bind(this.handleFollowerToggle,this))};
fyre.conv.view.StreamHeaderView.prototype.handleUserUpdated=function(){var a=this.appContext.collectionService,b=a.collection(),c=fyre.conv.i18n.textEnumeration,d=fyre.conv.user.ATTRIBUTES,e=fyre.conv.user;this.followerEl_&&(!b.isLiveBlog()||fyre.conv.user.get(d.MODERATOR)?goog.style.showElement(this.followerEl_,!1):(this.followerEl_.innerHTML=a.isFollowing(e.id)?c.get(c.KEYS.LIVEBLOG_UNFOLLOW):c.get(c.KEYS.LIVEBLOG_FOLLOW),goog.style.showElement(this.followerEl_,!0)))};
fyre.conv.view.StreamHeaderView.prototype.disposeInternal=function(){fyre.conv.view.StreamHeaderView.superClass_.disposeInternal.call(this);fyre.conv.user.off(null,null,this)};fyre.conv.user.VIEW_EVENTS={LOGIN_CLICKED:"loginClick",LOGOUT_CLICKED:"logoutClick",PROFILE_CLICKED:"profClick",EDIT_PROFILE_CLICKED:"editClick"};fyre.conv.view.UserDetailComponent=function(a,b,c){this.disableAvatars_=b;this.model_=a;this.isOpen=!1;goog.ui.Component.call(this,c)};goog.inherits(fyre.conv.view.UserDetailComponent,goog.ui.Component);fyre.conv.view.UserDetailComponent.CLASSES={EDIT_PROFILE:"fyre-edit-profile-link",PROFILE:"fyre-user-profile-link",LOGOUT:"fyre-logout-link",WRAPPER_TOUCH:"fyre-box-mobile-touch",WRAPPER:"fyre-box-wrapper"};
fyre.conv.view.UserDetailComponent.prototype.getSoyData=function(){var a=fyre.conv.i18n.textEnumeration,b=fyre.conv.user.ATTRIBUTES,b={avatar:this.model_.get(b.AVATAR),displayName:this.model_.get(b.DISPLAY_NAME),moderator:this.model_.get(b.MODERATOR)},c=fyre.conv.user.get(fyre.conv.user.ATTRIBUTES.TOKEN);b.adminUrl=(fyre.conv.config.customNetwork?fyre.conv.config.servers.admin:fyre.conv.config.servers.web)+"/admin/comments/?lftoken="+encodeURIComponent(c);b.defaultAvatar=fyre.conv.config.defaultAvatar;
b.disableAvatars=this.disableAvatars_;b.strings={editProfile:a.get(a.KEYS.EDIT_PROFILE),notificationSettings:a.get(a.KEYS.NOTIFICATION_SETTINGS),siteAdmin:a.get(a.KEYS.SITE_ADMIN),signOut:a.get(a.KEYS.SIGN_OUT)};return b};fyre.conv.view.UserDetailComponent.prototype.createDom=function(){this.element_=goog.soy.renderAsElement(fyre.templates.conv.user.detail,this.getSoyData())};
fyre.conv.view.UserDetailComponent.prototype.enterDocument=function(){var a=fyre.conv.view.UserDetailComponent.CLASSES;this.logoutEl_=this.getElementByClass(a.LOGOUT);this.profileEl_=this.getElementByClass(a.PROFILE);this.editEl_=this.getElementByClass(a.EDIT_PROFILE);a=goog.events.EventType.CLICK;fyre.v1.util.browser.isMobile()?(this.getHandler().listen(this.element_,goog.events.EventType.TOUCHEND,this.handleTouch),this.getHandler().listen(this.element_,a,this.handleClickMobile_)):(this.getHandler().listen(this.logoutEl_,
a,this.handleClick),this.getHandler().listen(this.profileEl_,a,this.handleClick),this.getHandler().listen(this.editEl_,a,this.handleClick));fyre.conv.view.UserDetailComponent.superClass_.enterDocument.call(this)};
fyre.conv.view.UserDetailComponent.prototype.handleClick=function(a,b){var c;c=fyre.conv.user.VIEW_EVENTS;switch(b?b:a.currentTarget){case this.logoutEl_:c=c.LOGOUT_CLICKED;break;case this.profileEl_:c=c.PROFILE_CLICKED;break;case this.editEl_:c=c.EDIT_PROFILE_CLICKED;break;default:return}this.closeDropDown_();this.dispatchEvent({type:c,event:a});a.preventDefault()};
fyre.conv.view.UserDetailComponent.prototype.handleTouch=function(a){a.preventDefault();a.stopPropagation();this.isOpen?this.handleClick(a,a.getBrowserEvent().target.parentNode):(goog.dom.classes.add(this.element_,fyre.conv.view.UserDetailComponent.CLASSES.WRAPPER_TOUCH),this.isOpen=!0,this.setBodyTouchHandler_())};fyre.conv.view.UserDetailComponent.prototype.handleClickMobile_=function(a){a.preventDefault();a.stopPropagation()};
fyre.conv.view.UserDetailComponent.prototype.setBodyTouchHandler_=function(){this.getHandler().listen(document,goog.events.EventType.TOUCHEND,this.handleBodyTouch_)};fyre.conv.view.UserDetailComponent.prototype.handleBodyTouch_=function(a){a=a.getBrowserEvent().target;goog.dom.contains(this.element_,a)||this.closeDropDown_()};
fyre.conv.view.UserDetailComponent.prototype.closeDropDown_=function(){goog.dom.classes.remove(this.element_,fyre.conv.view.UserDetailComponent.CLASSES.WRAPPER_TOUCH);this.isOpen=!1;this.getHandler().unlisten(document,goog.events.EventType.TOUCHEND,this.handleBodyTouch_)};fyre.conv.view.UserDetailComponent.prototype.exitDocument=function(){this.editEl_=this.avatarEl_=this.logoutEl_=null;fyre.conv.view.UserDetailComponent.superClass_.exitDocument.call(this)};
fyre.conv.view.UserDetailComponent.prototype.disposeInternal=function(){this.model_=null;fyre.conv.view.UserDetailComponent.superClass_.disposeInternal.call(this)};fyre.conv.view.UserGuestComponent=function(a,b,c){this.model_=a;this.disableAvatars_=b||!1;goog.ui.Component.call(this,c)};goog.inherits(fyre.conv.view.UserGuestComponent,goog.ui.Component);fyre.conv.view.UserGuestComponent.CLASSES={LOGOUT:"fyre-logout-link"};
fyre.conv.view.UserGuestComponent.prototype.getSoyData=function(){var a=fyre.conv.user.ATTRIBUTES,b=fyre.conv.i18n.textEnumeration,a={displayName:this.model_.get(a.DISPLAY_NAME),avatar:this.model_.get(a.AVATAR)};a.defaultAvatar=fyre.conv.config.defaultAvatar;a.disableAvatars=this.disableAvatars_;a.strings={signOut:b.get(b.KEYS.SIGN_OUT)};return a};
fyre.conv.view.UserGuestComponent.prototype.createDom=function(){fyre.conv.view.UserGuestComponent.superClass_.createDom.call(this);this.element_=goog.soy.renderAsElement(fyre.templates.conv.user.guest,this.getSoyData())};fyre.conv.view.UserGuestComponent.prototype.enterDocument=function(){var a=fyre.conv.view.UserGuestComponent.CLASSES;this.getHandler().listen(this.getElementByClass(a.LOGOUT),goog.events.EventType.CLICK,this.handleLogout);fyre.conv.view.UserGuestComponent.superClass_.enterDocument.call(this)};
fyre.conv.view.UserGuestComponent.prototype.handleLogout=function(a){a.preventDefault();this.dispatchEvent({type:fyre.conv.user.VIEW_EVENTS.LOGOUT_CLICKED})};fyre.conv.view.UserAnonComponent=function(a,b){this.isGuestEnabled_=a;goog.ui.Component.call(this,b)};goog.inherits(fyre.conv.view.UserAnonComponent,goog.ui.Component);fyre.conv.view.UserAnonComponent.prototype.createDom=function(){this.element_=goog.soy.renderAsElement(fyre.templates.conv.user.anonymous)};fyre.conv.view.UserAnonComponent.prototype.enterDocument=function(){this.setMsg();this.getHandler().listen(this.element_,goog.events.EventType.CLICK,this.handleLogin);fyre.conv.view.UserAnonComponent.superClass_.enterDocument.call(this)};
fyre.conv.view.UserAnonComponent.prototype.handleLogin=function(a){a.preventDefault();this.dispatchEvent({type:fyre.conv.user.VIEW_EVENTS.LOGIN_CLICKED})};fyre.conv.view.UserAnonComponent.prototype.setMsg=function(){this.element_.innerHTML=fyre.conv.i18n.textEnumeration.get(this.isGuestEnabled_?fyre.conv.i18n.textEnumeration.KEYS.SIGN_IN_GUEST:fyre.conv.i18n.textEnumeration.KEYS.SIGN_IN)};fyre.conv.view.UserAnonComponent.prototype.disposeInternal=function(){fyre.conv.view.UserAnonComponent.superClass_.disposeInternal.call(this)};fyre.conv.view.UserView=function(a,b,c){this.isGuestEnabled_=a;this.disableAvatars_=b||!1;goog.ui.Component.call(this,c)};goog.inherits(fyre.conv.view.UserView,goog.ui.Component);fyre.conv.view.UserView.prototype.enterDocument=function(){this.handleUserStateChange();var a=fyre.conv.user;a.on(a.attributeChangeEvent(a.ATTRIBUTES.ID),this.handleUserStateChange,this);fyre.conv.view.UserView.superClass_.enterDocument.call(this)};
fyre.conv.view.UserView.prototype.handleUserStateChange=function(){this.removeChildren(!0);this.addChild(fyre.conv.user.id?fyre.conv.user.isGuest()?new fyre.conv.view.UserGuestComponent(fyre.conv.user,this.disableAvatars_):new fyre.conv.view.UserDetailComponent(fyre.conv.user,this.disableAvatars_):new fyre.conv.view.UserAnonComponent(this.isGuestEnabled_),!0)};fyre.conv.view.UserView.prototype.exitDocument=function(){fyre.conv.user.off(null,null,this);fyre.conv.view.UserView.superClass_.exitDocument.call(this)};fyre.v1.lib.html5={};
(function(a,b){function c(){var a=j.elements;return"string"==typeof a?a.split(" "):a}function d(a){var b={},d=a.createElement,e=a.createDocumentFragment,h=e();a.createElement=function(a){j.shivMethods||d(a);var c;c=b[a]?b[a].cloneNode():g.test(a)?(b[a]=d(a)).cloneNode():d(a);return c.canHaveChildren&&!f.test(a)?h.appendChild(c):c};a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+c().join().replace(/\w+/g,function(a){b[a]=d(a);h.createElement(a);
return'c("'+a+'")'})+");return n}")(j,h)}function e(a){var b;if(a.documentShived)return a;if(j.shivCSS&&!h){b=a.createElement("p");var c=a.getElementsByTagName("head")[0]||a.documentElement;b.innerHTML="x<style>article,aside,details,figcaption,figure,footer,header,hgroup,nav,section{display:block}audio{display:none}canvas,video{display:inline-block;*display:inline;*zoom:1}[hidden]{display:none}audio[controls]{display:inline-block;*display:inline;*zoom:1}mark{background:#FF0;color:#000}</style>";b=
!!c.insertBefore(b.lastChild,c.firstChild)}i||(b=!d(a));b&&(a.documentShived=b);return a}var f=/^<|^(?:button|form|map|select|textarea|object|iframe)$/i,g=/^<|^(?:a|b|button|code|div|fieldset|form|h1|h2|h3|h4|h5|h6|i|iframe|img|input|label|li|link|ol|option|p|param|q|script|select|span|strong|style|table|tbody|td|textarea|tfoot|th|thead|tr|ul)$/i,h,i;(function(){var c=b.createElement("a");c.innerHTML="<xyz></xyz>";(h="hidden"in c)&&"function"==typeof a.injectElementWithStyles&&a.injectElementWithStyles("#modernizr{}",
function(b){b.hidden=!0;h="none"==(a.getComputedStyle?a.getComputedStyle(b,null):b.currentStyle).display});i=1==c.childNodes.length||function(){try{b.createElement("a")}catch(a){return!0}var c=b.createDocumentFragment();return"undefined"==typeof c.cloneNode||"undefined"==typeof c.createDocumentFragment||"undefined"==typeof c.createElement}()})();var j={elements:"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",
shivCSS:!0,shivMethods:!0,type:"default",shivDocument:e};e(b)})(goog.global.window,goog.global.document);fyre.v1.util.pollCSSWidth=function(a,b){this.element_=a;this.width_=a.offsetWidth;this.classArr_=b;this.currentClass_=this.resizeTimer_=null;this.handleChange_(this.width_);this.handler_=new goog.events.EventHandler(this);this.handler_.listen(window,goog.events.EventType.RESIZE,this.handleResize_)};goog.inherits(fyre.v1.util.pollCSSWidth,goog.Disposable);
fyre.v1.util.pollCSSWidth.prototype.handleResize_=function(){this.resizeTimer_||(this.resizeTimer_=window.setTimeout(goog.bind(function(){this.checkWidth_();window.clearTimeout(this.resizeTimer_);this.resizeTimer_=null},this),3E3))};fyre.v1.util.pollCSSWidth.prototype.checkWidth_=function(){var a=this.element_.offsetWidth;a!==this.width_&&this.handleChange_(a)};
fyre.v1.util.pollCSSWidth.prototype.handleChange_=function(a){goog.array.some(this.classArr_,function(b){var c=goog.object.getAnyValue(b),b=goog.object.getAnyKey(b);if(c<a)return goog.dom.classes.addRemove(this.element_,this.currentClass_,b),this.currentClass_=b,this.width_=a,!0},this)};fyre.v1.util.pollCSSWidth.prototype.disposeInternal=function(){this.handler_.dispose();window.clearTimeout(this.resizeTimer_);this.element_=this.resizeTimer_=null;fyre.v1.util.pollCSSWidth.superClass_.disposeInternal.call(this)};fyre.conv.widget.ui.WidgetComponent=function(a,b){goog.ui.Component.call(this,b);this.appContext=a;var c=a.collectionService.followers(),d=a.collectionService.collection();this.livecount=new fyre.conv.view.LivecountView(c,a.livecountService.model,d.isLiveChat()||fyre.v1.util.browser.isMobile());this.addChild(this.livecount);a.appOpts.disableAvatars||(this.follower=new fyre.conv.view.FollowerViewContainer(c),this.addChild(this.follower));this.helper=new fyre.conv.view.HelpView;this.addChild(this.helper)};
goog.inherits(fyre.conv.widget.ui.WidgetComponent,goog.ui.Component);
fyre.conv.widget.ui.WidgetComponent.prototype.registerCollection=function(a,b){if(!this.isDisposed()){goog.asserts.assert(!this.collection_);this.collection_=b;var c=fyre.conv.model.Collection.ATTRIBUTES,d=b.get(c.GUEST);this.userView=new fyre.conv.view.UserView(d,a.appOpts.disableAvatars);this.addChild(this.userView);this.commentcount=new fyre.conv.view.CommentCountView(a.collectionService.collection());this.addChild(this.commentcount);d=fyre.v1.util.browser.isMobile()&&!goog.userAgent.product.IPAD;
c=b.get(c.HIGH_VELOCITY_MODE);!d&&!c&&(this.notifier=new fyre.conv.view.NotificationView(a,b.isLiveBlog()),this.addChild(this.notifier));this.permalinkStream=new fyre.conv.view.PermalinkStreamView(a);this.permalinkStream.setParent(this);this.streamHeader=new fyre.conv.view.StreamHeaderView(a);this.addChild(this.streamHeader);this.stream=new fyre.conv.view.CommentStreamView(a);this.stream.setParent(this.streamHeader);c={stream:this.stream};this.initTopContentDisplayViews_(a,b,c);this.streamHeader.setStreamViews(c);
this.editor=this.makeEditor_();this.editor.setParent(this)}};
fyre.conv.widget.ui.WidgetComponent.prototype.initTopContentDisplayViews_=function(a,b,c){var d=fyre.conv.model.Collection.TOP_CONTENT_DISPLAY_TYPES,b=b.get(fyre.conv.model.Collection.ATTRIBUTES.TOP_CONTENT_DISPLAY);b!==d.NONE&&(this.topContentStream=new fyre.conv.view.TopContentStreamView(a,b),this.topContentStream.setParent(this.streamHeader),c.topContentStream=this.topContentStream,b===d.HOT_THREADS&&(this.threadBreakoutStream=new fyre.conv.view.CommentStreamView(a,!1),this.threadBreakoutStream.setParent(this.streamHeader),
c.threadBreakoutStream=this.threadBreakoutStream))};fyre.conv.widget.ui.WidgetComponent.prototype.getSoyData=function(){return{trackingHost:fyre.conv.config.servers.tracking,trackingUrl:goog.string.urlEncode(window.location.href),disableAvatars:this.appContext.appOpts.disableAvatars,isLiveChat:this.collection_.isLiveChat(),isLiveBlog:this.collection_.isLiveBlog()}};
fyre.conv.widget.ui.WidgetComponent.CLASSES={AVATARS:"fyre-listener-avatars",BOOTSTRAP:"fyre-bootstrap",COMMENT_COUNT:"fyre-comment-count",COMMENT_STREAM:"fyre-comment-stream",EDITOR:"fyre-editor",HELPER:"fyre-help",TOP_CONTENT_STREAM:"fyre-top-content-stream",LIVECOUNT:"fyre-livecount",LOGIN_BAR:"fyre-login-bar",NOTIFIER:"fyre-notifier-container",PERMALINK_STREAM:"fyre-permalink-stream",STREAM_HEADER:"fyre-stream-header",THREAD_BREAKOUT_STREAM:"fyre-thread-breakout-stream",WIDGET:"fyre-widget",WRAPPER:"fyre"};
fyre.conv.widget.ui.WidgetComponent.WIDTH_ARRAY=[{"fyre-width-large":1024},{"fyre-width-medium":400},{"fyre-width-small":0}];
fyre.conv.widget.ui.WidgetComponent.prototype.createDom=function(){var a=fyre.conv.widget.ui.WidgetComponent.CLASSES;this.element_=goog.soy.renderAsElement(fyre.templates.conv.app.main,this.getSoyData());this.userViewEl_=this.getElementByClass(a.LOGIN_BAR);this.userView.decorate(this.userViewEl_);this.livecountEl_=this.getElementByClass(a.LIVECOUNT);this.livecount.decorate(this.livecountEl_);this.commentcountEl_=this.getElementByClass(a.COMMENT_COUNT);this.commentcount.decorate(this.commentcountEl_);
this.follower&&(this.followerEl_=this.getElementByClass(a.AVATARS),this.follower.decorate(this.followerEl_));this.notifier&&this.notifier.render(this.element_);this.helperEl_=this.getElementByClass(a.HELPER);this.helper.decorate(this.helperEl_);this.streamHeaderEl_=this.getElementByClass(a.STREAM_HEADER);this.streamHeader.decorate(this.streamHeaderEl_);this.commentStreamEl_=this.getElementByClass(a.COMMENT_STREAM);this.stream.decorate(this.commentStreamEl_,!0);this.topContentStream&&(this.topContentStreamEl_=
this.getElementByClass(a.TOP_CONTENT_STREAM),this.topContentStream.decorate(this.topContentStreamEl_,!0),this.threadBreakoutStream&&(this.threadBreakoutStreamEL_=this.getElementByClass(a.THREAD_BREAKOUT_STREAM),this.threadBreakoutStream.decorate(this.threadBreakoutStreamEL_,!0)));this.permalinkStreamEl_=this.getElementByClass(a.PERMALINK_STREAM);this.editorEl_=this.getElementByClass(a.EDITOR)};
fyre.conv.widget.ui.WidgetComponent.prototype.enterDocument=function(){fyre.conv.widget.ui.WidgetComponent.superClass_.enterDocument.call(this);this.editor.decorate(this.editorEl_,!0);this.collection_.on(this.collection_.attributeChangeEvent(this.collection_.ATTRIBUTES.COMMENTS_ENABLED),this.handleCommentsEnabledChange_,this);this.appContext.bus.subscribe(fyre.conv.events.RENDER_COMPLETE,this.handleRenderComplete_,this);this.cssPoller_=new fyre.v1.util.pollCSSWidth(this.element_,fyre.conv.widget.ui.WidgetComponent.WIDTH_ARRAY);
this.stream.realEnterDocument()};fyre.conv.widget.ui.WidgetComponent.prototype.exitDocument=function(){this.collection_.off(null,null,this);this.appContext.bus.unsubscribe(fyre.conv.events.RENDER_COMPLETE,this.handleRenderComplete_,this);fyre.conv.widget.ui.WidgetComponent.superClass_.exitDocument.call(this)};fyre.conv.widget.ui.WidgetComponent.prototype.handleRenderComplete_=function(){this.follower&&this.follower.handleRenderComplete();this.livecount.handleRenderComplete()};
fyre.conv.widget.ui.WidgetComponent.prototype.makeEditor_=function(){return new fyre.conv.view.EditorView(this.appContext,{postToButtons:this.appContext.appOpts.postToButtons,XX_UseSeamlessEditor:this.appContext.appOpts.XX_UseSeamlessEditor,collectionModel:this.collection_,editorCss:this.appContext.appOpts.editorCss})};fyre.conv.widget.ui.WidgetComponent.prototype.handleCommentsEnabledChange_=function(){this.editor.dispose();this.editor=this.makeEditor_();this.editor.decorate(this.editorEl_,!0)};
fyre.conv.widget.ui.WidgetComponent.prototype.highlightComment=function(a){goog.isDefAndNotNull(a)&&(this.permalinkStream.decorate(this.permalinkStreamEl_,!0),setTimeout(goog.bind(function(){this.isDisposed()||(this.stream.highlightComment(a,6E3),this.permalinkStream.start(a))},this),3E3))};
fyre.conv.widget.ui.WidgetComponent.prototype.disposeInternal=function(){fyre.conv.widget.ui.WidgetComponent.superClass_.disposeInternal.call(this);this.collection_&&(this.collection_.off(null,null,this),this.collection_=null);this.widgetEl_&&(this.widgetEl_=null);this.userViewEl_&&(this.userViewEl_=null);this.livecountEl_&&(this.livecountEl_=null);this.commentcountEl_&&(this.commentcountEl_=null);this.followerEl_&&(this.followerEl_=null);this.helperEl_&&(this.helperEl_=null);this.stream&&this.stream.dispose();
this.commentStreamEl_&&(this.commentStreamEl_=null);this.topContentStream&&this.topContentStream.dispose();this.topContentStreamEl_&&(this.topContentStreamEl_=null);this.permalinkStream&&this.permalinkStream.dispose();this.permalinkStreamEl_&&(this.permalinkStreamEl_=null);this.threadBreakoutStream&&this.threadBreakoutStream.dispose();this.threadBreakoutStreamEL_&&(this.threadBreakoutStreamEL_=null);this.editor&&this.editor.dispose();this.editorEl_&&(this.editorEl_=null);this.cssPoller_&&this.cssPoller_.dispose();
this.notifier&&this.notifier.dispose()};fyre.conv.widget.ui.WidgetComponent.prototype.removeBootstrapDom=function(a){var b=fyre.conv.widget.ui.WidgetComponent.CLASSES,c=goog.dom.getElementByClass(b.BOOTSTRAP,a);c||(c=goog.dom.getElementByClass(b.WRAPPER,a));c&&goog.dom.removeNode(c)};fyre.v2.controllers={};fyre.v2.controllers.ControllerBase=function(a){goog.Disposable.call(this);this.appContext=a;this.handler_=null};goog.inherits(fyre.v2.controllers.ControllerBase,goog.Disposable);fyre.v2.controllers.ControllerBase.prototype.disposeInternal=function(){fyre.v2.controllers.ControllerBase.superClass_.disposeInternal.call(this);this.handler_&&this.handler_.dispose()};
fyre.v2.controllers.ControllerBase.prototype.handle=function(a){this.handler_||(this.handler_=new goog.events.EventHandler(this));this.handleInternal(this.handler_,a)};fyre.v2.controllers.ControllerBase.prototype.handleInternal=function(){};fyre.conv.author.AuthorController=function(a){fyre.v2.controllers.ControllerBase.call(this,a)};goog.inherits(fyre.conv.author.AuthorController,fyre.v2.controllers.ControllerBase);fyre.conv.author.AuthorController.prototype.handleInternal=function(a,b){var c=fyre.conv.author.EVENTS;a.listen(b,c.AUTHOR_CLICK,this.onAuthorClick_);a.listen(b,c.AUTHOR_FETCH,this.onAuthorFetch_)};
fyre.conv.author.AuthorController.prototype.onAuthorClick_=function(a){var b=a.author;if(!b.isGuest()){var c=fyre.conv.model.Author.ATTRIBUTES,a=b.get(c.ID),c=b.get(c.PROFILE_URL),b=b.isCuratedAuthor();this.appContext.authenticationService.viewProfile({id:a,isCuratedAuthor:b,profileUrl:c})}};
fyre.conv.author.AuthorController.prototype.onAuthorFetch_=function(a){var b=a.author,c=a.errorCallback;this.appContext.contentService.fetchAuthorData(b.id,fyre.conv.author.AuthorAdapter.toFetchAuthorRequest(b),goog.bind(this.onAuthorFetchSuccess_,this,a),c||goog.nullFunction)};fyre.conv.author.AuthorController.prototype.onAuthorFetchSuccess_=function(a,b){var c=a.author,d=b.data,e=a.errorCallback||goog.nullFunction;goog.object.isEmpty(d)?e():c.set(fyre.conv.author.AuthorAdapter.fromFetchAuthorResponse(d))};fyre.conv.comment.CommentController=function(){fyre.v2.controllers.ControllerBase.call(this)};goog.inherits(fyre.conv.comment.CommentController,fyre.v2.controllers.ControllerBase);fyre.conv.comment.CommentController.prototype.handle=function(){fyre.conv.comment.CommentController.superClass_.handle.call(this)};fyre.conv.user.UserAdapter={};fyre.conv.user.UserAdapter.userToExternalDelegate=function(a){var b=fyre.conv.model.User.ATTRIBUTES;return{id:a.id,profileUrl:a.get(b.PROFILE_URL),displayName:a.get(b.DISPLAY_NAME)}};fyre.conv.user.UserController=function(a){fyre.v2.controllers.ControllerBase.call(this,a)};goog.inherits(fyre.conv.user.UserController,fyre.v2.controllers.ControllerBase);fyre.conv.user.UserController.prototype.handleInternal=function(a,b){var c=fyre.conv.user.VIEW_EVENTS;this.isExpired_()||(a.listen(b,c.LOGIN_CLICKED,this.handleLoginButtonClick_),a.listen(b,c.LOGOUT_CLICKED,this.handleLogoutButtonClick_),a.listen(b,c.PROFILE_CLICKED,this.handleProfileClick_),a.listen(b,c.EDIT_PROFILE_CLICKED,this.handleEditProfileClick_))};
fyre.conv.user.UserController.prototype.isExpired_=function(){var a=fyre.conv.user;return a.get(a.ATTRIBUTES.TOKEN_EXPIRED)};fyre.conv.user.UserController.prototype.handleLoginButtonClick_=function(){this.appContext.authenticationService.login(this.appContext.collectionService.collection())};fyre.conv.user.UserController.prototype.handleLogoutButtonClick_=function(){this.appContext.authenticationService.logout()};fyre.conv.user.UserController.prototype.handleProfileClick_=function(){this.appContext.authenticationService.viewProfile(fyre.conv.user.UserAdapter.userToExternalDelegate(fyre.conv.user))};
fyre.conv.user.UserController.prototype.handleEditProfileClick_=function(){this.appContext.authenticationService.editProfile(fyre.conv.user.UserAdapter.userToExternalDelegate(fyre.conv.user))};fyre.conv.stream.StreamController=function(a){fyre.v2.controllers.ControllerBase.call(this,a);this.contentPromises_=[]};goog.inherits(fyre.conv.stream.StreamController,fyre.v2.controllers.ControllerBase);fyre.conv.stream.StreamController.prototype.disposeInternal=function(){fyre.conv.stream.StreamController.superClass_.disposeInternal.call(this);this.clearPromises_()};
fyre.v2.controllers.ControllerBase.prototype.handleInternal=function(a,b){var c=fyre.conv.stream.EVENTS;a.listen(b,c.PAST_PERMALINK_INSERTED,this.handlePastPermalink_);a.listen(b,c.POST_COMMENT,this.handlePostComment_);a.listen(b,c.REPLIES_EXPANDED,this.handleExpandReplies_);a.listen(b,c.SHOW_MORE,this.handleShowMore_);a.listen(b,c.SORT_HOT_THREADS,this.handleSortByHotThreads_);a.listen(b,c.SORT_ORDER_CHANGED,this.handleSortOrderChanged_);a.listen(b,c.SORT_TOP_COMMENTS,this.handleSortByTopComments_);
a.listen(b,c.STREAM_REFRESH_CLICKED,this.handleRefreshClicked_);a.listen(b,c.STREAM_RENDERED,this.handleStreamRendered_);a.listen(b,c.THREAD_BREAKOUT,this.handleThreadBreakout_);this.source_=b};fyre.conv.stream.StreamController.prototype.clearPromises_=function(){for(var a;a=this.contentPromises_.shift();)a.off(null,null,this)};
fyre.conv.stream.StreamController.prototype.handleStreamRendered_=function(a){var b=a.target;b.clear();this.attachContentPromise(this.appContext.contentService.getInitialContent(a.direction),goog.bind(this.handleData,this,b))};fyre.conv.stream.StreamController.prototype.handleData=function(a,b){goog.object.isEmpty(b)||(this.handleContentObject(a,b),a.setShowMore());this.appContext.bus.trigger(fyre.conv.events.STREAM_VIEW_RESET)};
fyre.conv.stream.StreamController.prototype.handleContentObject=function(a,b){goog.object.forEach(b,goog.partial(this.handleContent,a),this)};
fyre.conv.stream.StreamController.prototype.handleContent=function(a,b){var c=b.transport==fyre.conv.service.STATE_ENUM_TRANSPORT.STREAM,d=b.transport!=fyre.conv.service.STATE_ENUM_TRANSPORT.BOOTSTRAP;switch(b.type){case fyre.conv.model.ContentState.ENUM_TYPE.MESSAGE:var e=this.appContext.collectionService.collection(),e=fyre.conv.model.Comment.fromState(b,e),f=e.get(fyre.conv.model.Comment.ATTRIBUTES.AUTHOR_ID),f=this.appContext.collectionService.authors().get(f);e.set(fyre.conv.model.Comment.ATTRIBUTES.AUTHOR,
f);a.handleMessage(e,c,d);break;case fyre.conv.model.ContentState.ENUM_TYPE.OPINE:a.handleOpine(fyre.conv.model.Opine.fromState(b),c,d);break;case fyre.conv.model.ContentState.ENUM_TYPE.OEMBED:a.handleMedia(fyre.conv.model.MessageMedia.fromState(b),c,d);break;default:goog.asserts.fail("Unrecognized content type")}};
fyre.conv.stream.StreamController.prototype.handleShowMore_=function(a){var b=this.appContext.contentService.getMoreContent(a.childModel,a.direction,50),c=goog.bind(a.target.showMoreComponent_.setRequestComplete,a.target.showMoreComponent_);if(b.get(b.ATTRIBUTES.BOOTSTRAP_REQUEST_COMPLETE))c();else b.on(b.attributeChangeEvent(b.ATTRIBUTES.BOOTSTRAP_REQUEST_COMPLETE),c,this);c=goog.bind(function(b){this.handleData(a.target,b);a.successCallback()},this);this.attachContentPromise(b,c,a.failureCallback)};
fyre.conv.stream.StreamController.prototype.handlePostComment_=function(a){this.activeStream_||(this.activeStream_=this.source_.stream);this.activeStream_!==this.source_.stream&&(this.source_.streamHeader.selectSortByNewest(),goog.object.extend(a,{stream:this.source_.stream,direction:fyre.v1.enums.content.direction.NEW,successCallback:goog.nullFunction}),this.handleSortOrderChanged_(a))};
fyre.conv.stream.StreamController.prototype.handleSortOrderChanged_=function(a){this.clearPromises_();this.appContext.contentService.disposeTopContentManager();this.activeStream_&&this.activeStream_.clear();a.stream.changeSortOrder(a.direction);this.activeStream_=a.stream;var b=this.appContext.contentService.getInitialContent(a.direction),c=goog.bind(function(b){a.successCallback();this.handleData(a.stream,b)},this);this.attachContentPromise(b,c,a.failureCallback)};
fyre.conv.stream.StreamController.prototype.handleSortByTopComments_=function(a){this.clearPromises_();a.stream.hide();a.stream.clear();this.activeStream_=a.topContentStream;this.attachContentPromise(this.appContext.contentService.getAggregateContent("likes"),goog.bind(function(b){a.successCallback();goog.object.isEmpty(b)?a.noDataCallback():this.handleData(a.topContentStream,b)},this))};
fyre.conv.stream.StreamController.prototype.handleSortByHotThreads_=function(a){this.clearPromises_();a.stream.hide();a.stream.clear();this.activeStream_&&this.activeStream_.clear();this.activeStream_=a.topContentStream;this.attachContentPromise(this.appContext.contentService.getHotThreads(),goog.bind(function(b){a.successCallback();goog.object.isEmpty(b)?a.noDataCallback():this.handleData(a.topContentStream,b)},this))};
fyre.conv.stream.StreamController.prototype.handleThreadBreakout_=function(a){if(this.activeStream_ instanceof fyre.conv.view.TopContentStreamView){this.clearPromises_();this.activeStream_.clear();a.threadBreakoutStream.hide();this.activeStream_=a.threadBreakoutStream;var b=!1;this.attachContentPromise(this.appContext.contentService.getThread(a.threadId,!1),goog.bind(function(c){a.successCallback();this.handleData(a.threadBreakoutStream,c);!b&&a.threadBreakoutStream.fadeInAndShow();b=!0},this))}else goog.asserts.fail("Thread breakouts are only available via the TopCommentStream")};
fyre.conv.stream.StreamController.prototype.attachContentPromise=function(a,b,c){this.contentPromises_.push(a);a.on(a.EVENTS.CONTENT_UPDATED,b,this);a.on(a.EVENTS.REQ_FAILED,c||goog.nullFunction,this);a.get(a.ATTRIBUTES.HAS_DATA)&&b(a.get(a.ATTRIBUTES.CONTENT))};
fyre.conv.stream.StreamController.prototype.handleRefreshClicked_=function(a){this.clearPromises_();this.attachContentPromise(this.appContext.contentService.getInitialContent(fyre.v1.enums.content.direction.NEW),goog.bind(this.handleData,this,a.target),a.successCallback)};
fyre.conv.stream.StreamController.prototype.handleExpandReplies_=function(a){var b=a.commentModel,c=fyre.conv.model.Comment.ATTRIBUTES,d=c.EXPANDING,e=c.HAS_BEEN_EXPANDED,f=c.DESCENDENT_COUNT;if(!b.get(e)){b.set(d,!0);var g=function(){b.set(f,a.threadContainer.visibleDescendents)},c=goog.bind(function(c){b.set(f,a.threadContainer.visibleDescendents,!1);b.set(e,!0);b.set(d,!1);this.handleContentObject(a.commentStreamView,c);this.handler_.listen(a.threadContainer,fyre.conv.view.ThreadContainer.EVENTS.THREAD_VIS_CHANGED,
g)},this),h=this.appContext.contentService.getRepliesFor(b);h.on(h.EVENTS.CONTENT_UPDATED,c,this);c(h.get(h.ATTRIBUTES.CONTENT))}};fyre.conv.stream.StreamController.prototype.handlePastPermalink_=function(a){var b=a.commentId,c=this.appContext.contentService.getContentThread(b,!0);c.on(c.EVENTS.REQ_COMPLETE,goog.partial(a.highlightComment,b),this);this.attachContentPromise(c,goog.bind(function(b){a.handleData(b);this.handleContentObject(a.target,b)},this))};fyre.conv.widget.DialogController=function(a){fyre.v2.controllers.ControllerBase.call(this,a)};goog.inherits(fyre.conv.widget.DialogController,fyre.v2.controllers.ControllerBase);fyre.conv.widget.DialogController.prototype.handleInternal=function(a,b){a.listen(b,fyre.conv.widget.dialog.EVENTS.FLAG_CONFIRMATION_MOBILE,this.onFlagConfirmationMobile_)};
fyre.conv.widget.DialogController.prototype.onFlagConfirmationMobile_=function(a){var b=fyre.conv.i18n.textEnumeration,c=b.get(b.KEYS.FLAG_CONFIRMATION_MESSAGE),d=a.data,e=a.data.flagType,a=goog.string.subs(c,a.flaggedAuthor,a.flagName),c=null;fyre.v1.util.browser.isMobile()&&!goog.userAgent.product.IPAD?c=window.confirm(a):this.showFlagConfirmationDialog_(a,e,b,d);c&&this.appContext.commentService.flagMessage(d)};
fyre.conv.widget.DialogController.prototype.showFlagConfirmationDialog_=function(a,b,c,d){var e=fyre.v1.ui.Dialog.getInstance(),a=fyre.templates.conv.comment.flagConfirmationDialogMobile({message:a,flagType:b});e.setContent(a);e.open();e.setButtonText(c.get(c.KEYS.FLAG_CONFIRM_BTN),c.get(c.KEYS.FLAG_CANCEL_BTN));e.handleOkClick(goog.bind(function(a){a.preventDefault();this.appContext.commentService.flagMessage(d)},this))};fyre.conv.editor.EditorController=function(a){fyre.v2.controllers.ControllerBase.call(this,a)};goog.inherits(fyre.conv.editor.EditorController,fyre.v2.controllers.ControllerBase);fyre.conv.editor.EditorController.prototype.handleInternal=function(a,b){a.listen(b,fyre.conv.editor.EVENTS.MEDIA_UPLOAD_CLICKED,this.handleMediaUploadClicked_)};fyre.conv.editor.EditorController.prototype.handleMediaUploadClicked_=function(a){this.appContext.mediaService.pickAndStore(a.successCallback)};fyre.conv.widget.WidgetController=function(a){goog.Disposable.call(this);this.handler_=new goog.events.EventHandler(this);this.appContext=a;a.collectionService.getOrCreateCollection();this.widgetComponent_=new fyre.conv.widget.ui.WidgetComponent(a);this.domWatcher_=new fyre.conv.widget.ui.DomWatcher(a.appOpts.el);this.handler_.listen(this.domWatcher_,fyre.conv.widget.ui.DomWatcher.EVENT.FOUND,this.onElementReady_);this.domWatcher_.start();this.authorController_=new fyre.conv.author.AuthorController(a);
this.authorController_.handle(this.widgetComponent_);this.dialogController_=new fyre.conv.widget.DialogController(a);this.dialogController_.handle(this.widgetComponent_);this.streamController_=new fyre.conv.stream.StreamController(a);this.streamController_.handle(this.widgetComponent_);this.userController_=new fyre.conv.user.UserController(a);this.userController_.handle(this.widgetComponent_);this.editorController_=new fyre.conv.editor.EditorController(a);this.editorController_.handle(this.widgetComponent_);
this.maybeRender_()};goog.inherits(fyre.conv.widget.WidgetController,goog.Disposable);fyre.conv.widget.WidgetController.prototype.element_=null;
fyre.conv.widget.WidgetController.prototype.disposeInternal=function(){this.appContext.isDisposed()&&goog.asserts.fail("Need to dispose the appContext after the widgetController");fyre.conv.widget.WidgetController.superClass_.disposeInternal.call(this);delete this.appContext;this.handler_.dispose();this.streamController_.dispose();this.authorController_.dispose();this.userController_.dispose();this.dialogController_.dispose();this.editorController_.dispose();this.domWatcher_.dispose();this.widgetComponent_.dispose();
this.widgetSpinner_&&this.widgetSpinner_.dispose();delete this.widgetSpinner_};fyre.conv.widget.WidgetController.prototype.stopStream=function(){this.appContext.streamService.stop()};fyre.conv.widget.WidgetController.prototype.stopLivecount=function(){this.appContext.livecountService.stop()};fyre.conv.widget.WidgetController.prototype.startStream=function(){this.appContext.streamService.start()};fyre.conv.widget.WidgetController.prototype.startLivecount=function(){this.appContext.livecountService.start()};
fyre.conv.widget.WidgetController.getCommentHashParam_=function(){var a=window.location.hash.substring(1);return(new goog.Uri.QueryData(a)).get(fyre.conv.app.CONSTANTS.COMMENT_QUERY_PARAM)||null};fyre.conv.widget.WidgetController.prototype.maybeRender_=function(){if(this.widgetComponent_&&this.widgetComponent_.isInDocument())return!1;if(!this.collectionLoaded_)return this.loadCollection_(),!1;if(this.element_&&this.widgetComponent_)return this.render_(),!0};
fyre.conv.widget.WidgetController.prototype.render_=function(){goog.asserts.assert(this.element_);goog.asserts.assert(this.collectionLoaded_);goog.asserts.assert(this.widgetComponent_);this.widgetSpinner_&&this.widgetSpinner_.dispose();this.widgetComponent_.render(this.element_);this.widgetComponent_.highlightComment(fyre.conv.widget.WidgetController.getCommentHashParam_());this.appContext.bus.trigger(fyre.conv.events.RENDER_COMPLETE)};
fyre.conv.widget.WidgetController.prototype.loadCollection_=function(){this.collectionLoading_||(this.appContext.collectionService.getCollection(goog.bind(this.onCollectionReady_,this)),this.collectionLoading_=!0)};fyre.conv.widget.WidgetController.prototype.onCollectionReady_=function(){!this.isDisposed()&&this.appContext&&(this.collectionLoaded_=!0,this.widgetComponent_.registerCollection(this.appContext,this.appContext.collectionService.collection()),this.maybeRender_())};
fyre.conv.widget.WidgetController.prototype.onElementReady_=function(a){!this.isDisposed()&&this.appContext&&(a=this.element_=a.el,this.widgetComponent_.removeBootstrapDom(a),this.maybeRender_()||(this.widgetSpinner_=new fyre.conv.widget.ui.WidgetSpinner,this.widgetSpinner_.render(a)),this.appContext.bus.trigger(fyre.conv.events.DOM_READY))};fyre.conv.app.Main=function(a){goog.Disposable.call(this);this.setOpts_(a);a=this.appOpts;this.CONSTANTS=fyre.conv.app.CONSTANTS;this.name=fyre.conv.app.CONSTANTS.NAME+"_"+goog.getUid(this);this.logger=fyre.v1.logging.getLogger(this.name);this.build_();var b=this.getExtern();a.callback&&a.callback(b)};goog.inherits(fyre.conv.app.Main,goog.Disposable);fyre.conv.app.Main.prototype.mainAppContext_=null;fyre.conv.app.Main.prototype.mainExternApp_=null;fyre.conv.app.Main.prototype.mainExternalBus_=null;
fyre.conv.app.Main.prototype.disposeInternal=function(){fyre.conv.app.Main.superClass_.disposeInternal.call(this);this.stop();delete this.appOpts;delete this.opts;this.disposeWidgetController_();this.disposeAppContext_();this.mainExternApp_&&(this.mainExternApp_.dispose(),delete this.mainExternApp_)};fyre.conv.app.Main.prototype.disposeWidgetController_=function(){this.widgetController_&&(this.widgetController_.dispose(),delete this.widgetController_)};
fyre.conv.app.Main.prototype.disposeAppContext_=function(){this.mainAppContext_&&(this.mainAppContext_.dispose(),delete this.mainAppContext_)};fyre.conv.app.Main.prototype.disposeExternalApp_=function(){this.mainExternalBus_&&(this.mainExternalBus_.dispose(),delete this.mainExternalBus_)};fyre.conv.app.Main.prototype.setOpts_=function(a){goog.asserts.assert(a);a=fyre.conv.app.MainAdapter.ingestOptions(a);goog.object.extend(a,{bootstrap:!0});this.opts=this.appOpts=a};
fyre.conv.app.Main.prototype.getAppContext=function(){if(this.mainAppContext_)return this.mainAppContext_;var a=new fyre.conv.app.MainAppContext(this.appOpts,this.name);return this.context=this.mainAppContext_=a};fyre.conv.app.Main.prototype.getExtern=function(){this.ensureExternalBus_();return this.mainExternApp_?this.mainExternApp_:this.mainExternApp_=new fyre.conv.app.ExternalApp(this)};
fyre.conv.app.Main.prototype.ensureExternalBus_=function(){if(this.mainExternalBus_)return this.mainExternalBus_.setAppContext(this.getAppContext()),this.mainExternalBus_;this.mainExternalBus_=new fyre.conv.app.ExternalBus;this.mainExternalBus_.setAppContext(this.getAppContext());return this.mainExternalBus_};fyre.conv.app.Main.prototype.build_=function(){var a=this.getAppContext();this.ensureExternalBus_();this.started=!0;this.widgetController_=new fyre.conv.widget.WidgetController(a)};
fyre.conv.app.Main.prototype.tearDown_=function(){this.stop();this.disposeWidgetController_();this.disposeAppContext_()};fyre.conv.app.Main.prototype.changeCollection=function(a){this.tearDown_();this.setOpts_(a);this.build_()};fyre.conv.app.Main.prototype.remove=function(){this.dispose()};fyre.conv.app.Main.prototype.resume=function(){this.started=!0;this.widgetController_.startStream();this.widgetController_.startLivecount()};
fyre.conv.app.Main.prototype.stop=function(){this.started=!1;this.widgetController_.stopLivecount();this.widgetController_.stopStream()};fyre.conv.app.Main.prototype.on=function(a,b,c){if(this.mainExternalBus_)this.mainExternalBus_.on(a,b,c)};
fyre.conv.app.Main.prototype.debug=function(){var a=fyre.v1.config.servers.assets+"/javascripts/livefyre_mod_debug.js",b=goog.bind(function(){fyre.debugApps=fyre.debugApps||{};fyre.debugApps[this.name]=this;fyre.debug?fyre.debug.refresh():fyre.debug=new fyre.conv.debug.Debug;this.context.debugService=new fyre.conv.service.DebugService(this.context)},this);fyre.v1.util.ScriptLoader.loadScript(a,null,null,b)};fyre.conv.modules.Modules=fyre.conv.modules.Modules||{};fyre.conv.modules.Modules[fyre.conv.modules.enums.NAMES.MAIN].ctor.callback(fyre.conv.app.Main);
